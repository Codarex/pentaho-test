
window.Modernizr=(function(window,document,undefined){var version='2.0.6',Modernizr={},enableClasses=true,docElement=document.documentElement,docHead=document.head||document.getElementsByTagName('head')[0],mod='modernizr',modElem=document.createElement(mod),mStyle=modElem.style,inputElem=document.createElement('input'),smile=':)',toString=Object.prototype.toString,prefixes=' -webkit- -moz- -o- -ms- -khtml- '.split(' '),domPrefixes='Webkit Moz O ms Khtml'.split(' '),ns={'svg':'http://www.w3.org/2000/svg'},tests={},inputs={},attrs={},classes=[],featureName,injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,div=document.createElement('div');if(parseInt(nodes,10)){while(nodes--){node=document.createElement('div');node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node);}}
style=['&shy;','<style>',rule,'</style>'].join('');div.id=mod;div.innerHTML+=style;docElement.appendChild(div);ret=callback(div,rule);div.parentNode.removeChild(div);return!!ret;},testMediaQuery=function(mq){if(window.matchMedia){return matchMedia(mq).matches;}
var bool;injectElementWithStyles('@media '+mq+' { #'+mod+' { position: absolute; } }',function(node){bool=(window.getComputedStyle?getComputedStyle(node,null):node.currentStyle)['position']=='absolute';});return bool;},isEventSupported=(function(){var TAGNAMES={'select':'input','change':'input','submit':'form','reset':'form','error':'img','load':'img','abort':'img'};function isEventSupported(eventName,element){element=element||document.createElement(TAGNAMES[eventName]||'div');eventName='on'+eventName;var isSupported=eventName in element;if(!isSupported){if(!element.setAttribute){element=document.createElement('div');}
if(element.setAttribute&&element.removeAttribute){element.setAttribute(eventName,'');isSupported=is(element[eventName],'function');if(!is(element[eventName],undefined)){element[eventName]=undefined;}
element.removeAttribute(eventName);}}
element=null;return isSupported;}
return isEventSupported;})();var _hasOwnProperty=({}).hasOwnProperty,hasOwnProperty;if(!is(_hasOwnProperty,undefined)&&!is(_hasOwnProperty.call,undefined)){hasOwnProperty=function(object,property){return _hasOwnProperty.call(object,property);};}
else{hasOwnProperty=function(object,property){return((property in object)&&is(object.constructor.prototype[property],undefined));};}
function setCss(str){mStyle.cssText=str;}
function setCssAll(str1,str2){return setCss(prefixes.join(str1+';')+(str2||''));}
function is(obj,type){return typeof obj===type;}
function contains(str,substr){return!!~(''+str).indexOf(substr);}
function testProps(props,prefixed){for(var i in props){if(mStyle[props[i]]!==undefined){return prefixed=='pfx'?props[i]:true;}}
return false;}
function testPropsAll(prop,prefixed){var ucProp=prop.charAt(0).toUpperCase()+prop.substr(1),props=(prop+' '+domPrefixes.join(ucProp+' ')+ucProp).split(' ');return testProps(props,prefixed);}
var testBundle=(function(styles,tests){var style=styles.join(''),len=tests.length;injectElementWithStyles(style,function(node,rule){var style=document.styleSheets[document.styleSheets.length-1],cssText=style.cssRules&&style.cssRules[0]?style.cssRules[0].cssText:style.cssText||"",children=node.childNodes,hash={};while(len--){hash[children[len].id]=children[len];}
Modernizr['touch']=('ontouchstart'in window)||hash['touch'].offsetTop===9;Modernizr['csstransforms3d']=hash['csstransforms3d'].offsetLeft===9;Modernizr['generatedcontent']=hash['generatedcontent'].offsetHeight>=1;Modernizr['fontface']=/src/i.test(cssText)&&cssText.indexOf(rule.split(' ')[0])===0;},len,tests);})(['@font-face {font-family:"font";src:url("https://")}',['@media (',prefixes.join('touch-enabled),('),mod,')','{#touch{top:9px;position:absolute}}'].join(''),['@media (',prefixes.join('transform-3d),('),mod,')','{#csstransforms3d{left:9px;position:absolute}}'].join(''),['#generatedcontent:after{content:"',smile,'";visibility:hidden}'].join('')],['fontface','touch','csstransforms3d','generatedcontent']);tests['flexbox']=function(){function setPrefixedValueCSS(element,property,value,extra){property+=':';element.style.cssText=(property+prefixes.join(value+';'+property)).slice(0,-property.length)+(extra||'');}
function setPrefixedPropertyCSS(element,property,value,extra){element.style.cssText=prefixes.join(property+':'+value+';')+(extra||'');}
var c=document.createElement('div'),elem=document.createElement('div');setPrefixedValueCSS(c,'display','box','width:42px;padding:0;');setPrefixedPropertyCSS(elem,'box-flex','1','width:10px;');c.appendChild(elem);docElement.appendChild(c);var ret=elem.offsetWidth===42;c.removeChild(elem);docElement.removeChild(c);return ret;};tests['canvas']=function(){var elem=document.createElement('canvas');return!!(elem.getContext&&elem.getContext('2d'));};tests['canvastext']=function(){return!!(Modernizr['canvas']&&is(document.createElement('canvas').getContext('2d').fillText,'function'));};tests['webgl']=function(){return!!window.WebGLRenderingContext;};tests['touch']=function(){return Modernizr['touch'];};tests['geolocation']=function(){return!!navigator.geolocation;};tests['postmessage']=function(){return!!window.postMessage;};tests['websqldatabase']=function(){var result=!!window.openDatabase;return result;};tests['indexedDB']=function(){for(var i=-1,len=domPrefixes.length;++i<len;){if(window[domPrefixes[i].toLowerCase()+'IndexedDB']){return true;}}
return!!window.indexedDB;};tests['hashchange']=function(){return isEventSupported('hashchange',window)&&(document.documentMode===undefined||document.documentMode>7);};tests['history']=function(){return!!(window.history&&history.pushState);};tests['draganddrop']=function(){return isEventSupported('dragstart')&&isEventSupported('drop');};tests['websockets']=function(){for(var i=-1,len=domPrefixes.length;++i<len;){if(window[domPrefixes[i]+'WebSocket']){return true;}}
return'WebSocket'in window;};tests['rgba']=function(){setCss('background-color:rgba(150,255,150,.5)');return contains(mStyle.backgroundColor,'rgba');};tests['hsla']=function(){setCss('background-color:hsla(120,40%,100%,.5)');return contains(mStyle.backgroundColor,'rgba')||contains(mStyle.backgroundColor,'hsla');};tests['multiplebgs']=function(){setCss('background:url(https://),url(https://),red url(https://)');return new RegExp(/(url\s*\(.*?){3}/).test(mStyle.background);};tests['backgroundsize']=function(){return testPropsAll('backgroundSize');};tests['borderimage']=function(){return testPropsAll('borderImage');};tests['borderradius']=function(){return testPropsAll('borderRadius');};tests['boxshadow']=function(){return testPropsAll('boxShadow');};tests['textshadow']=function(){return document.createElement('div').style.textShadow==='';};tests['opacity']=function(){setCssAll('opacity:.55');return/^0.55$/.test(mStyle.opacity);};tests['cssanimations']=function(){return testPropsAll('animationName');};tests['csscolumns']=function(){return testPropsAll('columnCount');};tests['cssgradients']=function(){var str1='background-image:',str2='gradient(linear,left top,right bottom,from(#9f9),to(white));',str3='linear-gradient(left top,#9f9, white);';setCss((str1+prefixes.join(str2+str1)+prefixes.join(str3+str1)).slice(0,-str1.length));return contains(mStyle.backgroundImage,'gradient');};tests['cssreflections']=function(){return testPropsAll('boxReflect');};tests['csstransforms']=function(){return!!testProps(['transformProperty','WebkitTransform','MozTransform','OTransform','msTransform']);};tests['csstransforms3d']=function(){var ret=!!testProps(['perspectiveProperty','WebkitPerspective','MozPerspective','OPerspective','msPerspective']);if(ret&&'webkitPerspective'in docElement.style){ret=Modernizr['csstransforms3d'];}
return ret;};tests['csstransitions']=function(){return testPropsAll('transitionProperty');};tests['fontface']=function(){return Modernizr['fontface'];};tests['generatedcontent']=function(){return Modernizr['generatedcontent'];};tests['video']=function(){var elem=document.createElement('video'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('video/ogg; codecs="theora"');var h264='video/mp4; codecs="avc1.42E01E';bool.h264=elem.canPlayType(h264+'"')||elem.canPlayType(h264+', mp4a.40.2"');bool.webm=elem.canPlayType('video/webm; codecs="vp8, vorbis"');}}catch(e){}
return bool;};tests['audio']=function(){var elem=document.createElement('audio'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('audio/ogg; codecs="vorbis"');bool.mp3=elem.canPlayType('audio/mpeg;');bool.wav=elem.canPlayType('audio/wav; codecs="1"');bool.m4a=elem.canPlayType('audio/x-m4a;')||elem.canPlayType('audio/aac;');}}catch(e){}
return bool;};tests['localstorage']=function(){try{return!!localStorage.getItem;}catch(e){return false;}};tests['sessionstorage']=function(){try{return!!sessionStorage.getItem;}catch(e){return false;}};tests['webworkers']=function(){return!!window.Worker;};tests['applicationcache']=function(){return!!window.applicationCache;};tests['svg']=function(){return!!document.createElementNS&&!!document.createElementNS(ns.svg,'svg').createSVGRect;};tests['inlinesvg']=function(){var div=document.createElement('div');div.innerHTML='<svg/>';return(div.firstChild&&div.firstChild.namespaceURI)==ns.svg;};tests['smil']=function(){return!!document.createElementNS&&/SVG/.test(toString.call(document.createElementNS(ns.svg,'animate')));};tests['svgclippaths']=function(){return!!document.createElementNS&&/SVG/.test(toString.call(document.createElementNS(ns.svg,'clipPath')));};function webforms(){Modernizr['input']=(function(props){for(var i=0,len=props.length;i<len;i++){attrs[props[i]]=!!(props[i]in inputElem);}
return attrs;})('autocomplete autofocus list placeholder max min multiple pattern required step'.split(' '));Modernizr['inputtypes']=(function(props){for(var i=0,bool,inputElemType,defaultView,len=props.length;i<len;i++){inputElem.setAttribute('type',inputElemType=props[i]);bool=inputElem.type!=='text';if(bool){inputElem.value=smile;inputElem.style.cssText='position:absolute;visibility:hidden;';if(/^range$/.test(inputElemType)&&inputElem.style.WebkitAppearance!==undefined){docElement.appendChild(inputElem);defaultView=document.defaultView;bool=defaultView.getComputedStyle&&defaultView.getComputedStyle(inputElem,null).WebkitAppearance!=='textfield'&&(inputElem.offsetHeight!==0);docElement.removeChild(inputElem);}else if(/^(search|tel)$/.test(inputElemType)){}else if(/^(url|email)$/.test(inputElemType)){bool=inputElem.checkValidity&&inputElem.checkValidity()===false;}else if(/^color$/.test(inputElemType)){docElement.appendChild(inputElem);docElement.offsetWidth;bool=inputElem.value!=smile;docElement.removeChild(inputElem);}else{bool=inputElem.value!=smile;}}
inputs[props[i]]=!!bool;}
return inputs;})('search tel url email datetime date month week time datetime-local number range color'.split(' '));}
for(var feature in tests){if(hasOwnProperty(tests,feature)){featureName=feature.toLowerCase();Modernizr[featureName]=tests[feature]();classes.push((Modernizr[featureName]?'':'no-')+featureName);}}
Modernizr.input||webforms();Modernizr.addTest=function(feature,test){if(typeof feature=="object"){for(var key in feature){if(hasOwnProperty(feature,key)){Modernizr.addTest(key,feature[key]);}}}else{feature=feature.toLowerCase();if(Modernizr[feature]!==undefined){return;}
test=typeof test=="boolean"?test:!!test();docElement.className+=' '+(test?'':'no-')+feature;Modernizr[feature]=test;}
return Modernizr;};setCss('');modElem=inputElem=null;if(window.attachEvent&&(function(){var elem=document.createElement('div');elem.innerHTML='<elem></elem>';return elem.childNodes.length!==1;})()){(function(win,doc){win.iepp=win.iepp||{};var iepp=win.iepp,elems=iepp.html5elements||'abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video',elemsArr=elems.split('|'),elemsArrLen=elemsArr.length,elemRegExp=new RegExp('(^|\\s)('+elems+')','gi'),tagRegExp=new RegExp('<(\/*)('+elems+')','gi'),filterReg=/^\s*[\{\}]\s*$/,ruleRegExp=new RegExp('(^|[^\\n]*?\\s)('+elems+')([^\\n]*)({[\\n\\w\\W]*?})','gi'),docFrag=doc.createDocumentFragment(),html=doc.documentElement,head=html.firstChild,bodyElem=doc.createElement('body'),styleElem=doc.createElement('style'),printMedias=/print|all/,body;function shim(doc){var a=-1;while(++a<elemsArrLen)
doc.createElement(elemsArr[a]);}
iepp.getCSS=function(styleSheetList,mediaType){if(styleSheetList+''===undefined){return'';}
var a=-1,len=styleSheetList.length,styleSheet,cssTextArr=[];while(++a<len){styleSheet=styleSheetList[a];if(styleSheet.disabled){continue;}
mediaType=styleSheet.media||mediaType;if(printMedias.test(mediaType))cssTextArr.push(iepp.getCSS(styleSheet.imports,mediaType),styleSheet.cssText);mediaType='all';}
return cssTextArr.join('');};iepp.parseCSS=function(cssText){var cssTextArr=[],rule;while((rule=ruleRegExp.exec(cssText))!=null){cssTextArr.push(((filterReg.exec(rule[1])?'\n':rule[1])+rule[2]+rule[3]).replace(elemRegExp,'$1.iepp_$2')+rule[4]);}
return cssTextArr.join('\n');};iepp.writeHTML=function(){var a=-1;body=body||doc.body;while(++a<elemsArrLen){var nodeList=doc.getElementsByTagName(elemsArr[a]),nodeListLen=nodeList.length,b=-1;while(++b<nodeListLen)
if(nodeList[b].className.indexOf('iepp_')<0)
nodeList[b].className+=' iepp_'+elemsArr[a];}
docFrag.appendChild(body);html.appendChild(bodyElem);bodyElem.className=body.className;bodyElem.id=body.id;bodyElem.innerHTML=body.innerHTML.replace(tagRegExp,'<$1font');};iepp._beforePrint=function(){styleElem.styleSheet.cssText=iepp.parseCSS(iepp.getCSS(doc.styleSheets,'all'));iepp.writeHTML();};iepp.restoreHTML=function(){bodyElem.innerHTML='';html.removeChild(bodyElem);html.appendChild(body);};iepp._afterPrint=function(){iepp.restoreHTML();styleElem.styleSheet.cssText='';};shim(doc);shim(docFrag);if(iepp.disablePP){return;}
head.insertBefore(styleElem,head.firstChild);styleElem.media='print';styleElem.className='iepp-printshim';win.attachEvent('onbeforeprint',iepp._beforePrint);win.attachEvent('onafterprint',iepp._afterPrint);})(window,document);}
Modernizr._version=version;Modernizr._prefixes=prefixes;Modernizr._domPrefixes=domPrefixes;Modernizr.mq=testMediaQuery;Modernizr.hasEvent=isEventSupported;Modernizr.testProp=function(prop){return testProps([prop]);};Modernizr.testAllProps=testPropsAll;Modernizr.testStyles=injectElementWithStyles;Modernizr.prefixed=function(prop){return testPropsAll(prop,'pfx');};docElement.className=docElement.className.replace(/\bno-js\b/,'')
+(enableClasses?' js '+classes.join(' '):'');return Modernizr;})(this,this.document);(function(window,undefined){var document=window.document,navigator=window.navigator,location=window.location;var jQuery=(function(){var jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery);},_jQuery=window.jQuery,_$=window.$,rootjQuery,quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rnotwhite=/\S/,trimLeft=/^\s+/,trimRight=/\s+$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,rdashAlpha=/-([a-z]|[0-9])/ig,rmsPrefix=/^-ms-/,fcamelCase=function(all,letter){return(letter+"").toUpperCase();},userAgent=navigator.userAgent,browserMatch,readyList,DOMContentLoaded,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,push=Array.prototype.push,slice=Array.prototype.slice,trim=String.prototype.trim,indexOf=Array.prototype.indexOf,class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this;}
if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}
if(selector==="body"&&!context&&document.body){this.context=document;this[0]=document.body;this.selector=selector;this.length=1;return this;}
if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=quickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context?context.ownerDocument||context:document);ret=rsingleTag.exec(selector);if(ret){if(jQuery.isPlainObject(context)){selector=[document.createElement(ret[1])];jQuery.fn.attr.call(selector,context,true);}else{selector=[doc.createElement(ret[1])];}}else{ret=jQuery.buildFragment([match[1]],[doc]);selector=(ret.cacheable?jQuery.clone(ret.fragment):ret.fragment).childNodes;}
return jQuery.merge(this,selector);}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||rootjQuery).find(selector);}else{return this.constructor(context).find(selector);}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length;},toArray:function(){return slice.call(this,0);},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num]);},pushStack:function(elems,name,selector){var ret=this.constructor();if(jQuery.isArray(elems)){push.apply(ret,elems);}else{jQuery.merge(ret,elems);}
ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector;}else if(name){ret.selector=this.selector+"."+name+"("+selector+")";}
return ret;},each:function(callback,args){return jQuery.each(this,callback,args);},ready:function(fn){jQuery.bindReady();readyList.add(fn);return this;},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){return this.pushStack(slice.apply(this,arguments),"slice",slice.call(arguments).join(","));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},end:function(){return this.prevObject||this.constructor(null);},push:push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===i){target=this;--i;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if((wait===true&&!--jQuery.readyWait)||(wait!==true&&!jQuery.isReady)){if(!document.body){return setTimeout(jQuery.ready,1);}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.fireWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready");}}},bindReady:function(){if(readyList){return;}
readyList=jQuery.Callbacks("once memory");if(document.readyState==="complete"){return setTimeout(jQuery.ready,1);}
if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false);}else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var toplevel=false;try{toplevel=window.frameElement==null;}catch(e){}
if(document.documentElement.doScroll&&toplevel){doScrollCheck();}}},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj&&typeof obj==="object"&&"setInterval"in obj;},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);},type:function(obj){return obj==null?String(obj):class2type[toString.call(obj)]||"object";},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
var key;for(key in obj){}
return key===undefined||hasOwn.call(obj,key);},isEmptyObject:function(obj){for(var name in obj){return false;}
return true;},error:function(msg){throw new Error(msg);},parseJSON:function(data){if(typeof data!=="string"||!data){return null;}
data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}
jQuery.error("Invalid JSON: "+data);},parseXML:function(data){var xml,tmp;try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;},noop:function(){},globalEval:function(data){if(data&&rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase();},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||jQuery.isFunction(object);if(args){if(isObj){for(name in object){if(callback.apply(object[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break;}}}}else{if(isObj){for(name in object){if(callback.call(object[name],name,object[name])===false){break;}}}else{for(;i<length;){if(callback.call(object[i],i,object[i++])===false){break;}}}}
return object;},trim:trim?function(text){return text==null?"":trim.call(text);}:function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"");},makeArray:function(array,results){var ret=results||[];if(array!=null){var type=jQuery.type(array);if(array.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(array)){push.call(ret,array);}else{jQuery.merge(ret,array);}}
return ret;},inArray:function(elem,array,i){var len;if(array){if(indexOf){return indexOf.call(array,elem,i);}
len=array.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in array&&array[i]===elem){return i;}}}
return-1;},merge:function(first,second){var i=first.length,j=0;if(typeof second.length==="number"){for(var l=second.length;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,inv){var ret=[],retVal;inv=!!inv;for(var i=0,length=elems.length;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i]);}}
return ret;},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value;}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value;}}}
return ret.concat.apply([],ret);},guid:1,proxy:function(fn,context){if(typeof context==="string"){var tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
var args=slice.call(arguments,2),proxy=function(){return fn.apply(context,args.concat(slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++;return proxy;},access:function(elems,key,value,exec,fn,pass){var length=elems.length;if(typeof key==="object"){for(var k in key){jQuery.access(elems,k,key[k],exec,fn,value);}
return elems;}
if(value!==undefined){exec=!pass&&exec&&jQuery.isFunction(value);for(var i=0;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);}
return elems;}
return length?fn(elems[0],key):undefined;},now:function(){return(new Date()).getTime();},uaMatch:function(ua){ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};},sub:function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context);}
jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context);}
return jQuery.fn.init.call(this,selector,context,rootjQuerySub);};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub;},browser:{}});jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});browserMatch=jQuery.uaMatch(userAgent);if(browserMatch.browser){jQuery.browser[browserMatch.browser]=true;jQuery.browser.version=browserMatch.version;}
if(jQuery.browser.webkit){jQuery.browser.safari=true;}
if(rnotwhite.test("\xA0")){trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
rootjQuery=jQuery(document);if(document.addEventListener){DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready();};}else if(document.attachEvent){DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready();}};}
function doScrollCheck(){if(jQuery.isReady){return;}
try{document.documentElement.doScroll("left");}catch(e){setTimeout(doScrollCheck,1);return;}
jQuery.ready();}
return jQuery;})();var flagsCache={};function createFlags(flags){var object=flagsCache[flags]={},i,length;flags=flags.split(/\s+/);for(i=0,length=flags.length;i<length;i++){object[flags[i]]=true;}
return object;}
jQuery.Callbacks=function(flags){flags=flags?(flagsCache[flags]||createFlags(flags)):{};var
list=[],stack=[],memory,firing,firingStart,firingLength,firingIndex,add=function(args){var i,length,elem,type,actual;for(i=0,length=args.length;i<length;i++){elem=args[i];type=jQuery.type(elem);if(type==="array"){add(elem);}else if(type==="function"){if(!flags.unique||!self.has(elem)){list.push(elem);}}}},fire=function(context,args){args=args||[];memory=!flags.memory||[context,args];firing=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(context,args)===false&&flags.stopOnFalse){memory=true;break;}}
firing=false;if(list){if(!flags.once){if(stack&&stack.length){memory=stack.shift();self.fireWith(memory[0],memory[1]);}}else if(memory===true){self.disable();}else{list=[];}}},self={add:function(){if(list){var length=list.length;add(arguments);if(firing){firingLength=list.length;}else if(memory&&memory!==true){firingStart=length;fire(memory[0],memory[1]);}}
return this;},remove:function(){if(list){var args=arguments,argIndex=0,argLength=args.length;for(;argIndex<argLength;argIndex++){for(var i=0;i<list.length;i++){if(args[argIndex]===list[i]){if(firing){if(i<=firingLength){firingLength--;if(i<=firingIndex){firingIndex--;}}}
list.splice(i--,1);if(flags.unique){break;}}}}}
return this;},has:function(fn){if(list){var i=0,length=list.length;for(;i<length;i++){if(fn===list[i]){return true;}}}
return false;},empty:function(){list=[];return this;},disable:function(){list=stack=memory=undefined;return this;},disabled:function(){return!list;},lock:function(){stack=undefined;if(!memory||memory===true){self.disable();}
return this;},locked:function(){return!stack;},fireWith:function(context,args){if(stack){if(firing){if(!flags.once){stack.push([context,args]);}}else if(!(flags.once&&memory)){fire(context,args);}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!memory;}};return self;};var
sliceDeferred=[].slice;jQuery.extend({Deferred:function(func){var doneList=jQuery.Callbacks("once memory"),failList=jQuery.Callbacks("once memory"),progressList=jQuery.Callbacks("memory"),state="pending",lists={resolve:doneList,reject:failList,notify:progressList},promise={done:doneList.add,fail:failList.add,progress:progressList.add,state:function(){return state;},isResolved:doneList.fired,isRejected:failList.fired,then:function(doneCallbacks,failCallbacks,progressCallbacks){deferred.done(doneCallbacks).fail(failCallbacks).progress(progressCallbacks);return this;},always:function(){deferred.done.apply(deferred,arguments).fail.apply(deferred,arguments);return this;},pipe:function(fnDone,fnFail,fnProgress){return jQuery.Deferred(function(newDefer){jQuery.each({done:[fnDone,"resolve"],fail:[fnFail,"reject"],progress:[fnProgress,"notify"]},function(handler,data){var fn=data[0],action=data[1],returned;if(jQuery.isFunction(fn)){deferred[handler](function(){returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().then(newDefer.resolve,newDefer.reject,newDefer.notify);}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned]);}});}else{deferred[handler](newDefer[action]);}});}).promise();},promise:function(obj){if(obj==null){obj=promise;}else{for(var key in promise){obj[key]=promise[key];}}
return obj;}},deferred=promise.promise({}),key;for(key in lists){deferred[key]=lists[key].fire;deferred[key+"With"]=lists[key].fireWith;}
deferred.done(function(){state="resolved";},failList.disable,progressList.lock).fail(function(){state="rejected";},doneList.disable,progressList.lock);if(func){func.call(deferred,deferred);}
return deferred;},when:function(firstParam){var args=sliceDeferred.call(arguments,0),i=0,length=args.length,pValues=new Array(length),count=length,pCount=length,deferred=length<=1&&firstParam&&jQuery.isFunction(firstParam.promise)?firstParam:jQuery.Deferred(),promise=deferred.promise();function resolveFunc(i){return function(value){args[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;if(!(--count)){deferred.resolveWith(deferred,args);}};}
function progressFunc(i){return function(value){pValues[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;deferred.notifyWith(promise,pValues);};}
if(length>1){for(;i<length;i++){if(args[i]&&args[i].promise&&jQuery.isFunction(args[i].promise)){args[i].promise().then(resolveFunc(i),deferred.reject,progressFunc(i));}else{--count;}}
if(!count){deferred.resolveWith(deferred,args);}}else if(deferred!==firstParam){deferred.resolveWith(deferred,length?[firstParam]:[]);}
return promise;}});jQuery.support=(function(){var support,all,a,select,opt,input,marginDiv,fragment,tds,events,eventName,i,isSupported,div=document.createElement("div"),documentElement=document.documentElement;div.setAttribute("className","t");div.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!all.length||!a){return{};}
select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.55/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test;}catch(e){support.deleteExpando=false;}
if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",function(){support.noCloneEvent=false;});div.cloneNode(true).fireEvent("onclick");}
input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);div.innerHTML="";if(window.getComputedStyle){marginDiv=document.createElement("div");marginDiv.style.width="0";marginDiv.style.marginRight="0";div.style.width="2px";div.appendChild(marginDiv);support.reliableMarginRight=(parseInt((window.getComputedStyle(marginDiv,null)||{marginRight:0}).marginRight,10)||0)===0;}
if(div.attachEvent){for(i in{submit:1,change:1,focusin:1}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function");}
support[i+"Bubbles"]=isSupported;}}
fragment.removeChild(div);fragment=select=opt=marginDiv=div=input=null;jQuery(function(){var container,outer,inner,table,td,offsetSupport,conMarginTop,ptlm,vb,style,html,body=document.getElementsByTagName("body")[0];if(!body){return;}
conMarginTop=1;ptlm="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;";vb="visibility:hidden;border:0;";style="style='"+ptlm+"border:5px solid #000;padding:0;'";html="<div "+style+"><div></div></div>"+"<table "+style+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";container=document.createElement("div");container.style.cssText=vb+"width:0;height:0;position:static;top:0;margin-top:"+conMarginTop+"px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.width=div.style.paddingLeft="1px";jQuery.boxModel=support.boxModel=div.offsetWidth===2;if(typeof div.style.zoom!=="undefined"){div.style.display="inline";div.style.zoom=1;support.inlineBlockNeedsLayout=(div.offsetWidth===2);div.style.display="";div.innerHTML="<div style='width:4px;'></div>";support.shrinkWrapBlocks=(div.offsetWidth!==2);}
div.style.cssText=ptlm+vb;div.innerHTML=html;outer=div.firstChild;inner=outer.firstChild;td=outer.nextSibling.firstChild.firstChild;offsetSupport={doesNotAddBorder:(inner.offsetTop!==5),doesAddBorderForTableAndCells:(td.offsetTop===5)};inner.style.position="fixed";inner.style.top="20px";offsetSupport.fixedPosition=(inner.offsetTop===20||inner.offsetTop===15);inner.style.position=inner.style.top="";outer.style.overflow="hidden";outer.style.position="relative";offsetSupport.subtractsBorderForOverflowNotVisible=(inner.offsetTop===-5);offsetSupport.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==conMarginTop);body.removeChild(container);div=container=null;jQuery.extend(support,offsetSupport);});return support;})();var rbrace=/^(?:\{.*\}|\[.*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{"embed":true,"object":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000","applet":true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return;}
var privateCache,thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey,isEvents=name==="events";if((!id||!cache[id]||(!isEvents&&!pvt&&!cache[id].data))&&getByName&&data===undefined){return;}
if(!id){if(isNode){elem[internalKey]=id=++jQuery.uuid;}else{id=internalKey;}}
if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop;}}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
privateCache=thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(isEvents&&!thisCache[name]){return privateCache.events;}
if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,i,l,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:internalKey;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}
for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]];}
if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(jQuery.support.deleteExpando||!cache.setInterval){delete cache[id];}else{cache[id]=null;}
if(isNode){if(jQuery.support.deleteExpando){delete elem[internalKey];}else if(elem.removeAttribute){elem.removeAttribute(internalKey);}else{elem[internalKey]=null;}}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true);},acceptData:function(elem){if(elem.nodeName){var match=jQuery.noData[elem.nodeName.toLowerCase()];if(match){return!(match===true||elem.getAttribute("classid")!==match);}}
return true;}});jQuery.fn.extend({data:function(key,value){var parts,attr,name,data=null;if(typeof key==="undefined"){if(this.length){data=jQuery.data(this[0]);if(this[0].nodeType===1&&!jQuery._data(this[0],"parsedAttrs")){attr=this[0].attributes;for(var i=0,l=attr.length;i<l;i++){name=attr[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.substring(5));dataAttr(this[0],name,data[name]);}}
jQuery._data(this[0],"parsedAttrs",true);}}
return data;}else if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
parts=key.split(".");parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);if(data===undefined&&this.length){data=jQuery.data(this[0],key);data=dataAttr(this[0],key,data);}
return data===undefined&&parts[1]?this.data(parts[0]):data;}else{return this.each(function(){var self=jQuery(this),args=[parts[0],value];self.triggerHandler("setData"+parts[1]+"!",args);jQuery.data(this,key,value);self.triggerHandler("changeData"+parts[1]+"!",args);});}},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:jQuery.isNumeric(data)?parseFloat(data):rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){for(var name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
function handleQueueMarkDefer(elem,type,src){var deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",defer=jQuery._data(elem,deferDataKey);if(defer&&(src==="queue"||!jQuery._data(elem,queueDataKey))&&(src==="mark"||!jQuery._data(elem,markDataKey))){setTimeout(function(){if(!jQuery._data(elem,queueDataKey)&&!jQuery._data(elem,markDataKey)){jQuery.removeData(elem,deferDataKey,true);defer.fire();}},0);}}
jQuery.extend({_mark:function(elem,type){if(elem){type=(type||"fx")+"mark";jQuery._data(elem,type,(jQuery._data(elem,type)||0)+1);}},_unmark:function(force,elem,type){if(force!==true){type=elem;elem=force;force=false;}
if(elem){type=type||"fx";var key=type+"mark",count=force?0:((jQuery._data(elem,key)||1)-1);if(count){jQuery._data(elem,key,count);}else{jQuery.removeData(elem,key,true);handleQueueMarkDefer(elem,type,"mark");}}},queue:function(elem,type,data){var q;if(elem){type=(type||"fx")+"queue";q=jQuery._data(elem,type);if(data){if(!q||jQuery.isArray(data)){q=jQuery._data(elem,type,jQuery.makeArray(data));}else{q.push(data);}}
return q||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),fn=queue.shift(),hooks={};if(fn==="inprogress"){fn=queue.shift();}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
jQuery._data(elem,type+".run",hooks);fn.call(elem,function(){jQuery.dequeue(elem,type);},hooks);}
if(!queue.length){jQuery.removeData(elem,type+"queue "+type+".run",true);handleQueueMarkDefer(elem,type,"queue");}}});jQuery.fn.extend({queue:function(type,data){if(typeof type!=="string"){data=type;type="fx";}
if(data===undefined){return jQuery.queue(this[0],type);}
return this.each(function(){var queue=jQuery.queue(this,type,data);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout);};});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,object){if(typeof type!=="string"){object=type;type=undefined;}
type=type||"fx";var defer=jQuery.Deferred(),elements=this,i=elements.length,count=1,deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",tmp;function resolve(){if(!(--count)){defer.resolveWith(elements,[elements]);}}
while(i--){if((tmp=jQuery.data(elements[i],deferDataKey,undefined,true)||(jQuery.data(elements[i],queueDataKey,undefined,true)||jQuery.data(elements[i],markDataKey,undefined,true))&&jQuery.data(elements[i],deferDataKey,jQuery.Callbacks("once memory"),true))){count++;tmp.add(resolve);}}
resolve();return defer.promise();}});var rclass=/[\n\t\r]/g,rspace=/\s+/,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea)?$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,nodeHook,boolHook,fixSpecified;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,name,value,true,jQuery.attr);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});},prop:function(name,value){return jQuery.access(this,name,value,true,jQuery.prop);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className));});}
if(value&&typeof value==="string"){classNames=value.split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value;}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(!~setClass.indexOf(" "+classNames[c]+" ")){setClass+=classNames[c]+" ";}}
elem.className=jQuery.trim(setClass);}}}}
return this;},removeClass:function(value){var classNames,i,l,elem,className,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className));});}
if((value&&typeof value==="string")||value===undefined){classNames=(value||"").split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){if(value){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ");}
elem.className=jQuery.trim(className);}else{elem.className="";}}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal);});}
return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className);}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className);}
this.className=this.className||value===false?"":jQuery._data(this,"__className__")||"";}});},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>-1){return true;}}
return false;},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.nodeName.toLowerCase()]||jQuery.valHooks[elem.type];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var self=jQuery(this),val;if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,self.val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.nodeName.toLowerCase()]||jQuery.valHooks[this.type];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text;}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0){return null;}
i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
if(one&&!values.length&&options.length){return jQuery(options[index]).val();}
return values;},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0;});if(!values.length){elem.selectedIndex=-1;}
return values;}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
if(pass&&name in jQuery.attrFn){return jQuery(elem)[name](value);}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{elem.setAttribute(name,""+value);return value;}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret;}else{ret=elem.getAttribute(name);return ret===null?undefined:ret;}},removeAttr:function(elem,value){var propName,attrNames,name,l,i=0;if(value&&elem.nodeType===1){attrNames=value.toLowerCase().split(rspace);l=attrNames.length;for(;i<l;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;jQuery.attr(elem,name,"");elem.removeAttribute(getSetAttribute?name:propName);if(rboolean.test(name)&&propName in elem){elem[propName]=false;}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed");}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name);}
return name in elem?elem.value:null;},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name);}
elem.value=value;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{return(elem[name]=value);}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}else{return elem[name];}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined;}}}});jQuery.attrHooks.tabindex=jQuery.propHooks.tabIndex;boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined;},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name);}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true;}
elem.setAttribute(name,name.toLowerCase());}
return name;}};if(!getSetAttribute){fixSpecified={name:true,id:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.nodeValue!=="":ret.specified)?ret.nodeValue:undefined;},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret);}
return(ret.nodeValue=value+"");}};jQuery.attrHooks.tabindex.set=nodeHook.set;jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}});});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false";}
nodeHook.set(elem,value,name);}};}
if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret;}});});}
if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined;},set:function(elem,value){return(elem.style.cssText=""+value);}};}
if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;}});}
if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding";}
if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value;}};});}
jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0);}}});});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*)?(?:\.(.+))?$/,rhoverHack=/\bhover(\.\S+)?\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rquickIs=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,quickParse=function(selector){var quick=rquickIs.exec(selector);if(quick){quick[1]=(quick[1]||"").toLowerCase();quick[3]=quick[3]&&new RegExp("(?:^|\\s)"+quick[3]+"(?:\\s|$)");}
return quick;},quickIs=function(elem,m){var attrs=elem.attributes||{};return((!m[1]||elem.nodeName.toLowerCase()===m[1])&&(!m[2]||(attrs.id||{}).value===m[2])&&(!m[3]||m[3].test((attrs["class"]||{}).value)));},hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1");};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,quick,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;}
if(!handler.guid){handler.guid=jQuery.guid++;}
events=elemData.events;if(!events){elemData.events=events={};}
eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,quick:quickParse(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},global:{},remove:function(elem,types,handler,selector,mappedTypes){var elemData=jQuery.hasData(elem)&&jQuery._data(elem),t,tns,type,origType,namespaces,origCount,j,events,special,handle,eventType,handleObj;if(!elemData||!(events=elemData.events)){return;}
types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){handle=elemData.handle;if(handle){handle.elem=null;}
jQuery.removeData(elem,["events","handle"],true);}},customEvent:{"getData":true,"setData":true,"changeData":true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return;}
var type=event.type||event,namespaces=[],cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType;if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true;}
if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return;}
event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true);}}
return;}
event.result=undefined;if(!event.target){event.target=elem;}
data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return;}
eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;old=null;for(;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur;}
if(old&&old===elem.ownerDocument){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType]);}}
for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply(cur,data)===false){event.preventDefault();}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null;}
jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event||window.event);var handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=[].slice.call(arguments,0),run_all=!event.exclusive&&!event.namespace,handlerQueue=[],i,j,cur,jqcur,ret,selMatch,matched,matches,handleObj,sel,related;args[0]=event;event.delegateTarget=this;if(delegateCount&&!event.target.disabled&&!(event.button&&event.type==="click")){jqcur=jQuery(this);jqcur.context=this.ownerDocument||this;for(cur=event.target;cur!=this;cur=cur.parentNode||this){selMatch={};matches=[];jqcur[0]=cur;for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=(handleObj.quick?quickIs(cur,handleObj.quick):jqcur.is(sel));}
if(selMatch[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,matches:matches});}}}
if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});}
for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}}}
return event.result;},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
if(event.metaKey===undefined){event.metaKey=event.ctrlKey;}
return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{ready:{setup:jQuery.bindReady},load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle;}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null;}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem);}else{jQuery.event.dispatch.call(elem,e);}
if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false);}}:function(elem,type,handle){if(elem.detachEvent){elem.detachEvent("on"+type,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};function returnFalse(){return false;}
function returnTrue(){return true;}
jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector,ret;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!form._submit_attached){jQuery.event.add(form,"submit._submit",function(event){if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true);}});form._submit_attached=true;}});},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true;}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;jQuery.event.simulate("change",this,event,true);}});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!elem._change_attached){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true);}});elem._change_attached=true;}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return rformElems.test(this.nodeName);}};}
if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true);};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true);}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=selector;selector=undefined;}
for(type in types){this.on(type,selector,data,types[type],one);}
return this;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return this;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return this.each(function(){jQuery.event.add(this,types,fn,data,selector);});},one:function(types,selector,data,fn){return this.on.call(this,types,selector,data,fn,1);},off:function(types,selector,fn){if(types&&types.preventDefault&&types.handleObj){var handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.type+"."+handleObj.namespace:handleObj.type,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(var type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this;},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this;},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length==1?this.off(selector,"**"):this.off(types,selector,fn);},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true);}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false;};toggler.guid=guid;while(i<args.length){args[i++].guid=guid;}
return this.click(toggler);},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null;}
return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};if(jQuery.attrFn){jQuery.attrFn[name]=true;}
if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks;}
if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks;}});(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,expando="sizcache"+(Math.random()+'').replace('.',''),done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true,rBackslash=/\\/g,rReturn=/\r\n/g,rNonWord=/\W/;[0,0].sort(function(){baseHasDuplicate=false;return 0;});var Sizzle=function(selector,context,results,seed){results=results||[];context=context||document;var origContext=context;if(context.nodeType!==1&&context.nodeType!==9){return[];}
if(!selector||typeof selector!=="string"){return results;}
var m,set,checkSet,extra,ret,cur,pop,i,prune=true,contextXML=Sizzle.isXML(context),parts=[],soFar=selector;do{chunker.exec("");m=chunker.exec(soFar);if(m){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break;}}}while(m);if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context,seed);}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift();}
set=posProcess(selector,set,seed);}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0];}
if(context){ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set);}else{prune=false;}
while(parts.length){cur=parts.pop();pop=cur;if(!Expr.relative[cur]){cur="";}else{pop=parts.pop();}
if(pop==null){pop=context;}
Expr.relative[cur](checkSet,pop,contextXML);}}else{checkSet=parts=[];}}
if(!checkSet){checkSet=set;}
if(!checkSet){Sizzle.error(cur||selector);}
if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet);}else if(context&&context.nodeType===1){for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&Sizzle.contains(context,checkSet[i]))){results.push(set[i]);}}}else{for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i]);}}}}else{makeArray(checkSet,results);}
if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results);}
return results;};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1);}}}}
return results;};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set);};Sizzle.matchesSelector=function(node,expr){return Sizzle(expr,null,null,[node]).length>0;};Sizzle.find=function(expr,context,isXML){var set,i,len,match,type,left;if(!expr){return[];}
for(i=0,len=Expr.order.length;i<len;i++){type=Expr.order[i];if((match=Expr.leftMatch[type].exec(expr))){left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(rBackslash,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break;}}}}
if(!set){set=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName("*"):[];}
return{set:set,expr:expr};};Sizzle.filter=function(expr,set,inplace,not){var match,anyFound,type,found,item,filter,left,i,pass,old=expr,result=[],curLoop=set,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);while(expr&&set.length){for(type in Expr.filter){if((match=Expr.leftMatch[type].exec(expr))!=null&&match[2]){filter=Expr.filter[type];left=match[1];anyFound=false;match.splice(1,1);if(left.substr(left.length-1)==="\\"){continue;}
if(curLoop===result){result=[];}
if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true;}else if(match===true){continue;}}
if(match){for(i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);pass=not^found;if(inplace&&found!=null){if(pass){anyFound=true;}else{curLoop[i]=false;}}else if(pass){result.push(item);anyFound=true;}}}}
if(found!==undefined){if(!inplace){curLoop=result;}
expr=expr.replace(Expr.match[type],"");if(!anyFound){return[];}
break;}}}
if(expr===old){if(anyFound==null){Sizzle.error(expr);}else{break;}}
old=expr;}
return curLoop;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};var getText=Sizzle.getText=function(elem){var i,node,nodeType=elem.nodeType,ret="";if(nodeType){if(nodeType===1||nodeType===9){if(typeof elem.textContent==='string'){return elem.textContent;}else if(typeof elem.innerText==='string'){return elem.innerText.replace(rReturn,'');}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}}else{for(i=0;(node=elem[i]);i++){if(node.nodeType!==8){ret+=getText(node);}}}
return ret;};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href");},type:function(elem){return elem.getAttribute("type");}},relative:{"+":function(checkSet,part){var isPartStr=typeof part==="string",isTag=isPartStr&&!rNonWord.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag){part=part.toLowerCase();}
for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}
checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||false:elem===part;}}
if(isPartStrNotTag){Sizzle.filter(part,checkSet,true);}},">":function(checkSet,part){var elem,isPartStr=typeof part==="string",i=0,l=checkSet.length;if(isPartStr&&!rNonWord.test(part)){part=part.toLowerCase();for(;i<l;i++){elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part?parent:false;}}}else{for(;i<l;i++){elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part;}}
if(isPartStr){Sizzle.filter(part,checkSet,true);}}},"":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck;}
checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML);},"~":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck;}
checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML);}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m&&m.parentNode?[m]:[];}},NAME:function(match,context){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i]);}}
return ret.length===0?null:ret;}},TAG:function(match,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(match[1]);}}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(rBackslash,"")+" ";if(isXML){return match;}
for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").replace(/[\t\n\r]/g," ").indexOf(match)>=0)){if(!inplace){result.push(elem);}}else if(inplace){curLoop[i]=false;}}}
return false;},ID:function(match){return match[1].replace(rBackslash,"");},TAG:function(match,curLoop){return match[1].replace(rBackslash,"").toLowerCase();},CHILD:function(match){if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0]);}
match[2]=match[2].replace(/^\+|\s*/g,'');var test=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(match[2]==="even"&&"2n"||match[2]==="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0;}
else if(match[2]){Sizzle.error(match[0]);}
match[0]=done++;return match;},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1]=match[1].replace(rBackslash,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name];}
match[4]=(match[4]||match[5]||"").replace(rBackslash,"");if(match[2]==="~="){match[4]=" "+match[4]+" ";}
return match;},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop);}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret);}
return false;}}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true;}
return match;},POS:function(match){match.unshift(true);return match;}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden";},disabled:function(elem){return elem.disabled===true;},checked:function(elem){return elem.checked===true;},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},parent:function(elem){return!!elem.firstChild;},empty:function(elem){return!elem.firstChild;},has:function(elem,i,match){return!!Sizzle(match[3],elem).length;},header:function(elem){return(/h\d/i).test(elem.nodeName);},text:function(elem){var attr=elem.getAttribute("type"),type=elem.type;return elem.nodeName.toLowerCase()==="input"&&"text"===type&&(attr===type||attr===null);},radio:function(elem){return elem.nodeName.toLowerCase()==="input"&&"radio"===elem.type;},checkbox:function(elem){return elem.nodeName.toLowerCase()==="input"&&"checkbox"===elem.type;},file:function(elem){return elem.nodeName.toLowerCase()==="input"&&"file"===elem.type;},password:function(elem){return elem.nodeName.toLowerCase()==="input"&&"password"===elem.type;},submit:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"submit"===elem.type;},image:function(elem){return elem.nodeName.toLowerCase()==="input"&&"image"===elem.type;},reset:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"reset"===elem.type;},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&"button"===elem.type||name==="button";},input:function(elem){return(/input|select|textarea|button/i).test(elem.nodeName);},focus:function(elem){return elem===elem.ownerDocument.activeElement;}},setFilters:{first:function(elem,i){return i===0;},last:function(elem,i,match,array){return i===array.length-1;},even:function(elem,i){return i%2===0;},odd:function(elem,i){return i%2===1;},lt:function(elem,i,match){return i<match[3]-0;},gt:function(elem,i,match){return i>match[3]-0;},nth:function(elem,i,match){return match[3]-0===i;},eq:function(elem,i,match){return match[3]-0===i;}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array);}else if(name==="contains"){return(elem.textContent||elem.innerText||getText([elem])||"").indexOf(match[3])>=0;}else if(name==="not"){var not=match[3];for(var j=0,l=not.length;j<l;j++){if(not[j]===elem){return false;}}
return true;}else{Sizzle.error(name);}},CHILD:function(elem,match){var first,last,doneName,parent,cache,count,diff,type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false;}}
if(type==="first"){return true;}
node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false;}}
return true;case"nth":first=match[2];last=match[3];if(first===1&&last===0){return true;}
doneName=match[0];parent=elem.parentNode;if(parent&&(parent[expando]!==doneName||!elem.nodeIndex)){count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count;}}
parent[expando]=doneName;}
diff=elem.nodeIndex-last;if(first===0){return diff===0;}else{return(diff%first===0&&diff/first>=0);}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match;},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||!!elem.nodeName&&elem.nodeName.toLowerCase()===match;},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1;},ATTR:function(elem,match){var name=match[1],result=Sizzle.attr?Sizzle.attr(elem,name):Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":!type&&Sizzle.attr?result!=null:type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!==check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false;},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array);}}}};var origPOS=Expr.match.POS,fescape=function(all,num){return"\\"+(num-0+1);};for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+(/(?![^\[]*\])(?![^\(]*\))/.source));Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape));}
var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results;}
return array;};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType;}catch(e){makeArray=function(array,results){var i=0,ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array);}else{if(typeof array.length==="number"){for(var l=array.length;i<l;i++){ret.push(array[i]);}}else{for(;array[i];i++){ret.push(array[i]);}}}
return ret;};}
var sortOrder,siblingCheck;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0;}
if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1;}
return a.compareDocumentPosition(b)&4?-1:1;};}else{sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0;}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex;}
var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b);}else if(!aup){return-1;}else if(!bup){return 1;}
while(cur){ap.unshift(cur);cur=cur.parentNode;}
cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode;}
al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i]);}}
return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1);};siblingCheck=function(a,b,ret){if(a===b){return ret;}
var cur=a.nextSibling;while(cur){if(cur===b){return-1;}
cur=cur.nextSibling;}
return 1;};}
(function(){var form=document.createElement("div"),id="script"+(new Date()).getTime(),root=document.documentElement;form.innerHTML="<a name='"+id+"'/>";root.insertBefore(form,root.firstChild);if(document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[];}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match;};}
root.removeChild(form);root=form=null;})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i]);}}
results=tmp;}
return results;};}
div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2);};}
div=null;})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div"),id="__sizzle__";div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return;}
Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&!Sizzle.isXML(context)){var match=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(query);if(match&&(context.nodeType===1||context.nodeType===9)){if(match[1]){return makeArray(context.getElementsByTagName(query),extra);}else if(match[2]&&Expr.find.CLASS&&context.getElementsByClassName){return makeArray(context.getElementsByClassName(match[2]),extra);}}
if(context.nodeType===9){if(query==="body"&&context.body){return makeArray([context.body],extra);}else if(match&&match[3]){var elem=context.getElementById(match[3]);if(elem&&elem.parentNode){if(elem.id===match[3]){return makeArray([elem],extra);}}else{return makeArray([],extra);}}
try{return makeArray(context.querySelectorAll(query),extra);}catch(qsaError){}}else if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){var oldContext=context,old=context.getAttribute("id"),nid=old||id,hasParent=context.parentNode,relativeHierarchySelector=/^\s*[+~]/.test(query);if(!old){context.setAttribute("id",nid);}else{nid=nid.replace(/'/g,"\\$&");}
if(relativeHierarchySelector&&hasParent){context=context.parentNode;}
try{if(!relativeHierarchySelector||hasParent){return makeArray(context.querySelectorAll("[id='"+nid+"'] "+query),extra);}}catch(pseudoError){}finally{if(!old){oldContext.removeAttribute("id");}}}}
return oldSizzle(query,context,extra,seed);};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop];}
div=null;})();}
(function(){var html=document.documentElement,matches=html.matchesSelector||html.mozMatchesSelector||html.webkitMatchesSelector||html.msMatchesSelector;if(matches){var disconnectedMatch=!matches.call(document.createElement("div"),"div"),pseudoWorks=false;try{matches.call(document.documentElement,"[test!='']:sizzle");}catch(pseudoError){pseudoWorks=true;}
Sizzle.matchesSelector=function(node,expr){expr=expr.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!Sizzle.isXML(node)){try{if(pseudoWorks||!Expr.match.PSEUDO.test(expr)&&!/!=/.test(expr)){var ret=matches.call(node,expr);if(ret||!disconnectedMatch||node.document&&node.document.nodeType!==11){return ret;}}}catch(e){}}
return Sizzle(expr,null,null,[node]).length>0;};}})();(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(!div.getElementsByClassName||div.getElementsByClassName("e").length===0){return;}
div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return;}
Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1]);}};div=null;})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1&&!isXML){elem[expando]=doneName;elem.sizset=i;}
if(elem.nodeName.toLowerCase()===cur){match=elem;break;}
elem=elem[dir];}
checkSet[i]=match;}}}
function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1){if(!isXML){elem[expando]=doneName;elem.sizset=i;}
if(typeof cur!=="string"){if(elem===cur){match=true;break;}}else if(Sizzle.filter(cur,[elem]).length>0){match=elem;break;}}
elem=elem[dir];}
checkSet[i]=match;}}}
if(document.documentElement.contains){Sizzle.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):true);};}else if(document.documentElement.compareDocumentPosition){Sizzle.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16);};}else{Sizzle.contains=function(){return false;};}
Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};var posProcess=function(selector,context,seed){var match,tmpSet=[],later="",root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"");}
selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet,seed);}
return Sizzle.filter(later,tmpSet);};Sizzle.attr=jQuery.attr;Sizzle.selectors.attrMap={};jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.filters;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;})();var runtil=/Until$/,rparentsprev=/^(?:parents|prevUntil|prevAll)/,rmultiselector=/,/,isSimple=/^.[^:#\[\.,]*$/,slice=Array.prototype.slice,POS=jQuery.expr.match.POS,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var self=this,i,l;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true;}}});}
var ret=this.pushStack("","find",selector),length,n,r;for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break;}}}}}
return ret;},has:function(target){var targets=jQuery(target);return this.filter(function(){for(var i=0,l=targets.length;i<l;i++){if(jQuery.contains(this,targets[i])){return true;}}});},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector);},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector);},is:function(selector){return!!selector&&(typeof selector==="string"?POS.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0);},closest:function(selectors,context){var ret=[],i,l,cur=this[0];if(jQuery.isArray(selectors)){var level=1;while(cur&&cur.ownerDocument&&cur!==context){for(i=0;i<selectors.length;i++){if(jQuery(cur).is(selectors[i])){ret.push({selector:selectors[i],elem:cur,level:level});}}
cur=cur.parentNode;level++;}
return ret;}
var pos=POS.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(i=0,l=this.length;i<l;i++){cur=this[i];while(cur){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break;}else{cur=cur.parentNode;if(!cur||!cur.ownerDocument||cur===context||cur.nodeType===11){break;}}}}
ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all));},andSelf:function(){return this.add(this.prevObject);}});function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return jQuery.dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until);},next:function(elem){return jQuery.nth(elem,2,"nextSibling");},prev:function(elem){return jQuery.nth(elem,2,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until);},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if((this.length>1||rmultiselector.test(selector))&&rparentsprev.test(name)){ret=ret.reverse();}
return this.pushStack(ret,name,slice.call(arguments).join(","));};});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")";}
return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems);},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur);}
cur=cur[dir];}
return matched;},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType===1&&++num===result){break;}}
return cur;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n);}}
return r;}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep;});}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep;});}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1;});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep);}else{qualifier=jQuery.filter(qualifier,filtered);}}
return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep;});}
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
var nodeNames="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:\d+|null)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")","i"),rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)/,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document);wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"div<div>","</div>"];}
jQuery.fn.extend({text:function(text){if(jQuery.isFunction(text)){return this.each(function(i){var self=jQuery(this);self.text(text.call(this,i,self.text()));});}
if(typeof text!=="object"&&text!==undefined){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text));}
return jQuery.text(this);},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.appendChild(elem);}});},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.insertBefore(elem,this.firstChild);}});},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this);});}else if(arguments.length){var set=jQuery.clean(arguments);set.push.apply(set,this.toArray());return this.pushStack(set,"before",arguments);}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});}else if(arguments.length){var set=this.pushStack(this,"after",arguments);set.push.apply(set,jQuery.clean(arguments));return set;}},remove:function(selector,keepData){for(var i=0,elem;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem]);}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}}
return this;},empty:function(){for(var i=0,elem;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){if(value===undefined){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(rinlinejQuery,""):null;}else if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(var i=0,l=this.length;i<l;i++){if(this[i].nodeType===1){jQuery.cleanData(this[i].getElementsByTagName("*"));this[i].innerHTML=value;}}}catch(e){this.empty().append(value);}}else if(jQuery.isFunction(value)){this.each(function(i){var self=jQuery(this);self.html(value.call(this,i,self.html()));});}else{this.empty().append(value);}
return this;},replaceWith:function(value){if(this[0]&&this[0].parentNode){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old));});}
if(typeof value!=="string"){value=jQuery(value).detach();}
return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value);}else{jQuery(parent).append(value);}});}else{return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this;}},detach:function(selector){return this.remove(selector,true);},domManip:function(args,table,callback){var results,first,fragment,parent,value=args[0],scripts=[];if(!jQuery.support.checkClone&&arguments.length===3&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback,true);});}
if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback);});}
if(this[0]){parent=value&&value.parentNode;if(jQuery.support.parentNode&&parent&&parent.nodeType===11&&parent.childNodes.length===this.length){results={fragment:parent};}else{results=jQuery.buildFragment(args,this,scripts);}
fragment=results.fragment;if(fragment.childNodes.length===1){first=fragment=fragment.firstChild;}else{first=fragment.firstChild;}
if(first){table=table&&jQuery.nodeName(first,"tr");for(var i=0,l=this.length,lastIndex=l-1;i<l;i++){callback.call(table?root(this[i],first):this[i],results.cacheable||(l>1&&i<lastIndex)?jQuery.clone(fragment,true,true):fragment);}}
if(scripts.length){jQuery.each(scripts,evalScript);}}
return this;}});function root(elem,cur){return jQuery.nodeName(elem,"table")?(elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody"))):elem;}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type+(events[type][i].namespace?".":"")+events[type][i].namespace,events[type][i],events[type][i].data);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return;}
if(dest.clearAttributes){dest.clearAttributes();}
if(dest.mergeAttributes){dest.mergeAttributes(src);}
nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){dest.outerHTML=src.outerHTML;}else if(nodeName==="input"&&(src.type==="checkbox"||src.type==="radio")){if(src.checked){dest.defaultChecked=dest.checked=src.checked;}
if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}
dest.removeAttribute(jQuery.expando);}
jQuery.buildFragment=function(args,nodes,scripts){var fragment,cacheable,cacheresults,doc,first=args[0];if(nodes&&nodes[0]){doc=nodes[0].ownerDocument||nodes[0];}
if(!doc.createDocumentFragment){doc=document;}
if(args.length===1&&typeof first==="string"&&first.length<512&&doc===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;cacheresults=jQuery.fragments[first];if(cacheresults&&cacheresults!==1){fragment=cacheresults;}}
if(!fragment){fragment=doc.createDocumentFragment();jQuery.clean(args,doc,fragment,scripts);}
if(cacheable){jQuery.fragments[first]=cacheresults?fragment:1;}
return{fragment:fragment,cacheable:cacheable};};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector),parent=this.length===1&&this[0].parentNode;if(parent&&parent.nodeType===11&&parent.childNodes.length===1&&insert.length===1){insert[original](this[0]);return this;}else{for(var i=0,l=insert.length;i<l;i++){var elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems);}
return this.pushStack(ret,name,insert.selector);}};});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*");}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*");}else{return[];}}
function fixDefaultChecked(elem){if(elem.type==="checkbox"||elem.type==="radio"){elem.defaultChecked=elem.checked;}}
function findInputs(elem){var nodeName=(elem.nodeName||"").toLowerCase();if(nodeName==="input"){fixDefaultChecked(elem);}else if(nodeName!=="script"&&typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);}}
function shimCloneNode(elem){var div=document.createElement("div");safeFragment.appendChild(div);div.innerHTML=elem.outerHTML;return div.firstChild;}
jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone=jQuery.support.html5Clone||!rnoshimcache.test("<"+elem.nodeName)?elem.cloneNode(true):shimCloneNode(elem);if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i]);}}}
if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i]);}}}
srcElements=destElements=null;return clone;},clean:function(elems,context,fragment,scripts){var checkScriptType;context=context||document;if(typeof context.createElement==="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document;}
var ret=[],j;for(var i=0,elem;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+="";}
if(!elem){continue;}
if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem);}else{elem=elem.replace(rxhtmlTag,"<$1></$2>");var tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div=context.createElement("div");if(context===document){safeFragment.appendChild(div);}else{createSafeFragment(context).appendChild(div);}
div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild;}
if(!jQuery.support.tbody){var hasBody=rtbody.test(elem),tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j]);}}}
if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild);}
elem=div.childNodes;}}
var len;if(!jQuery.support.appendChecked){if(elem[0]&&typeof(len=elem.length)==="number"){for(j=0;j<len;j++){findInputs(elem[j]);}}else{findInputs(elem);}}
if(elem.nodeType){ret.push(elem);}else{ret=jQuery.merge(ret,elem);}}
if(fragment){checkScriptType=function(elem){return!elem.type||rscriptType.test(elem.type);};for(i=0;ret[i];i++){if(scripts&&jQuery.nodeName(ret[i],"script")&&(!ret[i].type||ret[i].type.toLowerCase()==="text/javascript")){scripts.push(ret[i].parentNode?ret[i].parentNode.removeChild(ret[i]):ret[i]);}else{if(ret[i].nodeType===1){var jsTags=jQuery.grep(ret[i].getElementsByTagName("script"),checkScriptType);ret.splice.apply(ret,[i+1,0].concat(jsTags));}
fragment.appendChild(ret[i]);}}}
return ret;},cleanData:function(elems){var data,id,cache=jQuery.cache,special=jQuery.event.special,deleteExpando=jQuery.support.deleteExpando;for(var i=0,elem;(elem=elems[i])!=null;i++){if(elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()]){continue;}
id=elem[jQuery.expando];if(id){data=cache[id];if(data&&data.events){for(var type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}
if(data.handle){data.handle.elem=null;}}
if(deleteExpando){delete elem[jQuery.expando];}else if(elem.removeAttribute){elem.removeAttribute(jQuery.expando);}
delete cache[id];}}}});function evalScript(i,elem){if(elem.src){jQuery.ajax({url:elem.src,async:false,dataType:"script"});}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"/*$0*/"));}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}
var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rupper=/([A-Z]|^ms)/g,rnumpx=/^-?\d+(?:px)?$/i,rnum=/^-?\d/,rrelNum=/^([\-+])=([\-+.\de]+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssWidth=["Left","Right"],cssHeight=["Top","Bottom"],curCSS,getComputedStyle,currentStyle;jQuery.fn.css=function(name,value){if(arguments.length===2&&value===undefined){return this;}
return jQuery.access(this,name,value,true,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);});};jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity","opacity");return ret===""?"1":ret;}else{return elem.style.opacity;}}}},cssNumber:{"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,origName=jQuery.camelCase(name),style=elem.style,hooks=jQuery.cssHooks[origName];name=jQuery.cssProps[origName]||origName;if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(+(ret[1]+1)*+ret[2])+parseFloat(jQuery.css(elem,name));type="number";}
if(value==null||type==="number"&&isNaN(value)){return;}
if(type==="number"&&!jQuery.cssNumber[origName]){value+="px";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,extra){var ret,hooks;name=jQuery.camelCase(name);hooks=jQuery.cssHooks[name];name=jQuery.cssProps[name]||name;if(name==="cssFloat"){name="float";}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,true,extra))!==undefined){return ret;}else if(curCSS){return curCSS(elem,name);}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
callback.call(elem);for(name in options){elem.style[name]=old[name];}}});jQuery.curCSS=jQuery.css;jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){var val;if(computed){if(elem.offsetWidth!==0){return getWH(elem,name,extra);}else{jQuery.swap(elem,cssShow,function(){val=getWH(elem,name,extra);});}
return val;}},set:function(elem,value){if(rnumpx.test(value)){value=parseFloat(value);if(value>=0){return value+"px";}}else{return value;}}};});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(parseFloat(RegExp.$1)/100)+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){var ret;jQuery.swap(elem,{"display":"inline-block"},function(){if(computed){ret=curCSS(elem,"margin-right","marginRight");}else{ret=elem.style.marginRight;}});return ret;}};}});if(document.defaultView&&document.defaultView.getComputedStyle){getComputedStyle=function(elem,name){var ret,defaultView,computedStyle;name=name.replace(rupper,"-$1").toLowerCase();if((defaultView=elem.ownerDocument.defaultView)&&(computedStyle=defaultView.getComputedStyle(elem,null))){ret=computedStyle.getPropertyValue(name);if(ret===""&&!jQuery.contains(elem.ownerDocument.documentElement,elem)){ret=jQuery.style(elem,name);}}
return ret;};}
if(document.documentElement.currentStyle){currentStyle=function(elem,name){var left,rsLeft,uncomputed,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret===null&&style&&(uncomputed=style[name])){ret=uncomputed;}
if(!rnumpx.test(ret)&&rnum.test(ret)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":(ret||0);ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft;}}
return ret===""?"auto":ret;};}
curCSS=getComputedStyle||currentStyle;function getWH(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,which=name==="width"?cssWidth:cssHeight,i=0,len=which.length;if(val>0){if(extra!=="border"){for(;i<len;i++){if(!extra){val-=parseFloat(jQuery.css(elem,"padding"+which[i]))||0;}
if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0;}else{val-=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0;}}}
return val+"px";}
val=curCSS(elem,name,name);if(val<0||val==null){val=elem.style[name]||0;}
val=parseFloat(val)||0;if(extra){for(;i<len;i++){val+=parseFloat(jQuery.css(elem,"padding"+which[i]))||0;if(extra!=="padding"){val+=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0;}
if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0;}}}
return val+"px";}
if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){var width=elem.offsetWidth,height=elem.offsetHeight;return(width===0&&height===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||jQuery.css(elem,"display"))==="none");};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};}
var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rselectTextarea=/^(?:select|textarea)/i,rspacesAjax=/\s+/,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,_load=jQuery.fn.load,prefilters={},transports={},ajaxLocation,ajaxLocParts,allTypes=["*/"]+["*"];try{ajaxLocation=location.href;}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
if(jQuery.isFunction(func)){var dataTypes=dataTypeExpression.toLowerCase().split(rspacesAjax),i=0,length=dataTypes.length,dataType,list,placeBefore;for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*";}
list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func);}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters),selection;for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined;}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected);}}}
if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected);}
return selection;}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}}
jQuery.fn.extend({load:function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}else if(!this.length){return this;}
var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off);}
var type="GET";if(params){if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(typeof params==="object"){params=jQuery.param(params,jQuery.ajaxSettings.traditional);type="POST";}}
var self=this;jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status,responseText){responseText=jqXHR.responseText;if(jqXHR.isResolved()){jqXHR.done(function(r){responseText=r;});self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText);}
if(callback){self.each(callback,[responseText,status,jqXHR]);}}});return this;},serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f);};});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type});};});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings);}else{settings=target;target=jQuery.ajaxSettings;}
ajaxExtend(target,settings);return target;},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},ifModifiedKey,requestHeaders={},requestHeadersNames={},responseHeadersString,responseHeaders,transport,timeoutTimer,parts,state=0,fireGlobals,i,jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match===undefined?null:match;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},abort:function(statusText){statusText=statusText||"abort";if(transport){transport.abort(statusText);}
done(0,statusText);return this;}};function done(status,nativeStatusText,responses,headers){if(state===2){return;}
state=2;if(timeoutTimer){clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;var isSuccess,success,error,statusText=nativeStatusText,response=responses?ajaxHandleResponses(s,jqXHR,responses):undefined,lastModified,etag;if(status>=200&&status<300||status===304){if(s.ifModified){if((lastModified=jqXHR.getResponseHeader("Last-Modified"))){jQuery.lastModified[ifModifiedKey]=lastModified;}
if((etag=jqXHR.getResponseHeader("Etag"))){jQuery.etag[ifModifiedKey]=etag;}}
if(status===304){statusText="notmodified";isSuccess=true;}else{try{success=ajaxConvert(s,response);statusText="success";isSuccess=true;}catch(e){statusText="parsererror";error=e;}}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=""+(nativeStatusText||statusText);if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]];}}else{tmp=map[jqXHR.status];jqXHR.then(tmp,tmp);}}
return this;};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(rspacesAjax);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return false;}
fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data;}
ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"");}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]);}
if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey]);}}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){jqXHR.abort();return false;}
for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
return jqXHR;},param:function(a,traditional){var s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(var prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");}});function buildParams(prefix,obj,traditional,add){if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"||jQuery.isArray(v)?i:"")+"]",v,traditional,add);}});}else if(!traditional&&obj!=null&&typeof obj==="object"){for(var name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
jQuery.extend({active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields,ct,type,finalDataType,firstDataType;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type];}}
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response){if(s.dataFilter){response=s.dataFilter(response,s.dataType);}
var dataTypes=s.dataTypes,converters={},i,key,length=dataTypes.length,tmp,current=dataTypes[0],prev,conversion,conv,conv1,conv2;for(i=1;i<length;i++){if(i===1){for(key in s.converters){if(typeof key==="string"){converters[key.toLowerCase()]=s.converters[key];}}}
prev=current;current=dataTypes[i];if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conversion=prev+" "+current;conv=converters[conversion]||converters["* "+current];if(!conv){conv2=undefined;for(conv1 in converters){tmp=conv1.split(" ");if(tmp[0]===prev||tmp[0]==="*"){conv2=converters[tmp[1]+" "+current];if(conv2){conv1=converters[conv1];if(conv1===true){conv=conv2;}else if(conv2===true){conv=conv1;}
break;}}}}
if(!(conv||conv2)){jQuery.error("No conversion from "+conversion.replace(" "," to "));}
if(conv!==true){response=conv?conv(response):conv2(conv1(response));}}}
return response;}
var jsc=jQuery.now(),jsre=/(\=)\?(&|$)|\?\?/i;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return jQuery.expando+"_"+(jsc++);}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var inspectData=s.contentType==="application/x-www-form-urlencoded"&&(typeof s.data==="string");if(s.dataTypes[0]==="jsonp"||s.jsonp!==false&&(jsre.test(s.url)||inspectData&&jsre.test(s.data))){var responseContainer,jsonpCallback=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,previous=window[jsonpCallback],url=s.url,data=s.data,replace="$1"+jsonpCallback+"$2";if(s.jsonp!==false){url=url.replace(jsre,replace);if(s.url===url){if(inspectData){data=data.replace(jsre,replace);}
if(s.data===data){url+=(/\?/.test(url)?"&":"?")+s.jsonp+"="+jsonpCallback;}}}
s.url=url;s.data=data;window[jsonpCallback]=function(response){responseContainer=[response];};jqXHR.always(function(){window[jsonpCallback]=previous;if(responseContainer&&jQuery.isFunction(previous)){window[jsonpCallback](responseContainer[0]);}});s.converters["script json"]=function(){if(!responseContainer){jQuery.error(jsonpCallback+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";return"script";}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}
script=undefined;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(0,1);}}};}});var
xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1);}}:false,xhrId=0,xhrCallbacks;function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR();}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials"in xhr)});})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var xhr=s.xhr(),handle,i;if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password);}else{xhr.open(s.type,s.url,s.async);}
if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i];}}
if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType);}
if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
try{for(i in headers){xhr.setRequestHeader(i,headers[i]);}}catch(_){}
xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle];}}
if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml;}
responses.text=xhr.responseText;try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException);}}
if(responses){complete(status,statusText,responses,responseHeaders);}};if(!s.async||xhr.readyState===4){callback();}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort);}
xhrCallbacks[handle]=callback;}
xhr.onreadystatechange=callback;}},abort:function(){if(callback){callback(0,1);}}};}});}
var elemdisplay={},iframe,iframeDoc,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,timerId,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],fxNow;jQuery.fn.extend({show:function(speed,easing,callback){var elem,display;if(speed||speed===0){return this.animate(genFx("show",3),speed,easing,callback);}else{for(var i=0,j=this.length;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(!jQuery._data(elem,"olddisplay")&&display==="none"){display=elem.style.display="";}
if(display===""&&jQuery.css(elem,"display")==="none"){jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName));}}}
for(i=0;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(display===""||display==="none"){elem.style.display=jQuery._data(elem,"olddisplay")||"";}}}
return this;}},hide:function(speed,easing,callback){if(speed||speed===0){return this.animate(genFx("hide",3),speed,easing,callback);}else{var elem,display,i=0,j=this.length;for(;i<j;i++){elem=this[i];if(elem.style){display=jQuery.css(elem,"display");if(display!=="none"&&!jQuery._data(elem,"olddisplay")){jQuery._data(elem,"olddisplay",display);}}}
for(i=0;i<j;i++){if(this[i].style){this[i].style.display="none";}}
return this;}},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2,callback){var bool=typeof fn==="boolean";if(jQuery.isFunction(fn)&&jQuery.isFunction(fn2)){this._toggle.apply(this,arguments);}else if(fn==null||bool){this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]();});}else{this.animate(genFx("toggle",3),fn,fn2,callback);}
return this;},fadeTo:function(speed,to,easing,callback){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);if(jQuery.isEmptyObject(prop)){return this.each(optall.complete,[false]);}
prop=jQuery.extend({},prop);function doAnimation(){if(optall.queue===false){jQuery._mark(this);}
var opt=jQuery.extend({},optall),isElement=this.nodeType===1,hidden=isElement&&jQuery(this).is(":hidden"),name,val,p,e,parts,start,end,unit,method;opt.animatedProperties={};for(p in prop){name=jQuery.camelCase(p);if(p!==name){prop[name]=prop[p];delete prop[p];}
val=prop[name];if(jQuery.isArray(val)){opt.animatedProperties[name]=val[1];val=prop[name]=val[0];}else{opt.animatedProperties[name]=opt.specialEasing&&opt.specialEasing[name]||opt.easing||'swing';}
if(val==="hide"&&hidden||val==="show"&&!hidden){return opt.complete.call(this);}
if(isElement&&(name==="height"||name==="width")){opt.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(jQuery.css(this,"display")==="inline"&&jQuery.css(this,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||defaultDisplay(this.nodeName)==="inline"){this.style.display="inline-block";}else{this.style.zoom=1;}}}}
if(opt.overflow!=null){this.style.overflow="hidden";}
for(p in prop){e=new jQuery.fx(this,opt,p);val=prop[p];if(rfxtypes.test(val)){method=jQuery._data(this,"toggle"+p)||(val==="toggle"?hidden?"show":"hide":0);if(method){jQuery._data(this,"toggle"+p,method==="show"?"hide":"show");e[method]();}else{e[val]();}}else{parts=rfxnum.exec(val);start=e.cur();if(parts){end=parseFloat(parts[2]);unit=parts[3]||(jQuery.cssNumber[p]?"":"px");if(unit!=="px"){jQuery.style(this,p,(end||1)+unit);start=((end||1)/e.cur())*start;jQuery.style(this,p,start+unit);}
if(parts[1]){end=((parts[1]==="-="?-1:1)*end)+start;}
e.custom(start,end,unit);}else{e.custom(start,val,"");}}}
return true;}
return optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var index,hadTimers=false,timers=jQuery.timers,data=jQuery._data(this);if(!gotoEnd){jQuery._unmark(true,this);}
function stopQueue(elem,data,index){var hooks=data[index];jQuery.removeData(elem,index,true);hooks.stop(gotoEnd);}
if(type==null){for(index in data){if(data[index]&&data[index].stop&&index.indexOf(".run")===index.length-4){stopQueue(this,data,index);}}}else if(data[index=type+".run"]&&data[index].stop){stopQueue(this,data,index);}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){if(gotoEnd){timers[index](true);}else{timers[index].saveState();}
hadTimers=true;timers.splice(index,1);}}
if(!(gotoEnd&&hadTimers)){jQuery.dequeue(this,type);}});}});function createFxNow(){setTimeout(clearFxNow,0);return(fxNow=jQuery.now());}
function clearFxNow(){fxNow=undefined;}
function genFx(type,num){var obj={};jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type;});return obj;}
jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(noUnmark){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}else if(noUnmark!==false){jQuery._unmark(this);}};return opt;},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p;},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum;}},timers:[],fx:function(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;options.orig=options.orig||{};}});jQuery.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this);}
(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this);},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop];}
var parsed,r=jQuery.css(this.elem,this.prop);return isNaN(parsed=parseFloat(r))?!r||r==="auto"?0:r:parsed;},custom:function(from,to,unit){var self=this,fx=jQuery.fx;this.startTime=fxNow||createFxNow();this.end=to;this.now=this.start=from;this.pos=this.state=0;this.unit=unit||this.unit||(jQuery.cssNumber[this.prop]?"":"px");function t(gotoEnd){return self.step(gotoEnd);}
t.queue=this.options.queue;t.elem=this.elem;t.saveState=function(){if(self.options.hide&&jQuery._data(self.elem,"fxshow"+self.prop)===undefined){jQuery._data(self.elem,"fxshow"+self.prop,self.start);}};if(t()&&jQuery.timers.push(t)&&!timerId){timerId=setInterval(fx.tick,fx.interval);}},show:function(){var dataShow=jQuery._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=dataShow||jQuery.style(this.elem,this.prop);this.options.show=true;if(dataShow!==undefined){this.custom(this.cur(),dataShow);}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());}
jQuery(this.elem).show();},hide:function(){this.options.orig[this.prop]=jQuery._data(this.elem,"fxshow"+this.prop)||jQuery.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0);},step:function(gotoEnd){var p,n,complete,t=fxNow||createFxNow(),done=true,elem=this.elem,options=this.options;if(gotoEnd||t>=options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();options.animatedProperties[this.prop]=true;for(p in options.animatedProperties){if(options.animatedProperties[p]!==true){done=false;}}
if(done){if(options.overflow!=null&&!jQuery.support.shrinkWrapBlocks){jQuery.each(["","X","Y"],function(index,value){elem.style["overflow"+value]=options.overflow[index];});}
if(options.hide){jQuery(elem).hide();}
if(options.hide||options.show){for(p in options.animatedProperties){jQuery.style(elem,p,options.orig[p]);jQuery.removeData(elem,"fxshow"+p,true);jQuery.removeData(elem,"toggle"+p,true);}}
complete=options.complete;if(complete){options.complete=false;complete.call(elem);}}
return false;}else{if(options.duration==Infinity){this.now=t;}else{n=t-this.startTime;this.state=n/options.duration;this.pos=jQuery.easing[options.animatedProperties[this.prop]](this.state,n,0,1,options.duration);this.now=this.start+((this.end-this.start)*this.pos);}
this.update();}
return true;}};jQuery.extend(jQuery.fx,{tick:function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}},interval:13,stop:function(){clearInterval(timerId);timerId=null;},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.style(fx.elem,"opacity",fx.now);},_default:function(fx){if(fx.elem.style&&fx.elem.style[fx.prop]!=null){fx.elem.style[fx.prop]=fx.now+fx.unit;}else{fx.elem[fx.prop]=fx.now;}}}});jQuery.each(["width","height"],function(i,prop){jQuery.fx.step[prop]=function(fx){jQuery.style(fx.elem,prop,Math.max(0,fx.now)+fx.unit);};});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};}
function defaultDisplay(nodeName){if(!elemdisplay[nodeName]){var body=document.body,elem=jQuery("<"+nodeName+">").appendTo(body),display=elem.css("display");elem.remove();if(display==="none"||display===""){if(!iframe){iframe=document.createElement("iframe");iframe.frameBorder=iframe.width=iframe.height=0;}
body.appendChild(iframe);if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write((document.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");iframeDoc.close();}
elem=iframeDoc.createElement(nodeName);iframeDoc.body.appendChild(elem);display=jQuery.css(elem,"display");body.removeChild(iframe);}
elemdisplay[nodeName]=display;}
return elemdisplay[nodeName];}
var rtable=/^t(?:able|d|h)$/i,rroot=/^(?:body|html)$/i;if("getBoundingClientRect"in document.documentElement){jQuery.fn.offset=function(options){var elem=this[0],box;if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
if(!elem||!elem.ownerDocument){return null;}
if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem);}
try{box=elem.getBoundingClientRect();}catch(e){}
var doc=elem.ownerDocument,docElem=doc.documentElement;if(!box||!jQuery.contains(docElem,elem)){return box?{top:box.top,left:box.left}:{top:0,left:0};}
var body=doc.body,win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||jQuery.support.boxModel&&docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||jQuery.support.boxModel&&docElem.scrollLeft||body.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:top,left:left};};}else{jQuery.fn.offset=function(options){var elem=this[0];if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
if(!elem||!elem.ownerDocument){return null;}
if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem);}
var computedStyle,offsetParent=elem.offsetParent,prevOffsetParent=elem,doc=elem.ownerDocument,docElem=doc.documentElement,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top=elem.offsetTop,left=elem.offsetLeft;while((elem=elem.parentNode)&&elem!==body&&elem!==docElem){if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){break;}
computedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle;top-=elem.scrollTop;left-=elem.scrollLeft;if(elem===offsetParent){top+=elem.offsetTop;left+=elem.offsetLeft;if(jQuery.support.doesNotAddBorder&&!(jQuery.support.doesAddBorderForTableAndCells&&rtable.test(elem.nodeName))){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0;}
prevOffsetParent=offsetParent;offsetParent=elem.offsetParent;}
if(jQuery.support.subtractsBorderForOverflowNotVisible&&computedStyle.overflow!=="visible"){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0;}
prevComputedStyle=computedStyle;}
if(prevComputedStyle.position==="relative"||prevComputedStyle.position==="static"){top+=body.offsetTop;left+=body.offsetLeft;}
if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){top+=Math.max(docElem.scrollTop,body.scrollTop);left+=Math.max(docElem.scrollLeft,body.scrollLeft);}
return{top:top,left:left};};}
jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0;}
return{top:top,left:left};},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative";}
var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset);}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({position:function(){if(!this[0]){return null;}
var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent;});}});jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;jQuery.fn[method]=function(val){var elem,win;if(val===undefined){elem=this[0];if(!elem){return null;}
win=getWindow(elem);return win?("pageXOffset"in win)?win[i?"pageYOffset":"pageXOffset"]:jQuery.support.boxModel&&win.document.documentElement[method]||win.document.body[method]:elem[method];}
return this.each(function(){win=getWindow(this);if(win){win.scrollTo(!i?val:jQuery(win).scrollLeft(),i?val:jQuery(win).scrollTop());}else{this[method]=val;}});};});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn["inner"+name]=function(){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,"padding")):this[type]():null;};jQuery.fn["outer"+name]=function(margin){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,margin?"margin":"border")):this[type]():null;};jQuery.fn[type]=function(size){var elem=this[0];if(!elem){return size==null?null:this;}
if(jQuery.isFunction(size)){return this.each(function(i){var self=jQuery(this);self[type](size.call(this,i,self[type]()));});}
if(jQuery.isWindow(elem)){var docElemProp=elem.document.documentElement["client"+name],body=elem.document.body;return elem.document.compatMode==="CSS1Compat"&&docElemProp||body&&body["client"+name]||docElemProp;}else if(elem.nodeType===9){return Math.max(elem.documentElement["client"+name],elem.body["scroll"+name],elem.documentElement["scroll"+name],elem.body["offset"+name],elem.documentElement["offset"+name]);}else if(size===undefined){var orig=jQuery.css(elem,type),ret=parseFloat(orig);return jQuery.isNumeric(ret)?ret:orig;}else{return this.css(type,typeof size==="string"?size:size+"px");}};});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery;});}})(window);pen.define("cdf/lib/CCC/jquery.tipsy",["cdf/jquery"],function($){(function($){function fixTitle($ele){var title=$ele.attr('title');if(title||typeof($ele.attr('original-title'))!=='string'){$ele.attr('original-title',title||'').removeAttr('title');}}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;fixTitle(this.$element);}
Tipsy.prototype={enter:function(){var tipsy=this;var options=this.options;tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{setTimeout(function(){if(tipsy.hoverState==='in'){tipsy.hoverState=null;tipsy.show();}},options.delayIn);}},leave:function(){var tipsy=this;var options=this.options;tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState==='out')tipsy.hide();},options.delayOut);}},visible:function(){var parent;return this.hoverState==='in'||(this.hoverState!=='out'&&!!(this.$tip&&(parent=this.$tip[0].parentNode)&&(parent.nodeType!==11)));},update:function(){if(this.visible()){this.show(true);}else{this.enter();}},show:function(isUpdate){if(this.hoverState==='in'){return;}
var title=this.getTitle();if(!this.enabled||!title){this.hoverState=null;this.hide();return;}
var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';if(!isUpdate){$tip.remove();}
var parent=$tip[0].parentNode;if(!parent||(parent.nodeType===11)){$tip.css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);}
var pos=$.extend({},this.$element.offset());if(this.$element[0].nearestViewportElement){var rect=this.$element[0].getBoundingClientRect();pos.width=rect.width;pos.height=rect.height;}else{pos.width=this.$element[0].offsetWidth||0;pos.height=this.$element[0].offsetHeight||0;}
var tipOffset=this.options.offset,useCorners=this.options.corners,showArrow=this.options.arrow,actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;if(!showArrow){tipOffset-=4;}
function calcPosition(gravity){var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-tipOffset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+tipOffset};break;}
if(gravity.length===2){if(gravity.charAt(1)=='w'){tp.left=useCorners?pos.left+pos.width+tipOffset:pos.left+pos.width/2-15;}else{tp.left=useCorners?pos.left-actualWidth-tipOffset:pos.left+pos.width/2-actualWidth+15;}}
return tp;}
var gravity=(typeof this.options.gravity=='function')?this.options.gravity.call(this.$element[0],{width:actualWidth,height:actualHeight},calcPosition):this.options.gravity;var tp=calcPosition(gravity);$tip.css(tp).addClass('tipsy-'+gravity+(useCorners&&gravity.length>1?gravity.charAt(1):''));if(showArrow){var hideArrow=useCorners&&gravity.length===2;$tip.find('.tipsy-arrow')[hideArrow?'hide':'show']();}
var doFadeIn=this.options.fade&&(!isUpdate||!this._prevGravity||(this._prevGravity!==gravity));if(doFadeIn){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}
this._prevGravity=gravity;this.hoverState=null;},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else if(this.$tip){this.tip().remove();}
this.hoverState=null;},setTitle:function(title){title=(title==null)?"":(""+title);this.$element.attr('original-title',title).removeAttr('title');},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);if(typeof o.title==='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title==='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>');if(this.options.arrow){this.$tip.html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>');}else{this.$tip.html('<div class="tipsy-inner"/></div>');}
this.$tip.remove();}
return this.$tip;},validate:function(){var parent=this.$element[0].parentNode;if(!parent||(parent.nodeType===11)){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options,arg){if(options===true){return this.data('tipsy');}else if(typeof options==='string'){return this.data('tipsy')[options](arg);}
options=$.extend({},$.fn.tipsy.defaults,options);if(options.arrow==null){options.arrow=!options.corners;}
function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){get(this).enter();}
function leave(){get(this).leave();}
if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)
[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.8,title:'title',trigger:'hover',corners:false,arrow:null};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};})(jQuery);});pen.define("cdf/lib/CCC/protovis",function(){if(!Array.prototype.map)Array.prototype.map=function(f,o){var n=this.length;var result=new Array(n);for(var i=0;i<n;i++){if(i in this){result[i]=f.call(o,this[i],i,this);}}
return result;};if(!Array.prototype.filter)Array.prototype.filter=function(f,o){var n=this.length;var result=new Array();for(var i=0;i<n;i++){if(i in this){var v=this[i];if(f.call(o,v,i,this))result.push(v);}}
return result;};if(!Array.prototype.forEach)Array.prototype.forEach=function(f,o){var n=this.length>>>0;for(var i=0;i<n;i++){if(i in this)f.call(o,this[i],i,this);}};if(!Array.prototype.reduce)Array.prototype.reduce=function(f,v){var len=this.length;if(!len&&(arguments.length==1)){throw new Error("reduce: empty array, no initial value");}
var i=0;if(arguments.length<2){while(true){if(i in this){v=this[i++];break;}
if(++i>=len){throw new Error("reduce: no values, no initial value");}}}
for(;i<len;i++){if(i in this){v=f(v,this[i],i,this);}}
return v;};var pv={};pv.version={major:3,minor:3};pv.identity=function(x){return x;};pv.index=function(){return this.index;};pv.child=function(){return this.childIndex;};pv.parent=function(){return this.parent.index;};pv.extend=function(f){function g(){}
g.prototype=f.prototype||f;return new g();};try{eval("pv.parse = function(x) x;");}catch(e){pv.parse=function(js){var re=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),m,d,i=0,s="";while(m=re.exec(js)){var j=m.index+m[0].length;if(js.charAt(j)!='{'){s+=js.substring(i,j)+"{return ";i=j;for(var p=0;p>=0&&j<js.length;j++){var c=js.charAt(j);switch(c){case'"':case'\'':{while(++j<js.length&&(d=js.charAt(j))!=c){if(d=='\\')j++;}
break;}
case'[':case'(':p++;break;case']':case')':p--;break;case';':case',':if(p==0)p--;break;}}
s+=pv.parse(js.substring(i,--j))+";}";i=j;}
re.lastIndex=j;}
s+=js.substring(i);return s;};}
pv.css=function(e,p){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(p):e.currentStyle[p];};pv.error=function(e){(typeof console=="undefined")?alert(e):console.error(e);};pv.listen=function(target,type,listener){if(type=='load'||type=='onload')
return pv.listenForPageLoad(pv.listener(listener));listener=pv.listener(listener);target.addEventListener?target.addEventListener(type,listener,false):target.attachEvent("on"+type,listener);return listener;};pv.unlisten=function(target,type,listener){if(listener.$listener){listener=listener.$listener;}
target.removeEventListener?target.removeEventListener(type,listener,false):target.detachEvent("on"+type,listener);};pv.listener=function(f){return f.$listener||(f.$listener=function(e){try{pv.event=e;return f.call(this,e);}catch(ex){pv.error(ex);}finally{delete pv.event;}});};pv.ancestor=function(a,e){while(e){if(e==a)return true;e=e.parentNode;}
return false;};pv.scrollOffset=function(elem){var left=0,top=0;while(elem){left+=elem.scrollLeft||0;top+=elem.scrollTop||0;elem=elem.parentNode;}
return[left,top];};pv.listenForPageLoad=function(listener){if(document.readyState==="complete"){listener();}
if(pv.renderer()=="svgweb"){window.addEventListener("SVGLoad",listener,false);}else{if(document.addEventListener){window.addEventListener("load",listener,false);}else if(document.attachEvent){window.attachEvent("onload",listener);}}};pv.renderer=function(){var renderer=(typeof document.svgImplementation!=="undefined")?document.svgImplementation:(typeof window.svgweb==="undefined")?"nativesvg":"svgweb";pv.renderer=function(){return renderer;};return renderer;};pv.id=function(){var id=1;return function(){return id++;};}();pv.functor=function(v){return typeof v=="function"?v:function(){return v;};};pv.get=function(o,p,dv){var v;return o&&(v=o[p])!=null?v:dv;};if(pv.renderer()!=="batik"){pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.xlen=pv.$.x.length;for(;pv.$.i<pv.$.xlen;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text));}catch(e){pv.error(e);}}}
delete pv.$;});}
pv.Format={};pv.Format.re=function(s){return s.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&");};pv.Format.pad=function(c,n,s){var m=n-String(s).length;return(m<1)?s:new Array(m+1).join(c)+s;};pv.Format.date=function(pattern){var pad=pv.Format.pad;function format(d){return pattern.replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case'%a':return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];case'%A':return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];case'%h':case'%b':return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()];case'%B':return["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()];case'%c':return d.toLocaleString();case'%C':return pad("0",2,Math.floor(d.getFullYear()/100)%100);case'%d':return pad("0",2,d.getDate());case'%x':case'%D':return pad("0",2,d.getMonth()+1)
+"/"+pad("0",2,d.getDate())
+"/"+pad("0",2,d.getFullYear()%100);case'%e':return pad(" ",2,d.getDate());case'%H':return pad("0",2,d.getHours());case'%I':{var h=d.getHours()%12;return h?pad("0",2,h):12;}
case'%m':return pad("0",2,d.getMonth()+1);case'%M':return pad("0",2,d.getMinutes());case'%n':return"\n";case'%p':return d.getHours()<12?"AM":"PM";case'%T':case'%X':case'%r':{var h=d.getHours()%12;return(h?pad("0",2,h):12)
+":"+pad("0",2,d.getMinutes())
+":"+pad("0",2,d.getSeconds())
+" "+(d.getHours()<12?"AM":"PM");}
case'%R':return pad("0",2,d.getHours())+":"+pad("0",2,d.getMinutes());case'%S':return pad("0",2,d.getSeconds());case'%Q':return pad("0",3,d.getMilliseconds());case'%t':return"\t";case'%u':{var w=d.getDay();return w?w:1;}
case'%w':return d.getDay();case'%y':return pad("0",2,d.getFullYear()%100);case'%Y':return d.getFullYear();case'%%':return"%";}
return s;});}
format.format=format;format.parse=function(s){var year=1970,month=0,date=1,hour=0,minute=0,second=0;var fields=[function(){}];var re=pv.Format.re(pattern).replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case'%b':{fields.push(function(x){month={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[x];});return"([A-Za-z]+)";}
case'%h':case'%B':{fields.push(function(x){month={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[x];});return"([A-Za-z]+)";}
case'%e':case'%d':{fields.push(function(x){date=x;});return"([0-9]+)";}
case'%I':case'%H':{fields.push(function(x){hour=x;});return"([0-9]+)";}
case'%m':{fields.push(function(x){month=x-1;});return"([0-9]+)";}
case'%M':{fields.push(function(x){minute=x;});return"([0-9]+)";}
case'%p':{fields.push(function(x){if(hour==12){if(x=="am")hour=0;}else if(x=="pm"){hour=Number(hour)+12;}});return"(am|pm)";}
case'%S':{fields.push(function(x){second=x;});return"([0-9]+)";}
case'%y':{fields.push(function(x){x=Number(x);year=x+(((0<=x)&&(x<69))?2000:(((x>=69)&&(x<100)?1900:0)));});return"([0-9]+)";}
case'%Y':{fields.push(function(x){year=x;});return"([0-9]+)";}
case'%%':{fields.push(function(){});return"%";}}
return s;});var match=s.match(re);if(match)match.forEach(function(m,i){fields[i](m);});return new Date(year,month,date,hour,minute,second);};return format;};pv.Format.time=function(type){var pad=pv.Format.pad;function format(t){t=Number(t);switch(type){case"short":{if(t>=31536e6){return(t/31536e6).toFixed(1)+" years";}else if(t>=6048e5){return(t/6048e5).toFixed(1)+" weeks";}else if(t>=864e5){return(t/864e5).toFixed(1)+" days";}else if(t>=36e5){return(t/36e5).toFixed(1)+" hours";}else if(t>=6e4){return(t/6e4).toFixed(1)+" minutes";}
return(t/1e3).toFixed(1)+" seconds";}
case"long":{var a=[],s=((t%6e4)/1e3)>>0,m=((t%36e5)/6e4)>>0;a.push(pad("0",2,s));if(t>=36e5){var h=((t%864e5)/36e5)>>0;a.push(pad("0",2,m));if(t>=864e5){a.push(pad("0",2,h));a.push(Math.floor(t/864e5).toFixed());}else{a.push(h.toFixed());}}else{a.push(m.toFixed());}
return a.reverse().join(":");}}}
format.format=format;format.parse=function(s){switch(type){case"short":{var re=/([0-9,.]+)\s*([a-z]+)/g,a,t=0;while(a=re.exec(s)){var f=parseFloat(a[0].replace(",","")),u=0;switch(a[2].toLowerCase()){case"year":case"years":u=31536e6;break;case"week":case"weeks":u=6048e5;break;case"day":case"days":u=864e5;break;case"hour":case"hours":u=36e5;break;case"minute":case"minutes":u=6e4;break;case"second":case"seconds":u=1e3;break;}
t+=f*u;}
return t;}
case"long":{var a=s.replace(",","").split(":").reverse(),t=0;if(a.length)t+=parseFloat(a[0])*1e3;if(a.length>1)t+=parseFloat(a[1])*6e4;if(a.length>2)t+=parseFloat(a[2])*36e5;if(a.length>3)t+=parseFloat(a[3])*864e5;return t;}}}
return format;};pv.Format.number=function(){var mini=0,maxi=Infinity,mins=0,minf=0,maxf=0,maxk=1,padi="0",padf="0",padg=true,decimal=".",group=",",np="\u2212",ns="";function format(x){if(Infinity>maxf)x=Math.round(x*maxk)/maxk;var s=String(Math.abs(x)).split(".");var i=s[0];if(i.length>maxi)i=i.substring(i.length-maxi);if(padg&&(i.length<mini))i=new Array(mini-i.length+1).join(padi)+i;if(i.length>3)i=i.replace(/\B(?=(?:\d{3})+(?!\d))/g,group);if(!padg&&(i.length<mins))i=new Array(mins-i.length+1).join(padi)+i;s[0]=x<0?np+i+ns:i;var f=s[1]||"";if(f.length>maxf){f=s[1]=f.substr(0,maxf);}
if(f.length<minf)s[1]=f+new Array(minf-f.length+1).join(padf);return s.join(decimal);}
format.format=format;format.parse=function(x){var re=pv.Format.re;var s=String(x).split(decimal);if(s.length==1)
s[1]="";s[0].replace(new RegExp("^("+re(padi)+")*"),"");s[1].replace(new RegExp("("+re(padf)+")*$"),"")
var i=s[0].replace(new RegExp(re(group),"g"),"");if(i.length>maxi)i=i.substring(i.length-maxi);var f=s[1]?Number("0."+s[1]):0;if(Infinity>maxf)f=Math.round(f*maxk)/maxk;return Math.round(i)+f;};format.integerDigits=function(min,max){if(arguments.length){mini=Number(min);maxi=(arguments.length>1)?Number(max):mini;mins=mini+Math.floor(mini/3)*group.length;return this;}
return[mini,maxi];};format.fractionDigits=function(min,max){if(arguments.length){minf=Number(min);maxf=(arguments.length>1)?Number(max):minf;maxk=Math.pow(10,maxf);return this;}
return[minf,maxf];};format.integerPad=function(x){if(arguments.length){padi=String(x);padg=/\d/.test(padi);return this;}
return padi;};format.fractionPad=function(x){if(arguments.length){padf=String(x);return this;}
return padf;};format.decimal=function(x){if(arguments.length){decimal=String(x);return this;}
return decimal;};format.group=function(x){if(arguments.length){group=x?String(x):"";mins=mini+Math.floor(mini/3)*group.length;return this;}
return group;};format.negativeAffix=function(x,y){if(arguments.length){np=String(x||"");ns=String(y||"");return this;}
return[np,ns];};return format;};pv.map=function(array,f){var o={};return f?array.map(function(d,i){o.index=i;return f.call(o,d);}):array.slice();};pv.repeat=function(array,n){if(arguments.length==1)n=2;return pv.blend(pv.range(n).map(function(){return array;}));};pv.array=function(len,dv){var a=len>=0?new Array(len):[];if(dv!==undefined){for(var i=0;i<len;i++){a[i]=dv;}}
return a;};pv.cross=function(a,b){var array=[];for(var i=0,n=a.length,m=b.length;i<n;i++){for(var j=0,x=a[i];j<m;j++){array.push([x,b[j]]);}}
return array;};pv.blend=function(arrays){return Array.prototype.concat.apply([],arrays);};pv.transpose=function(arrays){var n=arrays.length,m=pv.max(arrays,function(d){return d.length;});if(m>n){arrays.length=m;for(var i=n;i<m;i++){arrays[i]=new Array(n);}
for(var i=0;i<n;i++){for(var j=i+1;j<m;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}}else{for(var i=0;i<m;i++){arrays[i].length=n;}
for(var i=0;i<n;i++){for(var j=0;j<i;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}}
arrays.length=m;for(var i=0;i<m;i++){arrays[i].length=n;}
return arrays;};pv.normalize=function(array,f){var norm=pv.map(array,f),sum=pv.sum(norm);for(var i=0;i<norm.length;i++)norm[i]/=sum;return norm;};pv.permute=function(array,indexes,f){if(!f)f=pv.identity;var p=new Array(indexes.length),o={};indexes.forEach(function(j,i){o.index=j;p[i]=f.call(o,array[j]);});return p;};pv.numerate=function(keys,f){if(!f)f=pv.identity;var map={},o={};keys.forEach(function(x,i){o.index=i;map[f.call(o,x)]=i;});return map;};pv.uniq=function(array,f){if(!f)f=pv.identity;var map={},keys=[],o={},y;array.forEach(function(x,i){o.index=i;y=f.call(o,x);if(!(y in map))map[y]=keys.push(y);});return keys;};pv.naturalOrder=function(a,b){return(a<b)?-1:((a>b)?1:0);};pv.reverseOrder=function(b,a){return(a<b)?-1:((a>b)?1:0);};pv.search=function(array,value,f){if(!f)f=pv.identity;var low=0,high=array.length-1;while(low<=high){var mid=(low+high)>>1,midValue=f(array[mid]);if(midValue<value)low=mid+1;else if(midValue>value)high=mid-1;else return mid;}
return-low-1;};pv.search.index=function(array,value,f){var i=pv.search(array,value,f);return(i<0)?(-i-1):i;};pv.range=function(start,stop,step){if(arguments.length==1){stop=start;start=0;}
if(step==undefined)step=1;if((stop-start)/step==Infinity)throw new Error("range must be finite");var array=[],i=0,j;stop-=(stop-start)*1e-10;if(step<0){while((j=start+step*i++)>stop){array.push(j);}}else{while((j=start+step*i++)<stop){array.push(j);}}
return array;};pv.random=function(start,stop,step){if(arguments.length==1){stop=start;start=0;}
if(step==undefined)step=1;return step?(Math.floor(Math.random()*(stop-start)/step)*step+start):(Math.random()*(stop-start)+start);};pv.sum=function(array,f){var o={};return array.reduce(f?function(p,d,i){o.index=i;return p+f.call(o,d);}:function(p,d){return p+d;},0);};pv.max=function(array,f){if(f==pv.index)return array.length-1;return Math.max.apply(null,f?pv.map(array,f):array);};pv.max.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return array.length-1;if(!f)f=pv.identity;var maxi=0,maxx=-Infinity,o={};for(var i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x>maxx){maxx=x;maxi=i;}}
return maxi;};pv.min=function(array,f){if(f==pv.index)return 0;return Math.min.apply(null,f?pv.map(array,f):array);};pv.min.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return 0;if(!f)f=pv.identity;var mini=0,minx=Infinity,o={};for(var i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x<minx){minx=x;mini=i;}}
return mini;};pv.mean=function(array,f){return pv.sum(array,f)/array.length;};pv.median=function(array,f){if(f==pv.index)return(array.length-1)/2;array=pv.map(array,f).sort(pv.naturalOrder);if(array.length%2)return array[Math.floor(array.length/2)];var i=array.length/2;return(array[i-1]+array[i])/2;};pv.variance=function(array,f){if(array.length<1)return NaN;if(array.length==1)return 0;var mean=pv.mean(array,f),sum=0,o={};if(!f)f=pv.identity;for(var i=0;i<array.length;i++){o.index=i;var d=f.call(o,array[i])-mean;sum+=d*d;}
return sum;};pv.deviation=function(array,f){return Math.sqrt(pv.variance(array,f)/(array.length-1));};pv.log=function(x,b){return Math.log(x)/Math.log(b);};pv.logSymmetric=function(x,b){return(x==0)?0:((x<0)?-pv.log(-x,b):pv.log(x,b));};pv.logAdjusted=function(x,b){if(!isFinite(x))return x;var negative=x<0;if(x<b)x+=(b-x)/b;return negative?-pv.log(x,b):pv.log(x,b);};pv.logFloor=function(x,b){return(x>0)?Math.pow(b,Math.floor(pv.log(x,b))):-Math.pow(b,-Math.floor(-pv.log(-x,b)));};pv.logCeil=function(x,b){return(x>0)?Math.pow(b,Math.ceil(pv.log(x,b))):-Math.pow(b,-Math.ceil(-pv.log(-x,b)));};(function(){var radians=Math.PI/180,degrees=180/Math.PI;pv.radians=function(degrees){return radians*degrees;};pv.degrees=function(radians){return degrees*radians;};})();pv.keys=function(map){var array=[];for(var key in map){array.push(key);}
return array;};pv.entries=function(map){var array=[];for(var key in map){array.push({key:key,value:map[key]});}
return array;};pv.values=function(map){var array=[];for(var key in map){array.push(map[key]);}
return array;};pv.dict=function(keys,f){var m={},o={};for(var i=0;i<keys.length;i++){if(i in keys){var k=keys[i];o.index=i;m[k]=f.call(o,k);}}
return m;};pv.dom=function(map){return new pv.Dom(map);};pv.Dom=function(map){this.$map=map;};pv.Dom.prototype.$leaf=function(n){return typeof n!="object";};pv.Dom.prototype.leaf=function(f){if(arguments.length){this.$leaf=f;return this;}
return this.$leaf;};pv.Dom.prototype.root=function(nodeName){var leaf=this.$leaf,root=recurse(this.$map);function recurse(map){var n=new pv.Dom.Node();for(var k in map){var v=map[k];n.appendChild(leaf(v)?new pv.Dom.Node(v):recurse(v)).nodeName=k;}
return n;}
root.nodeName=nodeName;return root;};pv.Dom.prototype.nodes=function(){return this.root().nodes();};pv.Dom.Node=function(value){this.nodeValue=value;this.childNodes=[];};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype.removeChild=function(n){var i=this.childNodes.indexOf(n);if(i==-1)throw new Error("child not found");this.childNodes.splice(i,1);if(n.previousSibling)n.previousSibling.nextSibling=n.nextSibling;else this.firstChild=n.nextSibling;if(n.nextSibling)n.nextSibling.previousSibling=n.previousSibling;else this.lastChild=n.previousSibling;delete n.nextSibling;delete n.previousSibling;delete n.parentNode;return n;};pv.Dom.Node.prototype.appendChild=function(n){if(n.parentNode)n.parentNode.removeChild(n);n.parentNode=this;n.previousSibling=this.lastChild;if(this.lastChild)this.lastChild.nextSibling=n;else this.firstChild=n;this.lastChild=n;this.childNodes.push(n);return n;};pv.Dom.Node.prototype.insertBefore=function(n,r){if(!r)return this.appendChild(n);var i=this.childNodes.indexOf(r);if(i==-1)throw new Error("child not found");if(n.parentNode)n.parentNode.removeChild(n);n.parentNode=this;n.nextSibling=r;n.previousSibling=r.previousSibling;if(r.previousSibling){r.previousSibling.nextSibling=n;}else{if(r==this.lastChild)this.lastChild=n;this.firstChild=n;}
this.childNodes.splice(i,0,n);return n;};pv.Dom.Node.prototype.insertAt=function(n,index){var L;if(index==null||index===(L=this.childNodes.length)){return this.appendChild(n);}
if(index>L){throw new Error("Index out of range.");}
if(n.parentNode){n.parentNode.removeChild(n);}
var r=this.childNodes[index];n.parentNode=this;n.nextSibling=r;n.previousSibling=r.previousSibling;if(r.previousSibling){r.previousSibling.nextSibling=n;}else{if(r==this.lastChild){this.lastChild=n;}
this.firstChild=n;}
this.childNodes.splice(index,0,n);return n;};pv.Dom.Node.prototype.removeAt=function(i){var n=this.childNodes[i];if(n){this.childNodes.splice(i,1);if(n.previousSibling){n.previousSibling.nextSibling=n.nextSibling;}else{this.firstChild=n.nextSibling;}
if(n.nextSibling){n.nextSibling.previousSibling=n.previousSibling;}else{this.lastChild=n.previousSibling;}
delete n.nextSibling;delete n.previousSibling;delete n.parentNode;}
return n;};pv.Dom.Node.prototype.replaceChild=function(n,r){var i=this.childNodes.indexOf(r);if(i==-1)throw new Error("child not found");if(n.parentNode)n.parentNode.removeChild(n);n.parentNode=this;n.nextSibling=r.nextSibling;n.previousSibling=r.previousSibling;if(r.previousSibling)r.previousSibling.nextSibling=n;else this.firstChild=n;if(r.nextSibling)r.nextSibling.previousSibling=n;else this.lastChild=n;this.childNodes[i]=n;return r;};pv.Dom.Node.prototype.visitBefore=function(f){function visit(n,i){f(n,i);for(var c=n.firstChild;c;c=c.nextSibling){visit(c,i+1);}}
visit(this,0);};pv.Dom.Node.prototype.visitAfter=function(f){function visit(n,i){for(var c=n.firstChild;c;c=c.nextSibling){visit(c,i+1);}
f(n,i);}
visit(this,0);};pv.Dom.Node.prototype.sort=function(f){if(this.firstChild){this.childNodes.sort(f);var p=this.firstChild=this.childNodes[0],c;delete p.previousSibling;for(var i=1;i<this.childNodes.length;i++){p.sort(f);c=this.childNodes[i];c.previousSibling=p;p=p.nextSibling=c;}
this.lastChild=p;delete p.nextSibling;p.sort(f);}
return this;};pv.Dom.Node.prototype.reverse=function(){var childNodes=[];this.visitAfter(function(n){while(n.lastChild)childNodes.push(n.removeChild(n.lastChild));for(var c;c=childNodes.pop();)n.insertBefore(c,n.firstChild);});return this;};pv.Dom.Node.prototype.nodes=function(){var array=[];function flatten(node){array.push(node);node.childNodes.forEach(flatten);}
flatten(this,array);return array;};pv.Dom.Node.prototype.toggle=function(recursive){if(recursive)return this.toggled?this.visitBefore(function(n){if(n.toggled)n.toggle();}):this.visitAfter(function(n){if(!n.toggled)n.toggle();});var n=this;if(n.toggled){for(var c;c=n.toggled.pop();)n.appendChild(c);delete n.toggled;}else if(n.lastChild){n.toggled=[];while(n.lastChild)n.toggled.push(n.removeChild(n.lastChild));}};pv.nodes=function(values){var root=new pv.Dom.Node();for(var i=0;i<values.length;i++){root.appendChild(new pv.Dom.Node(values[i]));}
return root.nodes();};pv.tree=function(array){return new pv.Tree(array);};pv.Tree=function(array){this.array=array;};pv.Tree.prototype.keys=function(k){this.k=k;return this;};pv.Tree.prototype.value=function(v){this.v=v;return this;};pv.Tree.prototype.map=function(){var map={},o={};for(var i=0;i<this.array.length;i++){o.index=i;var value=this.array[i],keys=this.k.call(o,value),node=map;for(var j=0;j<keys.length-1;j++){node=node[keys[j]]||(node[keys[j]]={});}
node[keys[j]]=this.v?this.v.call(o,value):value;}
return map;};pv.nest=function(array){return new pv.Nest(array);};pv.Nest=function(array){this.array=array;this.keys=[];};pv.Nest.prototype.key=function(key){this.keys.push(key);return this;};pv.Nest.prototype.sortKeys=function(order){this.keys[this.keys.length-1].order=order||pv.naturalOrder;return this;};pv.Nest.prototype.sortValues=function(order){this.order=order||pv.naturalOrder;return this;};pv.Nest.prototype.map=function(){var map={},values=[];for(var i,j=0;j<this.array.length;j++){var x=this.array[j];var m=map;for(i=0;i<this.keys.length-1;i++){var k=this.keys[i](x);if(!m[k])m[k]={};m=m[k];}
k=this.keys[i](x);if(!m[k]){var a=[];values.push(a);m[k]=a;}
m[k].push(x);}
if(this.order){for(var i=0;i<values.length;i++){values[i].sort(this.order);}}
return map;};pv.Nest.prototype.entries=function(){function entries(map){var array=[];for(var k in map){var v=map[k];array.push({key:k,values:(v instanceof Array)?v:entries(v)});};return array;}
function sort(array,i){var o=this.keys[i].order;if(o)array.sort(function(a,b){return o(a.key,b.key);});if(++i<this.keys.length){for(var j=0;j<array.length;j++){sort.call(this,array[j].values,i);}}
return array;}
return sort.call(this,entries(this.map()),0);};pv.Nest.prototype.rollup=function(f){function rollup(map){for(var key in map){var value=map[key];if(value instanceof Array){map[key]=f(value);}else{rollup(value);}}
return map;}
return rollup(this.map());};pv.flatten=function(map){return new pv.Flatten(map);};pv.Flatten=function(map){this.map=map;this.keys=[];};pv.Flatten.prototype.key=function(key,f){this.keys.push({name:key,value:f});delete this.$leaf;return this;};pv.Flatten.prototype.leaf=function(f){this.keys.length=0;this.$leaf=f;return this;};pv.Flatten.prototype.array=function(){var entries=[],stack=[],keys=this.keys,leaf=this.$leaf;if(leaf){function recurse(value,i){if(leaf(value)){entries.push({keys:stack.slice(),value:value});}else{for(var key in value){stack.push(key);recurse(value[key],i+1);stack.pop();}}}
recurse(this.map,0);return entries;}
function visit(value,i){if(i<keys.length-1){for(var key in value){stack.push(key);visit(value[key],i+1);stack.pop();}}else{entries.push(stack.concat(value));}}
visit(this.map,0);return entries.map(function(stack){var m={};for(var i=0;i<keys.length;i++){var k=keys[i],v=stack[i];m[k.name]=k.value?k.value.call(null,v):v;}
return m;});};pv.vector=function(x,y){return new pv.Vector(x,y);};pv.Vector=function(x,y){this.x=x;this.y=y;};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x);};pv.Vector.prototype.rotate=function(angle){var c=Math.cos(angle);var s=Math.sin(angle);return new pv.Vector(c*this.x-s*this.y,s*this.x+c*this.y);};pv.Vector.prototype.norm=function(){var l=this.length();return this.times(l?(1/l):1);};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};pv.Vector.prototype.times=function(k){return new pv.Vector(this.x*k,this.y*k);};pv.Vector.prototype.plus=function(x,y){return(arguments.length==1)?new pv.Vector(this.x+x.x,this.y+x.y):new pv.Vector(this.x+x,this.y+y);};pv.Vector.prototype.minus=function(x,y){return(arguments.length==1)?new pv.Vector(this.x-x.x,this.y-x.y):new pv.Vector(this.x-x,this.y-y);};pv.Vector.prototype.dot=function(x,y){return(arguments.length==1)?this.x*x.x+this.y*x.y:this.x*x+this.y*y;};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(x,y){var v=new pv.Transform();v.k=this.k;v.x=this.k*x+this.x;v.y=this.k*y+this.y;return v;};pv.Transform.prototype.scale=function(k){var v=new pv.Transform();v.k=this.k*k;v.x=this.x;v.y=this.y;return v;};pv.Transform.prototype.invert=function(){var v=new pv.Transform(),k=1/this.k;v.k=k;v.x=-this.x*k;v.y=-this.y*k;return v;};pv.Transform.prototype.times=function(m){var v=new pv.Transform();v.k=this.k*m.k;v.x=this.k*m.x+this.x;v.y=this.k*m.y+this.y;return v;};pv.Scale=function(){};pv.Scale.interpolator=function(start,end){if(typeof start=="number"){return function(t){return t*(end-start)+start;};}
start=pv.color(start).rgb();end=pv.color(end).rgb();return function(t){var a=start.a*(1-t)+end.a*t;if(a<1e-5)a=0;return(start.a==0)?pv.rgb(end.r,end.g,end.b,a):((end.a==0)?pv.rgb(start.r,start.g,start.b,a):pv.rgb(Math.round(start.r*(1-t)+end.r*t),Math.round(start.g*(1-t)+end.g*t),Math.round(start.b*(1-t)+end.b*t),a));};};pv.Scale.quantitative=function(){var d=[0,1],l=[0,1],r=[0,1],i=[pv.identity],type=Number,n=false,f=pv.identity,g=pv.identity,tickFormat=String,tickFormatter=null,dateTickFormat,dateTickPrecision;function newDate(x){return new Date(x);}
function scale(x){var j=pv.search(d,x);if(j<0)j=-j-2;j=Math.max(0,Math.min(i.length-1,j));return i[j]((f(x)-l[j])/(l[j+1]-l[j]));}
scale.transform=function(forward,inverse){f=function(x){return n?-forward(-x):forward(x);};g=function(y){return n?-inverse(-y):inverse(y);};l=d.map(f);return this;};scale.domain=function(array,min,max){if(arguments.length){var o;if(array instanceof Array){if(arguments.length<2)min=pv.identity;if(arguments.length<3)max=min;o=array.length&&min(array[0]);d=array.length?[pv.min(array,min),pv.max(array,max)]:[];}else{o=array;d=Array.prototype.slice.call(arguments).map(Number);}
if(!d.length)d=[-Infinity,Infinity];else if(d.length==1)d=[d[0],d[0]];n=(d[0]||d[d.length-1])<0;l=d.map(f);type=(o instanceof Date)?newDate:Number;return this;}
return d.map(type);};scale.range=function(){if(arguments.length){r=Array.prototype.slice.call(arguments);if(!r.length)r=[-Infinity,Infinity];else if(r.length==1)r=[r[0],r[0]];i=[];for(var j=0;j<r.length-1;j++){i.push(pv.Scale.interpolator(r[j],r[j+1]));}
return this;}
return r;};scale.invert=function(y){var j=pv.search(r,y);if(j<0)j=-j-2;j=Math.max(0,Math.min(i.length-1,j));return type(g(l[j]+(y-r[j])/(r[j+1]-r[j])*(l[j+1]-l[j])));};scale.ticks=function(m,options){var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end,span=max-min;if(!span||!isFinite(span)){if(type==newDate)tickFormat=pv.Format.date("%x");return[type(min)];}
if(type==newDate){function floor(d,p){switch(p){case 31536e6:d.setMonth(0);case 2592e6:d.setDate(1);case 6048e5:if(p==6048e5)d.setDate(d.getDate()-d.getDay());case 864e5:d.setHours(0);case 36e5:d.setMinutes(0);case 6e4:d.setSeconds(0);case 1e3:d.setMilliseconds(0);}}
var nn=5;var precision,format,increment,step=1;if(span>=nn*31536e6){precision=31536e6;format="%Y";increment=function(d){d.setFullYear(d.getFullYear()+step);};}else if(span>=nn*2592e6){precision=2592e6;format="%m/%Y";increment=function(d){d.setMonth(d.getMonth()+step);};}else if(span>=nn*6048e5){precision=6048e5;format="%m/%d";increment=function(d){d.setDate(d.getDate()+7*step);};}else if(span>=nn*864e5){precision=864e5;format="%m/%d";increment=function(d){d.setDate(d.getDate()+step);};}else if(span>=nn*36e5){precision=36e5;format="%I:%M %p";increment=function(d){d.setHours(d.getHours()+step);};}else if(span>=nn*6e4){precision=6e4;format="%I:%M %p";increment=function(d){d.setMinutes(d.getMinutes()+step);};}else if(span>=nn*1e3){precision=1e3;format="%I:%M:%S";increment=function(d){d.setSeconds(d.getSeconds()+step);};}else{precision=1;format="%S.%Qs";increment=function(d){d.setTime(d.getTime()+step);};}
precision=dateTickPrecision?dateTickPrecision:precision;format=dateTickFormat?dateTickFormat:format;tickFormat=pv.Format.date(format);var date=new Date(min),dates=[];floor(date,precision);var n=span/precision;if(n>10){switch(precision){case 36e5:{step=(n>20)?6:3;date.setHours(Math.floor(date.getHours()/step)*step);break;}
case 2592e6:{step=(n>24)?3:((n>12)?2:1);date.setMonth(Math.floor(date.getMonth()/step)*step);break;}
case 6048e5:{step=(n>15)?3:(n>10?2:1);date.setDate(Math.floor(date.getDate()/(7*step))*(7*step));break;}
case 864e5:{step=(n>=30)?5:((n>=15)?3:2);date.setDate(Math.floor(date.getDate()/step)*step);break;}
case 6e4:{step=(n>30)?15:((n>15)?10:5);date.setMinutes(Math.floor(date.getMinutes()/step)*step);break;}
case 1e3:{step=(n>90)?15:((n>60)?10:5);date.setSeconds(Math.floor(date.getSeconds()/step)*step);break;}
case 1:{step=(n>1000)?250:((n>200)?100:((n>100)?50:((n>50)?25:5)));date.setMilliseconds(Math.floor(date.getMilliseconds()/step)*step);break;}
default:{step=pv.logCeil(n/15,10);if(n/step<2)step/=5;else if(n/step<5)step/=2;date.setFullYear(Math.floor(date.getFullYear()/step)*step);break;}}}
if(dateTickPrecision){step=1;increment=function(d){d.setSeconds(d.getSeconds()+step*dateTickPrecision/1000);};}
while(true){increment(date);if(date>max)break;dates.push(new Date(date));}
return reverse?dates.reverse():dates;}
if(m==null){m=10;}
var roundInside=pv.get(options,'roundInside',true);var exponentMin=pv.get(options,'numberExponentMin',-Infinity);var exponentMax=pv.get(options,'numberExponentMax',+Infinity);var exponent=Math.floor(pv.log(span/m,10));var overflow=false;if(exponent>exponentMax){exponent=exponentMax;overflow=true;}else if(exponent<exponentMin){exponent=exponentMin;overflow=true;}
var step=Math.pow(10,exponent);var mObtained=(span/step);var err=m/mObtained;if(err<=.15&&exponent<exponentMax-1){step*=10;}else if(err<=.35){step*=5;}else if(err<=.75){step*=2;}
exponent=Math.floor(pv.log(step,10)+1e-10);var start=step*Math[roundInside?'ceil':'floor'](min/step);var end=step*Math[roundInside?'floor':'ceil'](max/step);tickFormat=pv.Format.number().fractionDigits(Math.max(0,-exponent));var ticks=pv.range(start,end+step,step);if(reverse){ticks.reverse();}
ticks.roundInside=roundInside;ticks.step=step;ticks.exponent=exponent;ticks.exponentOverflow=overflow;ticks.exponentMin=exponentMin;ticks.exponentMax=exponentMax;return ticks;};scale.dateTickFormat=function(){if(arguments.length){dateTickFormat=arguments[0];return this;}
return dateTickFormat;};scale.dateTickPrecision=function(){if(arguments.length){dateTickPrecision=arguments[0];return this;}
return dateTickPrecision;};scale.tickFormatter=function(f){if(arguments.length){tickFormatter=f;return this;}
return tickFormatter;};scale.tickFormat=function(t){var formatter=tickFormatter||tickFormat;return formatter(t);};scale.nice=function(){if(d.length!=2)return this;var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end,span=max-min;if(!span||!isFinite(span))return this;var step=Math.pow(10,Math.round(Math.log(span)/Math.log(10))-1);d=[Math.floor(min/step)*step,Math.ceil(max/step)*step];if(reverse)d.reverse();l=d.map(f);return this;};scale.by=function(f){function by(){return scale(f.apply(this,arguments));}
for(var method in scale)by[method]=scale[method];return by;};scale.by1=function(f){function by1(x){return scale(f.call(this,x));}
for(var method in scale)by1[method]=scale[method];return by1;};scale.domain.apply(scale,arguments);return scale;};pv.Scale.linear=function(){var scale=pv.Scale.quantitative();scale.domain.apply(scale,arguments);return scale;};pv.Scale.log=function(){var scale=pv.Scale.quantitative(1,10),b,p,log=function(x){return Math.log(x)/p;},pow=function(y){return Math.pow(b,y);};scale.ticks=function(){var d=scale.domain(),n=d[0]<0,i=Math.floor(n?-log(-d[0]):log(d[0])),j=Math.ceil(n?-log(-d[1]):log(d[1])),ticks=[];if(n){ticks.push(-pow(-i));for(;i++<j;)for(var k=b-1;k>0;k--)ticks.push(-pow(-i)*k);}else{for(;i<j;i++)for(var k=1;k<b;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}
for(i=0;ticks[i]<d[0];i++);for(j=ticks.length;ticks[j-1]>d[1];j--);return ticks.slice(i,j);};scale.tickFormat=function(t){return t.toPrecision(1);};scale.nice=function(){var d=scale.domain();return scale.domain(pv.logFloor(d[0],b),pv.logCeil(d[1],b));};scale.base=function(v){if(arguments.length){b=Number(v);p=Math.log(b);scale.transform(log,pow);return this;}
return b;};scale.domain.apply(scale,arguments);return scale.base(10);};pv.Scale.root=function(){var scale=pv.Scale.quantitative();scale.power=function(v){if(arguments.length){var b=Number(v),p=1/b;scale.transform(function(x){return Math.pow(x,p);},function(y){return Math.pow(y,b);});return this;}
return b;};scale.domain.apply(scale,arguments);return scale.power(2);};pv.Scale.ordinal=function(){var d=[],i={},r=[],band=0;function scale(x){if(!(x in i))i[x]=d.push(x)-1;return r[i[x]%r.length];}
scale.domain=function(array,f){if(arguments.length){array=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);d=[];var seen={};for(var j=0;j<array.length;j++){var o=array[j];if(!(o in seen)){seen[o]=true;d.push(o);}}
i=pv.numerate(d);return this;}
return d;};scale.range=function(array,f){if(arguments.length){r=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);if(typeof r[0]=="string")r=r.map(pv.color);return this;}
return r;};scale.split=function(min,max){var R=max-min;var N=this.domain().length;var step=0;if(R===0){r=pv.array(N,min);}else if(N){step=(max-min)/N;r=pv.range(min+step/2,max,step);}
r.step=step;return this;};scale.splitBandedCenter=function(min,max,band){scale.split(min,max);if(band==null){band=1;}
r.band=r.step*band;r.margin=r.step-r.band;return this;};scale.splitBandedFlushCenter=function(min,max,band){if(band==null){band=1;}
var R=(max-min),N=this.domain().length,S=0,B=0,M=0;if(R===0){r=pv.array(N,min);}else if(N){B=(R*band)/N;M=N>1?((R-N*B)/(N-1)):0;S=M+B;r=pv.range(min+B/2,max,S);}
r.step=S;r.band=B;r.margin=M;return this;};scale.splitFlush=function(min,max){var n=this.domain().length,step=(max-min)/(n-1);r=(n==1)?[(min+max)/2]:pv.range(min,max+step/2,step);return this;};scale.splitBanded=function(min,max,band){if(arguments.length<3)band=1;if(band<0){var n=this.domain().length,total=-band*n,remaining=max-min-total,padding=remaining/(n+1);r=pv.range(min+padding,max,padding-band);r.band=-band;}else{var step=(max-min)/(this.domain().length+(1-band));r=pv.range(min+step*(1-band),max,step);r.band=step*band;r.step=step;r.margin=step-r.band;}
return this;};scale.by=function(f){function by(){return scale(f.apply(this,arguments));}
for(var method in scale)by[method]=scale[method];return by;};scale.by1=function(f){function by1(x){return scale(f.call(this,x));}
for(var method in scale)by1[method]=scale[method];return by1;};scale.domain.apply(scale,arguments);return scale;};pv.Scale.quantile=function(){var n=-1,j=-1,q=[],d=[],y=pv.Scale.linear();function scale(x){return y(Math.max(0,Math.min(j,pv.search.index(q,x)-1))/j);}
scale.quantiles=function(x){if(arguments.length){n=Number(x);if(n<0){q=[d[0]].concat(d);j=d.length-1;}else{q=[];q[0]=d[0];for(var i=1;i<=n;i++){q[i]=d[~~(i*(d.length-1)/n)];}
j=n-1;}
return this;}
return q;};scale.domain=function(array,f){if(arguments.length){d=(array instanceof Array)?pv.map(array,f):Array.prototype.slice.call(arguments);d.sort(pv.naturalOrder);scale.quantiles(n);return this;}
return d;};scale.range=function(){if(arguments.length){y.range.apply(y,arguments);return this;}
return y.range();};scale.by=function(f){function by(){return scale(f.apply(this,arguments));}
for(var method in scale)by[method]=scale[method];return by;};scale.by1=function(f){function by1(x){return scale(f.call(this,x));}
for(var method in scale)by1[method]=scale[method];return by1;};scale.domain.apply(scale,arguments);return scale;};pv.histogram=function(data,f){var frequency=true;return{bins:function(ticks){var x=pv.map(data,f),bins=[];if(!arguments.length)ticks=pv.Scale.linear(x).ticks();for(var i=0;i<ticks.length-1;i++){var bin=bins[i]=[];bin.x=ticks[i];bin.dx=ticks[i+1]-ticks[i];bin.y=0;}
for(var i=0;i<x.length;i++){var j=pv.search.index(ticks,x[i])-1,bin=bins[Math.max(0,Math.min(bins.length-1,j))];bin.y++;bin.push(data[i]);}
if(!frequency)for(var i=0;i<bins.length;i++){bins[i].y/=x.length;}
return bins;},frequency:function(x){if(arguments.length){frequency=Boolean(x);return this;}
return frequency;}};};pv.color=function(format){if(format.rgb)return format.rgb();var m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){var m2=m1[2].split(","),a=1;switch(m1[1]){case"hsla":case"rgba":{a=parseFloat(m2[3]);if(!a)return pv.Color.transparent;break;}}
switch(m1[1]){case"hsla":case"hsl":{var h=parseFloat(m2[0]),s=parseFloat(m2[1])/100,l=parseFloat(m2[2])/100;return(new pv.Color.Hsl(h,s,l,a)).rgb();}
case"rgba":case"rgb":{function parse(c){var f=parseFloat(c);return(c[c.length-1]=='%')?Math.round(f*2.55):f;}
var r=parse(m2[0]),g=parse(m2[1]),b=parse(m2[2]);return pv.rgb(r,g,b,a);}}}
var named=pv.Color.names[format];if(named)return named;if(format.charAt(0)=="#"){var r,g,b;if(format.length==4){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b;}else if(format.length==7){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7);}
return pv.rgb(parseInt(r,16),parseInt(g,16),parseInt(b,16),1);}
return new pv.Color(format,1);};pv.Color=function(color,opacity){this.color=color;this.opacity=opacity;};pv.Color.prototype.hsl=function(){return this.rgb().hsl();};pv.Color.prototype.brighter=function(k){return this.rgb().brighter(k);};pv.Color.prototype.darker=function(k){return this.rgb().darker(k);};pv.rgb=function(r,g,b,a){return new pv.Color.Rgb(r,g,b,(arguments.length==4)?a:1);};pv.Color.Rgb=function(r,g,b,a){pv.Color.call(this,a?("rgb("+r+","+g+","+b+")"):"none",a);this.r=r;this.g=g;this.b=b;this.a=a;};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(r){return pv.rgb(r,this.g,this.b,this.a);};pv.Color.Rgb.prototype.green=function(g){return pv.rgb(this.r,g,this.b,this.a);};pv.Color.Rgb.prototype.blue=function(b){return pv.rgb(this.r,this.g,b,this.a);};pv.Color.Rgb.prototype.alpha=function(a){return pv.rgb(this.r,this.g,this.b,a);};pv.Color.Rgb.prototype.rgb=function(){return this;};pv.Color.Rgb.prototype.brighter=function(k){k=Math.pow(0.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return pv.rgb(i,i,i,this.a);if(r&&(r<i))r=i;if(g&&(g<i))g=i;if(b&&(b<i))b=i;return pv.rgb(Math.min(255,Math.floor(r/k)),Math.min(255,Math.floor(g/k)),Math.min(255,Math.floor(b/k)),this.a);};pv.Color.Rgb.prototype.darker=function(k){k=Math.pow(0.7,arguments.length?k:1);return pv.rgb(Math.max(0,Math.floor(k*this.r)),Math.max(0,Math.floor(k*this.g)),Math.max(0,Math.floor(k*this.b)),this.a);};pv.Color.Rgb.prototype.hsl=function(){var r=this.r/255;var g=this.g/255;var b=this.b/255;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var l=(max+min)/2;var h,s;if(max===min){h=s=0;}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return pv.hsl(h*360,s,l,this.a);};pv.hsl=function(h,s,l,a){return new pv.Color.Hsl(h,s,l,(arguments.length==4)?a:1);};pv.Color.Hsl=function(h,s,l,a){pv.Color.call(this,"hsl("+h+","+(s*100)+"%,"+(l*100)+"%)",a);this.h=h;this.s=s;this.l=l;this.a=a;};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hsl=function(){return this;};pv.Color.Hsl.prototype.hue=function(h){return pv.hsl(h,this.s,this.l,this.a);};pv.Color.Hsl.prototype.saturation=function(s){return pv.hsl(this.h,s,this.l,this.a);};pv.Color.Hsl.prototype.lightness=function(l){return pv.hsl(this.h,this.s,l,this.a);};pv.Color.Hsl.prototype.alpha=function(a){return pv.hsl(this.h,this.s,this.l,a);};pv.Color.Hsl.prototype.rgb=function(){var h=this.h,s=this.s,l=this.l;h=h%360;if(h<0)h+=360;s=Math.max(0,Math.min(s,1));l=Math.max(0,Math.min(l,1));var m2=(l<=.5)?(l*(1+s)):(l+s-l*s);var m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return pv.rgb(vv(h+120),vv(h),vv(h-120),this.a);};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var names=pv.Color.names;names.none=names.transparent;for(var name in names)names[name]=pv.color(names[name]);})();pv.colors=function(){var scale=pv.Scale.ordinal();scale.range.apply(scale,arguments);return scale;};pv.Colors={};pv.Colors.category10=function(){var scale=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category20=function(){var scale=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category19=function(){var scale=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");scale.domain.apply(scale,arguments);return scale;};(function(){pv.fillStyle=function(format){if(format.type){return format;}
if(format.rgb){return new pv.FillStyle.Solid(format.color,format.opacity);}
var match=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(format);if(match){switch(match[1]){case"linear-gradient":return parseLinearGradient(match[2]);case"radial-gradient":return parseRadialGradient(match[2]);}}
return new pv.FillStyle.Solid(pv.color(format));};var keyAnglesDeg={top:0,'top right':45,right:90,'bottom right':135,bottom:180,'bottom left':225,left:270,'top left':315};function parseLinearGradient(text){var terms=parseText(text);if(!terms.length){return null;}
var angle=Math.PI;var keyAngle;var m,f;var term=terms[0];if(term.indexOf('to ')===0){m=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(term);if(m){if(m[1]){keyAngle=m[2];if(m[3]){keyAngle+=' '+m[3];}}else{keyAngle=m[5];if(m[6]){keyAngle=m[6]+' '+keyAngle;}}
angle=pv.radians(keyAnglesDeg[keyAngle]);terms.shift();}}else{f=parseFloat(term);if(!isNaN(f)){angle=f;if(/^.*?deg$/.test(term)){angle=pv.radians(angle);}
terms.shift();}}
var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.LinearGradient(angle,stops);}
function parseRadialGradient(text){var terms=parseText(text);if(!terms.length){return null;}
var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.RadialGradient(50,50,stops);}
function parseText(text){var colorFuns={};var colorFunId=0;text=text.replace(/\b\w+?\(.*?\)/g,function($0){var id='__color'+(colorFunId++);colorFuns[id]=$0;return id;});var terms=text.split(/\s*,\s*/);if(!terms.length){return null;}
if(colorFunId){terms.forEach(function(id,index){if(colorFuns.hasOwnProperty(id)){terms[index]=colorFuns[id];}});}
return terms;}
function parseStops(terms){var stops=[];var minOffsetPercent=+Infinity;var maxOffsetPercent=-Infinity;var pendingOffsetStops=[];function processPendingStops(lastOffset){var count=pendingOffsetStops.length;if(count){var firstOffset=maxOffsetPercent;var step=(lastOffset-firstOffset)/(count+1);for(var i=0;i<count;i++){firstOffset+=step;pendingOffsetStops[i].offset=firstOffset;}
pendingOffsetStops.length=0;}}
var i=0;var T=terms.length;while(i<T){var term=terms[i++];var m=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(term);if(m){var stop={color:pv.color(m[1])};var offsetPercent=parseFloat(m[2]);if(isNaN(offsetPercent)){if(!stops.length){offsetPercent=0;}else if(i===T){offsetPercent=Math.max(maxOffsetPercent,100);}}
stops.push(stop);if(isNaN(offsetPercent)){pendingOffsetStops.push(stop);}else{stop.offset=offsetPercent;processPendingStops(offsetPercent);if(offsetPercent>maxOffsetPercent){maxOffsetPercent=offsetPercent;}else if(offsetPercent<maxOffsetPercent){offsetPercent=maxOffsetPercent;}
if(offsetPercent<minOffsetPercent){minOffsetPercent=offsetPercent;}}}}
if(stops.length>=2&&(minOffsetPercent<0||maxOffsetPercent>100)){var colorDomain=[];var colorRange=[];stops.forEach(function(stop){colorDomain.push(stop.offset);colorRange.push(stop.color);});var colorScale=pv.scale.linear().domain(colorDomain).range(colorRange);if(minOffsetPercent<0){while(stops.length&&stops[0].offset<=0){stops.shift();}
stops.unshift({offset:0,color:colorScale(0)});}
if(maxOffsetPercent>100){while(stops.length&&stops[stops.length-1].offset>=100){stops.pop();}
stops.push({offset:100,color:colorScale(100)});}}
return stops;}
var FillStyle=pv.FillStyle=function(type){this.type=type;};FillStyle.prototype=new pv.Color('none',1);FillStyle.prototype.rgb=function(){var color=pv.color(this.color);if(this.opacity!==color.opacity){color=color.alpha(this.opacity);}
return color;};var Solid=pv.FillStyle.Solid=function(color,opacity){FillStyle.call(this,'solid');if(color.rgb){this.color=color.color;this.opacity=color.opacity;}else{this.color=color;this.opacity=opacity;}};Solid.prototype=pv.extend(pv.FillStyle);Solid.prototype.alpha=function(opacity){return new Solid(this.color,opacity);};Solid.prototype.brighter=function(k){return new Solid(this.rgb().brighter(k));};Solid.prototype.darker=function(k){return new Solid(this.color.darker(k));};pv.FillStyle.transparent=new Solid(pv.Color.transparent);var gradient_id=0;var Gradient=pv.FillStyle.Gradient=function(type,stops){FillStyle.call(this,type);this.id=++gradient_id;this.stops=stops;if(stops.length){this.color=stops[0].color.color;}};Gradient.prototype=pv.extend(pv.FillStyle);Gradient.prototype.rgb=function(){return this.stops.length?this.stops[0].color:undefined;};Gradient.prototype.alpha=function(opacity){return this._clone(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.alpha(opacity)};}));};Gradient.prototype.darker=function(k){return this._clone(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.darker(k)};}));};Gradient.prototype.brighter=function(k){return this._clone(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.brighter(k)};}));};var LinearGradient=pv.FillStyle.LinearGradient=function(angle,stops){Gradient.call(this,'lineargradient',stops);this.angle=angle;};LinearGradient.prototype=pv.extend(Gradient);LinearGradient.prototype._clone=function(stops){return new LinearGradient(this.angle,stops);};var RadialGradient=pv.FillStyle.RadialGradient=function(cx,cy,stops){Gradient.call(this,'radialgradient',stops);this.cx=cx;this.cy=cy;};RadialGradient.prototype=pv.extend(Gradient);RadialGradient.prototype._clone=function(stops){return new RadialGradient(this.cx,this.cy,stops);};})();pv.ramp=function(start,end){var scale=pv.Scale.linear();scale.range.apply(scale,arguments);return scale;};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted","x":0,"y":0,"dy":0,"text-anchor":"start","transform":"translate(0,0)","fill":"none","fill-opacity":1,"stroke":"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter","stroke-linecap":"butt","stroke-miterlimit":8,"stroke-dasharray":"none"},css:{"font":"10px sans-serif"}}};pv.SvgScene.updateAll=function(scenes){if(scenes.length&&scenes[0].reverse&&(scenes.type!="line")&&(scenes.type!="area")){var reversed=pv.extend(scenes);for(var i=0,j=scenes.length-1;j>=0;i++,j--){reversed[i]=scenes[j];}
scenes=reversed;}
this.removeSiblings(this[scenes.type](scenes));};pv.SvgScene.create=function(type){return document.createElementNS(this.svg,type);};pv.SvgScene.expect=function(e,type,scenes,i,attributes,style){if(e){var tagName=e.tagName;if(tagName==="defs")e=e.nextSibling;if(tagName==="a")e=e.firstChild;if(tagName!==type){var n=this.create(type);e.parentNode.replaceChild(n,e);e=n;}}else{e=this.create(type);}
if(attributes)this.setAttributes(e,attributes);if(style)this.setStyle(e,style);return e;};pv.SvgScene.setAttributes=function(e,attributes){var implicitSvg=this.implicit.svg;for(var name in attributes){var value=attributes[name];if(value==null||value==implicitSvg[name]){e.removeAttribute(name);}else{e.setAttribute(name,value);}}};pv.SvgScene.setStyle=function(e,style){var implicitCss=this.implicit.css;switch(pv.renderer()){case'batik':for(var name in style){var value=style[name];if(value==null||value==implicitCss[name]){e.removeAttribute(name);}else{e.style.setProperty(name,value);}}
break;case'svgweb':for(var name in style){var value=style[name];if(value==null||value==implicitCss[name]){continue;}
e.style[name]=value;}
break;default:for(var name in style){var value=style[name];if(value==null||value==implicitCss[name]){e.style.removeProperty(name);}else{e.style[name]=value;}}}};pv.SvgScene.append=function(e,scenes,index){e.$scene={scenes:scenes,index:index};e=this.title(e,scenes[index]);if(!e.parentNode)scenes.$g.appendChild(e);return e.nextSibling;};pv.SvgScene.title=function(e,s){var a=e.parentNode;if(a&&(a.tagName!="a"))a=null;if(s.title){if(!a){a=this.create("a");a.setAttributeNS(this.xlink,"xlink:href","");if(e.parentNode)e.parentNode.replaceChild(a,e);a.appendChild(e);}
a.setAttributeNS(this.xlink,"xlink:title",s.title);var t=null;for(var c=e.firstChild;c!=null;c=c.nextSibling){if(c.nodeName=="title"){t=c;break;}}
if(!t){t=this.create("title");e.appendChild(t);}else{t.removeChild(t.firstChild);}
if(pv.renderer()=="svgweb"){t.appendChild(document.createTextNode(s.title,true));}else{t.appendChild(document.createTextNode(s.title));}
return a;}
if(a)a.parentNode.replaceChild(e,a);return e;};pv.SvgScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var type=e.type;switch(type){case"DOMMouseScroll":{type="mousewheel";e.wheel=-480*e.detail;break;}
case"mousewheel":{e.wheel=(window.opera?12:1)*e.wheelDelta;break;}}
if(pv.Mark.dispatch(type,t.scenes,t.index,e))e.preventDefault();}});pv.SvgScene.removeSiblings=function(e){while(e){var n=e.nextSibling;if(e.nodeName!='defs'){e.parentNode.removeChild(e);}
e=n;}};pv.SvgScene.undefined=function(){};pv.SvgScene.removeFillStyleDefinitions=function(scenes){var results=scenes.$g.getElementsByTagName('defs');if(results.length===1){var defs=results[0];var cur=defs.firstChild;while(cur){var next=cur.nextSibling;if(cur.nodeName=='linearGradient'||cur.nodeName=='radialGradient'){defs.removeChild(cur);}
cur=next;}}};(function(){var dashAliasMap={'-':'shortdash','.':'shortdot','-.':'shortdashdot','-..':'shortdashdotdot','. ':'dot','- ':'dash','--':'longdash','- .':'dashdot','--.':'longdashdot','--..':'longdashdotdot'};var dashMap={'shortdash':[3,1],'shortdot':[1,1],'shortdashdot':[3,1,1,1],'shortdashdotdot':[3,1,1,1,1,1],'dot':[1,3],'dash':[4,3],'longdash':[8,3],'dashdot':[4,3,1,3],'longdashdot':[8,3,1,3],'longdashdotdot':[8,3,1,3,1,3]};pv.SvgScene.isStandardDashStyle=function(dashArray){return dashMap.hasOwnProperty(dashArray);};pv.SvgScene.translateDashStyleAlias=function(dashArray){return dashAliasMap.hasOwnProperty(dashArray)?dashAliasMap[dashArray]:dashArray;};pv.SvgScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&dashArray!=='none'){dashArray=this.translateDashStyleAlias(dashArray);var standardDashArray=dashMap[dashArray];if(standardDashArray){dashArray=standardDashArray;}else{dashArray=dashArray.split(/[\s,]+/);}
var lineWidth=s.lineWidth;var lineCap=s.lineCap||'butt';var isButtCap=lineCap==='butt';dashArray=dashArray.map(function(num,index){num=+num;if(!isButtCap){if(index%2){num+=1;}else{num-=1;}}
if(num<=0){num=.001;}
return num*lineWidth/this.scale;},this).join(' ');}else{dashArray=null;}
return dashArray;};})();(function(){var gradient_definition_id=0;pv.SvgScene.addFillStyleDefinition=function(scenes,fill){var isLinear=fill.type==='lineargradient';if(isLinear||fill.type==='radialgradient'){var g=scenes.$g;var results=g.getElementsByTagName('defs');var defs;if(results.length){defs=results[0];}else{defs=g.appendChild(this.create("defs"));}
var elem;var className='__pv_gradient'+fill.id;results=undefined;if(!results){var instId='__pv_gradient'+fill.id+'_inst_'+(++gradient_definition_id);elem=defs.appendChild(this.create(isLinear?"linearGradient":"radialGradient"));elem.setAttribute("id",instId);elem.setAttribute("class",className);if(isLinear){var svgAngle=fill.angle-Math.PI/2;var diagAngle=Math.abs(svgAngle%(Math.PI/2))-Math.PI/4;var radius=Math.abs((Math.SQRT2/2)*Math.cos(diagAngle));var dirx=radius*Math.cos(svgAngle);var diry=radius*Math.sin(svgAngle);var x1=0.5-dirx;var y1=0.5-diry;var x2=0.5+dirx;var y2=0.5+diry;elem.setAttribute("x1",x1);elem.setAttribute("y1",y1);elem.setAttribute("x2",x2);elem.setAttribute("y2",y2);}else{}
var stops=fill.stops;for(var i=0,S=stops.length;i<S;i++){var stop=stops[i];var stopElem=elem.appendChild(this.create("stop"));var color=stop.color;stopElem.setAttribute("offset",stop.offset+'%');stopElem.setAttribute("stop-color",color.color);stopElem.setAttribute("stop-opacity",color.opacity+'');}
fill.color='url(#'+instId+')';}}};})();pv.SvgScene.pathBasis=(function(){var basis=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];function weight(w,p0,p1,p2,p3){return{x:w[0]*p0.left+w[1]*p1.left+w[2]*p2.left+w[3]*p3.left,y:w[0]*p0.top+w[1]*p1.top+w[2]*p2.top+w[3]*p3.top};}
var convert=function(p0,p1,p2,p3){var b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return"C"+b1.x+","+b1.y
+","+b2.x+","+b2.y
+","+b3.x+","+b3.y;};convert.segment=function(p0,p1,p2,p3){var b0=weight(basis[0],p0,p1,p2,p3),b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return"M"+b0.x+","+b0.y
+"C"+b1.x+","+b1.y
+","+b2.x+","+b2.y
+","+b3.x+","+b3.y;};return convert;})();pv.SvgScene.curveBasis=function(points){if(points.length<=2)return"";var path="",p0=points[0],p1=p0,p2=p0,p3=points[1];path+=this.pathBasis(p0,p1,p2,p3);for(var i=2;i<points.length;i++){p0=p1;p1=p2;p2=p3;p3=points[i];path+=this.pathBasis(p0,p1,p2,p3);}
path+=this.pathBasis(p1,p2,p3,p3);path+=this.pathBasis(p2,p3,p3,p3);return path;};pv.SvgScene.curveBasisSegments=function(points){if(points.length<=2)return"";var paths=[],p0=points[0],p1=p0,p2=p0,p3=points[1],firstPath=this.pathBasis.segment(p0,p1,p2,p3);p0=p1;p1=p2;p2=p3;p3=points[2];paths.push(firstPath+this.pathBasis(p0,p1,p2,p3));for(var i=3;i<points.length;i++){p0=p1;p1=p2;p2=p3;p3=points[i];paths.push(this.pathBasis.segment(p0,p1,p2,p3));}
paths.push(this.pathBasis.segment(p1,p2,p3,p3)+this.pathBasis(p2,p3,p3,p3));return paths;};pv.SvgScene.curveHermite=function(points,tangents){if(tangents.length<1||(points.length!=tangents.length&&points.length!=tangents.length+2))return"";var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p.left-t0.x*2/3)+","+(p.top-t0.y*2/3)
+","+p.left+","+p.top;p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0.left+t0.x)+","+(p0.top+t0.y)
+","+(p.left-t.x)+","+(p.top-t.y)
+","+p.left+","+p.top;for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p.left-t.x)+","+(p.top-t.y)
+","+p.left+","+p.top;}}
if(quad){var lp=points[pi];path+="Q"+(p.left+t.x*2/3)+","+(p.top+t.y*2/3)+","
+lp.left+","+lp.top;}
return path;};pv.SvgScene.curveHermiteSegments=function(points,tangents){if(tangents.length<1||(points.length!=tangents.length&&points.length!=tangents.length+2))return[];var quad=points.length!=tangents.length,paths=[],p0=points[0],p=p0,t0=tangents[0],t=t0,pi=1;if(quad){p=points[1];paths.push("M"+p0.left+","+p0.top
+"Q"+(p.left-t.x*2/3)+","+(p.top-t.y*2/3)
+","+p.left+","+p.top);pi=2;}
for(var i=1;i<tangents.length;i++,pi++){p0=p;t0=t;p=points[pi];t=tangents[i];paths.push("M"+p0.left+","+p0.top
+"C"+(p0.left+t0.x)+","+(p0.top+t0.y)
+","+(p.left-t.x)+","+(p.top-t.y)
+","+p.left+","+p.top);}
if(quad){var lp=points[pi];paths.push("M"+p.left+","+p.top
+"Q"+(p.left+t.x*2/3)+","+(p.top+t.y*2/3)+","
+lp.left+","+lp.top);}
return paths;};pv.SvgScene.cardinalTangents=function(points,tension){var tangents=[],a=(1-tension)/2,p0=points[0],p1=points[1],p2=points[2];for(var i=3;i<points.length;i++){tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});p0=p1;p1=p2;p2=points[i];}
tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});return tangents;};pv.SvgScene.curveCardinal=function(points,tension){if(points.length<=2)return"";return this.curveHermite(points,this.cardinalTangents(points,tension));};pv.SvgScene.curveCardinalSegments=function(points,tension){if(points.length<=2)return"";return this.curveHermiteSegments(points,this.cardinalTangents(points,tension));};pv.SvgScene.monotoneTangents=function(points){var tangents=[],d=[],m=[],dx=[],k=0;for(k=0;k<points.length-1;k++){d[k]=(points[k+1].top-points[k].top)/(points[k+1].left-points[k].left);}
m[0]=d[0];dx[0]=points[1].left-points[0].left;for(k=1;k<points.length-1;k++){m[k]=(d[k-1]+d[k])/2;dx[k]=(points[k+1].left-points[k-1].left)/2;}
m[k]=d[k-1];dx[k]=(points[k].left-points[k-1].left);for(k=0;k<points.length-1;k++){if(d[k]==0){m[k]=0;m[k+1]=0;}}
for(k=0;k<points.length-1;k++){if((Math.abs(m[k])<1e-5)||(Math.abs(m[k+1])<1e-5))continue;var ak=m[k]/d[k],bk=m[k+1]/d[k],s=ak*ak+bk*bk;if(s>9){var tk=3/Math.sqrt(s);m[k]=tk*ak*d[k];m[k+1]=tk*bk*d[k];}}
var len;for(var i=0;i<points.length;i++){len=1+m[i]*m[i];tangents.push({x:dx[i]/3/len,y:m[i]*dx[i]/3/len});}
return tangents;};pv.SvgScene.curveMonotone=function(points){if(points.length<=2)return"";return this.curveHermite(points,this.monotoneTangents(points));};pv.SvgScene.curveMonotoneSegments=function(points){if(points.length<=2)return"";return this.curveHermiteSegments(points,this.monotoneTangents(points));};pv.SvgScene.area=function(scenes){var e=scenes.$g.firstChild;this.removeFillStyleDefinitions(scenes);if(!scenes.length)return e;var s=scenes[0];if(s.segmented)return this.areaSegment(scenes);if(!s.visible)return e;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)return e;if(fill.type&&fill.type!=='solid'){this.addFillStyleDefinition(scenes,fill);}
if(stroke.type&&stroke.type!='solid'){this.addFillStyleDefinition(scenes,stroke);}
function path(i,j){var p1=[],p2=[];for(var k=j;i<=k;i++,j--){var si=scenes[i],sj=scenes[j],pi=si.left+","+si.top,pj=(sj.left+sj.width)+","+(sj.top+sj.height);if(i<k){var sk=scenes[i+1],sl=scenes[j-1];switch(s.interpolate){case"step-before":{pi+="V"+sk.top;pj+="H"+(sl.left+sl.width);break;}
case"step-after":{pi+="H"+sk.left;pj+="V"+(sl.top+sl.height);break;}}}
p1.push(pi);p2.push(pj);}
return p1.concat(p2).join("L");}
function pathCurve(i,j){var pointsT=[],pointsB=[],pathT,pathB;for(var k=j;i<=k;i++,j--){var sj=scenes[j];pointsT.push(scenes[i]);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
if(s.interpolate=="basis"){pathT=pv.SvgScene.curveBasis(pointsT);pathB=pv.SvgScene.curveBasis(pointsB);}else if(s.interpolate=="cardinal"){pathT=pv.SvgScene.curveCardinal(pointsT,s.tension);pathB=pv.SvgScene.curveCardinal(pointsB,s.tension);}else{pathT=pv.SvgScene.curveMonotone(pointsT);pathB=pv.SvgScene.curveMonotone(pointsB);}
return pointsT[0].left+","+pointsT[0].top+pathT
+"L"+pointsB[0].left+","+pointsB[0].top+pathB;}
var d=[],si,sj;for(var i=0;i<scenes.length;i++){si=scenes[i];if(!si.width&&!si.height)continue;for(var j=i+1;j<scenes.length;j++){sj=scenes[j];if(!sj.width&&!sj.height)break;}
if(i&&(s.interpolate!="step-after"))i--;if((j<scenes.length)&&(s.interpolate!="step-before"))j++;d.push(((j-i>2&&(s.interpolate=="basis"||s.interpolate=="cardinal"||s.interpolate=="monotone"))?pathCurve:path)(i,j-1));i=j-1;}
if(!d.length)return e;e=this.expect(e,"path",scenes,0,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"d":"M"+d.join("ZM")+"Z","fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);return this.append(e,scenes,0);};pv.SvgScene.areaSegment=function(scenes){var e=scenes.$g.firstChild,s=scenes[0],pathsT,pathsB;if(s.interpolate=="basis"||s.interpolate=="cardinal"||s.interpolate=="monotone"){var pointsT=[],pointsB=[];for(var i=0,n=scenes.length;i<n;i++){var sj=scenes[n-i-1];pointsT.push(scenes[i]);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
if(s.interpolate=="basis"){pathsT=this.curveBasisSegments(pointsT);pathsB=this.curveBasisSegments(pointsB);}else if(s.interpolate=="cardinal"){pathsT=this.curveCardinalSegments(pointsT,s.tension);pathsB=this.curveCardinalSegments(pointsB,s.tension);}else{pathsT=this.curveMonotoneSegments(pointsT);pathsB=this.curveMonotoneSegments(pointsB);}}
for(var i=0,n=scenes.length-1;i<n;i++){var s1=scenes[i],s2=scenes[i+1];if(!s1.visible||!s2.visible)continue;var fill=s1.fillStyle,stroke=s1.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;var d;if(pathsT){var pathT=pathsT[i],pathB="L"+pathsB[n-i-1].substr(1);d=pathT+pathB+"Z";}else{var si=s1,sj=s2;switch(s1.interpolate){case"step-before":si=s2;break;case"step-after":sj=s1;break;}
d="M"+s1.left+","+si.top
+"L"+s2.left+","+sj.top
+"L"+(s2.left+s2.width)+","+(sj.top+sj.height)
+"L"+(s1.left+s1.width)+","+(si.top+si.height)
+"Z";}
e=this.expect(e,"path",scenes,i,{"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,"cursor":s1.cursor,"d":d,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null});if(s1.svg)this.setAttributes(e,s1.svg);if(s1.css)this.setStyle(e,s1.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.minBarWidth=1;pv.SvgScene.minBarHeight=1;pv.SvgScene.minBarLineWidth=1;pv.SvgScene.bar=function(scenes){var e=scenes.$g.firstChild;this.removeFillStyleDefinitions(scenes);for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible||Math.abs(s.width)<=1E-10||Math.abs(s.height)<=1E-10)continue;if(s.width<this.minBarWidth){s.width=this.minBarWidth;}
if(s.height<this.minBarHeight){s.height=this.minBarHeight;}
var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;if(fill.type&&fill.type!=='solid'){this.addFillStyleDefinition(scenes,fill);}
if(stroke.type&&stroke.type!='solid'){this.addFillStyleDefinition(scenes,stroke);}
var lineWidth;if(stroke.opacity){lineWidth=s.lineWidth;if(lineWidth<1e-10){lineWidth=0;}else{lineWidth=Math.max(this.minBarLineWidth,lineWidth/this.scale);}}else{lineWidth=null;}
e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":Math.max(1E-10,s.width),"height":Math.max(1E-10,s.height),"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.dot=function(scenes){var e=scenes.$g.firstChild;this.removeFillStyleDefinitions(scenes);for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;if(fill.type&&fill.type!=='solid'){this.addFillStyleDefinition(scenes,fill);}
if(stroke.type&&stroke.type!='solid'){this.addFillStyleDefinition(scenes,stroke);}
var radius=s.shapeRadius,path=null;switch(s.shape){case"cross":{path="M"+-radius+","+-radius
+"L"+radius+","+radius
+"M"+radius+","+-radius
+"L"+-radius+","+radius;break;}
case"triangle":{var h=radius,w=radius*1.1547;path="M0,"+h
+"L"+w+","+-h
+" "+-w+","+-h
+"Z";break;}
case"diamond":{radius*=Math.SQRT2;path="M0,"+-radius
+"L"+radius+",0"
+" 0,"+radius
+" "+-radius+",0"
+"Z";break;}
case"square":{path="M"+-radius+","+-radius
+"L"+radius+","+-radius
+" "+radius+","+radius
+" "+-radius+","+radius
+"Z";break;}
case"tick":{path="M0,0L0,"+-s.shapeSize;break;}
case"bar":{path="M0,"+(s.shapeSize/2)+"L0,"+-(s.shapeSize/2);break;}}
var svg={"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null};if(path){svg.transform="translate("+s.left+","+s.top+")";if(s.shapeAngle)svg.transform+=" rotate("+180*s.shapeAngle/Math.PI+")";svg.d=path;e=this.expect(e,"path",scenes,i,svg);}else{svg.cx=s.left;svg.cy=s.top;svg.r=radius;e=this.expect(e,"circle",scenes,i,svg);}
if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.image=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;e=this.fill(e,scenes,i);if(s.image){e=this.expect(e,"foreignObject",scenes,i,{"cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);var c=e.firstChild||e.appendChild(document.createElementNS(this.xhtml,"canvas"));c.$scene={scenes:scenes,index:i};c.style.width=s.width;c.style.height=s.height;c.width=s.imageWidth;c.height=s.imageHeight;c.getContext("2d").putImageData(s.image,0,0);}else{e=this.expect(e,"image",scenes,i,{"preserveAspectRatio":"none","cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e.setAttributeNS(this.xlink,"xlink:href",s.url);}
e=this.append(e,scenes,i);e=this.stroke(e,scenes,i);}
return e;};pv.SvgScene.label=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.textStyle;if(!fill.opacity||!s.text)continue;var x=0,y=0,dy=0,anchor="start";switch(s.textBaseline){case"middle":if(pv.renderer()=='svgweb')
y=3;else
dy=".35em";break;case"top":if(pv.renderer()=='svgweb'){y=9+s.textMargin;}else{dy=".71em";y=s.textMargin;}
break;case"bottom":y="-"+s.textMargin;break;}
switch(s.textAlign){case"right":anchor="end";x="-"+s.textMargin;break;case"center":anchor="middle";break;case"left":x=s.textMargin;break;}
e=this.expect(e,"text",scenes,i,{"pointer-events":s.events,"cursor":s.cursor,"x":x,"y":y,"dy":dy,"transform":"translate("+s.left+","+s.top+")"
+(s.textAngle?" rotate("+180*s.textAngle/Math.PI+")":"")
+(this.scale!=1?" scale("+1/this.scale+")":""),"fill":fill.color,"fill-opacity":fill.opacity||null,"text-anchor":anchor},{"font":s.font,"text-shadow":s.textShadow,"text-decoration":s.textDecoration});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);if(e.firstChild)e.firstChild.nodeValue=s.text;else{if(pv.renderer()=="svgweb"){e.appendChild(document.createTextNode(s.text,true));}else{e.appendChild(document.createTextNode(s.text));}}
e=this.append(e,scenes,i);}
return e;};pv.SvgScene.line=function(scenes){var e=scenes.$g.firstChild;this.removeFillStyleDefinitions(scenes);if(scenes.length<2)return e;var s=scenes[0];if(s.segmented)return this.lineSegment(scenes);if(!s.visible)return e;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)return e;if(stroke.type&&stroke.type!='solid'){this.addFillStyleDefinition(scenes,stroke);}
var d="M"+s.left+","+s.top;if(scenes.length>2&&(s.interpolate=="basis"||s.interpolate=="cardinal"||s.interpolate=="monotone")){switch(s.interpolate){case"basis":d+=this.curveBasis(scenes);break;case"cardinal":d+=this.curveCardinal(scenes,s.tension);break;case"monotone":d+=this.curveMonotone(scenes);break;}}else{for(var i=1;i<scenes.length;i++){d+=this.pathSegment(scenes[i-1],scenes[i]);}}
e=this.expect(e,"path",scenes,0,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"d":d,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);return this.append(e,scenes,0);};pv.SvgScene.lineSegment=function(scenes){var e=scenes.$g.firstChild;var s=scenes[0];var paths;switch(s.interpolate){case"basis":paths=this.curveBasisSegments(scenes);break;case"cardinal":paths=this.curveCardinalSegments(scenes,s.tension);break;case"monotone":paths=this.curveMonotoneSegments(scenes);break;}
for(var i=0,n=scenes.length-1;i<n;i++){var s1=scenes[i],s2=scenes[i+1];if(!s1.visible||!s2.visible)continue;var stroke=s1.strokeStyle,fill=pv.FillStyle.transparent;if(!stroke.opacity)continue;var d;if((s1.interpolate=="linear")&&(s1.lineJoin=="miter")){fill=stroke;stroke=pv.FillStyle.transparent;d=this.pathJoin(scenes[i-1],s1,s2,scenes[i+2]);}else if(paths){d=paths[i];}else{d="M"+s1.left+","+s1.top+this.pathSegment(s1,s2);}
e=this.expect(e,"path",scenes,i,{"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,"cursor":s1.cursor,"d":d,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null,"stroke-linejoin":s1.lineJoin});if(s1.svg)this.setAttributes(e,s1.svg);if(s1.css)this.setStyle(e,s1.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.pathSegment=function(s1,s2){var l=1;switch(s1.interpolate){case"polar-reverse":l=0;case"polar":{var dx=s2.left-s1.left,dy=s2.top-s1.top,e=1-s1.eccentricity,r=Math.sqrt(dx*dx+dy*dy)/(2*e);if((e<=0)||(e>1))break;return"A"+r+","+r+" 0 0,"+l+" "+s2.left+","+s2.top;}
case"step-before":return"V"+s2.top+"H"+s2.left;case"step-after":return"H"+s2.left+"V"+s2.top;}
return"L"+s2.left+","+s2.top;};pv.SvgScene.lineIntersect=function(o1,d1,o2,d2){return o1.plus(d1.times(o2.minus(o1).dot(d2.perp())/d1.dot(d2.perp())));};pv.strokeMiterLimit=4;pv.SvgScene.pathJoin=function(s0,s1,s2,s3){var pts=[];var miterLimit,miterRatio,miterLength;var w1=s1.lineWidth/this.scale;var p1=pv.vector(s1.left,s1.top);var p2=pv.vector(s2.left,s2.top);var p21=p2.minus(p1);var v21=p21.perp().norm();var w21=v21.times(w1/2);var a=p1.plus(w21);var d=p1.minus(w21);var b=p2.plus(w21);var c=p2.minus(w21);if(!s0||!s0.visible){pts.push(d,a);}else{var p0=pv.vector(s0.left,s0.top);var p10=p1.minus(p0);var v10=p10.perp().norm();var v1=v10.plus(v21).norm();var am=this.lineIntersect(p1,v1,a,p21);var dm=this.lineIntersect(p1,v1,d,p21);miterLength=am.minus(dm).length();var w0=s0.lineWidth/this.scale;var w10avg=(w1+w0)/2;miterRatio=miterLength/w10avg;miterLimit=s1.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit){pts.push(dm,am);}else{var p12=p21.times(-1);var v1Outer=p10.norm().plus(p12.norm()).norm();var bevel10=p1.plus(v1Outer.times(w10avg/2));if(v1Outer.dot(v21)>=0){pts.push(dm,bevel10,a);}else{pts.push(d,bevel10,am);}}}
if(!s3||!s3.visible){pts.push(b,c);}else{var p3=pv.vector(s3.left,s3.top);var p32=p3.minus(p2);var v32=p32.perp().norm();var v2=v32.plus(v21).norm();var bm=this.lineIntersect(p2,v2,b,p21);var cm=this.lineIntersect(p2,v2,c,p21);miterLength=bm.minus(cm).length();var w3=s3.lineWidth/this.scale;var w31avg=(w3+w1)/2;miterRatio=miterLength/w31avg;miterLimit=s2.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit){pts.push(bm,cm);}else{var p23=p32.times(-1);var v2Outer=p21.norm().plus(p23.norm()).norm();var bevel31=p2.plus(v2Outer.times(w31avg/2));if(v2Outer.dot(v21)>=0){pts.push(b,bevel31,cm);}else{pts.push(bm,bevel31,c);}}}
var pt=pts.shift();return"M"+pt.x+","+pt.y+"L"+pts.map(function(pt2){return pt2.x+","+pt2.y;}).join(" ");};pv.SvgScene.panel=function(scenes){var g=scenes.$g,e=g&&g.firstChild;var complete=false;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;if(!scenes.parent){if(pv.renderer()!=="batik"){s.canvas.style.display="inline-block";}
if(g&&(g.parentNode!=s.canvas)){g=s.canvas.firstChild;e=g&&g.firstChild;}
if(!g){g=this.create(pv.renderer()!=="batik"?"svg":"g");g.setAttribute("font-size","10px");g.setAttribute("font-family","sans-serif");g.setAttribute("fill","none");g.setAttribute("stroke","none");g.setAttribute("stroke-width",1.5);if(pv.renderer()==="svgweb"){g.setAttribute("width",s.width+s.left+s.right);g.setAttribute("height",s.height+s.top+s.bottom);var frag=document.createDocumentFragment(true);g.addEventListener('SVGLoad',function(){var me=this;(function(){if(complete){complete=false;me.appendChild(frag);for(var j=0;j<pv.Scene.events.length;j++){me.addEventListener(pv.Scene.events[j],pv.SvgScene.dispatch,false);}
scenes.$g=me;scenes.$g.__ready=true;}else{setTimeout(arguments.callee,10);}})();},false);svgweb.appendChild(g,s.canvas);g=frag;}else{for(var j=0;j<this.events.length;j++){g.addEventListener(this.events[j],this.dispatch,false);}
g=s.canvas.appendChild(g);g.__ready=true;}
e=g.firstChild;}
scenes.$g=g;if(g.__ready){g.setAttribute("width",s.width+s.left+s.right);g.setAttribute("height",s.height+s.top+s.bottom);}}
if(s.overflow=="hidden"){var id=pv.id().toString(36),c=this.expect(e,"g",scenes,i,{"clip-path":"url(#"+id+")"});if(!c.parentNode)g.appendChild(c);scenes.$g=g=c;e=c.firstChild;e=this.expect(e,"clipPath",scenes,i,{"id":id});var r=e.firstChild||e.appendChild(this.create("rect"));r.setAttribute("x",s.left);r.setAttribute("y",s.top);r.setAttribute("width",s.width);r.setAttribute("height",s.height);if(!e.parentNode)g.appendChild(e);e=e.nextSibling;}
e=this.fill(e,scenes,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;this.eachChild(scenes,i,function(childScenes){childScenes.$g=e=this.expect(e,"g",scenes,i,{"transform":"translate("+x+","+y+")"+
(t.k!=1?" scale("+t.k+")":"")});this.updateAll(childScenes);if(!e.parentNode)g.appendChild(e);e=e.nextSibling;});this.scale=k;e=this.stroke(e,scenes,i);if(s.overflow=="hidden"){scenes.$g=g=c.parentNode;e=c.nextSibling;}}
complete=true;return e;};pv.SvgScene.eachChild=function(scenes,i,fun,ctx){if(scenes.mark.zOrderChildCount){var sorted=scenes[i].children.slice(0);sorted.sort(function(scenes1,scenes2){return scenes1.mark._zOrder-scenes2.mark._zOrder;});sorted.forEach(fun,ctx||this);}else{scenes[i].children.forEach(fun,ctx||this);}};pv.SvgScene.fill=function(e,scenes,i){this.removeFillStyleDefinitions(scenes);var s=scenes[i],fill=s.fillStyle;if(fill.opacity||s.events=="all"){if(fill.type&&fill.type!=='solid'){this.addFillStyleDefinition(scenes,fill);}
e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height,"fill":fill.color,"fill-opacity":fill.opacity,"stroke":null});e=this.append(e,scenes,i);}
return e;};pv.SvgScene.stroke=function(e,scenes,i){var s=scenes[i],stroke=s.strokeStyle;if(stroke.opacity||s.events=="all"){e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events=="all"?"stroke":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":Math.max(1E-10,s.width),"height":Math.max(1E-10,s.height),"fill":null,"stroke":stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":s.lineWidth/this.scale,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});e=this.append(e,scenes,i);}
return e;};pv.SvgScene.minRuleLineWidth=1;pv.SvgScene.rule=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var stroke=s.strokeStyle;if(!stroke.opacity)continue;var lineWidth=s.lineWidth;if(lineWidth<1e-10){lineWidth=0;}else{lineWidth=Math.max(this.minRuleLineWidth,lineWidth/this.scale);}
e=this.expect(e,"line",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x1":s.left,"y1":s.top,"x2":s.left+s.width,"y2":s.top+s.height,"stroke":stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.wedge=function(scenes){var e=scenes.$g.firstChild;this.removeFillStyleDefinitions(scenes);for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;var r1=s.innerRadius,r2=s.outerRadius,a=Math.abs(s.angle),p;if(a>=2*Math.PI){if(r1){p="M0,"+r2
+"A"+r2+","+r2+" 0 1,1 0,"+(-r2)
+"A"+r2+","+r2+" 0 1,1 0,"+r2
+"M0,"+r1
+"A"+r1+","+r1+" 0 1,1 0,"+(-r1)
+"A"+r1+","+r1+" 0 1,1 0,"+r1
+"Z";}else{p="M0,"+r2
+"A"+r2+","+r2+" 0 1,1 0,"+(-r2)
+"A"+r2+","+r2+" 0 1,1 0,"+r2
+"Z";}}else{var sa=Math.min(s.startAngle,s.endAngle),ea=Math.max(s.startAngle,s.endAngle),c1=Math.cos(sa),c2=Math.cos(ea),s1=Math.sin(sa),s2=Math.sin(ea);if(r1){p="M"+r2*c1+","+r2*s1
+"A"+r2+","+r2+" 0 "
+((a<Math.PI)?"0":"1")+",1 "
+r2*c2+","+r2*s2
+"L"+r1*c2+","+r1*s2
+"A"+r1+","+r1+" 0 "
+((a<Math.PI)?"0":"1")+",0 "
+r1*c1+","+r1*s1+"Z";}else{p="M"+r2*c1+","+r2*s1
+"A"+r2+","+r2+" 0 "
+((a<Math.PI)?"0":"1")+",1 "
+r2*c2+","+r2*s2+"L0,0Z";}}
if(fill.type&&fill.type!=='solid'){this.addFillStyleDefinition(scenes,fill);}
if(stroke.type&&stroke.type!='solid'){this.addFillStyleDefinition(scenes,stroke);}
e=this.expect(e,"path",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"transform":"translate("+s.left+","+s.top+")","d":p,"fill":fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.Mark=function(){this.$properties=[];this.$propertiesMap={};this.$handlers={};};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(name,cast){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties);}
this.properties[name]=true;pv.Mark.prototype.propertyMethod(name,false,pv.Mark.cast[name]=cast);return this;};pv.Mark.prototype.localProperty=function(name,cast){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties);}
this.properties[name]=true;var currCast=pv.Mark.cast[name];if(cast){pv.Mark.cast[name]=currCast=cast;}
this.propertyMethod(name,false,currCast);return this;};pv.Mark.prototype.propertyMethod=function(name,def,cast){if(!cast)cast=pv.Mark.cast[name];this[name]=function(v){if(def&&this.scene){var defs=this.scene.defs;if(arguments.length){defs[name]={id:(v==null)?0:pv.id(),value:((v!=null)&&cast)?cast(v):v};return this;}
return defs[name]?defs[name].value:null;}
if(arguments.length){var type=!def<<1|(typeof v==="function");var vf;if(type&1&&cast){vf=pv.Mark.funPropertyCaller(v,cast);}else if(v!=null&&cast){vf=cast(v);}else{vf=v;}
this.setPropertyValue(name,vf,type);return this;}
var propEval=pv.propertyEval;if(propEval){var binds=this.binds;var propRead=binds.properties[name];if(propRead){var net=binds.net;var readNetIndex=net[name];if(readNetIndex==null){readNetIndex=net[name]=0;}
(propRead.dependents||(propRead.dependents={}))
[propEval.name]=true;(pv.propertyEvalDependencies||(pv.propertyEvalDependencies={}))
[name]=true;if(readNetIndex>=pv.propertyEvalNetIndex){pv.propertyEvalNetIndex=readNetIndex+1;}}}
return this.instance()[name];};};pv.Mark.funPropertyCaller=function(fun,cast){var stack=pv.Mark.stack;return function(){var value=fun.apply(this,stack);return value!=null?cast(value):null;};};pv.Mark.prototype.setPropertyValue=function(name,v,type){var propertiesMap=this.$propertiesMap;var properties=this.$properties;var p={name:name,id:pv.id(),value:v,type:type};var specified=propertiesMap[name];propertiesMap[name]=p;if(specified){for(var i=0;i<properties.length;i++){if(properties[i]===specified){properties.splice(i,1);break;}}}
properties.push(p);return p;};pv.Mark.prototype.propertyValue=function(name){var p=this.$propertiesMap[name];if(p){return p.value;}};pv.Mark.stack=[];pv.Mark.prototype.property("data").property("visible",Boolean).property("datum",Object).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype._zOrder=0;pv.Mark.prototype.defaults=new pv.Mark().data(function(d){return[d];}).datum(function(){var parent=this.parent;return parent?parent.scene[parent.index].datum:null;}).visible(true).antialias(true).events("painted");pv.Mark.prototype.extend=function(proto){this.proto=proto;this.target=proto.target;return this;};pv.Mark.prototype.add=function(type){return this.parent.add(type).extend(this);};pv.Mark.prototype.def=function(name,v){this.propertyMethod(name,true);return this[name](arguments.length>1?v:null);};pv.Mark.prototype.zOrder=function(zOrder){if(!arguments.length){return this._zOrder;}
zOrder=(+zOrder)||0;if(this._zOrder!==zOrder){if(this._zOrder!==0&&this.parent){this.parent.zOrderChildCount--;}
this._zOrder=zOrder;if(this._zOrder!==0&&this.parent){this.parent.zOrderChildCount++;}}
return this;};pv.Mark.prototype.anchor=function(name){if(!name)name="center";return new pv.Anchor(this).name(name).data(function(){return this.scene.target.map(function(s){return s.data;});}).datum(function(){return this.scene.target[this.index].datum;}).visible(function(){return this.scene.target[this.index].visible;}).id(function(){return this.scene.target[this.index].id;}).left(function(){var s=this.scene.target[this.index],w=s.width||0;switch(this.name()){case"bottom":case"top":case"center":return s.left+w/2;case"left":return null;}
return s.left+w;}).top(function(){var s=this.scene.target[this.index],h=s.height||0;switch(this.name()){case"left":case"right":case"center":return s.top+h/2;case"top":return null;}
return s.top+h;}).right(function(){var s=this.scene.target[this.index];return this.name()=="left"?s.right+(s.width||0):null;}).bottom(function(){var s=this.scene.target[this.index];return this.name()=="top"?s.bottom+(s.height||0):null;}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top";}
return"bottom";});};pv.Mark.prototype.anchorTarget=function(){return this.target;};pv.Mark.prototype.margin=function(n){return this.left(n).right(n).top(n).bottom(n);};pv.Mark.prototype.instance=function(defaultIndex){var scene=this.scene||this.parent.instance(-1).children[this.childIndex],index=!arguments.length||this.hasOwnProperty("index")?this.index:defaultIndex;return scene[index<0?scene.length-1:index];};pv.Mark.prototype.instances=function(source){var mark=this,index=[],scene;while(!(scene=mark.scene)){source=source.parent;index.push({index:source.index,childIndex:mark.childIndex});mark=mark.parent;}
while(index.length){var i=index.pop();scene=scene[i.index].children[i.childIndex];}
if(this.hasOwnProperty("index")){var s=pv.extend(scene[this.index]);s.right=s.top=s.left=s.bottom=0;return[s];}
return scene;};pv.Mark.prototype.first=function(){return this.scene[0];};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1];};pv.Mark.prototype.sibling=function(){return(this.index==0)?null:this.scene[this.index-1];};pv.Mark.prototype.cousin=function(){var p=this.parent,s=p&&p.sibling();return(s&&s.children)?s.children[this.childIndex][this.index]:null;};pv.Mark.prototype.render=function(){if(this.parent&&!this.root.scene){this.root.render();return;}
this.renderCore();};pv.Mark.prototype.renderCore=function(){var parent=this.parent,stack=pv.Mark.stack;var indexes=[];for(var mark=this;mark.parent;mark=mark.parent){indexes.unshift(mark.childIndex);}
function render(mark,depth,scale){mark.scale=scale;if(depth<indexes.length){stack.unshift(null);if(mark.hasOwnProperty("index")){renderInstance(mark,depth,scale);}else{for(var i=0,n=mark.scene.length;i<n;i++){mark.index=i;renderInstance(mark,depth,scale);}
delete mark.index;}
stack.shift();}else{mark.build();pv.Scene.scale=scale;var id=null;if(mark.scene&&mark.scene.$g&&mark.scene.$g.suspendRedraw)
id=mark.scene.$g.suspendRedraw(1000);pv.Scene.updateAll(mark.scene);if(id)
mark.scene.$g.unsuspendRedraw(id);}
delete mark.scale;}
function renderInstance(mark,depth,scale){var s=mark.scene[mark.index],i;if(s.visible){var childIndex=indexes[depth],child=mark.children[childIndex];for(i=0;i<childIndex;i++){mark.children[i].scene=s.children[i];}
stack[0]=s.data;if(child.scene){render(child,depth+1,scale*s.transform.k);}else{child.scene=s.children[childIndex];render(child,depth+1,scale*s.transform.k);delete child.scene;}
for(i=0;i<childIndex;i++){delete mark.children[i].scene;}}}
this.bind();while(parent&&!parent.hasOwnProperty("index"))parent=parent.parent;this.context(parent?parent.scene:undefined,parent?parent.index:-1,function(){render(this.root,0,1);});};pv.Mark._requiredPropsPosition={id:0,datum:1,visible:3};pv.Mark.prototype.bind=function(){var seen={},data,required=[],types=[[],[],[],[]],requiredPositions=pv.Mark._requiredPropsPosition;function bind(mark){do{var properties=mark.$properties;for(var i=properties.length-1;i>=0;i--){var p=properties[i];if(!(p.name in seen)){seen[p.name]=p;switch(p.name){case"data":data=p;break;case"datum":case"visible":case"id":required.push(p);break;default:types[p.type].push(p);break;}}}}while(mark=mark.proto);}
bind(this);bind(this.defaults);required.sort(function(pa,pb){return requiredPositions[pa.name]-requiredPositions[pb.name];});types[1].reverse();types[3].reverse();var mark=this;do{for(var name in mark.properties){if(!(name in seen)){types[2].push(seen[name]={name:name,type:2,value:null});}}}while(mark=mark.proto);var defs=types[0].concat(types[1]);for(var i=0;i<defs.length;i++){this.propertyMethod(defs[i].name,true);}
this.binds={properties:seen,net:{},data:data,defs:defs,required:required,optional:pv.blend(types)};};pv.Mark.prototype.updateNet=function(pDependent,netIndex){var binds=this.binds;var props=binds.properties;var net=binds.net;propagateRecursive(pDependent,netIndex);function propagateRecursive(p,minNetIndex){if(minNetIndex>(net[p.name]||0)){net[p.name]=minNetIndex;var deps=p.dependents;if(deps){minNetIndex++;for(var depName in deps){if(deps.hasOwnProperty(depName)){var pDep=props[depName];if(pDep){propagateRecursive(pDep,minNetIndex);}}}}}}};pv.Mark.prototype.build=function(){var scene=this.scene,stack=pv.Mark.stack;if(!scene){scene=this.scene=[];scene.mark=this;scene.type=this.type;scene.childIndex=this.childIndex;if(this.parent){scene.parent=this.parent.scene;scene.parentIndex=this.parent.index;}}
if(this.target)scene.target=this.target.instances(scene);if(this.binds.defs.length){var defs=scene.defs;if(!defs)scene.defs=defs={};for(var i=0;i<this.binds.defs.length;i++){var p=this.binds.defs[i],d=defs[p.name];if(!d||(p.id>d.id)){defs[p.name]={id:0,value:(p.type&1)?p.value.apply(this,stack):p.value};}}}
var data=this.binds.data;data=data.type&1?data.value.apply(this,stack):data.value;var markProto=pv.Mark.prototype;stack.unshift(null);try{var L=scene.length=data.length;for(var i=0;i<L;i++){markProto.index=this.index=i;var s=scene[i]||(scene[i]={});s.data=stack[0]=data[i];this.buildInstance(s);}}finally{markProto.index=-1;delete this.index;stack.shift();}
return this;};pv.Mark.prototype.buildProperties=function(s,properties){var stack=pv.Mark.stack;for(var i=0,n=properties.length;i<n;i++){var p=properties[i];var v=p.value;switch(p.type){case 3:v=v.apply(this,stack);break;case 2:break;case 0:case 1:v=this.scene.defs[p.name].value;break;}
s[p.name]=v;}};pv.Mark.prototype.buildPropertiesWithDepTracking=function(s,properties){var net=this.binds.net;var netIndex,newNetIndex,netDirtyProps,prevNetDirtyProps,propertyIndexes,evaluatedProps;var stack=pv.Mark.stack;var n=properties.length;try{while(true){netDirtyProps=null;evaluatedProps={};for(var i=0;i<n;i++){var p=properties[i];var name=p.name;evaluatedProps[name]=true;if(!prevNetDirtyProps||prevNetDirtyProps[name]){var v=p.value;switch(p.type){case 0:case 1:v=this.scene.defs[name].value;break;case 3:pv.propertyEval=p;pv.propertyEvalNetIndex=netIndex=(net[name]||0);pv.propertyEvalDependencies=null;v=v.apply(this,stack);newNetIndex=pv.propertyEvalNetIndex;if(newNetIndex>netIndex){var evalDeps=pv.propertyEvalDependencies;for(var depName in evalDeps){if(evalDeps.hasOwnProperty(depName)&&!evaluatedProps.hasOwnProperty(name)){if(!netDirtyProps){netDirtyProps={};}
netDirtyProps[depName]=true;}}
this.updateNet(p,newNetIndex);}
break;}
s[name]=v;}}
if(!netDirtyProps){break;}
prevNetDirtyProps=netDirtyProps;propertyIndexes=pv.numerate(properties,function(p){return p.name;});properties.sort(function(pa,pb){var comp=pv.naturalOrder(net[pa.name]||0,net[pb.name]||0);if(!comp){comp=pv.naturalOrder(propertyIndexes[pa.name],propertyIndexes[pb.name]);}
return comp;});propertyIndexes=null;}}finally{pv.propertyEval=null;pv.propertyEvalNetIndex=null;pv.propertyEvalDependencies=null;}};pv.Mark.prototype.buildInstance=function(s){this.buildProperties(s,this.binds.required);if(s.visible){if(this.index===0){this.buildPropertiesWithDepTracking(s,this.binds.optional);}else{this.buildProperties(s,this.binds.optional);}
this.buildImplied(s);}};pv.Mark.prototype.buildImplied=function(s){var l=s.left;var r=s.right;var t=s.top;var b=s.bottom;var p=this.properties;var w=p.width?s.width:0;var h=p.height?s.height:0;var instance;var checked;if(w==null||r==null||l==null){instance=this.parent?this.parent.instance():null;checked=true;var width=instance?instance.width:(w+l+r);if(w==null){w=width-(r=r||0)-(l=l||0);}else if(r==null){if(l==null){l=r=(width-w)/2;}else{r=width-w-l;}}else{l=width-w-r;}}
if(h==null||b==null||t==null){if(!checked){instance=this.parent?this.parent.instance():null;}
var height=instance?instance.height:(h+t+b);if(h==null){h=height-(t=t||0)-(b=b||0);}else if(b==null){if(t==null){b=t=(height-h)/2;}else{b=height-h-t;}}else{t=height-h-b;}}
s.left=l;s.right=r;s.top=t;s.bottom=b;if(p.width)s.width=w;if(p.height)s.height=h;if(p.textStyle&&!s.textStyle)s.textStyle=pv.FillStyle.transparent;if(p.fillStyle&&!s.fillStyle)s.fillStyle=pv.FillStyle.transparent;if(p.strokeStyle&&!s.strokeStyle)s.strokeStyle=pv.FillStyle.transparent;};pv.Mark.prototype.mouse=function(){var n=this.root.canvas(),scrollOffset=pv.scrollOffset(n),ev=pv.event,x=scrollOffset[0]+ev.clientX*1,y=scrollOffset[1]+ev.clientY*1;if(pv.renderer()!=='svgweb'){do{x-=n.offsetLeft;y-=n.offsetTop;}while((n=n.offsetParent));}
var t=pv.Transform.identity,p=this.properties.transform?this:this.parent,pz=[];do{pz.push(p);}while((p=p.parent));while((p=pz.pop())){var pinst=p.instance();t=t.translate(pinst.left,pinst.top).times(pinst.transform);}
t=t.invert();return pv.vector(x*t.k+t.x,y*t.k+t.y);};pv.Mark.prototype.event=function(type,handler){handler=pv.functor(handler);var handlers=this.$handlers[type];if(!handlers){handlers=handler;}else if(handlers instanceof Array){handlers.push(handler);}else{handlers=[handlers,handler];}
this.$handlers[type]=handlers;return this;};pv.Mark.prototype.context=function(scene,index,f){var proto=pv.Mark.prototype,stack=pv.Mark.stack,oscene=pv.Mark.scene,oindex=proto.index;function apply(scene,index){pv.Mark.scene=scene;proto.index=index;if(!scene){return;}
var that=scene.mark,mark=that,ancestors=[];do{ancestors.push(mark);stack.push(scene[index].data);mark.index=index;mark.scene=scene;index=scene.parentIndex;scene=scene.parent;}while(mark=mark.parent);for(var i=ancestors.length-1,k=1;i>0;i--){mark=ancestors[i];mark.scale=k;k*=mark.scene[mark.index].transform.k;}
var children=that.children;if(children){var thatInstance=that.scene[that.index];for(var i=0,n=children.length;i<n;i++){mark=children[i];mark.scene=thatInstance.children[i];mark.scale=k;}}}
function clear(scene,index){if(!scene)return;var that=scene.mark,mark;var children=that.children;if(children){for(var i=0,n=children.length;i<n;i++){mark=children[i];delete mark.scene;delete mark.scale;}}
mark=that;do{stack.pop();if(mark.parent){delete mark.scene;delete mark.scale;}
delete mark.index;}while(mark=mark.parent);}
if(scene&&scene===oscene&&index===oindex){try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{pv.Mark.scene=oscene;proto.index=oindex;}}else{clear(oscene,oindex);apply(scene,index);try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{clear(scene,index);apply(oscene,oindex);}}};pv.Mark.dispatch=function(type,scene,index,event){var m=scene.mark,p=scene.parent,l=m.$handlers[type];if(!l){return p&&pv.Mark.dispatch(type,p,scene.parentIndex,event);}
m.context(scene,index,function(){var stack=pv.Mark.stack.concat(event);if(l instanceof Array){var ms;l.forEach(function(li){var mi=li.apply(m,stack);if(mi&&mi.render){(ms||(ms=[])).push(mi);}});if(ms){ms.forEach(function(mi){mi.render();});}}else{m=l.apply(m,stack);if(m&&m.render){m.render();}}});return true;};pv.Mark.prototype.eachInstance=function(fun,ctx){var mark=this,indexes=[],breakInstance={isBreak:true,visible:false,datum:{}};while(mark.parent){indexes.unshift(mark.childIndex);mark=mark.parent;}
var rootScene=mark.scene;if(!rootScene){return;}
var L=indexes.length;function collectRecursive(scene,level,toScreen){var isLastLevel=level===L,childIndex;if(!isLastLevel){childIndex=indexes[level];}
var D=scene.length;if(D>0){for(var index=0;index<D;index++){var instance=scene[index];if(level===L){fun.call(ctx,scene[index],toScreen);}else if(instance.visible){var childScene=instance.children[childIndex];if(childScene){var childToScreen=toScreen.times(instance.transform).translate(instance.left,instance.top);collectRecursive(childScene,level+1,childToScreen);}}}
fun.call(ctx,breakInstance,null);}}
collectRecursive(rootScene,0,pv.Transform.identity);};pv.Mark.prototype.toScreenTransform=function(){var t=pv.Transform.identity;if(this instanceof pv.Panel){t=t.translate(this.left(),this.top()).times(this.transform());}
var parent=this.parent;if(parent){do{t=t.translate(parent.left(),parent.top()).times(parent.transform());}while((parent=parent.parent));}
return t;};pv.Mark.prototype.transition=function(){return new pv.Transition(this);};pv.Mark.prototype.on=function(state){return this["$"+state]=new pv.Transient(this);};pv.Anchor=function(target){pv.Mark.call(this);this.target=target;this.parent=target.parent;};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(proto){this.proto=proto;return this;};pv.Area=function(){pv.Mark.call(this);};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Area.prototype.buildImplied=function(s){if(s.height==null)s.height=0;if(s.width==null)s.width=0;pv.Mark.prototype.buildImplied.call(this,s);};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeMiterLimit:1,lineCap:1,strokeStyle:1,strokeDasharray:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var binds=this.binds,required=binds.required,optional=binds.optional;for(var i=0,n=optional.length;i<n;i++){var p=optional[i];p.fixed=p.name in pv.Area.fixed;if(p.name=="segmented"){required.push(p);optional.splice(i,1);i--;n--;}}
this.binds.$required=required;this.binds.$optional=optional;};pv.Area.prototype.buildInstance=function(s){var binds=this.binds;if(this.index){var fixed=binds.fixed;if(!fixed){fixed=binds.fixed=[];function f(p){return!p.fixed||(fixed.push(p),false);}
binds.required=binds.required.filter(f);if(!this.scene[0].segmented)binds.optional=binds.optional.filter(f);}
var n=fixed.length;if(n){var firstScene=this.scene[0];for(var i=0;i<n;i++){var p=fixed[i].name;s[p]=firstScene[p];}}}
else{binds.required=binds.$required;binds.optional=binds.$optional;binds.fixed=null;}
pv.Mark.prototype.buildInstance.call(this,s);};pv.Area.prototype.anchor=function(name){var scene;return pv.Mark.prototype.anchor.call(this,name).interpolate(function(){return this.scene.target[this.index].interpolate;}).eccentricity(function(){return this.scene.target[this.index].eccentricity;}).tension(function(){return this.scene.target[this.index].tension;});};pv.Bar=function(){pv.Mark.call(this);};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot=function(){pv.Mark.call(this);};pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot.prototype.anchor=function(name){var scene;return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return s.left;case"left":return null;}
return s.left+s.shapeRadius;}).right(function(){var s=this.scene.target[this.index];return this.name()=="left"?s.right+s.shapeRadius:null;}).top(function(){var s=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return s.top;case"top":return null;}
return s.top+s.shapeRadius;}).bottom(function(){var s=this.scene.target[this.index];return this.name()=="top"?s.bottom+s.shapeRadius:null;}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top";}
return"bottom";});};pv.Dot.prototype.buildImplied=function(s){var r=s.shapeRadius,z=s.shapeSize;if(r==null){if(z==null){s.shapeSize=20.25;s.shapeRadius=4.5;}else{s.shapeRadius=Math.sqrt(z);}}else if(z==null){s.shapeSize=r*r;}
pv.Mark.prototype.buildImplied.call(this,s);};pv.Label=function(){pv.Mark.call(this);};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this);};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(name){return pv.Area.prototype.anchor.call(this,name).textAlign(function(d){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left";}}).textBaseline(function(d){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top";}});};pv.Rule=function(){pv.Mark.call(this);};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false).lineCap("butt").strokeDasharray("none");pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(s){var l=s.left,r=s.right,t=s.top,b=s.bottom;if((s.width!=null)||((l==null)&&(r==null))||((r!=null)&&(l!=null))){s.height=0;}else{s.width=0;}
pv.Mark.prototype.buildImplied.call(this,s);};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s;};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(c){return(typeof c=="string")?document.getElementById(c):c;});pv.Panel.prototype.type="panel";pv.Panel.prototype.zOrderChildCount=0;pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(name){var anchor=pv.Bar.prototype.anchor.call(this,name);anchor.parent=this;return anchor;};pv.Panel.prototype.add=function(type){var child=new type();child.parent=this;child.root=this.root;child.childIndex=this.children.length;this.children.push(child);return child;};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var children=this.children;for(var i=0,n=children.length;i<n;i++){children[i].bind();}};pv.Panel.prototype.buildInstance=function(s){pv.Bar.prototype.buildInstance.call(this,s);if(!s.visible)return;var scale=this.scale*s.transform.k;pv.Mark.prototype.index=-1;var child;var children=this.children;var childScenes=s.children||(s.children=[]);for(var i=0,n=children.length;i<n;i++){child=children[i];child.scene=childScenes[i];child.scale=scale;child.build();}
for(var i=0;i<n;i++){child=children[i];childScenes[i]=child.scene;delete child.scene;delete child.scale;}
childScenes.length=n;};pv.Panel.prototype.buildImplied=function(s){if(!this.parent){var c=s.canvas;if(pv.renderer()==="batik"){if(c){if(c.$panel!=this){pv.Panel.updateCreateId(c);c.$panel=this;while(c.lastChild)c.removeChild(c.lastChild);}}else{c=document.lastChild;}}else if(c){if(c.$panel!=this){pv.Panel.updateCreateId(c);c.$panel=this;while(c.lastChild)c.removeChild(c.lastChild);}
var w,h;if(s.width==null){w=parseFloat(pv.css(c,"width"));s.width=w-s.left-s.right;}
if(s.height==null){h=parseFloat(pv.css(c,"height"));s.height=h-s.top-s.bottom;}}else{var cache=this.$canvas||(this.$canvas=[]);if(!(c=cache[this.index])){c=cache[this.index]=document.createElement(pv.renderer()=="svgweb"?"div":"span");if(this.$dom){this.$dom.parentNode.insertBefore(c,this.$dom);}else{var n=document.body;while(n.lastChild&&n.lastChild.tagName)n=n.lastChild;if(n!=document.body)n=n.parentNode;n.appendChild(c);}}}
s.canvas=c;}
if(!s.transform)s.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,s);};pv.Panel.updateCreateId=function(c){c.$pvCreateId=(c.$pvCreateId||0)+1;};pv.Image=function(){pv.Bar.call(this);};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(f){this.$image=function(){var c=f.apply(this,arguments);return c==null?pv.Color.transparent:typeof c=="string"?pv.color(c):c;};return this;};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var binds=this.binds,mark=this;do{binds.image=mark.$image;}while(!binds.image&&(mark=mark.proto));};pv.Image.prototype.buildImplied=function(s){pv.Bar.prototype.buildImplied.call(this,s);if(!s.visible)return;if(s.imageWidth==null)s.imageWidth=s.width;if(s.imageHeight==null)s.imageHeight=s.height;if((s.url==null)&&this.binds.image){var canvas=this.$canvas||(this.$canvas=document.createElement("canvas")),context=canvas.getContext("2d"),w=s.imageWidth,h=s.imageHeight,stack=pv.Mark.stack,data;canvas.width=w;canvas.height=h;data=(s.image=context.createImageData(w,h)).data;stack.unshift(null,null);for(var y=0,p=0;y<h;y++){stack[1]=y;for(var x=0;x<w;x++){stack[0]=x;var color=this.binds.image.apply(this,stack);data[p++]=color.r;data[p++]=color.g;data[p++]=color.b;data[p++]=255*color.a;}}
stack.splice(0,2);}};pv.Wedge=function(){pv.Mark.call(this);};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var s=this.sibling();return s?s.endAngle:-Math.PI/2;}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2;};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2;};pv.Wedge.prototype.anchor=function(name){function partial(s){return s.innerRadius||s.angle<2*Math.PI;}
function midRadius(s){return(s.innerRadius+s.outerRadius)/2;}
function midAngle(s){return(s.startAngle+s.endAngle)/2;}
return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.left+s.outerRadius*Math.cos(midAngle(s));case"inner":return s.left+s.innerRadius*Math.cos(midAngle(s));case"start":return s.left+midRadius(s)*Math.cos(s.startAngle);case"center":return s.left+midRadius(s)*Math.cos(midAngle(s));case"end":return s.left+midRadius(s)*Math.cos(s.endAngle);}
return s.left;}).top(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.top+s.outerRadius*Math.sin(midAngle(s));case"inner":return s.top+s.innerRadius*Math.sin(midAngle(s));case"start":return s.top+midRadius(s)*Math.sin(s.startAngle);case"center":return s.top+midRadius(s)*Math.sin(midAngle(s));case"end":return s.top+midRadius(s)*Math.sin(s.endAngle);}
return s.top;}).textAlign(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return pv.Wedge.upright(midAngle(s))?"right":"left";case"inner":return pv.Wedge.upright(midAngle(s))?"left":"right";}
return"center";}).textBaseline(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"start":return pv.Wedge.upright(s.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(s.endAngle)?"bottom":"top";}
return"middle";}).textAngle(function(){var s=this.scene.target[this.index],a=0;if(partial(s))switch(this.name()){case"center":case"inner":case"outer":a=midAngle(s);break;case"start":a=s.startAngle;break;case"end":a=s.endAngle;break;}
return pv.Wedge.upright(a)?a:(a+Math.PI);});};pv.Wedge.upright=function(angle){angle=angle%(2*Math.PI);angle=(angle<0)?(2*Math.PI+angle):angle;return(angle<Math.PI/2)||(angle>=3*Math.PI/2);};pv.Wedge.prototype.buildImplied=function(s){if(s.angle==null)s.angle=s.endAngle-s.startAngle;else if(s.endAngle==null)s.endAngle=s.startAngle+s.angle;pv.Mark.prototype.buildImplied.call(this,s);};pv.Ease=(function(){function reverse(f){return function(t){return 1-f(1-t);};}
function reflect(f){return function(t){return.5*(t<.5?f(2*t):(2-f(2-2*t)));};}
function poly(e){return function(t){return t<0?0:t>1?1:Math.pow(t,e);}}
function sin(t){return 1-Math.cos(t*Math.PI/2);}
function exp(t){return t?Math.pow(2,10*(t-1))-0.001:0;}
function circle(t){return-(Math.sqrt(1-t*t)-1);}
function elastic(a,p){var s;if(!p)p=0.45;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return function(t){return t<=0||t>=1?t:-(a*Math.pow(2,10*(--t))*Math.sin((t-s)*(2*Math.PI)/p));};}
function back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
var quad=poly(2),cubic=poly(3),elasticDefault=elastic(),backDefault=back();var eases={"linear":pv.identity,"quad-in":quad,"quad-out":reverse(quad),"quad-in-out":reflect(quad),"quad-out-in":reflect(reverse(quad)),"cubic-in":cubic,"cubic-out":reverse(cubic),"cubic-in-out":reflect(cubic),"cubic-out-in":reflect(reverse(cubic)),"sin-in":sin,"sin-out":reverse(sin),"sin-in-out":reflect(sin),"sin-out-in":reflect(reverse(sin)),"exp-in":exp,"exp-out":reverse(exp),"exp-in-out":reflect(exp),"exp-out-in":reflect(reverse(exp)),"circle-in":circle,"circle-out":reverse(circle),"circle-in-out":reflect(circle),"circle-out-in":reflect(reverse(circle)),"elastic-in":elasticDefault,"elastic-out":reverse(elasticDefault),"elastic-in-out":reflect(elasticDefault),"elastic-out-in":reflect(reverse(elasticDefault)),"back-in":backDefault,"back-out":reverse(backDefault),"back-in-out":reflect(backDefault),"back-out-in":reflect(reverse(backDefault)),"bounce-in":bounce,"bounce-out":reverse(bounce),"bounce-in-out":reflect(bounce),"bounce-out-in":reflect(reverse(bounce))};pv.ease=function(f){return eases[f];};return{reverse:reverse,reflect:reflect,linear:function(){return pv.identity;},sin:function(){return sin;},exp:function(){return exp;},circle:function(){return circle;},elastic:elastic,back:back,bounce:bounce,poly:poly};})();pv.Transition=function(mark){var that=this,ease=pv.ease("cubic-in-out"),duration=250,timer,onEndCallback;var interpolated={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1};var defaults=new pv.Transient();function ids(marks){var map={};for(var i=0;i<marks.length;i++){var mark=marks[i];if(mark.id){map[mark.id]=mark;}}
return map;}
function interpolateProperty(list,name,before,after){var f;if(name in interpolated){var i=pv.Scale.interpolator(before[name],after[name]);f=function(t){before[name]=i(t);};}else{f=function(t){if(t>.5){before[name]=after[name];}};}
f.next=list.head;list.head=f;}
function interpolateInstance(list,before,after){for(var name in before){if(name=="children")continue;if(before[name]==after[name])continue;interpolateProperty(list,name,before,after);}
if(before.children){for(var j=0;j<before.children.length;j++){interpolate(list,before.children[j],after.children[j]);}}}
function interpolate(list,before,after){var mark=before.mark,bi=ids(before),ai=ids(after);for(var i=0;i<before.length;i++){var b=before[i],a=b.id?ai[b.id]:after[i];b.index=i;if(!b.visible){continue;}
if(!(a&&a.visible)){var o=override(before,i,mark.$exit,after);b.transition=a?2:(after.push(o),1);a=o;}
interpolateInstance(list,b,a);}
for(var i=0;i<after.length;i++){var a=after[i],b=a.id?bi[a.id]:before[i];if(!(b&&b.visible)&&a.visible){var o=override(after,i,mark.$enter,before);if(!b)
before.push(o);else
before[b.index]=o;interpolateInstance(list,o,a);}}}
function override(scene,index,proto,other){var s=pv.extend(scene[index]),m=scene.mark,r=m.root.scene,p=(proto||defaults).$properties,t;if(other.target&&(t=other.target[other.length])){scene=pv.extend(scene);scene.target=pv.extend(other.target);scene.target[index]=t;}
var seen={};for(var i=0;i<p.length;i++){seen[p[i].name]=1;}
p=m.binds.optional.filter(function(p){return!(p.name in seen);}).concat(p);m.context(scene,index,function(){this.buildProperties(s,p);this.buildImplied(s);});m.root.scene=r;return s;}
function cleanup(scene){for(var i=0,j=0;i<scene.length;i++){var s=scene[i];if(s.transition!=1){scene[j++]=s;if(s.transition==2)s.visible=false;if(s.children)s.children.forEach(cleanup);}}
scene.length=j;}
that.ease=function(x){return arguments.length?(ease=typeof x=="function"?x:pv.ease(x),that):ease;};that.duration=function(x){return arguments.length?(duration=Number(x),that):duration;};function doEnd(){if(onEndCallback){var cb=onEndCallback;onEndCallback=null;cb();}}
that.start=function(onEnd){onEndCallback=onEnd;if(mark.parent){doEnd();fail();}
if(mark.$transition){mark.$transition.stop();}
mark.$transition=that;var i=pv.Mark.prototype.index,before=mark.scene,after;mark.scene=null;mark.bind();mark.build();after=mark.scene;mark.scene=before;pv.Mark.prototype.index=i;var start=Date.now(),list={};interpolate(list,before,after);timer=setInterval(function(){var t=Math.max(0,Math.min(1,(Date.now()-start)/duration)),e=ease(t);for(var i=list.head;i;i=i.next){i(e);}
if(t==1){cleanup(mark.scene);that.stop();}
pv.Scene.updateAll(before);},24);};that.stop=function(){clearInterval(timer);doEnd();};};pv.Transient=function(mark){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(state){return mark.on(state);};};pv.Transient.prototype=pv.extend(pv.Mark);pv.simulation=function(particles){return new pv.Simulation(particles);};pv.Simulation=function(particles){for(var i=0;i<particles.length;i++)this.particle(particles[i]);};pv.Simulation.prototype.particle=function(p){p.next=this.particles;if(isNaN(p.px))p.px=p.x;if(isNaN(p.py))p.py=p.y;if(isNaN(p.fx))p.fx=0;if(isNaN(p.fy))p.fy=0;this.particles=p;return this;};pv.Simulation.prototype.force=function(f){f.next=this.forces;this.forces=f;return this;};pv.Simulation.prototype.constraint=function(c){c.next=this.constraints;this.constraints=c;return this;};pv.Simulation.prototype.stabilize=function(n){var c;if(!arguments.length)n=3;for(var i=0;i<n;i++){var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);}
for(var p=this.particles;p;p=p.next){p.px=p.x;p.py=p.y;}
return this;};pv.Simulation.prototype.step=function(){var p,f,c;for(p=this.particles;p;p=p.next){var px=p.px,py=p.py;p.px=p.x;p.py=p.y;p.x+=p.vx=((p.x-px)+p.fx);p.y+=p.vy=((p.y-py)+p.fy);}
var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);for(p=this.particles;p;p=p.next)p.fx=p.fy=0;for(f=this.forces;f;f=f.next)f.apply(this.particles,q);};pv.Quadtree=function(particles){var p;var x1=Number.POSITIVE_INFINITY,y1=x1,x2=Number.NEGATIVE_INFINITY,y2=x2;for(p=particles;p;p=p.next){if(p.x<x1)x1=p.x;if(p.y<y1)y1=p.y;if(p.x>x2)x2=p.x;if(p.y>y2)y2=p.y;}
var dx=x2-x1,dy=y2-y1;if(dx>dy)y2=y1+dx;else x2=x1+dy;this.xMin=x1;this.yMin=y1;this.xMax=x2;this.yMax=y2;function insert(n,p,x1,y1,x2,y2){if(isNaN(p.x)||isNaN(p.y))return;if(n.leaf){if(n.p){if((Math.abs(n.p.x-p.x)+Math.abs(n.p.y-p.y))<.01){insertChild(n,p,x1,y1,x2,y2);}else{var v=n.p;n.p=null;insertChild(n,v,x1,y1,x2,y2);insertChild(n,p,x1,y1,x2,y2);}}else{n.p=p;}}else{insertChild(n,p,x1,y1,x2,y2);}}
function insertChild(n,p,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=p.x>=sx,bottom=p.y>=sy;n.leaf=false;switch((bottom<<1)+right){case 0:n=n.c1||(n.c1=new pv.Quadtree.Node());break;case 1:n=n.c2||(n.c2=new pv.Quadtree.Node());break;case 2:n=n.c3||(n.c3=new pv.Quadtree.Node());break;case 3:n=n.c4||(n.c4=new pv.Quadtree.Node());break;}
if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,p,x1,y1,x2,y2);}
this.root=new pv.Quadtree.Node();for(p=particles;p;p=p.next)insert(this.root,p,x1,y1,x2,y2);};pv.Quadtree.Node=function(){this.leaf=true;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null;};pv.Force={};pv.Force.charge=function(k){var min=2,min1=1/min,max=500,max1=1/max,theta=.9,force={};if(!arguments.length)k=-40;force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.domain=function(a,b){if(arguments.length){min=Number(a);min1=1/min;max=Number(b);max1=1/max;return force;}
return[min,max];};force.theta=function(x){if(arguments.length){theta=Number(x);return force;}
return theta;};function accumulate(n){var cx=0,cy=0;n.cn=0;function accumulateChild(c){accumulate(c);n.cn+=c.cn;cx+=c.cn*c.cx;cy+=c.cn*c.cy;}
if(!n.leaf){if(n.c1)accumulateChild(n.c1);if(n.c2)accumulateChild(n.c2);if(n.c3)accumulateChild(n.c3);if(n.c4)accumulateChild(n.c4);}
if(n.p){n.cn+=k;cx+=k*n.p.x;cy+=k*n.p.y;}
n.cx=cx/n.cn;n.cy=cy/n.cn;}
function forces(n,p,x1,y1,x2,y2){var dx=n.cx-p.x,dy=n.cy-p.y,dn=1/Math.sqrt(dx*dx+dy*dy);if((n.leaf&&(n.p!=p))||((x2-x1)*dn<theta)){if(dn<max1)return;if(dn>min1)dn=min1;var kc=n.cn*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}else if(!n.leaf){var sx=(x1+x2)*.5,sy=(y1+y2)*.5;if(n.c1)forces(n.c1,p,x1,y1,sx,sy);if(n.c2)forces(n.c2,p,sx,y1,x2,sy);if(n.c3)forces(n.c3,p,x1,sy,sx,y2);if(n.c4)forces(n.c4,p,sx,sy,x2,y2);if(dn<max1)return;if(dn>min1)dn=min1;if(n.p&&(n.p!=p)){var kc=k*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}}}
force.apply=function(particles,q){accumulate(q.root);for(var p=particles;p;p=p.next){forces(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);}};return force;};pv.Force.drag=function(k){var force={};if(!arguments.length)k=.1;force.constant=function(x){if(arguments.length){k=x;return force;}
return k;};force.apply=function(particles){if(k)for(var p=particles;p;p=p.next){p.fx-=k*p.vx;p.fy-=k*p.vy;}};return force;};pv.Force.spring=function(k){var d=.1,l=20,links,kl,force={};if(!arguments.length)k=.1;force.links=function(x){if(arguments.length){links=x;kl=x.map(function(l){return 1/Math.sqrt(Math.max(l.sourceNode.linkDegree,l.targetNode.linkDegree));});return force;}
return links;};force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.damping=function(x){if(arguments.length){d=Number(x);return force;}
return d;};force.length=function(x){if(arguments.length){l=Number(x);return force;}
return l;};force.apply=function(particles){for(var i=0;i<links.length;i++){var a=links[i].sourceNode,b=links[i].targetNode,dx=a.x-b.x,dy=a.y-b.y,dn=Math.sqrt(dx*dx+dy*dy),dd=dn?(1/dn):1,ks=k*kl[i],kd=d*kl[i],kk=(ks*(dn-l)+kd*(dx*(a.vx-b.vx)+dy*(a.vy-b.vy))*dd)*dd,fx=-kk*(dn?dx:(.01*(.5-Math.random()))),fy=-kk*(dn?dy:(.01*(.5-Math.random())));a.fx+=fx;a.fy+=fy;b.fx-=fx;b.fy-=fy;}};return force;};pv.Constraint={};pv.Constraint.collision=function(radius){var n=1,r1,px1,py1,px2,py2,constraint={};if(!arguments.length)r1=10;constraint.repeat=function(x){if(arguments.length){n=Number(x);return constraint;}
return n;};function constrain(n,p,x1,y1,x2,y2){if(!n.leaf){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,top=sy>py1,bottom=sy<py2,left=sx>px1,right=sx<px2;if(top){if(n.c1&&left)constrain(n.c1,p,x1,y1,sx,sy);if(n.c2&&right)constrain(n.c2,p,sx,y1,x2,sy);}
if(bottom){if(n.c3&&left)constrain(n.c3,p,x1,sy,sx,y2);if(n.c4&&right)constrain(n.c4,p,sx,sy,x2,y2);}}
if(n.p&&(n.p!=p)){var dx=p.x-n.p.x,dy=p.y-n.p.y,l=Math.sqrt(dx*dx+dy*dy),d=r1+radius(n.p);if(l<d){var k=(l-d)/l*.5;dx*=k;dy*=k;p.x-=dx;p.y-=dy;n.p.x+=dx;n.p.y+=dy;}}}
constraint.apply=function(particles,q){var p,r,max=-Infinity;for(p=particles;p;p=p.next){r=radius(p);if(r>max)max=r;}
for(var i=0;i<n;i++){for(p=particles;p;p=p.next){r=(r1=radius(p))+max;px1=p.x-r;px2=p.x+r;py1=p.y-r;py2=p.y+r;constrain(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);}}};return constraint;};pv.Constraint.position=function(f){var a=1,constraint={};if(!arguments.length)f=function(p){return p.fix;};constraint.alpha=function(x){if(arguments.length){a=Number(x);return constraint;}
return a;};constraint.apply=function(particles){for(var p=particles;p;p=p.next){var v=f(p);if(v){p.x+=(v.x-p.x)*a;p.y+=(v.y-p.y)*a;p.fx=p.fy=p.vx=p.vy=0;}}};return constraint;};pv.Constraint.bound=function(){var constraint={},x,y;constraint.x=function(min,max){if(arguments.length){x={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return x;};constraint.y=function(min,max){if(arguments.length){y={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return y;};constraint.apply=function(particles){if(x)for(var p=particles;p;p=p.next){p.x=p.x<x.min?x.min:(p.x>x.max?x.max:p.x);}
if(y)for(var p=particles;p;p=p.next){p.y=p.y<y.min?y.min:(p.y>y.max?y.max:p.y);}};return constraint;};pv.Layout=function(){pv.Panel.call(this);};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=pv.Mark.prototype.localProperty;pv.Layout.Network=function(){pv.Layout.call(this);var that=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return that.nodes();}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(n){return n.x;}).top(function(n){return n.y;})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(p){return[p.sourceNode,p.targetNode];}).fillStyle(null).lineWidth(function(d,p){return p.linkValue*1.5;}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(type){return that.add(pv.Panel).data(function(){return that.links();}).add(type).extend(this);};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(n){return n.nodeName||n.nodeValue;}).textAngle(function(n){var a=n.midAngle;return pv.Wedge.upright(a)?a:(a+Math.PI);}).textAlign(function(n){return pv.Wedge.upright(n.midAngle)?"left":"right";})).parent=this;};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(v){return v.map(function(d,i){if(typeof d!="object")d={nodeValue:d};d.index=i;return d;});}).property("links",function(v){return v.map(function(d){if(isNaN(d.linkValue))d.linkValue=isNaN(d.value)?1:d.value;return d;});});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this;};pv.Layout.Network.prototype.buildProperties=function(s,properties){if((s.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,s,properties);}};pv.Layout.Network.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);if(s.$id>=this.$id)return true;s.$id=this.$id;s.nodes.forEach(function(d){d.linkDegree=0;});s.links.forEach(function(d){var v=d.linkValue;(d.sourceNode||(d.sourceNode=s.nodes[d.source])).linkDegree+=v;(d.targetNode||(d.targetNode=s.nodes[d.target])).linkDegree+=v;});};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc");};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(s){if(!s.links)s.links=pv.Layout.Hierarchy.links.call(this);pv.Layout.Network.prototype.buildImplied.call(this,s);};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(n){return n.parentNode;}).map(function(n){return{sourceNode:n,targetNode:n.parentNode,linkValue:1};});};pv.Layout.Hierarchy.NodeLink={buildImplied:function(s){var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height;if(orient=="radial"){var ir=s.innerRadius,or=s.outerRadius;if(ir==null)ir=0;if(or==null)or=Math.min(w,h)/2;}
function radius(n){return n.parentNode?(n.depth*(or-ir)+ir):0;}
function midAngle(n){return(n.parentNode?(n.breadth-.25)*2*Math.PI:0);}
function x(n){switch(orient){case"left":return n.depth*w;case"right":return w-n.depth*w;case"top":return n.breadth*w;case"bottom":return w-n.breadth*w;case"radial":return w/2+radius(n)*Math.cos(n.midAngle);}}
function y(n){switch(orient){case"left":return n.breadth*h;case"right":return h-n.breadth*h;case"top":return n.depth*h;case"bottom":return h-n.depth*h;case"radial":return h/2+radius(n)*Math.sin(n.midAngle);}}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.midAngle=orient=="radial"?midAngle(n):horizontal?Math.PI/2:0;n.x=x(n);n.y=y(n);if(n.firstChild)n.midAngle+=Math.PI;}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(n){return n.dx;}).height(function(n){return n.dy;}).innerRadius(function(n){return n.innerRadius;}).outerRadius(function(n){return n.outerRadius;}).startAngle(function(n){return n.startAngle;}).angle(function(n){return n.angle;});this.label.textAlign("center").left(function(n){return n.x+(n.dx/2);}).top(function(n){return n.y+(n.dy/2);});delete this.link;},buildImplied:function(s){var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height,depth=-nodes[0].minDepth;if(orient=="radial"){var ir=s.innerRadius,or=s.outerRadius;if(ir==null)ir=0;if(ir)depth*=2;if(or==null)or=Math.min(w,h)/2;}
function scale(d,depth){return(d+depth)/(1+depth);}
function x(n){switch(orient){case"left":return scale(n.minDepth,depth)*w;case"right":return(1-scale(n.maxDepth,depth))*w;case"top":return n.minBreadth*w;case"bottom":return(1-n.maxBreadth)*w;case"radial":return w/2;}}
function y(n){switch(orient){case"left":return n.minBreadth*h;case"right":return(1-n.maxBreadth)*h;case"top":return scale(n.minDepth,depth)*h;case"bottom":return(1-scale(n.maxDepth,depth))*h;case"radial":return h/2;}}
function dx(n){switch(orient){case"left":case"right":return(n.maxDepth-n.minDepth)/(1+depth)*w;case"top":case"bottom":return(n.maxBreadth-n.minBreadth)*w;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.cos(n.midAngle):0;}}
function dy(n){switch(orient){case"left":case"right":return(n.maxBreadth-n.minBreadth)*h;case"top":case"bottom":return(n.maxDepth-n.minDepth)/(1+depth)*h;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.sin(n.midAngle):0;}}
function innerRadius(n){return Math.max(0,scale(n.minDepth,depth/2))*(or-ir)+ir;}
function outerRadius(n){return scale(n.maxDepth,depth/2)*(or-ir)+ir;}
function startAngle(n){return(n.parentNode?n.minBreadth-.25:0)*2*Math.PI;}
function angle(n){return(n.parentNode?n.maxBreadth-n.minBreadth:1)*2*Math.PI;}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.x=x(n);n.y=y(n);if(orient=="radial"){n.innerRadius=innerRadius(n);n.outerRadius=outerRadius(n);n.startAngle=startAngle(n);n.angle=angle(n);n.midAngle=n.startAngle+n.angle/2;}else{n.midAngle=horizontal?-Math.PI/2:0;}
n.dx=dx(n);n.dy=dy(n);}}};pv.Layout.Grid=function(){pv.Layout.call(this);var that=this;(this.cell=new pv.Mark().data(function(){return that.scene[that.index].$grid;}).width(function(){return that.width()/that.cols();}).height(function(){return that.height()/that.rows();}).left(function(){return this.width()*(this.index%that.cols());}).top(function(){return this.height()*Math.floor(this.index/that.cols());})).parent=this;};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var r=s.rows,c=s.cols;if(typeof c=="object")r=pv.transpose(c);if(typeof r=="object"){s.$grid=pv.blend(r);s.rows=r.length;s.cols=r[0]?r[0].length:0;}else{s.$grid=pv.repeat([s.data],r*c);}};pv.Layout.Stack=function(){pv.Layout.call(this);var that=this,none=function(){return null;},prop={t:none,l:none,r:none,b:none,w:none,h:none},values,buildImplied=that.buildImplied;function proxy(name){return function(){return prop[name](this.parent.index,this.index);};}
this.buildImplied=function(s){buildImplied.call(this,s);var data=s.layers,n=data.length,m,orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),h=this.parent[horizontal?"height":"width"](),x=[],y=[],dy=[];var stack=pv.Mark.stack,o={parent:{parent:this}};stack.unshift(null);values=[];for(var i=0;i<n;i++){dy[i]=[];y[i]=[];o.parent.index=i;stack[0]=data[i];values[i]=this.$values.apply(o.parent,stack);if(!i)m=values[i].length;stack.unshift(null);for(var j=0;j<m;j++){stack[0]=values[i][j];o.index=j;if(!i)x[j]=this.$x.apply(o,stack);dy[i][j]=this.$y.apply(o,stack);}
stack.shift();}
stack.shift();var index;switch(s.order){case"inside-out":{var max=dy.map(function(v){return pv.max.index(v);}),map=pv.range(n).sort(function(a,b){return max[a]-max[b];}),sums=dy.map(function(v){return pv.sum(v);}),top=0,bottom=0,tops=[],bottoms=[];for(var i=0;i<n;i++){var j=map[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
index=bottoms.reverse().concat(tops);break;}
case"reverse":index=pv.range(n-1,-1,-1);break;default:index=pv.range(n);break;}
switch(s.offset){case"silohouette":{for(var j=0;j<m;j++){var o=0;for(var i=0;i<n;i++)o+=dy[i][j];y[index[0]][j]=(h-o)/2;}
break;}
case"wiggle":{var o=0;for(var i=0;i<n;i++)o+=dy[i][0];y[index[0]][0]=o=(h-o)/2;for(var j=1;j<m;j++){var s1=0,s2=0,dx=x[j]-x[j-1];for(var i=0;i<n;i++)s1+=dy[i][j];for(var i=0;i<n;i++){var s3=(dy[index[i]][j]-dy[index[i]][j-1])/(2*dx);for(var k=0;k<i;k++){s3+=(dy[index[k]][j]-dy[index[k]][j-1])/dx;}
s2+=s3*dy[index[i]][j];}
y[index[0]][j]=o-=s1?s2/s1*dx:0;}
break;}
case"expand":{for(var j=0;j<m;j++){y[index[0]][j]=0;var k=0;for(var i=0;i<n;i++)k+=dy[i][j];if(k){k=h/k;for(var i=0;i<n;i++)dy[i][j]*=k;}else{k=h/n;for(var i=0;i<n;i++)dy[i][j]=k;}}
break;}
default:{for(var j=0;j<m;j++)y[index[0]][j]=0;break;}}
for(var j=0;j<m;j++){var o=y[index[0]][j];for(var i=1;i<n;i++){o+=dy[index[i-1]][j];y[index[i]][j]=o;}}
var i=orient.indexOf("-"),pdy=horizontal?"h":"w",px=i<0?(horizontal?"l":"b"):orient.charAt(i+1),py=orient.charAt(0);for(var p in prop)prop[p]=none;prop[px]=function(i,j){return x[j];};prop[py]=function(i,j){return y[i][j];};prop[pdy]=function(i,j){return dy[i][j];};};this.layer=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h"));this.layer.add=function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(this);};};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0;};pv.Layout.Stack.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Stack.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.Band=function(){pv.Layout.call(this);var that=this,buildImplied=that.buildImplied,itemProps,values;var itemProto=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h"));function proxy(name){return function(){return itemProps[name](this.index,this.parent.index);};}
this.buildImplied=function(s){buildImplied.call(this,s);itemProps=Object.create(pv.Layout.Band.$baseItemProps);values=[];var data=s.layers,L=data.length;if(L>0){var orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),bh=this.parent[horizontal?"height":"width"](),bands=this._readData(data,values,s),B=bands.length;if(s.bandOrder==="reverse"){bands.reverse();}
if(s.order==="reverse"){values.reverse();for(var b=0;b<B;b++){bands[b].items.reverse();}}
switch(s.layout){case"grouped":this._calcGrouped(bands,L,s);break;case"stacked":this._calcStacked(bands,L,bh,s);break;}
this._bindItemProps(bands,itemProps,orient,horizontal);}};var itemAccessor=this.item={end:this,add:function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(itemProto);},order:function(value){that.order(value);return this;},w:function(f){that.$iw=pv.functor(f);return this;},h:function(f){that.$ih=pv.functor(f);return this;},horizontalRatio:function(f){that.$ihorizRatio=pv.functor(f);return this;},verticalMargin:function(f){that.$ivertiMargin=pv.functor(f);return this;}};var bandAccessor=this.band={end:this,w:function(f){that.$bw=pv.functor(f);return this;},x:function(f){that.$bx=pv.functor(f);return this;},order:function(value){that.bandOrder(value);return this;},differentialControl:function(f){that.$bDiffControl=pv.functor(f);return this;}};this.band.item=itemAccessor;this.item.band=bandAccessor;};pv.Layout.Band.$baseItemProps=(function(){var none=function(){return null;};return{t:none,l:none,r:none,b:none,w:none,h:none};}());pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String);pv.Layout.Band.prototype.defaults=new pv.Layout.Band().extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).layers([[]]);pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0);pv.Layout.Band.prototype.$ihorizRatio=pv.functor(0.9);pv.Layout.Band.prototype.$values=pv.identity;pv.Layout.Band.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.prototype._readData=function(data,layersValues,scene){var L=data.length,bands=[],B;var stack=pv.Mark.stack,o={parent:{parent:this}};stack.unshift(null);for(var l=0;l<L;l++){o.parent.index=l;stack[0]=data[l];var layerValues=layersValues[l]=this.$values.apply(o.parent,stack);if(!l){B=layerValues.length;}
stack.unshift(null);for(var b=0;b<B;b++){stack[0]=layerValues[b];o.index=b;var band=bands[b];if(!band){band=bands[b]={horizRatio:this.$ihorizRatio.apply(o,stack),vertiMargin:this.$ivertiMargin.apply(o,stack),w:this.$bw.apply(o,stack),x:this.$bx.apply(o,stack),diffControl:this.$bDiffControl?this.$bDiffControl.apply(o,stack):0,items:[]};}
var ih=this.$ih.apply(o,stack);band.items[l]={y:(scene.yZero||0),x:0,w:this.$iw.apply(o,stack),h:ih!=null?Math.abs(ih):ih,dir:ih<0?-1:1};}
stack.shift();}
stack.shift();return bands;};pv.Layout.Band.prototype._calcGrouped=function(bands,L,scene){for(var b=0,B=bands.length;b<B;b++){var band=bands[b],items=band.items,w=band.w,horizRatio=band.horizRatio,wItems=0;for(var l=0;l<L;l++){wItems+=items[l].w;}
if(L===1){horizRatio=1;}else if(!(horizRatio>0&&horizRatio<=1)){horizRatio=1;}
if(w==null){w=band.w=wItems/horizRatio;}else if(scene.horizontalMode==='expand'){var wItems2=horizRatio*w;if(wItems){var wScale=wItems2/wItems;for(var l=0;l<L;l++){items[l].w*=wScale;}}else{var wiavg=wItems2/L;for(var l=0;l<L;l++){items[l].w=wiavg;}}
wItems=wItems2;}
var wItemsWithMargin=wItems/horizRatio,ix=band.x-(wItemsWithMargin/2),margin=L>1?((wItemsWithMargin-wItems)/(L-1)):0;for(var l=0;l<L;l++){var item=items[l];item.x=ix;ix+=item.w+margin;if(item.dir<0){item.y-=item.h;}}}};pv.Layout.Band.prototype._calcStacked=function(bands,L,bh,scene){var B=bands.length,items;if(scene.verticalMode==="expand"){for(var b=0;b<B;b++){items=bands[b].items;var hSum=null,nonNullCount=0;for(var l=0;l<L;l++){var item=items[l];item.dir=1;var h=item.h;if(h!=null){nonNullCount++;hSum+=h;}}
if(nonNullCount){if(hSum){var hScale=bh/hSum;for(var l=0;l<L;l++){var h=items[l].h;if(h!=null){items[l].h=h*hScale;}}}else{var hAvg=bh/nonNullCount;for(var l=0;l<L;l++){var h=items[l].h;if(h!=null){items[l].h=hAvg;}}}}}}
var yZero=scene.yZero,yOffset=yZero;for(var b=0;b<B;b++){var band=bands[b],bx=band.x,bDiffControl=band.diffControl,invertDir=(bDiffControl<0),vertiMargin=band.vertiMargin>0?band.vertiMargin:0;items=band.items;var resultPos=this._layoutItemsOfDir(+1,invertDir,items,vertiMargin,bx,yOffset),resultNeg;if(resultPos.existsOtherDir){resultNeg=this._layoutItemsOfDir(-1,invertDir,items,vertiMargin,bx,yOffset);}
if(bDiffControl){if(Math.abs(bDiffControl)===1){yOffset=resultPos.yOffset;if(resultNeg){yOffset-=resultNeg.yOffset;}}}else{yOffset=yZero;}}};pv.Layout.Band.prototype._layoutItemsOfDir=function(dir,invertDir,items,vertiMargin,bx,yOffset){var existsOtherDir=false,vertiMargin2=vertiMargin/2,efItemDir=(invertDir?-dir:dir),reverseLayers=invertDir;for(var l=0,L=items.length;l<L;l+=1){var item=items[reverseLayers?(L-l-1):l];if(item.dir===dir){var h=item.h||0;if(efItemDir>0){item.y=yOffset+vertiMargin2;yOffset+=h;}else{item.y=yOffset-(h-vertiMargin2);yOffset-=h;}
item.h-=vertiMargin;item.x=bx-item.w/2;}else{existsOtherDir=true;}}
return{existsOtherDir:existsOtherDir,yOffset:yOffset};};pv.Layout.Band.prototype._bindItemProps=function(bands,itemProps,orient,horizontal){var index=orient.indexOf("-"),ph=horizontal?"h":"w",pw=horizontal?"w":"h",px=index<0?(horizontal?"l":"b"):orient.charAt(index+1),py=orient.charAt(0);itemProps[px]=function(b,l){return bands[b].items[l].x;};itemProps[py]=function(b,l){return bands[b].items[l].y;};itemProps[pw]=function(b,l){return bands[b].items[l].w;};itemProps[ph]=function(b,l){return bands[b].items[l].h||0;};};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(n){return n.dx;}).height(function(n){return n.dy;});this.label.visible(function(n){return!n.firstChild;}).left(function(n){return n.x+(n.dx/2);}).top(function(n){return n.y+(n.dy/2);}).textAlign("center").textAngle(function(n){return n.dx>n.dy?0:-Math.PI/2;});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(n){return!n.firstChild;})).parent=this;delete this.link;};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.padding=function(n){return this.paddingLeft(n).paddingRight(n).paddingTop(n).paddingBottom(n);};pv.Layout.Treemap.prototype.$size=function(d){return Number(d.nodeValue);};pv.Layout.Treemap.prototype.size=function(f){this.$size=pv.functor(f);return this;};pv.Layout.Treemap.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var that=this,nodes=s.nodes,root=nodes[0],stack=pv.Mark.stack,left=s.paddingLeft,right=s.paddingRight,top=s.paddingTop,bottom=s.paddingBottom,size=function(n){return n.size;},round=s.round?Math.round:Number,mode=s.mode;function slice(row,sum,horizontal,x,y,w,h){for(var i=0,d=0;i<row.length;i++){var n=row[i];if(horizontal){n.x=x+d;n.y=y;d+=n.dx=round(w*n.size/sum);n.dy=h;}else{n.x=x;n.y=y+d;n.dx=w;d+=n.dy=round(h*n.size/sum);}}
if(n){if(horizontal){n.dx+=w-d;}else{n.dy+=h-d;}}}
function ratio(row,l){var rmax=-Infinity,rmin=Infinity,s=0;for(var i=0;i<row.length;i++){var r=row[i].size;if(r<rmin)rmin=r;if(r>rmax)rmax=r;s+=r;}
s=s*s;l=l*l;return Math.max(l*rmax/s,s/(l*rmin));}
function layout(n,i){var x=n.x+left,y=n.y+top,w=n.dx-left-right,h=n.dy-top-bottom;if(mode!="squarify"){slice(n.childNodes,n.size,mode=="slice"?true:mode=="dice"?false:i&1,x,y,w,h);return;}
var row=[],mink=Infinity,l=Math.min(w,h),k=w*h/n.size;if(n.size<=0)return;n.visitBefore(function(n){n.size*=k;});function position(row){var horizontal=w==l,sum=pv.sum(row,size),r=l?round(sum/l):0;slice(row,sum,horizontal,x,y,horizontal?w:r,horizontal?r:h);if(horizontal){y+=r;h-=r;}else{x+=r;w-=r;}
l=Math.min(w,h);return horizontal;}
var children=n.childNodes.slice();while(children.length){var child=children[children.length-1];if(!child.size){children.pop();continue;}
row.push(child);var k=ratio(row,l);if(k<=mink){children.pop();mink=k;}else{row.pop();position(row);row.length=0;mink=Infinity;}}
if(position(row))for(var i=0;i<row.length;i++){row[i].dy+=h;}else for(var i=0;i<row.length;i++){row[i].dx+=w;}}
stack.unshift(null);root.visitAfter(function(n,i){n.depth=i;n.x=n.y=n.dx=n.dy=0;n.size=n.firstChild?pv.sum(n.childNodes,function(n){return n.size;}):that.$size.apply(that,(stack[0]=n,stack));});stack.shift();switch(s.order){case"ascending":{root.sort(function(a,b){return a.size-b.size;});break;}
case"descending":{root.sort(function(a,b){return b.size-a.size;});break;}
case"reverse":root.reverse();break;}
root.x=0;root.y=0;root.dx=s.width;root.dy=s.height;root.visitBefore(layout);};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,orient=s.orient,depth=s.depth,breadth=s.breadth,group=s.group,w=s.width,h=s.height;function firstWalk(v){var l,r,a;if(!v.firstChild){if(l=v.previousSibling){v.prelim=l.prelim+distance(v.depth,true);}}else{l=v.firstChild;r=v.lastChild;a=l;for(var c=l;c;c=c.nextSibling){firstWalk(c);a=apportion(c,a);}
executeShifts(v);var midpoint=.5*(l.prelim+r.prelim);if(l=v.previousSibling){v.prelim=l.prelim+distance(v.depth,true);v.mod=v.prelim-midpoint;}else{v.prelim=midpoint;}}}
function secondWalk(v,m,depth){v.breadth=v.prelim+m;m+=v.mod;for(var c=v.firstChild;c;c=c.nextSibling){secondWalk(c,m,depth);}}
function apportion(v,a){var w=v.previousSibling;if(w){var vip=v,vop=v,vim=w,vom=v.parentNode.firstChild,sip=vip.mod,sop=vop.mod,sim=vim.mod,som=vom.mod,nr=nextRight(vim),nl=nextLeft(vip);while(nr&&nl){vim=nr;vip=nl;vom=nextLeft(vom);vop=nextRight(vop);vop.ancestor=v;var shift=(vim.prelim+sim)-(vip.prelim+sip)+distance(vim.depth,false);if(shift>0){moveSubtree(ancestor(vim,v,a),v,shift);sip+=shift;sop+=shift;}
sim+=vim.mod;sip+=vip.mod;som+=vom.mod;sop+=vop.mod;nr=nextRight(vim);nl=nextLeft(vip);}
if(nr&&!nextRight(vop)){vop.thread=nr;vop.mod+=sim-sop;}
if(nl&&!nextLeft(vom)){vom.thread=nl;vom.mod+=sip-som;a=v;}}
return a;}
function nextLeft(v){return v.firstChild||v.thread;}
function nextRight(v){return v.lastChild||v.thread;}
function moveSubtree(wm,wp,shift){var subtrees=wp.number-wm.number;wp.change-=shift/subtrees;wp.shift+=shift;wm.change+=shift/subtrees;wp.prelim+=shift;wp.mod+=shift;}
function executeShifts(v){var shift=0,change=0;for(var c=v.lastChild;c;c=c.previousSibling){c.prelim+=shift;c.mod+=shift;change+=c.change;shift+=c.shift+change;}}
function ancestor(vim,v,a){return(vim.ancestor.parentNode==v.parentNode)?vim.ancestor:a;}
function distance(depth,siblings){return(siblings?1:(group+1))/((orient=="radial")?depth:1);}
var root=nodes[0];root.visitAfter(function(v,i){v.ancestor=v;v.prelim=0;v.mod=0;v.change=0;v.shift=0;v.number=v.previousSibling?(v.previousSibling.number+1):0;v.depth=i;});firstWalk(root);secondWalk(root,-root.prelim,0);function midAngle(n){return(orient=="radial")?n.breadth/depth:0;}
function x(n){switch(orient){case"left":return n.depth;case"right":return w-n.depth;case"top":case"bottom":return n.breadth+w/2;case"radial":return w/2+n.depth*Math.cos(midAngle(n));}}
function y(n){switch(orient){case"left":case"right":return n.breadth+h/2;case"top":return n.depth;case"bottom":return h-n.depth;case"radial":return h/2+n.depth*Math.sin(midAngle(n));}}
root.visitAfter(function(v){v.breadth*=breadth;v.depth*=depth;v.midAngle=midAngle(v);v.x=x(v);v.y=y(v);if(v.firstChild)v.midAngle+=Math.PI;delete v.breadth;delete v.depth;delete v.ancestor;delete v.prelim;delete v.mod;delete v.change;delete v.shift;delete v.number;delete v.thread;});};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after");};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,bspace=s.breadth,dspace=s.depth,ax=0,ay=0;function position(n,breadth,depth){n.x=ax+depth++*dspace;n.y=ay+breadth++*bspace;n.midAngle=0;for(var c=n.firstChild;c;c=c.nextSibling){breadth=position(c,breadth,depth);}
return breadth;}
position(nodes[0],1,1);};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(n){return n.radius;}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link;};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1;};pv.Layout.Pack.prototype.size=function(f){this.$radius=typeof f=="function"?function(){return Math.sqrt(f.apply(this,arguments));}:(f=Math.sqrt(f),function(){return f;});return this;};pv.Layout.Pack.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var that=this,nodes=s.nodes,root=nodes[0];function radii(nodes){var stack=pv.Mark.stack;stack.unshift(null);for(var i=0,n=nodes.length;i<n;i++){var c=nodes[i];if(!c.firstChild){c.radius=that.$radius.apply(that,(stack[0]=c,stack));}}
stack.shift();}
function packTree(n){var nodes=[];for(var c=n.firstChild;c;c=c.nextSibling){if(c.firstChild)c.radius=packTree(c);c.n=c.p=c;nodes.push(c);}
switch(s.order){case"ascending":{nodes.sort(function(a,b){return a.radius-b.radius;});break;}
case"descending":{nodes.sort(function(a,b){return b.radius-a.radius;});break;}
case"reverse":nodes.reverse();break;}
return packCircle(nodes);}
function packCircle(nodes){var xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,j,k;function bound(n){xMin=Math.min(n.x-n.radius,xMin);xMax=Math.max(n.x+n.radius,xMax);yMin=Math.min(n.y-n.radius,yMin);yMax=Math.max(n.y+n.radius,yMax);}
function insert(a,b){var c=a.n;a.n=b;b.p=a;b.n=c;c.p=b;}
function splice(a,b){a.n=b;b.p=a;}
function intersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.radius+b.radius;return(dr*dr-dx*dx-dy*dy)>.001;}
a=nodes[0];a.x=-a.radius;a.y=0;bound(a);if(nodes.length>1){b=nodes[1];b.x=b.radius;b.y=0;bound(b);if(nodes.length>2){c=nodes[2];place(a,b,c);bound(c);insert(a,c);a.p=c;insert(c,b);b=a.n;for(var i=3;i<nodes.length;i++){place(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b.n;j!=b;j=j.n,s1++){if(intersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a.p;k!=j.p;k=k.p,s2++){if(intersects(k,c)){if(s2<s1){isect=-1;j=k;}
break;}}}
if(isect==0){insert(a,c);b=c;bound(c);}else if(isect>0){splice(a,j);b=j;i--;}else if(isect<0){splice(j,b);a=j;i--;}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(var i=0;i<nodes.length;i++){var n=nodes[i];n.x-=cx;n.y-=cy;cr=Math.max(cr,n.radius+Math.sqrt(n.x*n.x+n.y*n.y));}
return cr+s.spacing;}
function place(a,b,c){var da=b.radius+c.radius,db=a.radius+c.radius,dx=b.x-a.x,dy=b.y-a.y,dc=Math.sqrt(dx*dx+dy*dy),cos=(db*db+dc*dc-da*da)/(2*db*dc),theta=Math.acos(cos),x=cos*db,h=Math.sin(theta)*db;dx/=dc;dy/=dc;c.x=a.x+x*dx+h*dy;c.y=a.y+x*dy-h*dx;}
function transform(n,x,y,k){for(var c=n.firstChild;c;c=c.nextSibling){c.x+=n.x;c.y+=n.y;transform(c,x,y,k);}
n.x=x+k*n.x;n.y=y+k*n.y;n.radius*=k;}
radii(nodes);root.x=0;root.y=0;root.radius=packTree(root);var w=this.width(),h=this.height(),k=1/Math.max(2*root.radius/w,2*root.radius/h);transform(root,w/2,h/2,k);};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(d,p){return Math.sqrt(p.linkValue)*1.5;});this.label.textAlign("center");};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s)){var f=s.$force;if(f){f.next=this.binds.$force;this.binds.$force=f;}
return;}
var that=this,nodes=s.nodes,links=s.links,k=s.iterations,w=s.width,h=s.height;for(var i=0,n;i<nodes.length;i++){n=nodes[i];if(isNaN(n.x))n.x=w/2+40*Math.random()-20;if(isNaN(n.y))n.y=h/2+40*Math.random()-20;}
var sim=pv.simulation(nodes);sim.force(pv.Force.drag(s.dragConstant));sim.force(pv.Force.charge(s.chargeConstant).domain(s.chargeMinDistance,s.chargeMaxDistance).theta(s.chargeTheta));sim.force(pv.Force.spring(s.springConstant).damping(s.springDamping).length(s.springLength).links(links));sim.constraint(pv.Constraint.position());if(s.bound){sim.constraint(pv.Constraint.bound().x(6,w-6).y(6,h-6));}
function speed(n){return n.fix?1:n.vx*n.vx+n.vy*n.vy;}
if(k==null){sim.step();sim.step();var force=s.$force=this.binds.$force={next:this.binds.$force,nodes:nodes,min:1e-4*(links.length+1),sim:sim};if(!this.$timer)this.$timer=setInterval(function(){var render=false;for(var f=that.binds.$force;f;f=f.next){if(pv.max(f.nodes,speed)>f.min){f.sim.step();render=true;}}
if(render)that.render();},42);}else for(var i=0;i<k;i++){sim.step();}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var interpolate,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);interpolate=/^(top|bottom)$/.test(s.orient)?"step-before":/^(left|right)$/.test(s.orient)?"step-after":"linear";};this.link.interpolate(function(){return interpolate;});};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var root=s.nodes[0],group=s.group,breadth,depth,leafCount=0,leafIndex=.5-group/2;var p=undefined;root.visitAfter(function(n){if(n.firstChild){n.depth=1+pv.max(n.childNodes,function(n){return n.depth;});}else{if(group&&(p!=n.parentNode)){p=n.parentNode;leafCount+=group;}
leafCount++;n.depth=0;}});breadth=1/leafCount;depth=1/root.depth;var p=undefined;root.visitAfter(function(n){if(n.firstChild){n.breadth=pv.mean(n.childNodes,function(n){return n.breadth;});}else{if(group&&(p!=n.parentNode)){p=n.parentNode;leafIndex+=group;}
n.breadth=breadth*leafIndex++;}
n.depth=1-n.depth*depth;});root.visitAfter(function(n){n.minBreadth=n.firstChild?n.firstChild.minBreadth:(n.breadth-breadth/2);n.maxBreadth=n.firstChild?n.lastChild.maxBreadth:(n.breadth+breadth/2);});root.visitBefore(function(n){n.minDepth=n.parentNode?n.parentNode.maxDepth:0;n.maxDepth=n.parentNode?(n.depth+root.depth):(n.minDepth+2*root.depth);});root.minDepth=-depth;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(s){if(pv.Layout.Cluster.prototype.buildImplied.call(this,s))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1;};pv.Layout.Partition.prototype.size=function(f){this.$size=f;return this;};pv.Layout.Partition.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var that=this,root=s.nodes[0],stack=pv.Mark.stack,maxDepth=0;stack.unshift(null);root.visitAfter(function(n,i){if(i>maxDepth)maxDepth=i;n.size=n.firstChild?pv.sum(n.childNodes,function(n){return n.size;}):that.$size.apply(that,(stack[0]=n,stack));});stack.shift();switch(s.order){case"ascending":root.sort(function(a,b){return a.size-b.size;});break;case"descending":root.sort(function(b,a){return a.size-b.size;});break;}
var ds=1/maxDepth;root.minBreadth=0;root.breadth=.5;root.maxBreadth=1;root.visitBefore(function(n){var b=n.minBreadth,s=n.maxBreadth-b;for(var c=n.firstChild;c;c=c.nextSibling){c.minBreadth=b;c.maxBreadth=b+=(c.size/n.size)*s;c.breadth=(b+c.minBreadth)/2;}});root.visitAfter(function(n,i){n.minDepth=(i-1)*ds;n.maxDepth=n.depth=i*ds;});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(s){if(pv.Layout.Partition.prototype.buildImplied.call(this,s))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var interpolate,directed,reverse,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);directed=s.directed;interpolate=s.orient=="radial"?"linear":"polar";reverse=s.orient=="right"||s.orient=="top";};this.link.data(function(p){var s=p.sourceNode,t=p.targetNode;return reverse!=(directed||(s.breadth<t.breadth))?[s,t]:[t,s];}).interpolate(function(){return interpolate;});};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Arc.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,orient=s.orient,sort=this.$sort,index=pv.range(nodes.length),w=s.width,h=s.height,r=Math.min(w,h)/2;if(sort)index.sort(function(a,b){return sort(nodes[a],nodes[b]);});function midAngle(b){switch(orient){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(b-.25)*2*Math.PI;}}
function x(b){switch(orient){case"top":case"bottom":return b*w;case"left":return 0;case"right":return w;case"radial":return w/2+r*Math.cos(midAngle(b));}}
function y(b){switch(orient){case"top":return 0;case"bottom":return h;case"left":case"right":return b*h;case"radial":return h/2+r*Math.sin(midAngle(b));}}
for(var i=0;i<nodes.length;i++){var n=nodes[index[i]],b=n.breadth=(i+.5)/nodes.length;n.x=x(b);n.y=y(b);n.midAngle=midAngle(b);}};pv.Layout.Horizon=function(){pv.Layout.call(this);var that=this,bands,mode,size,fill,red,blue,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);bands=s.bands;mode=s.mode;size=Math.round((mode=="color"?.5:1)*s.height);fill=s.backgroundStyle;red=pv.ramp(fill,s.negativeStyle).domain(0,bands);blue=pv.ramp(fill,s.positiveStyle).domain(0,bands);};var bands=new pv.Panel().data(function(){return pv.range(bands*2);}).overflow("hidden").height(function(){return size;}).top(function(i){return mode=="color"?(i&1)*size:0;}).fillStyle(function(i){return i?null:fill;});this.band=new pv.Mark().top(function(d,i){return mode=="mirror"&&i&1?(i+1>>1)*size:null;}).bottom(function(d,i){return mode=="mirror"?(i&1?null:(i+1>>1)*-size):((i&1||-1)*(i+1>>1)*size);}).fillStyle(function(d,i){return(i&1?red:blue)((i>>1)+1);});this.band.add=function(type){return that.add(pv.Panel).extend(bands).add(type).extend(this);};};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var that=this,nodes,links,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);nodes=s.$rollup.nodes;links=s.$rollup.links;};this.node.data(function(){return nodes;}).shapeSize(function(d){return d.nodes.length*20;});this.link.interpolate("polar").eccentricity(.8);this.link.add=function(type){return that.add(pv.Panel).data(function(){return links;}).add(type).extend(this);};};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Rollup.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Rollup.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,links=s.links,directed=s.directed,n=nodes.length,x=[],y=[],rnindex=0,rnodes={},rlinks={};function id(i){return x[i]+","+y[i];}
var stack=pv.Mark.stack,o={parent:this};stack.unshift(null);for(var i=0;i<n;i++){o.index=i;stack[0]=nodes[i];x[i]=this.$x.apply(o,stack);y[i]=this.$y.apply(o,stack);}
stack.shift();for(var i=0;i<nodes.length;i++){var nodeId=id(i),rn=rnodes[nodeId];if(!rn){rn=rnodes[nodeId]=pv.extend(nodes[i]);rn.index=rnindex++;rn.x=x[i];rn.y=y[i];rn.nodes=[];}
rn.nodes.push(nodes[i]);}
for(var i=0;i<links.length;i++){var source=links[i].sourceNode,target=links[i].targetNode,rsource=rnodes[id(source.index)],rtarget=rnodes[id(target.index)],reverse=!directed&&rsource.index>rtarget.index,linkId=reverse?rtarget.index+","+rsource.index:rsource.index+","+rtarget.index,rl=rlinks[linkId];if(!rl){rl=rlinks[linkId]={sourceNode:rsource,targetNode:rtarget,linkValue:0,links:[]};}
rl.links.push(links[i]);rl.linkValue+=links[i].linkValue;}
s.$rollup={nodes:pv.values(rnodes),links:pv.values(rlinks)};};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var that=this,n,dx,dy,labels,pairs,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);n=s.nodes.length;dx=s.width/n;dy=s.height/n;labels=s.$matrix.labels;pairs=s.$matrix.pairs;};this.link.data(function(){return pairs;}).left(function(){return dx*(this.index%n);}).top(function(){return dy*Math.floor(this.index/n);}).width(function(){return dx;}).height(function(){return dy;}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(l){return l.linkValue?"#555":"#eee";}).parent=this;delete this.link.add;this.label.data(function(){return labels;}).left(function(){return this.index&1?dx*((this.index>>1)+.5):0;}).top(function(){return this.index&1?0:dy*((this.index>>1)+.5);}).textMargin(4).textAlign(function(){return this.index&1?"left":"right";}).textAngle(function(){return this.index&1?-Math.PI/2:0;});delete this.node;};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Matrix.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,links=s.links,sort=this.$sort,n=nodes.length,index=pv.range(n),labels=[],pairs=[],map={};s.$matrix={labels:labels,pairs:pairs};if(sort)index.sort(function(a,b){return sort(nodes[a],nodes[b]);});for(var i=0;i<n;i++){for(var j=0;j<n;j++){var a=index[i],b=index[j],p={row:i,col:j,sourceNode:nodes[a],targetNode:nodes[b],linkValue:0};pairs.push(map[a+"."+b]=p);}}
for(var i=0;i<n;i++){var a=index[i];labels.push(nodes[a],nodes[a]);}
for(var i=0;i<links.length;i++){var l=links[i],source=l.sourceNode.index,target=l.targetNode.index,value=l.linkValue;map[source+"."+target].linkValue+=value;if(!s.directed)map[target+"."+source].linkValue+=value;}};pv.Layout.Bullet=function(){pv.Layout.call(this);var that=this,buildImplied=that.buildImplied,scale=that.x=pv.Scale.linear(),orient,horizontal,rangeColor,measureColor,x;this.buildImplied=function(s){buildImplied.call(this,x=s);orient=s.orient;horizontal=/^left|right$/.test(orient);rangeColor=pv.ramp("#bbb","#eee").domain(0,Math.max(1,x.ranges.length-1));measureColor=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,x.measures.length-1));};(this.range=new pv.Mark()).data(function(){return x.ranges;}).reverse(true).left(function(){return orient=="left"?0:null;}).top(function(){return orient=="top"?0:null;}).right(function(){return orient=="right"?0:null;}).bottom(function(){return orient=="bottom"?0:null;}).width(function(d){return horizontal?scale(d):null;}).height(function(d){return horizontal?null:scale(d);}).fillStyle(function(){return rangeColor(this.index);}).antialias(false).parent=that;(this.measure=new pv.Mark()).extend(this.range).data(function(){return x.measures;}).left(function(){return orient=="left"?0:horizontal?null:this.parent.width()/3.25;}).top(function(){return orient=="top"?0:horizontal?this.parent.height()/3.25:null;}).right(function(){return orient=="right"?0:horizontal?null:this.parent.width()/3.25;}).bottom(function(){return orient=="bottom"?0:horizontal?this.parent.height()/3.25:null;}).fillStyle(function(){return measureColor(this.index);}).parent=that;(this.marker=new pv.Mark()).data(function(){return x.markers;}).left(function(d){return orient=="left"?scale(d):horizontal?null:this.parent.width()/2;}).top(function(d){return orient=="top"?scale(d):horizontal?this.parent.height()/2:null;}).right(function(d){return orient=="right"?scale(d):null;}).bottom(function(d){return orient=="bottom"?scale(d):null;}).strokeStyle("black").shape("bar").shapeAngle(function(){return horizontal?0:Math.PI/2;}).parent=that;(this.tick=new pv.Mark()).data(function(){return scale.ticks(7);}).left(function(d){return orient=="left"?scale(d):null;}).top(function(d){return orient=="top"?scale(d):null;}).right(function(d){return orient=="right"?scale(d):horizontal?null:-6;}).bottom(function(d){return orient=="bottom"?scale(d):horizontal?-8:null;}).height(function(){return horizontal?6:null;}).width(function(){return horizontal?null:6;}).parent=that;};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var size=this.parent[/^left|right$/.test(s.orient)?"width":"height"]();s.maximum=s.maximum||pv.max([].concat(s.ranges,s.markers,s.measures));this.x.domain(0,s.maximum).range(0,size);};pv.Behavior={};pv.Behavior.drag=function(){var scene,index,p,v1,max;function mousedown(d,e){index=this.index;scene=this.scene;var m=this.mouse();v1=((p=d).fix=pv.vector(d.x,d.y)).minus(m);max={x:this.parent.width()-(d.dx||0),y:this.parent.height()-(d.dy||0)};scene.mark.context(scene,index,function(){this.render();});pv.Mark.dispatch("dragstart",scene,index,e);}
function mousemove(e){if(!scene)return;scene.mark.context(scene,index,function(){var m=this.mouse();p.x=p.fix.x=Math.max(0,Math.min(v1.x+m.x,max.x));p.y=p.fix.y=Math.max(0,Math.min(v1.y+m.y,max.y));this.render();});pv.Mark.dispatch("drag",scene,index,e);}
function mouseup(e){if(!scene)return;p.fix=null;scene.mark.context(scene,index,function(){this.render();});pv.Mark.dispatch("dragend",scene,index,e);scene=null;}
pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.point=function(r){var unpoint,collapse=null,kx=1,ky=1,pointingPanel=null,r2=arguments.length?r*r:900;function search(scene,index){var s=scene[index],point={cost:Infinity};for(var i=(s.visible?s.children.length:0)-1;i>=0;i--){var child=s.children[i],mark=child.mark,p;if(mark.type=="panel"){mark.scene=child;for(var j=child.length-1;j>=0;j--){mark.index=j;p=search(child,j);if(p.cost<point.cost)point=p;}
delete mark.scene;delete mark.index;}else if(mark.$handlers.point){var v=mark.mouse();for(var j=child.length-1;j>=0;j--){var c=child[j],dx=v.x-c.left-(c.width||0)/2,dy=v.y-c.top-(c.height||0)/2,dd=kx*dx*dx+ky*dy*dy;if(dd<point.cost){point.distance=dx*dx+dy*dy;point.cost=dd;point.scene=child;point.index=j;}}}}
return point;}
function mousemove(e){var point=search(this.scene,this.index);if((point.cost==Infinity)||(point.distance>r2))point=null;if(unpoint){if(point&&(unpoint.scene==point.scene)&&(unpoint.index==point.index))return;pv.Mark.dispatch("unpoint",unpoint.scene,unpoint.index,e);}
if(unpoint=point){pv.Mark.dispatch("point",point.scene,point.index,e);if(!pointingPanel&&this.type==='panel'){pointingPanel=this;pointingPanel.event('mouseout',function(){var ev=arguments[arguments.length-1];mouseout.call(pointingPanel.scene.$g,ev);});}else{pv.listen(this.root.canvas(),"mouseout",mouseout);}}}
function mouseout(e){if(unpoint&&!pv.ancestor(this,e.relatedTarget)){pv.Mark.dispatch("unpoint",unpoint.scene,unpoint.index,e);unpoint=null;}}
mousemove.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;break;}
return mousemove;}
return collapse;};return mousemove;};pv.Behavior.select=function(){var scene,index,r,m1;function mousedown(d,e){index=this.index;scene=this.scene;m1=this.mouse();r=d;r.x=m1.x;r.y=m1.y;r.dx=r.dy=0;pv.Mark.dispatch("selectstart",scene,index,e);}
function mousemove(e){if(!scene)return;scene.mark.context(scene,index,function(){var m2=this.mouse();r.x=Math.max(0,Math.min(m1.x,m2.x));r.y=Math.max(0,Math.min(m1.y,m2.y));r.dx=Math.min(this.width(),Math.max(m2.x,m1.x))-r.x;r.dy=Math.min(this.height(),Math.max(m2.y,m1.y))-r.y;this.render();});pv.Mark.dispatch("select",scene,index,e);}
function mouseup(e){if(!scene)return;pv.Mark.dispatch("selectend",scene,index,e);scene=null;}
pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.resize=function(side){var scene,index,r,m1;function mousedown(d,e){index=this.index;scene=this.scene;m1=this.mouse();r=d;switch(side){case"left":m1.x=r.x+r.dx;break;case"right":m1.x=r.x;break;case"top":m1.y=r.y+r.dy;break;case"bottom":m1.y=r.y;break;}
pv.Mark.dispatch("resizestart",scene,index,e);}
function mousemove(e){if(!scene)return;scene.mark.context(scene,index,function(){var m2=this.mouse();r.x=Math.max(0,Math.min(m1.x,m2.x));r.y=Math.max(0,Math.min(m1.y,m2.y));r.dx=Math.min(this.parent.width(),Math.max(m2.x,m1.x))-r.x;r.dy=Math.min(this.parent.height(),Math.max(m2.y,m1.y))-r.y;this.render();});pv.Mark.dispatch("resize",scene,index,e);}
function mouseup(e){if(!scene)return;pv.Mark.dispatch("resizeend",scene,index,e);scene=null;}
pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.pan=function(){var scene,index,m1,v1,k,bound;function mousedown(){index=this.index;scene=this.scene;v1=pv.vector(pv.event.pageX,pv.event.pageY);m1=this.transform();k=1/(m1.k*this.scale);if(bound){bound={x:(1-m1.k)*this.width(),y:(1-m1.k)*this.height()};}}
function mousemove(e){if(!scene)return;scene.mark.context(scene,index,function(){var x=(pv.event.pageX-v1.x)*k,y=(pv.event.pageY-v1.y)*k,m=m1.translate(x,y);if(bound){m.x=Math.max(bound.x,Math.min(0,m.x));m.y=Math.max(bound.y,Math.min(0,m.y));}
this.transform(m).render();});pv.Mark.dispatch("pan",scene,index,e);}
function mouseup(){scene=null;}
mousedown.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.zoom=function(speed){var bound;if(!arguments.length)speed=1/48;function mousewheel(e){var v=this.mouse(),k=pv.event.wheel*speed,m=this.transform().translate(v.x,v.y).scale((k<0)?(1e3/(1e3-k)):((1e3+k)/1e3)).translate(-v.x,-v.y);if(bound){m.k=Math.max(1,m.k);m.x=Math.max((1-m.k)*this.width(),Math.min(0,m.x));m.y=Math.max((1-m.k)*this.height(),Math.min(0,m.y));}
this.transform(m).render();pv.Mark.dispatch("zoom",this.scene,this.index,e);}
mousewheel.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};return mousewheel;};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat>85?1:latlng.lat<-85?-1:Math.log(Math.tan(Math.PI/4
+pv.radians(latlng.lat)/2))/Math.PI};},invert:function(xy){return{lng:xy.x*180,lat:pv.degrees(2*Math.atan(Math.exp(xy.y*Math.PI))-Math.PI/2)};}},"gall-peters":{project:function(latlng){return{x:latlng.lng/180,y:Math.sin(pv.radians(latlng.lat))};},invert:function(xy){return{lng:xy.x*180,lat:pv.degrees(Math.asin(xy.y))};}},sinusoidal:{project:function(latlng){return{x:pv.radians(latlng.lng)*Math.cos(pv.radians(latlng.lat))/Math.PI,y:latlng.lat/90};},invert:function(xy){return{lng:pv.degrees((xy.x*Math.PI)/Math.cos(xy.y*Math.PI/2)),lat:xy.y*90};}},aitoff:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),a=Math.acos(Math.cos(f)*Math.cos(l/2));return{x:2*(a?(Math.cos(f)*Math.sin(l/2)*a/Math.sin(a)):0)/Math.PI,y:2*(a?(Math.sin(f)*a/Math.sin(a)):0)/Math.PI};},invert:function(xy){var x=xy.x*Math.PI/2,y=xy.y*Math.PI/2;return{lng:pv.degrees(x/Math.cos(y)),lat:pv.degrees(y)};}},hammer:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),c=Math.sqrt(1+Math.cos(f)*Math.cos(l/2));return{x:2*Math.SQRT2*Math.cos(f)*Math.sin(l/2)/c/3,y:Math.SQRT2*Math.sin(f)/c/1.5};},invert:function(xy){var x=xy.x*3,y=xy.y*1.5,z=Math.sqrt(1-x*x/16-y*y/4);return{lng:pv.degrees(2*Math.atan2(z*x,2*(2*z*z-1))),lat:pv.degrees(Math.asin(z*y))};}},identity:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat/90};},invert:function(xy){return{lng:xy.x*180,lat:xy.y*90};}}};pv.Geo.scale=function(p){var rmin={x:0,y:0},rmax={x:1,y:1},d=[],j=pv.Geo.projections.identity,x=pv.Scale.linear(-1,1).range(0,1),y=pv.Scale.linear(-1,1).range(1,0),c={lng:0,lat:0},lastLatLng,lastPoint;function scale(latlng){if(!lastLatLng||(latlng.lng!=lastLatLng.lng)||(latlng.lat!=lastLatLng.lat)){lastLatLng=latlng;var p=project(latlng);lastPoint={x:x(p.x),y:y(p.y)};}
return lastPoint;}
function project(latlng){var offset={lng:latlng.lng-c.lng,lat:latlng.lat};return j.project(offset);}
function invert(xy){var latlng=j.invert(xy);latlng.lng+=c.lng;return latlng;}
scale.x=function(latlng){return scale(latlng).x;};scale.y=function(latlng){return scale(latlng).y;};scale.ticks={lng:function(m){var lat,lng;if(d.length>1){var s=pv.Scale.linear();if(m==undefined)m=10;lat=s.domain(d,function(d){return d.lat;}).ticks(m);lng=s.domain(d,function(d){return d.lng;}).ticks(m);}else{lat=pv.range(-80,81,10);lng=pv.range(-180,181,10);}
return lng.map(function(lng){return lat.map(function(lat){return{lat:lat,lng:lng};});});},lat:function(m){return pv.transpose(scale.ticks.lng(m));}};scale.invert=function(p){return invert({x:x.invert(p.x),y:y.invert(p.y)});};scale.domain=function(array,f){if(arguments.length){d=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);if(d.length>1){var lngs=d.map(function(c){return c.lng;});var lats=d.map(function(c){return c.lat;});c={lng:(pv.max(lngs)+pv.min(lngs))/2,lat:(pv.max(lats)+pv.min(lats))/2};var n=d.map(project);x.domain(n,function(p){return p.x;});y.domain(n,function(p){return p.y;});}else{c={lng:0,lat:0};x.domain(-1,1);y.domain(-1,1);}
lastLatLng=null;return this;}
return d;};scale.range=function(min,max){if(arguments.length){if(typeof min=="object"){rmin={x:Number(min.x),y:Number(min.y)};rmax={x:Number(max.x),y:Number(max.y)};}else{rmin={x:0,y:0};rmax={x:Number(min),y:Number(max)};}
x.range(rmin.x,rmax.x);y.range(rmax.y,rmin.y);lastLatLng=null;return this;}
return[rmin,rmax];};scale.projection=function(p){if(arguments.length){j=typeof p=="string"?pv.Geo.projections[p]||pv.Geo.projections.identity:p;return this.domain(d);}
return p;};scale.by=function(f){function by(){return scale(f.apply(this,arguments));}
for(var method in scale)by[method]=scale[method];return by;};if(arguments.length)scale.projection(p);return scale;};return pv;});pen.define("cdf/lib/CCC/protovis-msie",["cdf/lib/CCC/protovis"],function(pv){pv.have_SVG=!!(document.createElementNS&&document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect);pv.have_VML=(function(d,a,b){a=d.createElement('div');a.innerHTML='<pvml:shape adj="1" />';b=a.firstChild;b.style.behavior='url(#default#VML)';return b?typeof b.adj==='object':true;})(document);if(!Array.prototype.indexOf){Array.prototype.indexOf=function(s,from){var n=this.length>>>0,i=(!isFinite(from)||from<0)?0:(from>this.length)?this.length:from;for(;i<n;i++){if(this[i]===s){return i;}}
return-1;};}
if(!pv.have_SVG&&pv.have_VML){(function(){if(typeof Date.now!=='function'){Date.now=function(){return new Date()*1;};}
var vml={is64Bit:window.navigator.cpuClass==='x64',round:function(n){return Math.round((n||0)*21.6);},styles:null,pre:'<pvml:',post:' class="msvml">',block:{'group':1,'shape':1,'shapetype':1,'line':1,'polyline':1,'curve':1,'rect':1,'roundrect':1,'oval':1,'arc':1,'image':1},caps:{'butt':'flat','round':'round','square':'square'},joins:{'bevel':'bevel','round':'round','miter':'miter'},cursorstyles:{'hand':'pointer','crosshair':1,'pointer':1,'move':1,'text':1,'wait':1,'help':1,'progress':1,'n-resize':1,'ne-resize':1,'nw-resize':1,'s-resize':1,'se-resize':1,'sw-resize':1,'e-resize':1,'w-resize':1},text_shim:null,_textcache:{},text_dims:function(text,font){var shim=vml.text_shim||(vml.init(),vml.text_shim);font=vml.processFont(font);var fontTextCache=vml._textcache[font]||(vml._textcache[font]={});var info=fontTextCache[text];if(!info){shim.style.font=font;shim.innerText=text;fontTextCache[text]=info={fontsize:parseInt(shim.style.fontSize,10),height:shim.offsetHeight,width:shim.offsetWidth};}
return info;},_fontCache:{},_fontSubst:{'default':'Arial','sans-serif':'Arial','sansserif':'Arial','sans':'Arial','serif':'Times New Roman','dialog':'Arial','monospaced':'Courier New','dialoginput':'Courier New'},_fontWhiteListIE64Bit:{'agency fb':1,'aharoni':1,'algerian':1,'andalus':1,'angsana new':1,'angsanaupc':1,'aparajita':1,'arabic typesetting':1,'arial':1,'arial black':1,'arial narrow':1,'arial rounded mt bold':1,'arial unicode ms':1,'baskerville old face':1,'batang':1,'batangche':1,'bauhaus 93':1,'bell mt':1,'berlin sans fb':1,'berlin sans fb demi':1,'bernard mt condensed':1,'blackadder itc':1,'bodoni mt':1,'bodoni mt black':1,'bodoni mt condensed':1,'bodoni mt poster compressed':1,'book antiqua':1,'bookman old style':1,'bookshelf symbol 7':1,'bradley hand itc':1,'britannic bold':1,'broadway':1,'browallia new':1,'browalliaupc':1,'brush script mt':1,'calibri':1,'californian fb':1,'calisto mt':1,'cambria':1,'cambria math':1,'candara':1,'castellar':1,'centaur':1,'century':1,'century gothic':1,'century schoolbook':1,'chiller':1,'colonna mt':1,'comic sans ms':1,'consolas':1,'constantia':1,'cooper black':1,'copperplate gothic bold':1,'copperplate gothic light':1,'corbel':1,'cordia new':1,'cordiaupc':1,'courier new':1,'curlz mt':1,'daunpenh':1,'david':1,'dfkai-sb':1,'dilleniaupc':1,'dokchampa':1,'dotum':1,'dotumche':1,'ebrima':1,'edwardian script itc':1,'elephant':1,'engravers mt':1,'eras bold itc':1,'eras demi itc':1,'eras light itc':1,'eras medium itc':1,'estrangelo edessa':1,'eucrosiaupc':1,'euphemia':1,'fangsong':1,'felix titling':1,'footlight mt light':1,'forte':1,'franklin gothic book':1,'franklin gothic demi':1,'franklin gothic demi cond':1,'franklin gothic heavy':1,'franklin gothic medium':1,'franklin gothic medium cond':1,'frankruehl':1,'freesiaupc':1,'freestyle script':1,'french script mt':1,'gabriola':1,'garamond':1,'gautami':1,'georgia':1,'gigi':1,'gill sans mt':1,'gill sans mt condensed':1,'gill sans mt ext condensed bold':1,'gill sans ultra bold':1,'gill sans ultra bold condensed':1,'gisha':1,'gloucester mt extra condensed':1,'goudy old style':1,'goudy stout':1,'gulim':1,'gulimche':1,'gungsuh':1,'gungsuhche':1,'guttman adii':1,'guttman adii-light':1,'guttman aharoni':1,'guttman calligraphic':1,'guttman david':1,'guttman drogolin':1,'guttman frank':1,'guttman frnew':1,'guttman haim':1,'guttman haim-condensed':1,'guttman hatzvi':1,'guttman hodes':1,'guttman kav':1,'guttman kav-light':1,'guttman keren':1,'guttman logo1':1,'guttman mantova':1,'guttman mantova-decor':1,'guttman miryam':1,'guttman myamfix':1,'guttman rashi':1,'guttman stam':1,'guttman stam1':1,'guttman vilna':1,'guttman yad':1,'guttman yad-brush':1,'guttman yad-light':1,'guttman-aharoni':1,'guttman-aram':1,'guttman-courmir':1,'guttman-soncino':1,'guttman-toledo':1,'haettenschweiler':1,'harlow solid italic':1,'harrington':1,'high tower text':1,'impact':1,'imprint mt shadow':1,'informal roman':1,'irisupc':1,'iskoola pota':1,'jasmineupc':1,'jokerman':1,'juice itc':1,'kaiti':1,'kalinga':1,'kartika':1,'khmer ui':1,'kodchiangupc':1,'kokila':1,'kristen itc':1,'kunstler script':1,'lao ui':1,'latha':1,'leelawadee':1,'levenim mt':1,'lilyupc':1,'lucida bright':1,'lucida calligraphy':1,'lucida console':1,'lucida fax':1,'lucida handwriting':1,'lucida sans':1,'lucida sans typewriter':1,'lucida sans unicode':1,'magneto':1,'maiandra gd':1,'malgun gothic':1,'mangal':1,'marlett':1,'matura mt script capitals':1,'meiryo':1,'meiryo ui':1,'microsoft himalaya':1,'microsoft jhenghei':1,'microsoft new tai lue':1,'microsoft phagspa':1,'microsoft sans serif':1,'microsoft tai le':1,'microsoft uighur':1,'microsoft yahei':1,'microsoft yi baiti':1,'mingliu':1,'mingliu-extb':1,'mingliu_hkscs':1,'mingliu_hkscs-extb':1,'miriam':1,'miriam fixed':1,'mistral':1,'modern no. 20':1,'mongolian baiti':1,'monotype corsiva':1,'monotype hadassah':1,'moolboran':1,'ms gothic':1,'ms mincho':1,'ms outlook':1,'ms pgothic':1,'ms pmincho':1,'ms reference sans serif':1,'ms reference specialty':1,'ms ui gothic':1,'mt extra':1,'mv boli':1,'narkisim':1,'niagara engraved':1,'niagara solid':1,'nsimsun':1,'nyala':1,'ocr a extended':1,'old english text mt':1,'onyx':1,'palace script mt':1,'palatino linotype':1,'papyrus':1,'parchment':1,'perpetua':1,'perpetua titling mt':1,'plantagenet cherokee':1,'playbill':1,'pmingliu':1,'pmingliu-extb':1,'poor richard':1,'pristina':1,'raavi':1,'rage italic':1,'ravie':1,'rockwell':1,'rockwell condensed':1,'rockwell extra bold':1,'rod':1,'sakkal majalla':1,'script mt bold':1,'segoe print':1,'segoe script':1,'segoe ui':1,'segoe ui light':1,'segoe ui semibold':1,'segoe ui symbol':1,'shonar bangla':1,'showcard gothic':1,'shruti':1,'simhei':1,'simplified arabic':1,'simplified arabic fixed':1,'simsun':1,'simsun-extb':1,'snap itc':1,'stencil':1,'sylfaen':1,'symbol':1,'tahoma':1,'tempus sans itc':1,'times new roman':1,'toptype soncino':1,'traditional arabic':1,'trebuchet ms':1,'tunga':1,'tw cen mt':1,'tw cen mt condensed':1,'tw cen mt condensed extra bold':1,'utsaah':1,'vani':1,'verdana':1,'vijaya':1,'viner hand itc':1,'vivaldi':1,'vladimir script':1,'vrinda':1,'webdings':1,'wide latin':1,'wingdings':1,'wingdings 2':1,'wingdings 3':1},_defaultFontIE64Bit:'Arial',processFont:function(font){var processedFont=vml._fontCache[font];if(!processedFont){var shim=vml.text_shim||(vml.init(),vml.text_shim);var style=shim.style;style.font=font;var fontFamily=style.fontFamily;if(fontFamily.charAt(0)==='"'){fontFamily=fontFamily.substr(1,fontFamily.length-1);}
var ffKey=fontFamily.toLowerCase();var substFF=vml._fontSubst[ffKey];if(substFF){fontFamily=substFF;}else if(vml.is64Bit&&!vml._fontWhiteListIE64Bit[ffKey]){fontFamily=vml._defaultFontIE64Bit;}
style.fontFamily='"'+fontFamily+'"';vml._fontCache[font]=processedFont=style.font;}
return processedFont;},d2r:Math.PI*2/360,get_dim:function(attr,target){var o=target||{};o.translate_x=0;o.translate_y=0;if(attr.transform){var t=/translate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(attr.transform);if(t&&t[1]){o.translate_x=parseFloat(t[1]);}
if(t&&t[2]){o.translate_y=parseFloat(t[2]);}
var r=/rotate\((\d+\.\d+|\d+)\)/.exec(attr.transform);if(r){o.rotation=parseFloat(r[1])%360;}}
o.x=parseFloat(attr.x||0);o.y=parseFloat(attr.y||0);if('width'in attr){o.width=parseFloat(attr.width);}
if('height'in attr){o.height=parseFloat(attr.height);}
return o;},solidFillStyle:{type:'solid'},elm_defaults:{"g":{rewrite:'span',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr);elm.style.cssText="position:absolute;zoom:1;left:"+
(d.translate_x+d.x)+"px;top:"+
(d.translate_y+d.y)+"px;";}},"line":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var x1=parseFloat(attr.x1||0),y1=parseFloat(attr.y1||0),x2=parseFloat(attr.x2||0),y2=parseFloat(attr.y2||0),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";vml.path(elm).v='M '+r(x1)+' '+r(y1)+' L '+r(x2)+' '+r(y2)+' E';vml.stroke(elm,attr,scenes,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},"rect":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),p=vml.path(elm),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";var x=r(d.translate_x+d.x),y=r(d.translate_y+d.y),w=r(d.width),h=r(d.height);p.v='M '+x+' '+y+' L '+(x+w)+' '+y+' L '+(x+w)+' '+(y+h)+' L '+x+' '+(y+h)+' x';vml.stroke(elm,attr,scenes,i);vml.fill(elm,attr,scenes,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},"path":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),es=elm.style;es.left=(d.translate_x+d.x)+"px";es.top=(d.translate_y+d.y)+"px";elm.coordorigin="0,0";elm.coordsize="21600,21600";vml.path(elm,attr.d);vml.fill(elm,attr,scenes,i);vml.stroke(elm,attr,scenes,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},"circle":{rewrite:'oval',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),es=elm.style,cx=parseFloat(attr.cx||0)+0.7,cy=parseFloat(attr.cy||0)+0.7,r=parseFloat(attr.r||0)+0.5;es.top=(d.translate_y+cy-r)+"px";es.left=(d.translate_x+cx-r)+"px";es.width=(r*2)+"px";es.height=(r*2)+"px";vml.fill(elm,attr,scenes,i);vml.stroke(elm,attr,scenes,i);}},"text":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr);var es=elm.style;elm.stroked="False";elm.path="m0,0 l1,0 e";var tp=vml.textpath(elm);tp.string=attr.string;var tpStyle=tp.style;tpStyle['v-text-align']=attr.textAlign;tpStyle.font=attr.font;if(attr.textDecoration){tpStyle.textDecoration=attr.textDecoration;}
vml.path(elm).textpathok='True';var r=attr.rotation;if(r){r=180*r/Math.PI;r=-(~~r%360)*vml.d2r;if(r){var ct=Math.cos(r).toFixed(8),st=Math.sin(r).toFixed(8);var skew=vml.skew(elm);skew.on='true';skew.matrix=ct+","+st+","+-st+","+ct+",0,0";}}
var s=scenes[i];s.fillStyle=vml.solidFillStyle;vml.fill(elm,attr,scenes,i);s.fillStyle=null;},css:"position:absolute;top:0px;left:0px;width:1px;height:1px;"},"svg":{rewrite:'span',css:'position:relative;overflow:hidden;display:inline-block;~display:block;'},"vml:path":{rewrite:'path'},"vml:stroke":{rewrite:'stroke'},"vml:fill":{rewrite:'fill'},"vml:textpath":{rewrite:'textpath'},"vml:skew":{rewrite:'skew'}},_elmcache:{'span':document.createElement('span'),'div':document.createElement('div')},createElement:function(type,reformat){var elm,cache=vml._elmcache,helper=vml.elm_defaults[type]||{};var tagName=helper.rewrite||type;if(tagName in cache){elm=cache[tagName].cloneNode(false);}
else{cache[tagName]=document.createElement(vml.pre+tagName+vml.post);if(tagName in vml.block){cache[tagName].className+=' msvml_block';}
elm=cache[tagName].cloneNode(false);}
helper.css&&(elm.style.cssText=helper.css);return elm;},_hex:pv.range(0,256).map(function(i){return pv.Format.pad("0",2,i.toString(16));}),_colorcache:{},color:function(value){var result=vml._colorcache[value];var rgb;if(!result&&(rgb=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(value))){vml._colorcache[value]=result='#'+vml._hex[rgb[1]]+vml._hex[rgb[2]]+vml._hex[rgb[3]];}
return result||value;},fill:function(elm,attr,scenes,i){var fill=elm.getElementsByTagName('fill')[0];if(!fill){fill=elm.appendChild(vml.createElement('vml:fill'));}
var fillStyle=scenes[i].fillStyle;if(!attr.fill||!fillStyle||(fillStyle.type==='solid'&&attr.fill==='none')){fill.on='false';}else{fill.on='true';if(fillStyle.type==='solid'){fill.type='solid';fill.color=vml.color(attr.fill);}else{var isLinear=fillStyle.type==='lineargradient';fill.method='none';var stops=fillStyle.stops;var S=stops.length;if(S>0){var stopsText=[];for(var i=0;i<S;i++){var stop=stops[i];stopsText.push(stop.offset+'% '+vml.color(stop.color.color));}
fill.color=vml.color(stops[0].color.color);fill.color2=vml.color(stops[S-1].color.color);fill.colors=stopsText.join(',');}
if(isLinear){fill.type='gradient';var angle=(-pv.degrees(fillStyle.angle))%360;fill.angle=angle<0?(angle+360):angle;}else{fill.type='gradientTitle';fill.focus='100%';fill.focussize='0 0';fill.focusposition='0 0';fill.angle=0;}}
fill.opacity=Math.min(parseFloat(attr['fill-opacity']||'1'),1)||'1';}},stroke:function(elm,attr,scenes,i){var stroke=elm.getElementsByTagName('stroke')[0];if(!stroke){stroke=elm.appendChild(vml.createElement('vml:stroke'));}
if(!attr.stroke||attr.stroke==='none'){stroke.on='false';stroke.weight=0;}else{var strokeWidth=attr['stroke-width'];if(strokeWidth==null||strokeWidth===''){strokeWidth=1;}else{strokeWidth=+strokeWidth;}
if(strokeWidth<1e-10){strokeWidth=0;}else if(strokeWidth<1){strokeWidth=1;}
if(!strokeWidth){stroke.on='false';stroke.weight=0;}else{stroke.on='true';stroke.weight=strokeWidth;stroke.color=vml.color(attr.stroke)||'black';stroke.opacity=Math.min(parseFloat(attr['stroke-opacity']||'1'),1)||'1';stroke.joinstyle=vml.joins[attr['stroke-linejoin']]||'miter';stroke.miterlimit=attr['stroke-miterlimit']||8;stroke.endcap=vml.caps[attr['stroke-linecap']]||'flat';var dashArray=attr["stroke-dasharray"];if(!dashArray||dashArray==='none'){dashArray='Solid';}
stroke.dashstyle=dashArray;}}},path:function(elm,svgpath){var p=elm.getElementsByTagName('path')[0];if(!p){p=elm.appendChild(vml.createElement('vml:path'));}
if(arguments.length>1){p.v=vml.rewritePath(svgpath);}
return p;},skew:function(elm){var sk=elm.getElementsByTagName('skew')[0];if(!sk)
sk=elm.appendChild(vml.createElement('vml:skew'));sk.on="false";return sk;},textpath:function(elm){var tp=elm.getElementsByTagName('textpath')[0];if(!tp){tp=elm.appendChild(vml.createElement('vml:textpath'));}
tp.style['v-text-align']='center';tp.style['v-text-kern']='true';tp.on="true";return tp;},init:function(){if(!vml.text_shim){vml.text_shim=document.getElementById('pv_vml_text_shim')||document.createElement('span');vml.text_shim.id='protovisvml_text_shim';vml.text_shim.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline-block;white-space:nowrap;";document.body.appendChild(vml.text_shim);}
if(!vml.styles){vml.styles=document.getElementById('protovisvml_styles')||document.createElement("style");vml.styles.id='protovisvml_styles';document.documentElement.firstChild.appendChild(vml.styles);vml.styles.styleSheet.addRule('.msvml','behavior:url(#default#VML);');vml.styles.styleSheet.addRule('.msvml_block','position:absolute;top:0;left:0;');try{if(!document.namespaces.pvml){document.namespaces.add('pvml','urn:schemas-microsoft-com:vml');}}catch(e){vml.pre='<';vml.post=' class="msvml" xmlns="urn:schemas-microsoft.com:vml">';}}},_pathcache:{},rewritePath:function(p,deb){var x=0,y=0,round=vml.round;if(!p){return p;}
if(p in vml._pathcache){return vml._pathcache[p];}
p=p.replace(/(\d*)((\.*\d*)(e ?-?\d*))/g,"$1");var bits=p.match(/([MLHVCSQTAZ ][^MLHVCSQTAZ ]*)/gi);var np=[],lastcurve=[];var oldOp='';for(var i=0,bl=bits.length;i<bl;i++){var itm=bits[i],op=itm.charAt(0),args=itm.substring(1).split(/[,]/);if(op==' '){op=oldOp;}
oldOp=op;switch(op){case'M':op='m';x=round(args[0]);y=round(args[1]);args=[x,y];break;case'm':op='m';x+=round(args[0]);y+=round(args[1]);args=[x,y];break;case"A":op='l';args=[(x=round(args[5])),(y=round(args[6]))];break;case"L":op='l';args=[(x=round(args[0])),(y=round(args[1]))];break;case"l":op='l';args=[(x=x+round(args[0])),(y=y+round(args[1]))];break;case"H":op='l';args=[(x=round(args[0])),y];break;case"h":op='l';args=[(x=x+round(args[0])),y];break;case"V":op='l';args=[x,(y=round(args[0]))];break;case"v":op='l';args=[x,(y=y+round(args[0]))];break;case"C":op='c';lastcurve=args=[round(args[0]),round(args[1]),round(args[2]),round(args[3]),(x=round(args[4])),(y=round(args[5]))];break;case"c":op='c';lastcurve=args=[x+round(args[0]),y+round(args[1]),x+round(args[2]),y+round(args[3]),(x=x+round(args[4])),(y=y+round(args[5]))];break;case"S":op='c';lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),round(args[0]),round(args[1]),(x=round(args[2])),(y=round(args[3]))];break;case"s":op='c';lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),x+round(args[0]),y+round(args[1]),(x=x+round(args[2])),(y=y+round(args[3]))];break;case"Q":op='c';var x1=round(args[0]),y1=round(args[1]),x2=round(args[2]),y2=round(args[3]);args=[~~(x+(x1-x)*2/3),~~(y+(y1-y)*2/3),~~(x1+(x2-x1)/3),~~(y1+(y2-y1)/3),(x=x2),(y=y2)];break;case"q":op='l';x+=round(args[2]);y+=round(args[3]);args=[x,y];break;case"Z":case"z":op='xe';args=[];break;default:op='';args=[];}
np.push(op,args.join(','));}
return(vml._pathcache[p]=(np.join('')+'e'));}};pv.Vml=vml;pv.VmlScene={scale:1,events:["mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{css:{}},copy_functions:function(obj){for(var name in obj){if(typeof obj[name]==='function'&&!(name in pv.VmlScene)){pv.VmlScene[name]=obj[name];}}}};pv.VmlScene.copy_functions(pv.SvgScene);pv.Scene=pv.VmlScene;pv.renderer=function(){return'vml';};(function(is64bit){pv.VmlScene.minRuleLineWidth=is64bit?1.2:1.1;pv.VmlScene.minBarWidth=is64bit?2.2:1.8;pv.VmlScene.minBarHeight=is64bit?2.2:1.8;pv.VmlScene.minBarLineWidth=is64bit?1.2:1.0;}(vml.is64Bit));pv.VmlScene.expect=function(e,type,scenes,i,attr,style){style=style||{};var helper=vml.elm_defaults[type]||{},_type=helper.rewrite||type;if(e){if(e.tagName.toUpperCase()!==_type.toUpperCase()){var n=vml.createElement(type);e.parentNode.replaceChild(n,e);e=n;}}else{e=vml.createElement(type);}
if('attr'in helper){helper.attr(attr,style,e,scenes,i);}
if(attr.cursor in vml.cursorstyles){var curs=vml.cursorstyles[attr.cursor];style.cursor=(curs===1)?attr.cursor:curs;}
if(style)this.setStyle(e,style);return e;};pv.VmlScene.removeSiblings=function(e){while(e){var n=e.nextSibling;e.parentNode.removeChild(e);e=n;}};pv.VmlScene.removeFillStyleDefinitions=function(scenes){};pv.VmlScene.addFillStyleDefinition=function(scenes,fill){};pv.VmlScene.setAttributes=function(e,attributes){};pv.VmlScene.setStyle=function(e,style){var eStyle=e.style;for(var name in style){var value=style[name];if(value==null)
eStyle.removeAttribute(name);else
eStyle[name]=value;}};pv.VmlScene.append=function(e,scenes,index){e.$scene={scenes:scenes,index:index};e=this.title(e,scenes[index]);if(!e.parentNode||e.parentNode.nodeType===11){scenes.$g.appendChild(e);}
return e.nextSibling;};pv.VmlScene.title=function(e,s){e.title=s.title||"";return e;};pv.VmlScene.panel=function(scenes){var g=scenes.$g,e=g&&g.firstChild;var inited=false;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;if(!scenes.parent){var canvas=s.canvas;canvas.style.display="inline-block";canvas.style.zoom=1;if(g&&(g.parentNode!==canvas)){g=canvas.firstChild;e=g&&g.firstChild;}
if(!g){inited=true;vml.init();g=canvas.appendChild(vml.createElement("svg"));g.unselectable='on';g.onselectstart=function(){return false;};var events=this.events;var dispatch=this.dispatch;for(var j=0,L=events.length;j<L;j++){g.addEventListener?g.addEventListener(events[j],dispatch,false):g.attachEvent("on"+events[j],dispatch);}
e=g.firstChild;}
scenes.$g=g;var w=(s.width+s.left+s.right),h=(s.height+s.top+s.bottom);g.style.width=w+'px';g.style.height=h+'px';g.style.clip="rect(0px "+w+"px "+h+"px 0px)";}
e=this.fill(e,scenes,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;this.eachChild(scenes,i,function(child){child.$g=e=this.expect(e,"g",scenes,i,{"transform":"translate("+x+","+y+")"+
(t.k!=1?" scale("+t.k+")":"")});this.updateAll(child);var parentNode=e.parentNode;if(!parentNode||parentNode.nodeType===11){g.appendChild(e);var helper=vml.elm_defaults[e.svgtype];if(helper&&typeof helper.onappend==='function'){helper.onappend(e,scenes[i]);}}
e=e.nextSibling;});this.scale=k;e=this.stroke(e,scenes,i);}
if(inited){this.removeSiblings(e);e=g.appendChild(vml.createElement("oval"));}
return e;};pv.VmlScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&dashArray!=='none'){var standardDashArray=this.translateDashStyleAlias(dashArray);if(this.isStandardDashStyle(standardDashArray)){dashArray=standardDashArray;}else{dashArray=dashArray.split(/[\s,]+/).map(function(num){return(+num)/this.scale;},this);if(dashArray.length%2){dashArray=dashArray.concat(dashArray);}
dashArray=dashArray.join(' ');}}else{dashArray=null;}
return dashArray;};(function(){var returnTrue=function(){return true;};var returnFalse=function(){return false;};var _event_props=["altKey","attrChange","attrName","bubbles","button","cancelable","charCode","clientX","clientY","ctrlKey","currentTarget","data","detail","eventPhase","fromElement","handler","keyCode","layerX","layerY","metaKey","newValue","offsetX","offsetY","pageX","pageY","prevValue","relatedNode","relatedTarget","screenX","screenY","shiftKey","srcElement","target","toElement","view","wheelDelta","which"];var _evPropCount=_event_props.length;function IEvent(src){if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=returnFalse;if(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault()){this.isDefaultPrevented=returnTrue;}
this.timeStamp=src.timeStamp||Date.now();}else{this.type=src;this.timeStamp=Date.now();}}
IEvent.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var SCROLL_NODE=(document.compatMode&&document.compatMode!="BackCompat")?'documentElement':'body';vml.fixEvent=function(ev){var originalEvent=ev;ev=new IEvent(originalEvent);var type=ev.type;var isKey=type==='keypress';for(var i=_evPropCount;i;){var prop=_event_props[--i];ev[prop]=originalEvent[prop];}
var target=ev.target;if(!target){target=ev.srcElement||document;if(target.nodeType===3){target=target.parentNode;}
ev.target=target;}
var fromElem;if(!ev.relatedTarget&&(fromElem=ev.fromElement)){ev.relatedTarget=(fromElem===target)?ev.toElement:fromElem;}
if(!isKey){var clientX;if(ev.pageX==null&&(clientX=ev.clientX)!=null){var scrollNode=document[SCROLL_NODE];ev.pageX=clientX+(scrollNode.scrollLeft||0)-(scrollNode.clientLeft||0);ev.pageY=ev.clientY+(scrollNode.scrollTop||0)-(scrollNode.clientTop||0);}}
if(ev.which==null){var charCode,keyCode,btn;if(!isKey){if((btn=ev.button)!==null){ev.which=(btn&1?1:(btn&2?3:(btn&4?2:0)));}}else{if((charCode=ev.charCode)!=null){ev.which=charCode;}else if((keyCode=ev.keyCode)!=null){ev.which=keyCode;}}}
ev.metaKey=!!ev.metaKey;if(type==="mousewheel"){ev.wheel=ev.wheelDelta;}
return ev;};})();pv.listener=function(f,target){return f.$listener||(f.$listener=function(e){try{pv.event=vml.fixEvent(e||window.event);return f.call(this,pv.event);}catch(e){pv.error(e);}finally{delete pv.event;}});};pv.listen=function(target,type,listener){listener=pv.listener(listener,target);if(target===window){target=document.documentElement;}
target.addEventListener?target.addEventListener(type,listener,false):target.attachEvent("on"+type,listener);return listener;};pv.VmlScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t&&pv.Mark.dispatch(e.type,t.scenes,t.index,e)){e.preventDefault();}});pv.VmlScene.image=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;e=this.fill(e,scenes,i);if(s.image){}else{e=new Image();e.src=s.url;var st=e.style;st.position='absolute';st.top=s.top;st.left=s.left;st.width=s.width;st.height=s.height;st.cursor=s.cursor;st.msInterpolationMode='bicubic';}
e=this.append(e,scenes,i);e=this.stroke(e,scenes,i);}
return e;};pv.VmlScene.label=function(scenes){var e=scenes.$g.firstChild,round=Math.round;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.textStyle;if(!fill.opacity||!s.text)continue;var txt=s.text.replace(/\s+/g,'\xA0');var font=vml.processFont(s.font);var label=vml.text_dims(txt,font);var dx=0;var dy=0;switch(s.textBaseline){case'middle':dy=(.1*label.fontsize);break;case'top':dy=s.textMargin+.5*label.fontsize;break;case'bottom':dy=-(s.textMargin+.5*label.fontsize);break;}
switch(s.textAlign){case'left':dx=s.textMargin;break;case'right':dx=-s.textMargin;break;}
var a=s.textAngle;if(a){var ct=Math.cos(a);var st=Math.sin(a);var dx2=dx*ct-dy*st;var dy2=dx*st+dy*ct;dx=dx2;dy=dy2;}
var left=s.left+dx;var top=s.top+dy;var attr={};if(s.cursor){attr.cursor=s.cursor;}
attr.fill=vml.color(fill.color)||"black";if(vml.is64Bit){attr['fill-opacity']=0.7;}
attr.x=left;attr.y=top;attr.rotation=s.textAngle;attr.string=txt;attr.textAlign=s.textAlign;attr.font=font;attr.textDecoration=s.textDecoration;e=this.expect(e,"text",scenes,i,attr,{'display':'block','lineHeight':1,'whiteSpace':'nowrap','zoom':1,'position':'absolute','cursor':'default','top':top+'px','left':left+'px'});e=this.append(e,scenes,i);}
return e;};pv.VmlScene.wedge=function(scenes){var e=scenes.$g.firstChild,round=vml.round;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;e=this.expect(e,"path",scenes,i,{"pointer-events":s.events,"cursor":s.cursor,"transform":"translate("+s.left+","+s.top+")","d":'',"fill":fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});var p=e.getElementsByTagName('path')[0];if(!p){p=vml.make('path');e.appendChild(p);}
var r1=round(s.innerRadius),r2=round(s.outerRadius),d;if(s.angle>=2*Math.PI){if(r1){d="AE0,0 "+r2+","+r2+" 0 23592960"
+"AL0,0 "+r1+","+r1+" 0 23592960";}
else{d="AE0,0 "+r2+","+r2+" 0 23592960";}}
else{var sa=Math.round(s.startAngle/Math.PI*11796480),a=Math.round(s.angle/Math.PI*11796480);if(r1){d="AE 0,0 "+r2+","+r2+" "+-sa+" "+-a
+" 0,0 "+r1+","+r1+" "+-(sa+a)+" "+a
+"X";}
else{d="M0,0"
+"AE0,0 "+r2+","+r2+" "+-sa+" "+-a
+"X";}}
p.v=d;e=this.append(e,scenes,i);}
return e;};})();}});pen.define("cdf/lib/CCC/tipsy",["cdf/lib/CCC/protovis"],function(pv){(function(){var _nextTipsyId=0;pv.Behavior.tipsy=function(opts){var _tipsyId=_nextTipsyId++;if(!opts){opts={};}else{opts=Object.create(opts);}
opts.trigger='manual';opts.userGravity=opts.gravity||$.fn.tipsy.defaults.gravity;opts.gravity=calculateGravity;var $fakeTipTarget,$targetElem,nextOperationId=0,prevMouseX,prevMouseY,delayOut=opts.delayOut,id,usesPoint=opts.usesPoint,$canvas,isEnabled=opts.isEnabled,sharedTipsyInfo;opts.delayOut=0;function getTooltipText(mark,instance){if(!instance){instance=mark.instance();}
var title=(instance&&instance.tooltip)||(!mark.properties.tooltip&&typeof mark.tooltip=='function'&&mark.tooltip())||instance.title||instance.text;if(typeof title==='function'){title=title();}
return title||"";}
function getInstanceBounds(mark){var left,top,width,height;if(mark.properties.width){var bounds=getVisibleScreenBounds(mark);left=bounds.left;top=bounds.top;width=bounds.width;height=bounds.height;}else{var t=mark.toScreenTransform();var instance=mark.instance();var radius;if(mark.properties.outerRadius){var midAngle=instance.startAngle+instance.angle/2;radius=instance.outerRadius;left=t.x+instance.left+radius*Math.cos(midAngle);top=t.y+instance.top+radius*Math.sin(midAngle);}else if(mark.properties.shapeRadius){radius=Math.max(2,instance.shapeRadius);var cx=instance.left;var cy=instance.top;switch(instance.shape){case'diamond':radius*=Math.SQRT2;break;case'circle':radius/=Math.SQRT2;break;}
left=(cx-radius)*t.k+t.x;top=(cy-radius)*t.k+t.y;height=width=2*radius*t.k;}else{left=instance.left*t.k+t.x;top=instance.top*t.k+t.y;}}
var left2=Math.ceil(left);var top2=Math.ceil(top);var leftE=left2-left;var topE=top2-top;width=Math.max(1,Math.floor((width||0)-leftE));height=Math.max(1,Math.floor((height||0)-topE));return{left:left2,top:top2,width:width,height:height};}
var _gravities=['nw','n','ne','e','se','s','sw','w'];function calculateGravity(tipSize,calcPosition){(this===$fakeTipTarget[0])||def.assert();var scrollOffset=pv.scrollOffset(this);var gravity=opts.userGravity;if(typeof gravity==='function'){gravity=gravity.call(this)||$.fn.tipsy.defaults.gravity;}
if(gravity==='c'){gravity='w';}
var bestScore=scoreGravity(gravity);if(!bestScore.isTotal){var g=_gravities.indexOf(gravity);for(var n=1,L=_gravities.length;n<L;n++){var i=(g+n)%L;bestScore=chooseScores(bestScore,scoreGravity(_gravities[i]));}
if(_tip.debug>=6&&gravity!==bestScore.gravity){_tip.log("[TIPSY] #"+_tipsyId+" Choosing gravity '"+bestScore.gravity+"' over '"+gravity+"'");}
gravity=bestScore.gravity;}
if(_tip.debug>=6){_tip.log("[TIPSY] #"+_tipsyId+" Gravity '"+gravity+"'");}
return gravity;function scoreGravity(gravity){var tp=calcPosition(gravity);return scorePosition(gravity,tp);}
function scorePosition(gravity,tp){var wScore=calcPosScore(tp.left,'width');var hScore=calcPosScore(tp.top,'height');var isTotal=wScore.fits&&hScore.fits;return{gravity:gravity,width:wScore,height:hScore,value:wScore.value+hScore.value+(2-gravity.length),isTotal:isTotal,isPartial:!isTotal&&(wScore.fits||hScore.fits)};}
function calcPosScore(absPos,a_len){var maxLen=$(window)[a_len]();var len=tipSize[a_len];var pos=absPos-scrollOffset[a_len==='width'?0:1];var opos=maxLen-(pos+len);var fits=pos>=0&&opos>=0;var value=(pos>=0?pos:(4*pos))+
(opos>=0?opos:(4*opos));return{fits:fits,value:value};}}
function chooseScores(score1,score2){if(score1.isTotal){if(!score2.isTotal){return score1;}}else if(score2.isTotal){if(!score1.isTotal){return score2;}}else if(score1.isPartial){if(!score2.isPartial){return score1;}}else if(score2.isPartial){if(!score1.isPartial){return score2;}}
return score2.value>score1.value?score2:score1;}
function setFakeTipTargetBounds(bounds){$fakeTipTarget.css({left:bounds.left,top:bounds.top,width:bounds.width,height:bounds.height});}
function createTipsy(mark){var c=mark.root.canvas();$canvas=$(c);c.style.position="relative";$canvas.mouseleave(hideTipsy);initTipsyCanvasSharedInfo();if(!id){id="tipsyPvBehavior_"+new Date().getTime();}
var fakeTipTarget=document.getElementById(id);if(!fakeTipTarget){fakeTipTarget=document.createElement("div");fakeTipTarget.id=id;c.appendChild(fakeTipTarget);}
var fakeStyle=fakeTipTarget.style;fakeStyle.padding='0px';fakeStyle.margin='0px';fakeStyle.position='absolute';fakeStyle.pointerEvents='none';fakeStyle.display='block';fakeStyle.zIndex=-10;$fakeTipTarget=$(fakeTipTarget);updateTipDebug();$fakeTipTarget.data('tipsy',null);$fakeTipTarget.tipsy(opts);}
function initTipsyCanvasSharedInfo(){sharedTipsyInfo=$canvas.data('tipsy-pv-shared-info');if(sharedTipsyInfo){var createId=($canvas[0].$pvCreateId||0);if(sharedTipsyInfo.createId===createId){sharedTipsyInfo.behaviors.push(hideTipsyOther);return;}
sharedTipsyInfo.behaviors.forEach(function(aHideTipsy){aHideTipsy();});}
sharedTipsyInfo={createId:($canvas[0].$pvCreateId||0),behaviors:[hideTipsyOther]};$canvas.data('tipsy-pv-shared-info',sharedTipsyInfo);}
function updateTipDebug(){if($fakeTipTarget){if(_tip.debug>=5){$fakeTipTarget.css({borderColor:'red',borderWidth:'1px',borderStyle:'solid'});}else{$fakeTipTarget.css({borderWidth:'0px'});}}}
function getMouseBounds(ev){if(!ev){ev=pv.event;}
var delta=5;var offset=$canvas.offset();return{left:ev.pageX-offset.left-delta,top:ev.pageY-offset.top-delta,width:10+2*delta,height:20};}
function setTarget(targetElem){if((!$targetElem&&targetElem)||($targetElem&&$targetElem[0]!==targetElem)){if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Changing target element.");}
if($targetElem){$targetElem.unbind('mousemove',updateTipsy);if(!usesPoint){$targetElem.unbind('mouseleave',hideTipsy);}}
$targetElem=targetElem?$(targetElem):null;prevMouseX=prevMouseY=null;if($targetElem){$targetElem.mousemove(updateTipsy);if(!usesPoint){$targetElem.mouseleave(hideTipsy);}}}}
function getNewOperationId(){return nextOperationId++;}
function checkCanOperate(opId){return opId===nextOperationId-1;}
function hideTipsy(){var opId=getNewOperationId();if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Begin opId="+opId);}
if(delayOut>0){setTimeout(function(){if(checkCanOperate(opId)){if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Hiding opId="+opId+" nextOperationId="+nextOperationId);}
hideTipsyCore(opId);}else{if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Cancelled opId="+opId);}}},delayOut);return;}
if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Hiding Immediately opId="+opId);}
hideTipsyCore(opId);}
function hideTipsyOther(){var opId=getNewOperationId();if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Hiding as Other opId="+opId);}
hideTipsyCore(opId);}
function hideTipsyCore(opId){setTarget(null);if($fakeTipTarget){$fakeTipTarget.tipsy("leave");}}
function hideOtherTipsies(){var hideTipsies=sharedTipsyInfo&&sharedTipsyInfo.behaviors;if(hideTipsies&&hideTipsies.length>1){hideTipsies.forEach(function(aHideTipsy){if(aHideTipsy!==hideTipsyOther){aHideTipsy();}});}}
function updateTipsy(ev){if(!$fakeTipTarget){return;}
if(prevMouseX!=null&&prevMouseX===ev.clientX&&prevMouseY===ev.clientY){return;}
var t=this.$scene;var mark,scene;if(!t||!(scene=t.scenes)||!(mark=scene.mark)){return;}
var opId=getNewOperationId();if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Updating opId="+opId);}
prevMouseX=ev.clientX;prevMouseY=ev.clientY;var bounds;if($fakeTipTarget.tipsy('visible')){if(!opts.followMouse){mark.context(scene,t.index,function(){bounds=getInstanceBounds(mark);});}else{bounds=getMouseBounds(ev);}}else{mark.context(scene,t.index,function(){var text=getTooltipText(mark);if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Update text. Was hidden. Text: "+text);}
$fakeTipTarget.tipsy('setTitle',text);bounds=opts.followMouse?getMouseBounds(ev):getInstanceBounds(mark);});}
setFakeTipTargetBounds(bounds);hideOtherTipsies();$fakeTipTarget.tipsy("update");}
function initBehavior(mark){if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Creating");}
createTipsy(mark);if(usesPoint){mark.event('unpoint',hideTipsy);}}
function showTipsy(mark){var opId=getNewOperationId();if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Show IN opId="+opId);}
if(!$canvas){initBehavior(mark);}
var isHidden=!$targetElem;setTarget(pv.event.target);var text=getTooltipText(mark);if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Text: "+text);}
$fakeTipTarget.tipsy('setTitle',text);setFakeTipTargetBounds(opts.followMouse?getMouseBounds():getInstanceBounds(mark));hideOtherTipsies();if(isHidden){$fakeTipTarget.tipsy('enter');}else{$fakeTipTarget.tipsy('update');}
if(_tip.debug>=4){_tip.log("[TIPSY] #"+_tipsyId+" Show OUT");}}
function tipsyBehavior(){var mark=this;if(!isEnabled||isEnabled(tipsyBehavior,mark)){showTipsy(mark);}}
return tipsyBehavior;};var _tip=pv.Behavior.tipsy;_tip.debug=0;_tip.setDebug=function(level){_tip.debug=level;};_tip.log=function(m){if(typeof console!=="undefined"){console.log(''+m);}};function toParentTransform(parentPanel){return pv.Transform.identity.translate(parentPanel.left(),parentPanel.top()).times(parentPanel.transform());}
function getVisibleScreenBounds(mark){var instance=mark.instance(),left=instance.left,top=instance.top,width=instance.width,height=instance.height,right,bottom,parent;while((parent=mark.parent)){if(left<0){width+=left;left=0;}
if(top<0){height+=top;top=0;}
right=instance.right;if(right<0){width+=right;}
bottom=instance.bottom;if(bottom<0){height+=bottom;}
var t=toParentTransform(parent),s=t.k;left=t.x+(s*left);top=t.y+(s*top);width=s*width;height=s*height;mark=parent;instance=mark.instance();}
return{left:left,top:top,width:width,height:height};}}());});(function($){$.prompt=function(message,options){options=$.extend({},$.prompt.defaults,options);$.prompt.currentPrefix=options.prefix;var ie6=($.browser.msie&&$.browser.version<7);var $body=$(document.body);var $window=$(window);options.classes=$.trim(options.classes);if(options.classes!='')
options.classes=' '+options.classes;var msgbox='<div class="'+options.prefix+'box'+options.classes+'" id="'+options.prefix+'box">';if(options.useiframe&&(($('object, applet').length>0)||ie6)){msgbox+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+options.prefix+'fade" id="'+options.prefix+'fade"></iframe>';}else{if(ie6){$('select').css('visibility','hidden');}
msgbox+='<div class="'+options.prefix+'fade" id="'+options.prefix+'fade"></div>';}
msgbox+='<div class="'+options.prefix+'" id="'+options.prefix+'"><div class="'+options.prefix+'container"><div class="';msgbox+=options.prefix+'close">X</div><div id="'+options.prefix+'states"></div>';msgbox+='</div></div></div>';var $jqib=$(msgbox).appendTo($body);var $jqi=$jqib.children('#'+options.prefix);var $jqif=$jqib.children('#'+options.prefix+'fade');if(message.constructor==String){message={state0:{html:message,buttons:options.buttons,focus:options.focus,submit:options.submit}};}
var states="";$.each(message,function(statename,stateobj){stateobj=$.extend({},$.prompt.defaults.state,stateobj);message[statename]=stateobj;states+='<div id="'+options.prefix+'_state_'+statename+'" class="'+options.prefix+'_state" style="display:none;"><div class="'+options.prefix+'message">'+stateobj.html+'</div><div class="'+options.prefix+'buttons">';$.each(stateobj.buttons,function(k,v){if(typeof v=='object')
states+='<button name="'+options.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" id="'+options.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" value="'+v.value+'">'+v.title+'</button>';else states+='<button name="'+options.prefix+'_'+statename+'_button'+k+'" id="'+options.prefix+'_'+statename+'_button'+k+'" value="'+v+'">'+k+'</button>';});states+='</div></div>';});$jqi.find('#'+options.prefix+'states').html(states).children('.'+options.prefix+'_state:first').css('display','block');$jqi.find('.'+options.prefix+'buttons:empty').css('display','none');$.each(message,function(statename,stateobj){var $state=$jqi.find('#'+options.prefix+'_state_'+statename);$state.children('.'+options.prefix+'buttons').children('button').click(function(){var msg=$state.children('.'+options.prefix+'message');var clicked=stateobj.buttons[$(this).text()];if(clicked==undefined){for(var i in stateobj.buttons)
if(stateobj.buttons[i].title==$(this).text())
clicked=stateobj.buttons[i].value;}
if(typeof clicked=='object')
clicked=clicked.value;var forminputs={};$.each($jqi.find('#'+options.prefix+'states :input').serializeArray(),function(i,obj){if(forminputs[obj.name]===undefined){forminputs[obj.name]=obj.value;}else if(typeof forminputs[obj.name]==Array||typeof forminputs[obj.name]=='object'){forminputs[obj.name].push(obj.value);}else{forminputs[obj.name]=[forminputs[obj.name],obj.value];}});var close=stateobj.submit(clicked,msg,forminputs);if(close===undefined||close){removePrompt(true,clicked,msg,forminputs);}});$state.find('.'+options.prefix+'buttons button:eq('+stateobj.focus+')').addClass(options.prefix+'defaultbutton');});var ie6scroll=function(){$jqib.css({top:$window.scrollTop()});};var fadeClicked=function(){if(options.persistent){var i=0;$jqib.addClass(options.prefix+'warning');var intervalid=setInterval(function(){$jqib.toggleClass(options.prefix+'warning');if(i++>1){clearInterval(intervalid);$jqib.removeClass(options.prefix+'warning');}},100);}
else{removePrompt();}};var keyPressEventHandler=function(e){var key=(window.event)?event.keyCode:e.keyCode;if(key==27){fadeClicked();}
if(key==9){var $inputels=$(':input:enabled:visible',$jqib);var fwd=!e.shiftKey&&e.target==$inputels[$inputels.length-1];var back=e.shiftKey&&e.target==$inputels[0];if(fwd||back){setTimeout(function(){if(!$inputels)
return;var el=$inputels[back===true?$inputels.length-1:0];if(el)
el.focus();},10);return false;}}};var positionPrompt=function(){$jqib.css({position:(ie6)?"absolute":"fixed",height:$window.height(),width:"100%",top:(ie6)?$window.scrollTop():0,left:0,right:0,bottom:0});$jqif.css({position:"absolute",height:$window.height(),width:"100%",top:0,left:0,right:0,bottom:0});$jqi.css({position:"absolute",top:options.top,left:"50%",marginLeft:(($jqi.outerWidth()/2)*-1)});};var stylePrompt=function(){$jqif.css({zIndex:options.zIndex,display:"none",opacity:options.opacity});$jqi.css({zIndex:options.zIndex+1,display:"none"});$jqib.css({zIndex:options.zIndex});};var removePrompt=function(callCallback,clicked,msg,formvals){$jqi.remove();if(ie6){$body.unbind('scroll',ie6scroll);}
$window.unbind('resize',positionPrompt);$jqif.fadeOut(options.overlayspeed,function(){$jqif.unbind('click',fadeClicked);$jqif.remove();if(callCallback){options.callback(clicked,msg,formvals);}
$jqib.unbind('keypress',keyPressEventHandler);$jqib.remove();if(ie6&&!options.useiframe){$('select').css('visibility','visible');}});};positionPrompt();stylePrompt();if(ie6){$window.scroll(ie6scroll);}
$jqif.click(fadeClicked);$window.resize(positionPrompt);$jqib.bind("keydown keypress",keyPressEventHandler);$jqi.find('.'+options.prefix+'close').click(removePrompt);$jqif.fadeIn(options.overlayspeed);$jqi[options.show](options.promptspeed,options.loaded);$jqi.find('#'+options.prefix+'states .'+options.prefix+'_state:first .'+options.prefix+'defaultbutton').focus();if(options.timeout>0)
setTimeout($.prompt.close,options.timeout);return $jqib;};$.prompt.defaults={prefix:'jqi',classes:'',buttons:{Ok:true},loaded:function(){},submit:function(){return true;},callback:function(){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,useiframe:false,top:"15%",persistent:true,timeout:0,state:{html:'',buttons:{Ok:true},focus:0,submit:function(){return true;}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o);};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o);};$.prompt.getStateContent=function(state){return $('#'+$.prompt.currentPrefix+'_state_'+state);};$.prompt.getCurrentState=function(){return $('.'+$.prompt.currentPrefix+'_state:visible');};$.prompt.getCurrentStateName=function(){var stateid=$.prompt.getCurrentState().attr('id');return stateid.replace($.prompt.currentPrefix+'_state_','');};$.prompt.goToState=function(state,callback){$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$('#'+$.prompt.currentPrefix+'_state_'+state).slideDown('slow',function(){$(this).find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.nextState=function(callback){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').next();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.prevState=function(callback){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').prev();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.close=function(){$('#'+$.prompt.currentPrefix+'box').fadeOut('fast',function(){$(this).remove();});};$.fn.prompt=function(options){if(options==undefined)
options={};if(options.withDataAndEvents==undefined)
options.withDataAndEvents=false;$.prompt($(this).clone(options.withDataAndEvents).html(),options);}})(jQuery);(function($,undefined){$.ui=$.ui||{};if($.ui.version){return;}
$.extend($.ui,{version:"1.8.14",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):this._focus.apply(this,arguments);},scrollParent:function(){var scrollParent;if(($.browser.msie&&(/(static|relative)/).test(this.css('position')))||(/absolute/).test(this.css('position'))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.curCSS(this,'position',1))&&(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}
return(/fixed/).test(this.css('position'))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,true))||0;if(border){size-=parseFloat($.curCSS(elem,"border"+this+"Width",true))||0;}
if(margin){size-=parseFloat($.curCSS(elem,"margin"+this,true))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return!$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this);}).length;}
$.extend($.expr[":"],{data:function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none";});$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode){return;}
for(var i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b);},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size));},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width);}});})(jQuery);(function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){$(elem).triggerHandler("remove");}
_cleanData(elems);};}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){if(!keepData){if(!selector||$.filter(selector,[this]).length){$("*",this).add([this]).each(function(){$(this).triggerHandler("remove");});}}
return _remove.call($(this),selector,keepData);});};}
$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName]=function(elem){return!!$.data(elem,name);};$[namespace]=$[namespace]||{};$[namespace][name]=function(options,element){if(arguments.length){this._createWidget(options,element);}};var basePrototype=new base();basePrototype.options=$.extend(true,{},basePrototype.options);$[namespace][name].prototype=$.extend(true,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype);$.widget.bridge(name,$[namespace][name]);};$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.extend.apply(null,[true,options].concat(args)):options;if(isMethodCall&&options.charAt(0)==="_"){return returnValue;}
if(isMethodCall){this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,name);if(instance){instance.option(options||{})._init();}else{$.data(this,name,new object(options,this));}});}
return returnValue;};};$.Widget=function(options,element){if(arguments.length){this._createWidget(options,element);}};$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(options,element){$.data(element,this.widgetName,this);this.element=$(element);this.options=$.extend(true,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy();});this._create();this._trigger("create");this._init();},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName];},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled");},widget:function(){return this.element;},option:function(key,value){var options=key;if(arguments.length===0){return $.extend({},this.options);}
if(typeof key==="string"){if(value===undefined){return this.options[key];}
options={};options[key]=value;}
this._setOptions(options);return this;},_setOptions:function(options){var self=this;$.each(options,function(key,value){self._setOption(key,value);});return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget()
[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",value);}
return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_trigger:function(type,event,data){var callback=this.options[type];event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();data=data||{};if(event.originalEvent){for(var i=$.event.props.length,prop;i;){prop=$.event.props[--i];event[prop]=event.originalEvent[prop];}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.call(this.element[0],event,data)===false||event.isDefaultPrevented());}};})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mousedown(function(e){mouseHandled=false;});$.widget("ui.mouse",{options:{cancel:':input,option',distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind('mousedown.'+this.widgetName,function(event){return self._mouseDown(event);}).bind('click.'+this.widgetName,function(event){if(true===$.data(event.target,self.widgetName+'.preventClickEvent')){$.removeData(event.target,self.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind('.'+this.widgetName);},_mouseDown:function(event){if(mouseHandled){return};(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var self=this,btnIsLeft=(event.which==1),elIsCancel=(typeof this.options.cancel=="string"?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return self._mouseMove(event);};this._mouseUpDelegate=function(event){return self._mouseUp(event);};$(document).bind('mousemove.'+this.widgetName,this._mouseMoveDelegate).bind('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.browser.msie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target==this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(event){return this.mouseDelayMet;},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true;}});})(jQuery);(function($,undefined){$.ui=$.ui||{};var horizontalPositions=/left|center|right/,verticalPositions=/top|center|bottom/,center="center",_position=$.fn.position,_offset=$.fn.offset;$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var target=$(options.of),targetElem=target[0],collision=(options.collision||"flip").split(" "),offset=options.offset?options.offset.split(" "):[0,0],targetWidth,targetHeight,basePosition;if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();basePosition={top:0,left:0};}else if(targetElem.setTimeout){targetWidth=target.width();targetHeight=target.height();basePosition={top:target.scrollTop(),left:target.scrollLeft()};}else if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;basePosition={top:options.of.pageY,left:options.of.pageX};}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();basePosition=target.offset();}
$.each(["my","at"],function(){var pos=(options[this]||"").split(" ");if(pos.length===1){pos=horizontalPositions.test(pos[0])?pos.concat([center]):verticalPositions.test(pos[0])?[center].concat(pos):[center,center];}
pos[0]=horizontalPositions.test(pos[0])?pos[0]:center;pos[1]=verticalPositions.test(pos[1])?pos[1]:center;options[this]=pos;});if(collision.length===1){collision[1]=collision[0];}
offset[0]=parseInt(offset[0],10)||0;if(offset.length===1){offset[1]=offset[0];}
offset[1]=parseInt(offset[1],10)||0;if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]===center){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]===center){basePosition.top+=targetHeight/2;}
basePosition.left+=offset[0];basePosition.top+=offset[1];return this.each(function(){var elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",true))||0,marginTop=parseInt($.curCSS(this,"marginTop",true))||0,collisionWidth=elemWidth+marginLeft+
(parseInt($.curCSS(this,"marginRight",true))||0),collisionHeight=elemHeight+marginTop+
(parseInt($.curCSS(this,"marginBottom",true))||0),position=$.extend({},basePosition),collisionPosition;if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]===center){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]===center){position.top-=elemHeight/2;}
position.left=Math.round(position.left);position.top=Math.round(position.top);collisionPosition={left:position.left-marginLeft,top:position.top-marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:offset,my:options.my,at:options.at});}});if($.fn.bgiframe){elem.bgiframe();}
elem.offset($.extend(position,{using:options.using}));});};$.ui.position={fit:{left:function(position,data){var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft();position.left=over>0?position.left-over:Math.max(position.left-data.collisionPosition.left,position.left);},top:function(position,data){var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop();position.top=over>0?position.top-over:Math.max(position.top-data.collisionPosition.top,position.top);}},flip:{left:function(position,data){if(data.at[0]===center){return;}
var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft(),myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0];position.left+=data.collisionPosition.left<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0;},top:function(position,data){if(data.at[1]===center){return;}
var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop(),myOffset=data.my[1]==="top"?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1];position.top+=data.collisionPosition.top<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0;}}};if(!$.offset.setOffset){$.offset.setOffset=function(elem,options){if(/static/.test($.curCSS(elem,"position"))){elem.style.position="relative";}
var curElem=$(elem),curOffset=curElem.offset(),curTop=parseInt($.curCSS(elem,"top",true),10)||0,curLeft=parseInt($.curCSS(elem,"left",true),10)||0,props={top:(options.top-curOffset.top)+curTop,left:(options.left-curOffset.left)+curLeft};if('using'in options){options.using.call(elem,props);}else{curElem.css(props);}};$.fn.offset=function(options){var elem=this[0];if(!elem||!elem.ownerDocument){return null;}
if(options){return this.each(function(){$.offset.setOffset(this,options);});}
return _offset.call(this);};}}(jQuery));(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=='original'&&!(/^(?:r|a|f)/).test(this.element.css("position")))
this.element[0].style.position='relative';(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit();},destroy:function(){if(!this.element.data('draggable'))return;this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable"
+" ui-draggable-dragging"
+" ui-draggable-disabled");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is('.ui-resizable-handle'))
return false;this.handle=this._getHandle(event);if(!this.handle)
return false;$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._cacheHelperProportions();if($.ui.ddmanager)
$.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment)
this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(event,true);if($.ui.ddmanager)$.ui.ddmanager.dragStart(this,event);return true;},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);return false;},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour)
dropped=$.ui.ddmanager.drop(this,event);if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")
return false;if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(self._trigger("stop",event)!==false){self._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){if(this.options.iframeFix===true){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});}
if($.ui.ddmanager)$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target)handle=true;});return handle;},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length)
helper.appendTo((o.appendTo=='parent'?this.element[0].parentNode:o.appendTo));if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position")))
helper.css("position","absolute");return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[o.containment=='document'?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=='document'?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=='document'?0:$(window).scrollLeft())+$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=='document'?0:$(window).scrollTop())+($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce)return;var co=c.offset();var over=($(ce).css("overflow")!='hidden');this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;}else if(o.containment.constructor==Array){this.containment=o.containment;}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top;}
if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag")this.positionAbs=this._convertPositionTo("absolute");return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.extend($.ui.draggable,{version:"1.8.14"});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,'sortable');if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=='original')
this.instance.currentItem.css({top:'auto',left:'auto'});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("draggable"),self=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth);};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(self).clone().removeAttr('id').appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem)this.instance._mouseDrag(event);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger('out',event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=false;}};});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$('body'),o=$(this).data('draggable').options;if(t.css("cursor"))o._cursor=t.css("cursor");t.css("cursor",o.cursor);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._cursor)$('body').css("cursor",o._cursor);}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data('draggable').options;if(t.css("opacity"))o._opacity=t.css("opacity");t.css('opacity',o.opacity);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._opacity)$(ui.helper).css('opacity',o._opacity);}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML')i.overflowOffset=i.scrollParent.offset();},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML'){if(!o.axis||o.axis!='x'){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}
if(!o.axis||o.axis!='y'){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(!o.axis||o.axis!='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(!o.axis||o.axis!='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(i,event);}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||':data(draggable)'):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0])i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});});},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping)(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!='inner'){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}
var first=(ts||bs||ls||rs);if(o.snapMode!='outer'){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first))
(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=(ts||bs||ls||rs||first);};}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i;});this[0].style.zIndex=min+group.length;}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex"))o._zIndex=t.css("zIndex");t.css('zIndex',o.zIndex);},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex)$(ui.helper).css('zIndex',o._zIndex);}});})(jQuery);(function($,undefined){$.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:'*',activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:'default',tolerance:'intersect'},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"));},destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++)
if(drop[i]==this)
drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this;},_setOption:function(key,value){if(key=='accept'){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}
$.Widget.prototype._setOption.apply(this,arguments);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);(draggable&&this._trigger('activate',event,this.ui(draggable)));},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);(draggable&&this._trigger('deactivate',event,this.ui(draggable)));},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return false;var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,'droppable');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false;}});if(childrenIntersection)return false;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.extend($.ui.droppable,{version:"1.8.14"});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return false;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case'pointer':var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break;}};$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element))))continue;for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop;}};m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible)continue;if(type=="mousedown")m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight};}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance))
dropped=dropped||this._drop.call(this,event);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);});},drag:function(draggable,event){if(draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?'isout':(intersects&&this.isover==0?'isover':null);if(!c)return;var parentInstance;if(this.options.greedy){var parent=this.element.parents(':data(droppable):eq(0)');if(parent.length){parentInstance=$.data(parent[0],'droppable');parentInstance.greedyChild=(c=='isover'?1:0);}}
if(parentInstance&&c=='isover'){parentInstance['isover']=0;parentInstance['isout']=1;parentInstance._out.call(parentInstance,event);}
this[c]=1;this[c=='isout'?'isover':'isout']=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=='isout'){parentInstance['isout']=0;parentInstance['isover']=1;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);}};})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var self=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css('position'))&&$.browser.opera)
this.element.css({position:'relative',top:'auto',left:'auto'});this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');if(/sw|se|ne|nw/.test(handle))axis.css({zIndex:++o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!self.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);self.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").hover(function(){if(o.disabled)return;$(this).removeClass("ui-resizable-autohide");self._handles.show();},function(){if(o.disabled)return;if(!self.resizing){$(this).addClass("ui-resizable-autohide");self._handles.hide();}});}
this._mouseInit();},destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;wrapper.after(this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')})).remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
if($.browser.opera&&(/relative/).test(el.css('position')))
el.css({position:'relative',top:'auto',left:'auto'});this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},self=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]),ie6=$.browser.msie&&$.browser.version<7,csdif=this.sizeDiff;this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,self=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var s={width:(self.helper.width()-soffsetw),height:(self.helper.height()-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));self.helper.height(self.size.height);self.helper.width(self.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth)b.minWidth=pMinWidth;if(pMinHeight>b.minHeight)b.minHeight=pMinHeight;if(pMaxWidth<b.maxWidth)b.maxWidth=pMaxWidth;if(pMaxHeight<b.maxHeight)b.maxHeight=pMaxHeight;}
this._vBoundaries=b;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height))data.width=(data.height*this.aspectRatio);else if(isNumber(data.width))data.height=(data.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
if($.browser.msie&&!(!($(element).is(':hidden')||$(element).parents(':hidden').length)))
continue;prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6=$.browser.msie&&$.browser.version<7,ie6offset=(ie6?1:0),pxyoffset=(ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.extend($.ui.resizable,{version:"1.8.14"});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10),position:el.css('position')});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,os=self.originalSize,op=self.originalPosition;var delta={height:(self.size.height-os.height)||0,width:(self.size.width-os.width)||0,top:(self.position.top-op.top)||0,left:(self.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});if($.browser.opera&&/relative/.test(el.css('position'))){self._revertToRelativePosition=true;el.css({position:'absolute',top:'auto',left:'auto'});}
el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _reset=function(exp){$(exp).each(function(){var el=$(this);el.css({position:el.data("resizable-alsoresize").position});});};if(self._revertToRelativePosition){self._revertToRelativePosition=false;if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp){_reset(exp);});}else{_reset(o.alsoResize);}}
$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var pr=self._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var style={width:(self.size.width-soffsetw),height:(self.size.height-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;self.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(self.element.css('width'),10),height:parseInt(self.element.css('height'),10),top:parseInt(self.element.css('top'),10),left:parseInt(self.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});self._updateCache(data);self._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,el=self.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;self.containerElement=$(ce);if(/document/.test(oc)||oc==document){self.containerOffset={left:0,top:0};self.containerPosition={left:0,top:0};self.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});self.containerOffset=element.offset();self.containerPosition=element.position();self.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=self.containerOffset,ch=self.containerSize.height,cw=self.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);self.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,ps=self.containerSize,co=self.containerOffset,cs=self.size,cp=self.position,pRatio=self._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=self.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(self._helper?co.left:0)){self.size.width=self.size.width+(self._helper?(self.position.left-co.left):(self.position.left-cop.left));if(pRatio)self.size.height=self.size.width/o.aspectRatio;self.position.left=o.helper?co.left:0;}
if(cp.top<(self._helper?co.top:0)){self.size.height=self.size.height+(self._helper?(self.position.top-co.top):self.position.top);if(pRatio)self.size.width=self.size.height*o.aspectRatio;self.position.top=self._helper?co.top:0;}
self.offset.left=self.parentData.left+self.position.left;self.offset.top=self.parentData.top+self.position.top;var woset=Math.abs((self._helper?self.offset.left-cop.left:(self.offset.left-cop.left))+self.sizeDiff.width),hoset=Math.abs((self._helper?self.offset.top-cop.top:(self.offset.top-co.top))+self.sizeDiff.height);var isParent=self.containerElement.get(0)==self.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(self.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=self.parentData.left;if(woset+self.size.width>=self.parentData.width){self.size.width=self.parentData.width-woset;if(pRatio)self.size.height=self.size.width/self.aspectRatio;}
if(hoset+self.size.height>=self.parentData.height){self.size.height=self.parentData.height-hoset;if(pRatio)self.size.width=self.size.height*self.aspectRatio;}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options,cp=self.position,co=self.containerOffset,cop=self.containerPosition,ce=self.containerElement;var helper=$(self.helper),ho=helper.offset(),w=helper.outerWidth()-self.sizeDiff.width,h=helper.outerHeight()-self.sizeDiff.height;if(self._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(self._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size;self.ghost=self.originalElement.clone();self.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');self.ghost.appendTo(self.helper);},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost)self.ghost.css({position:'relative',height:self.size.height,width:self.size.width});},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost&&self.helper)self.helper.get(0).removeChild(self.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size,os=self.originalSize,op=self.originalPosition,a=self.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.left=op.left-ox;}
else{self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;self.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch'},_create:function(){var self=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(self.options.filter,self.element[0]);selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this;},_mouseStart:function(event){var self=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled)
return;var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.clientX,"top":event.clientY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=!event.metaKey||!selectee.$element.hasClass('ui-selected');selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){self._trigger("selecting",event,{selecting:selectee.element});}else{self._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){var self=this;this.dragged=true;if(this.options.disabled)
return;var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){var tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==self.element[0])
return;var hit=false;if(options.tolerance=='touch'){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance=='fit'){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass('ui-selected');selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass('ui-selecting');selectee.selecting=true;self._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if(event.metaKey&&selectee.startselected){selectee.$element.removeClass('ui-selecting');selectee.selecting=false;selectee.$element.addClass('ui-selected');selectee.selected=true;}else{selectee.$element.removeClass('ui-selecting');selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;}
self._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!selectee.startselected){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var self=this;this.dragged=false;var options=this.options;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;selectee.startselected=false;self._trigger("unselected",event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-selecting').addClass('ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;self._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});$.extend($.ui.selectable,{version:"1.8.14"});})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==='x'||(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData("sortable-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget()
[value?"addClass":"removeClass"]("ui-sortable-disabled");}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,self=this,nodes=$(event.target).parents().each(function(){if($.data(this,'sortable-item')==self){currentItem=$(this);return false;}});if($.data(event.target,'sortable-item')==self)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options,self=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,self._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.ui.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.ui.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var self=this;var cur=self.placeholder.offset();self.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-self.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-self.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){self._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){var self=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,self._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,self._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var self=this;var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data(sortable-item)");for(var i=0;i<this.items.length;i++){for(var j=0;j<list.length;j++){if(list[j]==this.items[i].item[0])
this.items.splice(i,1);};};},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var self=this;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data('sortable-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0])
continue;var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){var self=that||this,o=self.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(self.currentItem[0].nodeName)).addClass(className||self.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css('paddingTop')||0,10)-parseInt(self.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css('paddingLeft')||0,10)-parseInt(self.currentItem.css('paddingRight')||0,10));};}};}
self.placeholder=$(o.placeholder.element.call(self.element,self.currentItem));self.currentItem.after(self.placeholder);o.placeholder.update(self,self.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.ui.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else if(this.currentContainer!=this.containers[innermostIndex]){var dist=10000;var itemWithLeastDistance=null;var base=this.positionAbs[this.containers[innermostIndex].floating?'left':'top'];for(var j=this.items.length-1;j>=0;j--){if(!$.ui.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;var cur=this.items[j][this.containers[innermostIndex].floating?'left':'top'];if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){if(counter==self.counter)self.refreshPositions(!hardRefresh);},0);},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[],self=this;if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(!$.ui.contains(this.element[0],this.currentItem[0])){if(!noPropagation)delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.containers[i]));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.containers[i]));}};};for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(inst){var self=inst||this;return{helper:self.helper,placeholder:self.placeholder||$([]),position:self.position,originalPosition:self.originalPosition,offset:self.positionAbs,item:self.currentItem,sender:inst?inst.element:null};}});$.extend($.ui.sortable,{version:"1.8.14"});})(jQuery);(function($,undefined){$.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();}},_create:function(){var self=this,options=self.options;self.running=0;self.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");self.headers=self.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");}).bind("mouseleave.accordion",function(){if(options.disabled){return;}
$(this).removeClass("ui-state-hover");}).bind("focus.accordion",function(){if(options.disabled){return;}
$(this).addClass("ui-state-focus");}).bind("blur.accordion",function(){if(options.disabled){return;}
$(this).removeClass("ui-state-focus");});self.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(options.navigation){var current=self.element.find("a").filter(options.navigationFilter).eq(0);if(current.length){var header=current.closest(".ui-accordion-header");if(header.length){self.active=header;}else{self.active=current.closest(".ui-accordion-content").prev();}}}
self.active=self._findActive(self.active||options.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");self.active.next().addClass("ui-accordion-content-active");self._createIcons();self.resize();self.element.attr("role","tablist");self.headers.attr("role","tab").bind("keydown.accordion",function(event){return self._keydown(event);}).next().attr("role","tabpanel");self.headers.not(self.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();if(!self.active.length){self.headers.eq(0).attr("tabIndex",0);}else{self.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0});}
if(!$.browser.safari){self.headers.find("a").attr("tabIndex",-1);}
if(options.event){self.headers.bind(options.event.split(" ").join(".accordion ")+".accordion",function(event){self._clickHandler.call(self,event,this);event.preventDefault();});}},_createIcons:function(){var options=this.options;if(options.icons){$("<span></span>").addClass("ui-icon "+options.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(options.icons.header).toggleClass(options.icons.headerSelected);this.element.addClass("ui-accordion-icons");}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons");},destroy:function(){var options=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var contents=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(options.autoHeight||options.fillHeight){contents.css("height","");}
return $.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key=="active"){this.activate(value);}
if(key=="icons"){this._destroyIcons();if(value){this._createIcons();}}
if(key=="disabled"){this.headers.add(this.headers.next())
[value?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled");}},_keydown:function(event){if(this.options.disabled||event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._clickHandler({target:event.target},event.target);event.preventDefault();}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();return false;}
return true;},resize:function(){var options=this.options,maxHeight;if(options.fillSpace){if($.browser.msie){var defOverflow=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden");}
maxHeight=this.element.parent().height();if($.browser.msie){this.element.parent().css("overflow",defOverflow);}
this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(options.autoHeight){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}
return this;},activate:function(index){this.options.active=index;var active=this._findActive(index)[0];this._clickHandler({target:active},active);return this;},_findActive:function(selector){return selector?typeof selector==="number"?this.headers.filter(":eq("+selector+")"):this.headers.not(this.headers.not(selector)):selector===false?$([]):this.headers.filter(":eq(0)");},_clickHandler:function(event,target){var options=this.options;if(options.disabled){return;}
if(!event.target){if(!options.collapsible){return;}
this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);this.active.next().addClass("ui-accordion-content-active");var toHide=this.active.next(),data={options:options,newHeader:$([]),oldHeader:options.active,newContent:$([]),oldContent:toHide},toShow=(this.active=$([]));this._toggle(toShow,toHide,data);return;}
var clicked=$(event.currentTarget||target),clickedIsActive=clicked[0]===this.active[0];options.active=options.collapsible&&clickedIsActive?false:this.headers.index(clicked);if(this.running||(!options.collapsible&&clickedIsActive)){return;}
var active=this.active,toShow=clicked.next(),toHide=this.active.next(),data={options:options,newHeader:clickedIsActive&&options.collapsible?$([]):clicked,oldHeader:this.active,newContent:clickedIsActive&&options.collapsible?$([]):toShow,oldContent:toHide},down=this.headers.index(this.active[0])>this.headers.index(clicked[0]);this.active=clickedIsActive?$([]):clicked;this._toggle(toShow,toHide,data,clickedIsActive,down);active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);if(!clickedIsActive){clicked.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(options.icons.header).addClass(options.icons.headerSelected);clicked.next().addClass("ui-accordion-content-active");}
return;},_toggle:function(toShow,toHide,data,clickedIsActive,down){var self=this,options=self.options;self.toShow=toShow;self.toHide=toHide;self.data=data;var complete=function(){if(!self){return;}
return self._completed.apply(self,arguments);};self._trigger("changestart",null,self.data);self.running=toHide.size()===0?toShow.size():toHide.size();if(options.animated){var animOptions={};if(options.collapsible&&clickedIsActive){animOptions={toShow:$([]),toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace};}else{animOptions={toShow:toShow,toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace};}
if(!options.proxied){options.proxied=options.animated;}
if(!options.proxiedDuration){options.proxiedDuration=options.duration;}
options.animated=$.isFunction(options.proxied)?options.proxied(animOptions):options.proxied;options.duration=$.isFunction(options.proxiedDuration)?options.proxiedDuration(animOptions):options.proxiedDuration;var animations=$.ui.accordion.animations,duration=options.duration,easing=options.animated;if(easing&&!animations[easing]&&!$.easing[easing]){easing="slide";}
if(!animations[easing]){animations[easing]=function(options){this.slide(options,{easing:easing,duration:duration||700});};}
animations[easing](animOptions);}else{if(options.collapsible&&clickedIsActive){toShow.toggle();}else{toHide.hide();toShow.show();}
complete(true);}
toHide.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur();toShow.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus();},_completed:function(cancel){this.running=cancel?0:--this.running;if(this.running){return;}
if(this.options.clearStyle){this.toShow.add(this.toHide).css({height:"",overflow:""});}
this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length){this.toHide.parent()[0].className=this.toHide.parent()[0].className;}
this._trigger("change",null,this.data);}});$.extend($.ui.accordion,{version:"1.8.14",animations:{slide:function(options,additions){options=$.extend({easing:"swing",duration:300},options,additions);if(!options.toHide.size()){options.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},options);return;}
if(!options.toShow.size()){options.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},options);return;}
var overflow=options.toShow.css("overflow"),percentDone=0,showProps={},hideProps={},fxAttrs=["height","paddingTop","paddingBottom"],originalWidth;var s=options.toShow;originalWidth=s[0].style.width;s.width(parseInt(s.parent().width(),10)
-parseInt(s.css("paddingLeft"),10)
-parseInt(s.css("paddingRight"),10)
-(parseInt(s.css("borderLeftWidth"),10)||0)
-(parseInt(s.css("borderRightWidth"),10)||0));$.each(fxAttrs,function(i,prop){hideProps[prop]="hide";var parts=(""+$.css(options.toShow[0],prop)).match(/^([\d+-.]+)(.*)$/);showProps[prop]={value:parts[1],unit:parts[2]||"px"};});options.toShow.css({height:0,overflow:"hidden"}).show();options.toHide.filter(":hidden").each(options.complete).end().filter(":visible").animate(hideProps,{step:function(now,settings){if(settings.prop=="height"){percentDone=(settings.end-settings.start===0)?0:(settings.now-settings.start)/(settings.end-settings.start);}
options.toShow[0].style[settings.prop]=(percentDone*showProps[settings.prop].value)
+showProps[settings.prop].unit;},duration:options.duration,easing:options.easing,complete:function(){if(!options.autoHeight){options.toShow.css("height","");}
options.toShow.css({width:originalWidth,overflow:overflow});options.complete();}});},bounceslide:function(options){this.slide(options,{easing:options.down?"easeOutBounce":"swing",duration:options.down?1000:200});}}});})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var self=this,doc=this.element[0].ownerDocument,suppressKeyPress;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(event){if(self.options.disabled||self.element.attr("readonly")){return;}
suppressKeyPress=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:self._move("previousPage",event);break;case keyCode.PAGE_DOWN:self._move("nextPage",event);break;case keyCode.UP:self._move("previous",event);event.preventDefault();break;case keyCode.DOWN:self._move("next",event);event.preventDefault();break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(self.menu.active){suppressKeyPress=true;event.preventDefault();}
case keyCode.TAB:if(!self.menu.active){return;}
self.menu.select(event);break;case keyCode.ESCAPE:self.element.val(self.term);self.close(event);break;default:clearTimeout(self.searching);self.searching=setTimeout(function(){if(self.term!=self.element.val()){self.selectedItem=null;self.search(null,event);}},self.options.delay);break;}}).bind("keypress.autocomplete",function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault();}}).bind("focus.autocomplete",function(){if(self.options.disabled){return;}
self.selectedItem=null;self.previous=self.element.val();}).bind("blur.autocomplete",function(event){if(self.options.disabled){return;}
clearTimeout(self.searching);self.closing=setTimeout(function(){self.close(event);self._change(event);},150);});this._initSource();this.response=function(){return self._response.apply(self,arguments);};this.menu=$("<ul></ul>").addClass("ui-autocomplete").appendTo($(this.options.appendTo||"body",doc)[0]).mousedown(function(event){var menuElement=self.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){setTimeout(function(){$(document).one('mousedown',function(event){if(event.target!==self.element[0]&&event.target!==menuElement&&!$.ui.contains(menuElement,event.target)){self.close();}});},1);}
setTimeout(function(){clearTimeout(self.closing);},13);}).menu({focus:function(event,ui){var item=ui.item.data("item.autocomplete");if(false!==self._trigger("focus",event,{item:item})){if(/^key/.test(event.originalEvent.type)){self.element.val(item.value);}}},selected:function(event,ui){var item=ui.item.data("item.autocomplete"),previous=self.previous;if(self.element[0]!==doc.activeElement){self.element.focus();self.previous=previous;setTimeout(function(){self.previous=previous;self.selectedItem=item;},1);}
if(false!==self._trigger("select",event,{item:item})){self.element.val(item.value);}
self.term=self.element.val();self.close(event);self.selectedItem=item;},blur:function(event,ui){if(self.menu.element.is(":visible")&&(self.element.val()!==self.term)){self.element.val(self.term);}}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");if($.fn.bgiframe){this.menu.element.bgiframe();}},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();$.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo($(value||"body",this.element[0].ownerDocument)[0])}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_initSource:function(){var self=this,array,url;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(self.xhr){self.xhr.abort();}
self.xhr=$.ajax({url:url,data:request,dataType:"json",autocompleteRequest:++requestIndex,success:function(data,status){if(this.autocompleteRequest===requestIndex){response(data);}},error:function(){if(this.autocompleteRequest===requestIndex){response([]);}}});};}else{this.source=this.options.source;}},search:function(value,event){value=value!=null?value:this.element.val();this.term=this.element.val();if(value.length<this.options.minLength){return this.close(event);}
clearTimeout(this.closing);if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:value},this.response);},_response:function(content){if(!this.options.disabled&&content&&content.length){content=this._normalize(content);this._suggest(content);this._trigger("open");}else{this.close();}
this.pending--;if(!this.pending){this.element.removeClass("ui-autocomplete-loading");}},close:function(event){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",event);}},_change:function(event){if(this.previous!==this.element.val()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({label:item.label||item.value,value:item.value||item.label},item);});},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.deactivate();this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new $.Event("mouseover"));}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth(),this.element.outerWidth()));},_renderMenu:function(ul,items){var self=this;$.each(items,function(index,item){self._renderItem(ul,item);});},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.element.val(this.term);this.menu.deactivate();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});}(jQuery));(function($){$.widget("ui.menu",{_create:function(){var self=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(event){if(!$(event.target).closest(".ui-menu-item a").length){return;}
event.preventDefault();self.select(event);});this.refresh();},refresh:function(){var self=this;var items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this).parent());}).mouseleave(function(){self.deactivate();});},activate:function(event,item){this.deactivate();if(this.hasScroll()){var offset=item.offset().top-this.element.offset().top,scroll=this.element.scrollTop(),elementHeight=this.element.height();if(offset<0){this.element.scrollTop(scroll+offset);}else if(offset>=elementHeight){this.element.scrollTop(scroll+offset-elementHeight+item.height());}}
this.active=item.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",event,{item:item});},deactivate:function(){if(!this.active){return;}
this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null;},next:function(event){this.move("next",".ui-menu-item:first",event);},previous:function(event){this.move("prev",".ui-menu-item:last",event);},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},move:function(direction,edge,event){if(!this.active){this.activate(event,this.element.children(edge));return;}
var next=this.active[direction+"All"](".ui-menu-item").eq(0);if(next.length){this.activate(event,next);}else{this.activate(event,this.element.children(edge));}},nextPage:function(event){if(this.hasScroll()){if(!this.active||this.last()){this.activate(event,this.element.children(".ui-menu-item:first"));return;}
var base=this.active.offset().top,height=this.element.height(),result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base-height+$(this).height();return close<10&&close>-10;});if(!result.length){result=this.element.children(".ui-menu-item:last");}
this.activate(event,result);}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"));}},previousPage:function(event){if(this.hasScroll()){if(!this.active||this.first()){this.activate(event,this.element.children(".ui-menu-item:last"));return;}
var base=this.active.offset().top,height=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base+height-$(this).height();return close<10&&close>-10;});if(!result.length){result=this.element.children(".ui-menu-item:first");}
this.activate(event,result);}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"));}},hasScroll:function(){return this.element.height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight");},select:function(event){this._trigger("selected",event,{item:this.active});}});}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh");},1);},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']");}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return!this.form;});}}
return radios;};$.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=this.element.attr("disabled");}
this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var self=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=this.buttonElement.html();}
if(this.element.is(":disabled")){options.disabled=true;}
this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter.button",function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active");}}).bind("mouseleave.button",function(){if(options.disabled){return;}
$(this).removeClass(hoverClass);}).bind("click.button",function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation();}});this.element.bind("focus.button",function(){self.buttonElement.addClass(focusClass);}).bind("blur.button",function(){self.buttonElement.removeClass(focusClass);});if(toggleButton){this.element.bind("change.button",function(){if(clickDragged){return;}
self.refresh();});this.buttonElement.bind("mousedown.button",function(event){if(options.disabled){return;}
clickDragged=false;startXPos=event.pageX;startYPos=event.pageY;}).bind("mouseup.button",function(event){if(options.disabled){return;}
if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true;}});}
if(this.type==="checkbox"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).toggleClass("ui-state-active");self.buttonElement.attr("aria-pressed",self.element[0].checked);});}else if(this.type==="radio"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).addClass("ui-state-active");self.buttonElement.attr("aria-pressed",true);var radio=self.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed",false);});}else{this.buttonElement.bind("mousedown.button",function(){if(options.disabled){return false;}
$(this).addClass("ui-state-active");lastActive=this;$(document).one("mouseup",function(){lastActive=null;});}).bind("mouseup.button",function(){if(options.disabled){return false;}
$(this).removeClass("ui-state-active");}).bind("keydown.button",function(event){if(options.disabled){return false;}
if(event.keyCode==$.ui.keyCode.SPACE||event.keyCode==$.ui.keyCode.ENTER){$(this).addClass("ui-state-active");}}).bind("keyup.button",function(){$(this).removeClass("ui-state-active");});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click();}});}}
this._setOption("disabled",options.disabled);this._resetButton();},_determineButtonType:function(){if(this.element.is(":checkbox")){this.type="checkbox";}else if(this.element.is(":radio")){this.type="radio";}else if(this.element.is("input")){this.type="input";}else{this.type="button";}
if(this.type==="checkbox"||this.type==="radio"){var ancestor=this.element.parents().filter(":last"),labelSelector="label[for="+this.element.attr("id")+"]";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector);}}
this.element.addClass("ui-helper-hidden-accessible");var checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active");}
this.buttonElement.attr("aria-pressed",checked);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title");}
$.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="disabled"){if(value){this.element.attr("disabled",true);}else{this.element.removeAttr("disabled");}
return;}
this._resetButton();},refresh:function(){var isDisabled=this.element.is(":disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled);}
if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed",true);}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed",false);}});}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed",true);}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed",false);}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label);}
return;}
var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")));}
if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>");}
if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>");}
if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",buttonText);}}}else{buttonClasses.push("ui-button-text-only");}
buttonElement.addClass(buttonClasses.join(" "));}});$.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value);}
$.Widget.prototype._setOption.apply(this,arguments);},refresh:function(){var ltr=this.element.css("direction")==="ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(ltr?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(ltr?"ui-corner-right":"ui-corner-left").end().end();},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");$.Widget.prototype.destroy.call(this);}});}(jQuery));(function($,undefined){var uiDialogClasses='ui-dialog '+'ui-widget '+'ui-widget-content '+'ui-corner-all ',sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},attrFn=$.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};$.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:'close',dialogClass:'',draggable:true,hide:null,height:'auto',maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:'center',at:'center',collision:'fit',using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css('top',pos.top-topOffset);}}},resizable:true,show:null,stack:true,title:'',width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr('title');if(typeof this.originalTitle!=="string"){this.originalTitle="";}
this.options.title=this.options.title||this.originalTitle;var self=this,options=self.options,title=options.title||'&#160;',titleId=$.ui.dialog.getTitleId(self.element),uiDialog=(self.uiDialog=$('<div></div>')).appendTo(document.body).hide().addClass(uiDialogClasses+options.dialogClass).css({zIndex:options.zIndex}).attr('tabIndex',-1).css('outline',0).keydown(function(event){if(options.closeOnEscape&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){self.close(event);event.preventDefault();}}).attr({role:'dialog','aria-labelledby':titleId}).mousedown(function(event){self.moveToTop(false,event);}),uiDialogContent=self.element.show().removeAttr('title').addClass('ui-dialog-content '+'ui-widget-content').appendTo(uiDialog),uiDialogTitlebar=(self.uiDialogTitlebar=$('<div></div>')).addClass('ui-dialog-titlebar '+'ui-widget-header '+'ui-corner-all '+'ui-helper-clearfix').prependTo(uiDialog),uiDialogTitlebarClose=$('<a href="#"></a>').addClass('ui-dialog-titlebar-close '+'ui-corner-all').attr('role','button').hover(function(){uiDialogTitlebarClose.addClass('ui-state-hover');},function(){uiDialogTitlebarClose.removeClass('ui-state-hover');}).focus(function(){uiDialogTitlebarClose.addClass('ui-state-focus');}).blur(function(){uiDialogTitlebarClose.removeClass('ui-state-focus');}).click(function(event){self.close(event);return false;}).appendTo(uiDialogTitlebar),uiDialogTitlebarCloseText=(self.uiDialogTitlebarCloseText=$('<span></span>')).addClass('ui-icon '+'ui-icon-closethick').text(options.closeText).appendTo(uiDialogTitlebarClose),uiDialogTitle=$('<span></span>').addClass('ui-dialog-title').attr('id',titleId).html(title).prependTo(uiDialogTitlebar);if($.isFunction(options.beforeclose)&&!$.isFunction(options.beforeClose)){options.beforeClose=options.beforeclose;}
uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();if(options.draggable&&$.fn.draggable){self._makeDraggable();}
if(options.resizable&&$.fn.resizable){self._makeResizable();}
self._createButtons(options.buttons);self._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe();}},_init:function(){if(this.options.autoOpen){this.open();}},destroy:function(){var self=this;if(self.overlay){self.overlay.destroy();}
self.uiDialog.hide();self.element.unbind('.dialog').removeData('dialog').removeClass('ui-dialog-content ui-widget-content').hide().appendTo('body');self.uiDialog.remove();if(self.originalTitle){self.element.attr('title',self.originalTitle);}
return self;},widget:function(){return this.uiDialog;},close:function(event){var self=this,maxZ,thisZ;if(false===self._trigger('beforeClose',event)){return;}
if(self.overlay){self.overlay.destroy();}
self.uiDialog.unbind('keypress.ui-dialog');self._isOpen=false;if(self.options.hide){self.uiDialog.hide(self.options.hide,function(){self._trigger('close',event);});}else{self.uiDialog.hide();self._trigger('close',event);}
$.ui.dialog.overlay.resize();if(self.options.modal){maxZ=0;$('.ui-dialog').each(function(){if(this!==self.uiDialog[0]){thisZ=$(this).css('z-index');if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ);}}});$.ui.dialog.maxZ=maxZ;}
return self;},isOpen:function(){return this._isOpen;},moveToTop:function(force,event){var self=this,options=self.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return self._trigger('focus',event);}
if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex;}
if(self.overlay){$.ui.dialog.maxZ+=1;self.overlay.$el.css('z-index',$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ);}
saveScroll={scrollTop:self.element.attr('scrollTop'),scrollLeft:self.element.attr('scrollLeft')};$.ui.dialog.maxZ+=1;self.uiDialog.css('z-index',$.ui.dialog.maxZ);self.element.attr(saveScroll);self._trigger('focus',event);return self;},open:function(){if(this._isOpen){return;}
var self=this,options=self.options,uiDialog=self.uiDialog;self.overlay=options.modal?new $.ui.dialog.overlay(self):null;self._size();self._position(options.position);uiDialog.show(options.show);self.moveToTop(true);if(options.modal){uiDialog.bind('keypress.ui-dialog',function(event){if(event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(':tabbable',this),first=tabbables.filter(':first'),last=tabbables.filter(':last');if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false;}else if(event.target===first[0]&&event.shiftKey){last.focus(1);return false;}});}
$(self.element.find(':tabbable').get().concat(uiDialog.find('.ui-dialog-buttonpane :tabbable').get().concat(uiDialog.get()))).eq(0).focus();self._isOpen=true;self._trigger('open');return self;},_createButtons:function(buttons){var self=this,hasButtons=false,uiDialogButtonPane=$('<div></div>').addClass('ui-dialog-buttonpane '+'ui-widget-content '+'ui-helper-clearfix'),uiButtonSet=$("<div></div>").addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);self.uiDialog.find('.ui-dialog-buttonpane').remove();if(typeof buttons==='object'&&buttons!==null){$.each(buttons,function(){return!(hasButtons=true);});}
if(hasButtons){$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$('<button type="button"></button>').click(function(){props.click.apply(self.element[0],arguments);}).appendTo(uiButtonSet);$.each(props,function(key,value){if(key==="click"){return;}
if(key in attrFn){button[key](value);}else{button.attr(key,value);}});if($.fn.button){button.button();}});uiDialogButtonPane.appendTo(self.uiDialog);}},_makeDraggable:function(){var self=this,options=self.options,doc=$(document),heightBeforeDrag;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
self.uiDialog.draggable({cancel:'.ui-dialog-content, .ui-dialog-titlebar-close',handle:'.ui-dialog-titlebar',containment:'document',start:function(event,ui){heightBeforeDrag=options.height==="auto"?"auto":$(this).height();$(this).height($(this).height()).addClass("ui-dialog-dragging");self._trigger('dragStart',event,filteredUi(ui));},drag:function(event,ui){self._trigger('drag',event,filteredUi(ui));},stop:function(event,ui){options.position=[ui.position.left-doc.scrollLeft(),ui.position.top-doc.scrollTop()];$(this).removeClass("ui-dialog-dragging").height(heightBeforeDrag);self._trigger('dragStop',event,filteredUi(ui));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var self=this,options=self.options,position=self.uiDialog.css('position'),resizeHandles=(typeof handles==='string'?handles:'n,e,s,w,se,sw,ne,nw');function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
self.uiDialog.resizable({cancel:'.ui-dialog-content',containment:'document',alsoResize:self.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:self._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");self._trigger('resizeStart',event,filteredUi(ui));},resize:function(event,ui){self._trigger('resize',event,filteredUi(ui));},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();self._trigger('resizeStop',event,filteredUi(ui));$.ui.dialog.overlay.resize();}}).css('position',position).find('.ui-resizable-se').addClass('ui-icon ui-icon-grip-diagonal-se');},_minHeight:function(){var options=this.options;if(options.height==='auto'){return options.minHeight;}else{return Math.min(options.minHeight,options.height);}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==='string'||(typeof position==='object'&&'0'in position)){myAt=position.split?position.split(' '):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0];}
$.each(['left','top'],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition;}});position={my:myAt.join(" "),at:myAt.join(" "),offset:offset.join(" ")};}
position=$.extend({},$.ui.dialog.prototype.options.position,position);}else{position=$.ui.dialog.prototype.options.position;}
isVisible=this.uiDialog.is(':visible');if(!isVisible){this.uiDialog.show();}
this.uiDialog.css({top:0,left:0}).position($.extend({of:window},position));if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var self=this,resizableOptions={},resize=false;$.each(options,function(key,value){self._setOption(key,value);if(key in sizeRelatedOptions){resize=true;}
if(key in resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var self=this,uiDialog=self.uiDialog;switch(key){case"beforeclose":key="beforeClose";break;case"buttons":self._createButtons(value);break;case"closeText":self.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(self.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass('ui-dialog-disabled');}else{uiDialog.removeClass('ui-dialog-disabled');}
break;case"draggable":var isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){self._makeDraggable();}
break;case"position":self._position(value);break;case"resizable":var isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable('destroy');}
if(isResizable&&typeof value==='string'){uiDialog.resizable('option','handles',value);}
if(!isResizable&&value!==false){self._makeResizable(value);}
break;case"title":$(".ui-dialog-title",self.uiDialogTitlebar).html(""+(value||'&#160;'));break;}
$.Widget.prototype._setOption.apply(self,arguments);},_size:function(){var options=this.options,nonContentHeight,minContentHeight,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:'auto',minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:'auto',width:options.width}).height();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"});}else{this.uiDialog.show();var autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide();}
this.element.height(Math.max(autoHeight,minContentHeight));}}else{this.element.height(Math.max(options.height-nonContentHeight,0));}
if(this.uiDialog.is(':data(resizable)')){this.uiDialog.resizable('option','minHeight',this._minHeight());}}});$.extend($.ui.dialog,{version:"1.8.14",uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr('id');if(!id){this.uuid+=1;id=this.uuid;}
return'ui-dialog-title-'+id;},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map('focus,mousedown,mouseup,keydown,keypress,click'.split(','),function(event){return event+'.dialog-overlay';}).join(' '),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ){return false;}});}},1);$(document).bind('keydown.dialog-overlay',function(event){if(dialog.options.closeOnEscape&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault();}});$(window).bind('resize.dialog-overlay',$.ui.dialog.overlay.resize);}
var $el=(this.oldInstances.pop()||$('<div></div>').addClass('ui-widget-overlay')).appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe();}
this.instances.push($el);return $el;},destroy:function($el){var indexOf=$.inArray($el,this.instances);if(indexOf!=-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0]);}
if(this.instances.length===0){$([document,window]).unbind('.dialog-overlay');}
$el.remove();var maxZ=0;$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css('z-index'));});this.maxZ=maxZ;},height:function(){var scrollHeight,offsetHeight;if($.browser.msie&&$.browser.version<7){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+'px';}else{return scrollHeight+'px';}}else{return $(document).height()+'px';}},width:function(){var scrollWidth,offsetWidth;if($.browser.msie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+'px';}else{return scrollWidth+'px';}}else{return $(document).width()+'px';}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this);});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()});}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el);}});}(jQuery));(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var self=this,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handleCount=(o.values&&o.values.length)||1,handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+
(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()];}
if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]];}}
this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+
((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""));}
for(var i=existingHandles.length;i<handleCount;i+=1){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(self.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault();}).hover(function(){if(!o.disabled){$(this).addClass("ui-state-hover");}},function(){$(this).removeClass("ui-state-hover");}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus");}else{$(this).blur();}}).blur(function(){$(this).removeClass("ui-state-focus");});this.handles.each(function(i){$(this).data("index.ui-slider-handle",i);});this.handles.keydown(function(event){var ret=true,index=$(this).data("index.ui-slider-handle"),allowed,curVal,newVal,step;if(self.options.disabled){return;}
switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ret=false;if(!self._keySliding){self._keySliding=true;$(this).addClass("ui-state-active");allowed=self._start(event,index);if(allowed===false){return;}}
break;}
step=self.options.step;if(self.options.values&&self.options.values.length){curVal=newVal=self.values(index);}else{curVal=newVal=self.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=self._valueMin();break;case $.ui.keyCode.END:newVal=self._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=self._trimAlignValue(curVal+((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=self._trimAlignValue(curVal-((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===self._valueMax()){return;}
newVal=self._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===self._valueMin()){return;}
newVal=self._trimAlignValue(curVal-step);break;}
self._slide(event,index,newVal);return ret;}).keyup(function(event){var index=$(this).data("index.ui-slider-handle");if(self._keySliding){self._keySliding=false;self._stop(event,index);self._change(event,index);$(this).removeClass("ui-state-active");}});this._refreshValue();this._animateOff=false;},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options,position,normValue,distance,closestHandle,self,index,allowed,offset,mouseOverHandle;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;self=this;this.handles.each(function(i){var thisDistance=Math.abs(normValue-self.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i;}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index]);}
allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;self._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(event){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}
if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length;}
$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.attr("disabled","disabled");this.element.addClass("ui-disabled");}else{this.handles.removeAttr("disabled");this.element.removeClass("ui-disabled");}
break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}
this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step;alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var oRange=this.options.range,o=this.options,self=this,animate=(!this._animateOff)?o.animate:false,valPercent,_set={},lastValPercent,value,valueMin,valueMax;if(this.options.values&&this.options.values.length){this.handles.each(function(i,j){valPercent=(self.values(i)-self._valueMin())/(self._valueMax()-self._valueMin())*100;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(self.options.range===true){if(self.orientation==="horizontal"){if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}}});$.extend($.ui.slider,{version:"1.8.14"});}(jQuery));(function($,undefined){var tabId=0,listId=0;function getNextTabId(){return++tabId;}
function getNextListId(){return++listId;}
$.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true);},_setOption:function(key,value){if(key=="selected"){if(this.options.collapsible&&value==this.options.selected){return;}
this.select(value);}else{this.options[key]=value;this._tabify();}},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+getNextTabId();},_sanitizeSelector:function(hash){return hash.replace(/:/g,"\\:");},_cookie:function(){var cookie=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+getNextListId());return $.cookie.apply(null,[cookie].concat($.makeArray(arguments)));},_ui:function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)};},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var el=$(this);el.html(el.data("label.tabs")).removeData("label.tabs");});},_tabify:function(init){var self=this,o=this.options,fragmentId=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=$(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return $("a",this)[0];});this.panels=$([]);this.anchors.each(function(i,a){var href=$(a).attr("href");var hrefBase=href.split("#")[0],baseEl;if(hrefBase&&(hrefBase===location.toString().split("#")[0]||(baseEl=$("base")[0])&&hrefBase===baseEl.href)){href=a.hash;a.href=href;}
if(fragmentId.test(href)){self.panels=self.panels.add(self.element.find(self._sanitizeSelector(href)));}else if(href&&href!=="#"){$.data(a,"href.tabs",href);$.data(a,"load.tabs",href.replace(/#.*$/,""));var id=self._tabId(a);a.href="#"+id;var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(self.panels[i-1]||self.list);$panel.data("destroy.tabs",true);}
self.panels=self.panels.add($panel);}else{o.disabled.push(i);}});if(init){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(o.selected===undefined){if(location.hash){this.anchors.each(function(i,a){if(a.hash==location.hash){o.selected=i;return false;}});}
if(typeof o.selected!=="number"&&o.cookie){o.selected=parseInt(self._cookie(),10);}
if(typeof o.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length){o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}
o.selected=o.selected||(this.lis.length?0:-1);}else if(o.selected===null){o.selected=-1;}
o.selected=((o.selected>=0&&this.anchors[o.selected])||o.selected<0)?o.selected:0;o.disabled=$.unique(o.disabled.concat($.map(this.lis.filter(".ui-state-disabled"),function(n,i){return self.lis.index(n);}))).sort();if($.inArray(o.selected,o.disabled)!=-1){o.disabled.splice($.inArray(o.selected,o.disabled),1);}
this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");if(o.selected>=0&&this.anchors.length){self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(o.selected).addClass("ui-tabs-selected ui-state-active");self.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[o.selected],self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash))[0]));});this.load(o.selected);}
$(window).bind("unload",function(){self.lis.add(self.anchors).unbind(".tabs");self.lis=self.anchors=self.panels=null;});}else{o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}
this.element[o.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");if(o.cookie){this._cookie(o.selected,o.cookie);}
for(var i=0,li;(li=this.lis[i]);i++){$(li)[$.inArray(i,o.disabled)!=-1&&!$(li).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");}
if(o.cache===false){this.anchors.removeData("cache.tabs");}
this.lis.add(this.anchors).unbind(".tabs");if(o.event!=="mouseover"){var addState=function(state,el){if(el.is(":not(.ui-state-disabled)")){el.addClass("ui-state-"+state);}};var removeState=function(state,el){el.removeClass("ui-state-"+state);};this.lis.bind("mouseover.tabs",function(){addState("hover",$(this));});this.lis.bind("mouseout.tabs",function(){removeState("hover",$(this));});this.anchors.bind("focus.tabs",function(){addState("focus",$(this).closest("li"));});this.anchors.bind("blur.tabs",function(){removeState("focus",$(this).closest("li"));});}
var hideFx,showFx;if(o.fx){if($.isArray(o.fx)){hideFx=o.fx[0];showFx=o.fx[1];}else{hideFx=showFx=o.fx;}}
function resetStyle($el,fx){$el.css("display","");if(!$.support.opacity&&fx.opacity){$el[0].style.removeAttribute("filter");}}
var showTab=showFx?function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.hide().removeClass("ui-tabs-hide").animate(showFx,showFx.duration||"normal",function(){resetStyle($show,showFx);self._trigger("show",null,self._ui(clicked,$show[0]));});}:function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.removeClass("ui-tabs-hide");self._trigger("show",null,self._ui(clicked,$show[0]));};var hideTab=hideFx?function(clicked,$hide){$hide.animate(hideFx,hideFx.duration||"normal",function(){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");resetStyle($hide,hideFx);self.element.dequeue("tabs");});}:function(clicked,$hide,$show){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");self.element.dequeue("tabs");};this.anchors.bind(o.event+".tabs",function(){var el=this,$li=$(el).closest("li"),$hide=self.panels.filter(":not(.ui-tabs-hide)"),$show=self.element.find(self._sanitizeSelector(el.hash));if(($li.hasClass("ui-tabs-selected")&&!o.collapsible)||$li.hasClass("ui-state-disabled")||$li.hasClass("ui-state-processing")||self.panels.filter(":animated").length||self._trigger("select",null,self._ui(this,$show[0]))===false){this.blur();return false;}
o.selected=self.anchors.index(this);self.abort();if(o.collapsible){if($li.hasClass("ui-tabs-selected")){o.selected=-1;if(o.cookie){self._cookie(o.selected,o.cookie);}
self.element.queue("tabs",function(){hideTab(el,$hide);}).dequeue("tabs");this.blur();return false;}else if(!$hide.length){if(o.cookie){self._cookie(o.selected,o.cookie);}
self.element.queue("tabs",function(){showTab(el,$show);});self.load(self.anchors.index(this));this.blur();return false;}}
if(o.cookie){self._cookie(o.selected,o.cookie);}
if($show.length){if($hide.length){self.element.queue("tabs",function(){hideTab(el,$hide);});}
self.element.queue("tabs",function(){showTab(el,$show);});self.load(self.anchors.index(this));}else{throw"jQuery UI Tabs: Mismatching fragment identifier.";}
if($.browser.msie){this.blur();}});this.anchors.bind("click.tabs",function(){return false;});},_getIndex:function(index){if(typeof index=="string"){index=this.anchors.index(this.anchors.filter("[href$="+index+"]"));}
return index;},destroy:function(){var o=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var href=$.data(this,"href.tabs");if(href){this.href=href;}
var $this=$(this).unbind(".tabs");$.each(["href","load","cache"],function(i,prefix){$this.removeData(prefix+".tabs");});});this.lis.unbind(".tabs").add(this.panels).each(function(){if($.data(this,"destroy.tabs")){$(this).remove();}else{$(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "));}});if(o.cookie){this._cookie(null,o.cookie);}
return this;},add:function(url,label,index){if(index===undefined){index=this.anchors.length;}
var self=this,o=this.options,$li=$(o.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId($("a",$li)[0]);$li.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).data("destroy.tabs",true);}
$panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(index>=this.lis.length){$li.appendTo(this.list);$panel.appendTo(this.list[0].parentNode);}else{$li.insertBefore(this.lis[index]);$panel.insertBefore(this.panels[index]);}
o.disabled=$.map(o.disabled,function(n,i){return n>=index?++n:n;});this._tabify();if(this.anchors.length==1){o.selected=0;$li.addClass("ui-tabs-selected ui-state-active");$panel.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[0],self.panels[0]));});this.load(0);}
this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this;},remove:function(index){index=this._getIndex(index);var o=this.options,$li=this.lis.eq(index).remove(),$panel=this.panels.eq(index).remove();if($li.hasClass("ui-tabs-selected")&&this.anchors.length>1){this.select(index+(index+1<this.anchors.length?1:-1));}
o.disabled=$.map($.grep(o.disabled,function(n,i){return n!=index;}),function(n,i){return n>=index?--n:n;});this._tabify();this._trigger("remove",null,this._ui($li.find("a")[0],$panel[0]));return this;},enable:function(index){index=this._getIndex(index);var o=this.options;if($.inArray(index,o.disabled)==-1){return;}
this.lis.eq(index).removeClass("ui-state-disabled");o.disabled=$.grep(o.disabled,function(n,i){return n!=index;});this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));return this;},disable:function(index){index=this._getIndex(index);var self=this,o=this.options;if(index!=o.selected){this.lis.eq(index).addClass("ui-state-disabled");o.disabled.push(index);o.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]));}
return this;},select:function(index){index=this._getIndex(index);if(index==-1){if(this.options.collapsible&&this.options.selected!=-1){index=this.options.selected;}else{return this;}}
this.anchors.eq(index).trigger(this.options.event+".tabs");return this;},load:function(index){index=this._getIndex(index);var self=this,o=this.options,a=this.anchors.eq(index)[0],url=$.data(a,"load.tabs");this.abort();if(!url||this.element.queue("tabs").length!==0&&$.data(a,"cache.tabs")){this.element.dequeue("tabs");return;}
this.lis.eq(index).addClass("ui-state-processing");if(o.spinner){var span=$("span",a);span.data("label.tabs",span.html()).html(o.spinner);}
this.xhr=$.ajax($.extend({},o.ajaxOptions,{url:url,success:function(r,s){self.element.find(self._sanitizeSelector(a.hash)).html(r);self._cleanup();if(o.cache){$.data(a,"cache.tabs",true);}
self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.success(r,s);}
catch(e){}},error:function(xhr,s,e){self._cleanup();self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.error(xhr,s,index,a);}
catch(e){}}}));self.element.dequeue("tabs");return this;},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr;}
this._cleanup();return this;},url:function(index,url){this.anchors.eq(index).removeData("cache.tabs").data("load.tabs",url);return this;},length:function(){return this.anchors.length;}});$.extend($.ui.tabs,{version:"1.8.14"});$.extend($.ui.tabs.prototype,{rotation:null,rotate:function(ms,continuing){var self=this,o=this.options;var rotate=self._rotate||(self._rotate=function(e){clearTimeout(self.rotation);self.rotation=setTimeout(function(){var t=o.selected;self.select(++t<self.anchors.length?t:0);},ms);if(e){e.stopPropagation();}});var stop=self._unrotate||(self._unrotate=!continuing?function(e){if(e.clientX){self.rotate(null);}}:function(e){t=o.selected;rotate();});if(ms){this.element.bind("tabsshow",rotate);this.anchors.bind(o.event+".tabs",stop);rotate();}else{clearTimeout(self.rotation);this.element.unbind("tabsshow",rotate);this.anchors.unbind(o.event+".tabs",stop);delete this._rotate;delete this._unrotate;}
return this;}});})(jQuery);(function($,undefined){$.extend($.ui,{datepicker:{version:"1.8.14"}});var PROP_NAME='datepicker';var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false};$.extend(this._defaults,this.regional['']);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,log:function(){if(this.debug)
console.log.apply('',arguments);},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute('date:'+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=='div'||nodeName=='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName))
return;this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});this._autoSize(inst);$.data(target,PROP_NAME,inst);},_attachments:function(input,inst){var appendText=this._get(inst,'appendText');var isRTL=this._get(inst,'isRTL');if(inst.append)
inst.append.remove();if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+'</span>');input[isRTL?'before':'after'](inst.append);}
input.unbind('focus',this._showDatepicker);if(inst.trigger)
inst.trigger.remove();var showOn=this._get(inst,'showOn');if(showOn=='focus'||showOn=='both')
input.focus(this._showDatepicker);if(showOn=='button'||showOn=='both'){var buttonText=this._get(inst,'buttonText');var buttonImage=this._get(inst,'buttonImage');inst.trigger=$(this._get(inst,'buttonImageOnly')?$('<img/>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==''?buttonText:$('<img/>').attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?'before':'after'](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0])
$.datepicker._hideDatepicker();else
$.datepicker._showDatepicker(input[0]);return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName))
return;divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);inst.dpDiv.show();},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id='dp'+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)
$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind('focus',this._showDatepicker).unbind('keydown',this._doKeyDown).unbind('keypress',this._doKeyPress).unbind('keyup',this._doKeyUp);}else if(nodeName=='div'||nodeName=='span')
$target.removeClass(this.markerClassName).empty();},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled");}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target)
return true;}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=='string'){return(name=='defaults'?$.extend({},$.datepicker._defaults):(inst?(name=='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
var settings=name||{};if(typeof name=='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst==inst){this._hideDatepicker();}
var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');extendRemove(inst.settings,settings);if(minDate!==null&&settings['dateFormat']!==undefined&&settings['minDate']===undefined)
inst.settings.minDate=this._formatDate(inst,minDate);if(maxDate!==null&&settings['dateFormat']!==undefined&&settings['maxDate']===undefined)
inst.settings.maxDate=this._formatDate(inst,maxDate);this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline)
this._setDateFromField(inst,noDefault);return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing)
switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0])
$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);else
$.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey)$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey)$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 38:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,-7,'D');handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 40:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,+7,'D');handled=event.ctrlKey||event.metaKey;break;default:handled=false;}
else if(event.keyCode==36&&event.ctrlKey)
$.datepicker._showDatepicker(this);else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){var chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(event){$.datepicker.log(event);}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!='input')
input=$('input',input.parentNode)[0];if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input)
return;var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){if($.datepicker._datepickerShowing){$.datepicker._triggerOnClose($.datepicker._curInst);}
$.datepicker._curInst.dpDiv.stop(true,true);}
var beforeShow=$.datepicker._get(inst,'beforeShow');extendRemove(inst.settings,(beforeShow?beforeShow.apply(input,[input,inst]):{}));inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog)
input.value='';if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')=='fixed';return!isFixed;});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop;}
var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){var showAnim=$.datepicker._get(inst,'showAnim');var duration=$.datepicker._get(inst,'duration');var postProcess=function(){var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()});}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects[showAnim])
inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[showAnim||'show']((showAnim?duration:null),postProcess);if(!showAnim||!duration)
postProcess();if(inst.input.is(':visible')&&!inst.input.is(':disabled'))
inst.input.focus();$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){var self=this;self.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}
inst.dpDiv.find('.'+this._dayOverClass+' a').mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1)
inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&inst.input[0]!=document.activeElement)
inst.input.focus();if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value;};return[parseFloat(convert(elem.css('border-left-width'))),parseFloat(convert(elem.css('border-top-width')))];},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+$(document).scrollLeft();var viewHeight=document.documentElement.clientHeight+$(document).scrollTop();offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,'isRTL');while(obj&&(obj.type=='hidden'||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
var position=$(obj).offset();return[position.left,position.top];},_triggerOnClose:function(inst){var onClose=this._get(inst,'onClose');if(onClose)
onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME)))
return;if(this._datepickerShowing){var showAnim=this._get(inst,'showAnim');var duration=this._get(inst,'duration');var postProcess=function(){$.datepicker._tidyDialog(inst);this._curInst=null;};if($.effects&&$.effects[showAnim])
inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[(showAnim=='slideDown'?'slideUp':(showAnim=='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);if(!showAnim)
postProcess();$.datepicker._triggerOnClose(inst);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst)
return;var $target=$(event.target);if($target[0].id!=$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI))
$.datepicker._hideDatepicker();},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period=='M'?this._get(inst,'showCurrentAtPos'):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}
else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst._selectingMonthYear=false;inst['selected'+(period=='M'?'Month':'Year')]=inst['draw'+(period=='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_clickMonthYear:function(id){var target=$(id);var inst=this._getInst(target[0]);if(inst.input&&inst._selectingMonthYear){setTimeout(function(){inst.input.focus();},0);}
inst._selectingMonthYear=!inst._selectingMonthYear;},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$('a',td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,'');},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input)
inst.input.val(dateStr);this._updateAlternate(inst);var onSelect=this._get(inst,'onSelect');if(onSelect)
onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);else if(inst.input)
inst.input.trigger('change');if(inst.inline)
this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!='object')
inst.input.focus();this._lastInput=null;}},_updateAlternate:function(inst){var altField=this._get(inst,'altField');if(altField){var altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null)
throw'Invalid arguments';value=(typeof value=='object'?value.toString():value+'');if(value=='')
return null;var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=='@'?14:(match=='!'?20:(match=='y'&&isDoubled?4:(match=='o'?3:2))));var digits=new RegExp('^\\d{1,'+size+'}');var num=value.substring(iValue).match(digits);if(!num)
throw'Missing number at position '+iValue;iValue+=num[0].length;return parseInt(num[0],10);};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!=-1)
return index+1;else
throw'Unknown name at position '+iValue;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat))
throw'Unexpected literal at position '+iValue;iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
checkLiteral();else
switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':var date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':var date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'"))
checkLiteral();else
literal=true;break;default:checkLiteral();}}
if(iValue<value.length){throw"Extra/unparsed characters found in date: "+value.substring(iValue);}
if(year==-1)
year=new Date().getFullYear();else if(year<100)
year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim)
break;month++;day-=dim;}while(true);}
var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day)
throw'Invalid date';return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date)
return'';var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match))
while(num.length<len)
num='0'+num;return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output='';var literal=false;if(date)
for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
output+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getYear()%100<10?'0':'')+date.getYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'"))
output+="'";else
literal=true;break;default:output+=format.charAt(iFormat);}}
return output;},_possibleChars:function(format){var chars='';var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};for(var iFormat=0;iFormat<format.length;iFormat++)
if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
chars+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case"'":if(lookAhead("'"))
chars+="'";else
literal=true;break;default:chars+=format.charAt(iFormat);}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat');var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);};var newDate=(date==null||date===''?defaultDate:(typeof date=='string'?offsetString(date):(typeof date=='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange)
this._notifyChange(inst);this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,'isRTL');var showButtonPanel=this._get(inst,'showButtonPanel');var hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext');var navigationAsDateFormat=this._get(inst,'navigationAsDateFormat');var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,'showCurrentAtPos');var stepMonths=this._get(inst,'stepMonths');var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', -'+stepMonths+', \'M\');"'+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>'));var nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', +'+stepMonths+', \'M\');"'+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>'));var currentText=this._get(inst,'currentText');var gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(inst,'closeText')+'</button>':'');var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:'')+
(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._gotoToday(\'#'+inst.id+'\');"'+'>'+currentText+'</button>':'')+(isRTL?'':controls)+'</div>':'';var firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,'showWeek');var dayNames=this._get(inst,'dayNames');var dayNamesShort=this._get(inst,'dayNamesShort');var dayNamesMin=this._get(inst,'dayNamesMin');var monthNames=this._get(inst,'monthNames');var monthNamesShort=this._get(inst,'monthNamesShort');var beforeShowDay=this._get(inst,'beforeShowDay');var showOtherMonths=this._get(inst,'showOtherMonths');var selectOtherMonths=this._get(inst,'selectOtherMonths');var calculateWeek=this._get(inst,'calculateWeek')||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html='';for(var row=0;row<numMonths[0];row++){var group='';this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=' ui-corner-all';var calender='';if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1)
switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}
calender+='">';}
calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+
(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+'<tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,'weekHeader')+'</th>':'');for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+='<th'+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':'')+'>'+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth)
inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+='<tr>';var tbody=(!showWeek?'':'<td class="ui-datepicker-week-col">'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()==currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()==today.getTime()?' ui-datepicker-today':''))+'"'+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':'')+
(unselectable?'':' onclick="DP_jQuery_'+dpuuid+'.datepicker._selectDay(\'#'+
inst.id+'\','+printDate.getMonth()+','+printDate.getFullYear()+', this);return false;"')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class="ui-state-default">'+printDate.getDate()+'</span>':'<a class="ui-state-default'+
(printDate.getTime()==today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()==currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'" href="#">'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+(isMultiMonth?'</div>'+
((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':'');inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,'changeMonth');var changeYear=this._get(inst,'changeYear');var showMonthAfterYear=this._get(inst,'showMonthAfterYear');var html='<div class="ui-datepicker-title">';var monthHtml='';if(secondary||!changeMonth)
monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+'</span>';else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'M\');" '+'onclick="DP_jQuery_'+dpuuid+'.datepicker._clickMonthYear(\'#'+inst.id+'\');"'+'>';for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth()))
monthHtml+='<option value="'+month+'"'+
(month==drawMonth?' selected="selected"':'')+'>'+monthNamesShort[month]+'</option>';}
monthHtml+='</select>';}
if(!showMonthAfterYear)
html+=monthHtml+(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear)
html+='<span class="ui-datepicker-year">'+drawYear+'</span>';else{var years=this._get(inst,'yearRange').split(':');var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'Y\');" '+'onclick="DP_jQuery_'+dpuuid+'.datepicker._clickMonthYear(\'#'+inst.id+'\');"'+'>';for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+
(year==drawYear?' selected="selected"':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear)
html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+monthHtml;html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=='Y'?offset:0);var month=inst.drawMonth+(period=='M'?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period=='D'?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=='M'||period=='Y')
this._notifyChange(inst);},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate;},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange)
onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths=='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0)
date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date);},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day=='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.bind('mouseout',function(event){var elem=$(event.target).closest(selector);if(!elem.length){return;}
elem.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover");}).bind('mouseover',function(event){var elem=$(event.target).closest(selector);if($.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])||!elem.length){return;}
elem.parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');elem.addClass('ui-state-hover');if(elem.hasClass('ui-datepicker-prev'))elem.addClass('ui-datepicker-prev-hover');if(elem.hasClass('ui-datepicker-next'))elem.addClass('ui-datepicker-next-hover');});}
function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]==null||props[name]==undefined)
target[name]=props[name];return target;};function isArray(a){return(a&&(($.browser.safari&&typeof a=='object'&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))));};$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find('body').append($.datepicker.dpDiv);$.datepicker.initialized=true;}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=='string'&&(options=='isDisabled'||options=='getDate'||options=='widget'))
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));if(options=='option'&&arguments.length==2&&typeof arguments[1]=='string')
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));return this.each(function(){typeof options=='string'?$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.8.14";window['DP_jQuery_'+dpuuid]=$;})(jQuery);(function($,undefined){$.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue();},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();$.Widget.prototype.destroy.apply(this,arguments);},value:function(newValue){if(newValue===undefined){return this._value();}
this._setOption("value",newValue);return this;},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete");}}
$.Widget.prototype._setOption.apply(this,arguments);},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0;}
return Math.min(this.options.max,Math.max(this.min,val));},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var value=this.value();var percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value);}});$.extend($.ui.progressbar,{version:"1.8.14"});})(jQuery);;jQuery.effects||(function($,undefined){$.effects={};$.each(['backgroundColor','borderBottomColor','borderLeftColor','borderRightColor','borderTopColor','borderColor','color','outlineColor'],function(i,attr){$.fx.step[attr]=function(fx){if(!fx.colorInit){fx.start=getColor(fx.elem,attr);fx.end=getRGB(fx.end);fx.colorInit=true;}
fx.elem.style[attr]='rgb('+
Math.max(Math.min(parseInt((fx.pos*(fx.end[0]-fx.start[0]))+fx.start[0],10),255),0)+','+
Math.max(Math.min(parseInt((fx.pos*(fx.end[1]-fx.start[1]))+fx.start[1],10),255),0)+','+
Math.max(Math.min(parseInt((fx.pos*(fx.end[2]-fx.start[2]))+fx.start[2],10),255),0)+')';};});function getRGB(color){var result;if(color&&color.constructor==Array&&color.length==3)
return color;if(result=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color))
return[parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10)];if(result=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color))
return[parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55];if(result=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color))
return[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)];if(result=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color))
return[parseInt(result[1]+result[1],16),parseInt(result[2]+result[2],16),parseInt(result[3]+result[3],16)];if(result=/rgba\(0, 0, 0, 0\)/.exec(color))
return colors['transparent'];return colors[$.trim(color).toLowerCase()];}
function getColor(elem,attr){var color;do{color=$.curCSS(elem,attr);if(color!=''&&color!='transparent'||$.nodeName(elem,"body"))
break;attr="backgroundColor";}while(elem=elem.parentNode);return getRGB(color);};var colors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var classAnimationActions=['add','remove','toggle'],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function getElementStyles(){var style=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,camelCase;if(style&&style.length&&style[0]&&style[style[0]]){var len=style.length;while(len--){key=style[len];if(typeof style[key]=='string'){camelCase=key.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase();});newStyle[camelCase]=style[key];}}}else{for(key in style){if(typeof style[key]==='string'){newStyle[key]=style[key];}}}
return newStyle;}
function filterStyles(styles){var name,value;for(name in styles){value=styles[name];if(value==null||$.isFunction(value)||name in shorthandStyles||(/scrollbar/).test(name)||(!(/color/i).test(name)&&isNaN(parseFloat(value)))){delete styles[name];}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={_:0},name;for(name in newStyle){if(oldStyle[name]!=newStyle[name]){diff[name]=newStyle[name];}}
return diff;}
$.effects.animateClass=function(value,duration,easing,callback){if($.isFunction(easing)){callback=easing;easing=null;}
return this.queue(function(){var that=$(this),originalStyleAttr=that.attr('style')||' ',originalStyle=filterStyles(getElementStyles.call(this)),newStyle,className=that.attr('class');$.each(classAnimationActions,function(i,action){if(value[action]){that[action+'Class'](value[action]);}});newStyle=filterStyles(getElementStyles.call(this));that.attr('class',className);that.animate(styleDifference(originalStyle,newStyle),{queue:false,duration:duration,easing:easing,complete:function(){$.each(classAnimationActions,function(i,action){if(value[action]){that[action+'Class'](value[action]);}});if(typeof that.attr('style')=='object'){that.attr('style').cssText='';that.attr('style').cssText=originalStyleAttr;}else{that.attr('style',originalStyleAttr);}
if(callback){callback.apply(this,arguments);}
$.dequeue(this);}});});};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{add:classNames},speed,easing,callback]):this._addClass(classNames);},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{remove:classNames},speed,easing,callback]):this._removeClass(classNames);},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force=="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force);}else{return $.effects.animateClass.apply(this,[(force?{add:classNames}:{remove:classNames}),speed,easing,callback]);}}else{return $.effects.animateClass.apply(this,[{toggle:classNames},force,speed,easing]);}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.apply(this,[{add:add,remove:remove},speed,easing,callback]);}});$.extend($.effects,{version:"1.8.14",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null)element.data("ec.storage."+set[i],element[0].style[set[i]]);}},restore:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null)element.css(set[i],element.data("ec.storage."+set[i]));}},setMode:function(el,mode){if(mode=='toggle')mode=el.is(':hidden')?'show':'hide';return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case'top':y=0;break;case'middle':y=0.5;break;case'bottom':y=1;break;default:y=origin[0]/original.height;};switch(origin[1]){case'left':x=0;break;case'center':x=0.5;break;case'right':x=1;break;default:x=origin[1]/original.width;};return{x:x,y:y};},createWrapper:function(element){if(element.parent().is('.ui-effects-wrapper')){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),'float':element.css('float')},wrapper=$('<div></div>').addClass('ui-effects-wrapper').css({fontSize:'100%',background:'transparent',border:'none',margin:0,padding:0});element.wrap(wrapper);wrapper=element.parent();if(element.css('position')=='static'){wrapper.css({position:'relative'});element.css({position:'relative'});}else{$.extend(props,{position:element.css('position'),zIndex:element.css('z-index')});$.each(['top','left','bottom','right'],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]='auto';}});element.css({position:'relative',top:0,left:0,right:'auto',bottom:'auto'});}
return wrapper.css(props).show();},removeWrapper:function(element){if(element.parent().is('.ui-effects-wrapper'))
return element.parent().replaceWith(element);return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){unit=element.cssUnit(x);if(unit[0]>0)value[x]=unit[0]*factor+unit[1];});return value;}});function _normalizeArguments(effect,options,speed,callback){if(typeof effect=='object'){callback=options;speed=null;options=effect;effect=options.effect;}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options=='number'||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
options=options||{};speed=speed||options.duration;speed=$.fx.off?0:typeof speed=='number'?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;callback=callback||options.complete;return[effect,options,speed,callback];}
function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true;}
if(typeof speed==="string"&&!$.effects[speed]){return true;}
return false;}
$.fn.extend({effect:function(effect,options,speed,callback){var args=_normalizeArguments.apply(this,arguments),args2={options:args[1],duration:args[2],callback:args[3]},mode=args2.options.mode,effectMethod=$.effects[effect];if($.fx.off||!effectMethod){if(mode){return this[mode](args2.duration,args2.callback);}else{return this.each(function(){if(args2.callback){args2.callback.call(this);}});}}
return effectMethod.call(this,args2);},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='show';return this.effect.apply(this,args);}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='hide';return this.effect.apply(this,args);}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='toggle';return this.effect.apply(this,args);}},cssUnit:function(key){var style=this.css(key),val=[];$.each(['em','px','%','pt'],function(i,unit){if(style.indexOf(unit)>0)
val=[parseFloat(style),unit];});return val;}});$.easing.jswing=$.easing.swing;$.extend($.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return $.easing[$.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-$.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return $.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return $.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});})(jQuery);(function($,undefined){$.effects.blind=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'vertical';$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var ref=(direction=='vertical')?'height':'width';var distance=(direction=='vertical')?wrapper.height():wrapper.width();if(mode=='show')wrapper.css(ref,0);var animation={};animation[ref]=mode=='show'?distance:0;wrapper.animate(animation,o.duration,o.options.easing,function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();});});};})(jQuery);(function($,undefined){$.effects.bounce=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'effect');var direction=o.options.direction||'up';var distance=o.options.distance||20;var times=o.options.times||5;var speed=o.duration||250;if(/show|hide/.test(mode))props.push('opacity');$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true})/3:el.outerWidth({margin:true})/3);if(mode=='show')el.css('opacity',0).css(ref,motion=='pos'?-distance:distance);if(mode=='hide')distance=distance/(times*2);if(mode!='hide')times--;if(mode=='show'){var animation={opacity:1};animation[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation,speed/2,o.options.easing);distance=distance/2;times--;};for(var i=0;i<times;i++){var animation1={},animation2={};animation1[ref]=(motion=='pos'?'-=':'+=')+distance;animation2[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing);distance=(mode=='hide')?distance*2:distance/2;};if(mode=='hide'){var animation={opacity:0};animation[ref]=(motion=='pos'?'-=':'+=')+distance;el.animate(animation,speed/2,o.options.easing,function(){el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});}else{var animation1={},animation2={};animation1[ref]=(motion=='pos'?'-=':'+=')+distance;animation2[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});};el.queue('fx',function(){el.dequeue();});el.dequeue();});};})(jQuery);(function($,undefined){$.effects.clip=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','height','width'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'vertical';$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var animate=el[0].tagName=='IMG'?wrapper:el;var ref={size:(direction=='vertical')?'height':'width',position:(direction=='vertical')?'top':'left'};var distance=(direction=='vertical')?animate.height():animate.width();if(mode=='show'){animate.css(ref.size,0);animate.css(ref.position,distance/2);}
var animation={};animation[ref.size]=mode=='show'?distance:0;animation[ref.position]=mode=='show'?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.drop=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','opacity'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'left';$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true})/2:el.outerWidth({margin:true})/2);if(mode=='show')el.css('opacity',0).css(ref,motion=='pos'?-distance:distance);var animation={opacity:mode=='show'?1:0};animation[ref]=(mode=='show'?(motion=='pos'?'+=':'-='):(motion=='pos'?'-=':'+='))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.explode=function(o){return this.queue(function(){var rows=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;var cells=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;o.options.mode=o.options.mode=='toggle'?($(this).is(':visible')?'hide':'show'):o.options.mode;var el=$(this).show().css('visibility','hidden');var offset=el.offset();offset.top-=parseInt(el.css("marginTop"),10)||0;offset.left-=parseInt(el.css("marginLeft"),10)||0;var width=el.outerWidth(true);var height=el.outerHeight(true);for(var i=0;i<rows;i++){for(var j=0;j<cells;j++){el.clone().appendTo('body').wrap('<div></div>').css({position:'absolute',visibility:'visible',left:-j*(width/cells),top:-i*(height/rows)}).parent().addClass('ui-effects-explode').css({position:'absolute',overflow:'hidden',width:width/cells,height:height/rows,left:offset.left+j*(width/cells)+(o.options.mode=='show'?(j-Math.floor(cells/2))*(width/cells):0),top:offset.top+i*(height/rows)+(o.options.mode=='show'?(i-Math.floor(rows/2))*(height/rows):0),opacity:o.options.mode=='show'?0:1}).animate({left:offset.left+j*(width/cells)+(o.options.mode=='show'?0:(j-Math.floor(cells/2))*(width/cells)),top:offset.top+i*(height/rows)+(o.options.mode=='show'?0:(i-Math.floor(rows/2))*(height/rows)),opacity:o.options.mode=='show'?1:0},o.duration||500);}}
setTimeout(function(){o.options.mode=='show'?el.css({visibility:'visible'}):el.css({visibility:'visible'}).hide();if(o.callback)o.callback.apply(el[0]);el.dequeue();$('div.ui-effects-explode').remove();},o.duration||500);});};})(jQuery);(function($,undefined){$.effects.fade=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'hide');elem.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(o.callback&&o.callback.apply(this,arguments));elem.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.fold=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'hide');var size=o.options.size||15;var horizFirst=!(!o.options.horizFirst);var duration=o.duration?o.duration/2:$.fx.speeds._default/2;$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var widthFirst=((mode=='show')!=horizFirst);var ref=widthFirst?['width','height']:['height','width'];var distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];var percent=/([0-9]+)%/.exec(size);if(percent)size=parseInt(percent[1],10)/100*distance[mode=='hide'?0:1];if(mode=='show')wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});var animation1={},animation2={};animation1[ref[0]]=mode=='show'?distance[0]:size;animation2[ref[1]]=mode=='show'?distance[1]:0;wrapper.animate(animation1,duration,o.options.easing).animate(animation2,duration,o.options.easing,function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();});});};})(jQuery);(function($,undefined){$.effects.highlight=function(o){return this.queue(function(){var elem=$(this),props=['backgroundImage','backgroundColor','opacity'],mode=$.effects.setMode(elem,o.options.mode||'show'),animation={backgroundColor:elem.css('backgroundColor')};if(mode=='hide'){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:'none',backgroundColor:o.options.color||'#ffff99'}).animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(mode=='hide'&&elem.hide());$.effects.restore(elem,props);(mode=='show'&&!$.support.opacity&&this.style.removeAttribute('filter'));(o.callback&&o.callback.apply(this,arguments));elem.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.pulsate=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'show');times=((o.options.times||5)*2)-1;duration=o.duration?o.duration/2:$.fx.speeds._default/2,isVisible=elem.is(':visible'),animateTo=0;if(!isVisible){elem.css('opacity',0).show();animateTo=1;}
if((mode=='hide'&&isVisible)||(mode=='show'&&!isVisible)){times--;}
for(var i=0;i<times;i++){elem.animate({opacity:animateTo},duration,o.options.easing);animateTo=(animateTo+1)%2;}
elem.animate({opacity:animateTo},duration,o.options.easing,function(){if(animateTo==0){elem.hide();}
(o.callback&&o.callback.apply(this,arguments));});elem.queue('fx',function(){elem.dequeue();}).dequeue();});};})(jQuery);(function($,undefined){$.effects.puff=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'hide'),percent=parseInt(o.options.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o.options,{fade:true,mode:mode,percent:mode=='hide'?percent:100,from:mode=='hide'?original:{height:original.height*factor,width:original.width*factor}});elem.effect('scale',o.options,o.duration,o.callback);elem.dequeue();});};$.effects.scale=function(o){return this.queue(function(){var el=$(this);var options=$.extend(true,{},o.options);var mode=$.effects.setMode(el,o.options.mode||'effect');var percent=parseInt(o.options.percent,10)||(parseInt(o.options.percent,10)==0?0:(mode=='hide'?0:100));var direction=o.options.direction||'both';var origin=o.options.origin;if(mode!='effect'){options.origin=origin||['middle','center'];options.restore=true;}
var original={height:el.height(),width:el.width()};el.from=o.options.from||(mode=='show'?{height:0,width:0}:original);var factor={y:direction!='horizontal'?(percent/100):1,x:direction!='vertical'?(percent/100):1};el.to={height:original.height*factor.y,width:original.width*factor.x};if(o.options.fade){if(mode=='show'){el.from.opacity=0;el.to.opacity=1;};if(mode=='hide'){el.from.opacity=1;el.to.opacity=0;};};options.from=el.from;options.to=el.to;options.mode=mode;el.effect('size',options,o.duration,o.callback);el.dequeue();});};$.effects.size=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','width','height','overflow','opacity'];var props1=['position','top','bottom','left','right','overflow','opacity'];var props2=['width','height','overflow'];var cProps=['fontSize'];var vProps=['borderTopWidth','borderBottomWidth','paddingTop','paddingBottom'];var hProps=['borderLeftWidth','borderRightWidth','paddingLeft','paddingRight'];var mode=$.effects.setMode(el,o.options.mode||'effect');var restore=o.options.restore||false;var scale=o.options.scale||'both';var origin=o.options.origin;var original={height:el.height(),width:el.width()};el.from=o.options.from||original;el.to=o.options.to||original;if(origin){var baseline=$.effects.getBaseline(origin,original);el.from.top=(original.height-el.from.height)*baseline.y;el.from.left=(original.width-el.from.width)*baseline.x;el.to.top=(original.height-el.to.height)*baseline.y;el.to.left=(original.width-el.to.width)*baseline.x;};var factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale=='box'||scale=='both'){if(factor.from.y!=factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);};if(factor.from.x!=factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);};};if(scale=='content'||scale=='both'){if(factor.from.y!=factor.to.y){props=props.concat(cProps);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);};};$.effects.save(el,restore?props:props1);el.show();$.effects.createWrapper(el);el.css('overflow','hidden').css(el.from);if(scale=='content'||scale=='both'){vProps=vProps.concat(['marginTop','marginBottom']).concat(cProps);hProps=hProps.concat(['marginLeft','marginRight']);props2=props.concat(vProps).concat(hProps);el.find("*[width]").each(function(){child=$(this);if(restore)$.effects.save(child,props2);var c_original={height:child.height(),width:child.width()};child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!=factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);};if(factor.from.x!=factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);};child.css(child.from);child.animate(child.to,o.duration,o.options.easing,function(){if(restore)$.effects.restore(child,props2);});});};el.animate(el.to,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(el.to.opacity===0){el.css('opacity',el.from.opacity);}
if(mode=='hide')el.hide();$.effects.restore(el,restore?props:props1);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.shake=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'effect');var direction=o.options.direction||'left';var distance=o.options.distance||20;var times=o.options.times||3;var speed=o.duration||o.options.duration||140;$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var animation={},animation1={},animation2={};animation[ref]=(motion=='pos'?'-=':'+=')+distance;animation1[ref]=(motion=='pos'?'+=':'-=')+distance*2;animation2[ref]=(motion=='pos'?'-=':'+=')+distance*2;el.animate(animation,speed,o.options.easing);for(var i=1;i<times;i++){el.animate(animation1,speed,o.options.easing).animate(animation2,speed,o.options.easing);};el.animate(animation1,speed,o.options.easing).animate(animation,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});el.queue('fx',function(){el.dequeue();});el.dequeue();});};})(jQuery);(function($,undefined){$.effects.slide=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'show');var direction=o.options.direction||'left';$.effects.save(el,props);el.show();$.effects.createWrapper(el).css({overflow:'hidden'});var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true}):el.outerWidth({margin:true}));if(mode=='show')el.css(ref,motion=='pos'?(isNaN(distance)?"-"+distance:-distance):distance);var animation={};animation[ref]=(mode=='show'?(motion=='pos'?'+=':'-='):(motion=='pos'?'-=':'+='))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.transfer=function(o){return this.queue(function(){var elem=$(this),target=$(o.options.to),endPosition=target.offset(),animation={top:endPosition.top,left:endPosition.left,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.options.className).css({top:startPosition.top,left:startPosition.left,height:elem.innerHeight(),width:elem.innerWidth(),position:'absolute'}).animate(animation,o.duration,o.options.easing,function(){transfer.remove();(o.callback&&o.callback.apply(elem[0],arguments));elem.dequeue();});});};})(jQuery);;(function($){var expr=(function(){if(!$.browser.msie)return false;var div=document.createElement('div');try{div.style.setExpression('width','0+0');}
catch(e){return false;}
return true;})();function sz(el,p){return parseInt($.css(el,p))||0;};function hex2(s){var s=parseInt(s).toString(16);return(s.length<2)?'0'+s:s;};function gpc(node){for(;node&&node.nodeName.toLowerCase()!='html';node=node.parentNode){var v=$.css(node,'backgroundColor');if(v=='rgba(0, 0, 0, 0)')
continue;if(v.indexOf('rgb')>=0){var rgb=v.match(/\d+/g);return'#'+hex2(rgb[0])+hex2(rgb[1])+hex2(rgb[2]);}
if(v&&v!='transparent')
return v;}
return'#ffffff';};function getWidth(fx,i,width){switch(fx){case'round':return Math.round(width*(1-Math.cos(Math.asin(i/width))));case'cool':return Math.round(width*(1+Math.cos(Math.asin(i/width))));case'sharp':return Math.round(width*(1-Math.cos(Math.acos(i/width))));case'bite':return Math.round(width*(Math.cos(Math.asin((width-i-1)/width))));case'slide':return Math.round(width*(Math.atan2(i,width/i)));case'jut':return Math.round(width*(Math.atan2(width,(width-i-1))));case'curl':return Math.round(width*(Math.atan(i)));case'tear':return Math.round(width*(Math.cos(i)));case'wicked':return Math.round(width*(Math.tan(i)));case'long':return Math.round(width*(Math.sqrt(i)));case'sculpt':return Math.round(width*(Math.log((width-i-1),width)));case'dog':return(i&1)?(i+1):width;case'dog2':return(i&2)?(i+1):width;case'dog3':return(i&3)?(i+1):width;case'fray':return(i%2)*width;case'notch':return width;case'bevel':return i+1;}};$.fn.corner=function(o){if(this.length==0){if(!$.isReady&&this.selector){var s=this.selector,c=this.context;$(function(){$(s,c).corner(o);});}
return this;}
o=(o||"").toLowerCase();var keep=/keep/.test(o);var cc=((o.match(/cc:(#[0-9a-f]+)/)||[])[1]);var sc=((o.match(/sc:(#[0-9a-f]+)/)||[])[1]);var width=parseInt((o.match(/(\d+)px/)||[])[1])||10;var re=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/;var fx=((o.match(re)||['round'])[0]);var edges={T:0,B:1};var opts={TL:/top|tl/.test(o),TR:/top|tr/.test(o),BL:/bottom|bl/.test(o),BR:/bottom|br/.test(o)};if(!opts.TL&&!opts.TR&&!opts.BL&&!opts.BR)
opts={TL:1,TR:1,BL:1,BR:1};var strip=document.createElement('div');strip.style.overflow='hidden';strip.style.height='1px';strip.style.backgroundColor=sc||'transparent';strip.style.borderStyle='solid';return this.each(function(index){var pad={T:parseInt($.css(this,'paddingTop'))||0,R:parseInt($.css(this,'paddingRight'))||0,B:parseInt($.css(this,'paddingBottom'))||0,L:parseInt($.css(this,'paddingLeft'))||0};if(typeof this.style.zoom!=undefined)this.style.zoom=1;if(!keep)this.style.border='none';strip.style.borderColor=cc||gpc(this.parentNode);var cssHeight=$.curCSS(this,'height');for(var j in edges){var bot=edges[j];if((bot&&(opts.BL||opts.BR))||(!bot&&(opts.TL||opts.TR))){strip.style.borderStyle='none '+(opts[j+'R']?'solid':'none')+' none '+(opts[j+'L']?'solid':'none');var d=document.createElement('div');$(d).addClass('jquery-corner');var ds=d.style;bot?this.appendChild(d):this.insertBefore(d,this.firstChild);if(bot&&cssHeight!='auto'){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.bottom=ds.left=ds.padding=ds.margin='0';if(expr)
ds.setExpression('width','this.parentNode.offsetWidth');else
ds.width='100%';}
else if(!bot&&$.browser.msie){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.top=ds.left=ds.right=ds.padding=ds.margin='0';if(expr){var bw=sz(this,'borderLeftWidth')+sz(this,'borderRightWidth');ds.setExpression('width','this.parentNode.offsetWidth - '+bw+'+ "px"');}
else
ds.width='100%';}
else{ds.margin=!bot?'-'+pad.T+'px -'+pad.R+'px '+(pad.T-width)+'px -'+pad.L+'px':(pad.B-width)+'px -'+pad.R+'px -'+pad.B+'px -'+pad.L+'px';}
for(var i=0;i<width;i++){var w=Math.max(0,getWidth(fx,i,width));var e=strip.cloneNode(false);e.style.borderWidth='0 '+(opts[j+'R']?w:0)+'px 0 '+(opts[j+'L']?w:0)+'px';bot?d.appendChild(e):d.insertBefore(e,d.firstChild);}}}});};$.fn.uncorner=function(){$('div.jquery-corner',this).remove();return this;};})(jQuery);(function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&&n.constructor==Number?n+'px':n;},html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+
(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($('> iframe.bgiframe',this).length==0)
this.insertBefore(document.createElement(html),this.firstChild);});}
return this;};})(jQuery);(function($){function addEvents(ul){var settings=$.data($(ul).parents().andSelf().filter('ul.jd_menu')[0],'jdMenuSettings');$('> li',ul).bind('mouseenter.jdmenu mouseleave.jdmenu',function(evt){$(this).toggleClass('jdm_hover');var ul=$('> ul',this);if(ul.length==1){clearTimeout(this.$jdTimer);var enter=(evt.type=='mouseenter');var fn=(enter?showMenu:hideMenu);this.$jdTimer=setTimeout(function(){fn(ul[0],settings.onAnimate,settings.isVertical);},enter?settings.showDelay:settings.hideDelay);}}).bind('click.jdmenu',function(evt){var ul=$('> ul',this);if(ul.length==1&&(settings.disableLinks==true||$(this).hasClass('accessible'))){showMenu(ul,settings.onAnimate,settings.isVertical);return false;}
if(evt.target==this){var link=$('> a',evt.target).not('.accessible');if(link.length>0){var a=link[0];if(!a.onclick){window.open(a.href,a.target||'_self');}else{$(a).trigger('click');}}}
if(settings.disableLinks||(!settings.disableLinks&&!$(this).parent().hasClass('jd_menu'))){$(this).parent().jdMenuHide();evt.stopPropagation();}}).find('> a').bind('focus.jdmenu blur.jdmenu',function(evt){var p=$(this).parents('li:eq(0)');if(evt.type=='focus'){p.addClass('jdm_hover');}else{p.removeClass('jdm_hover');}}).filter('.accessible').bind('click.jdmenu',function(evt){evt.preventDefault();});}
function showMenu(ul,animate,vertical){var ul=$(ul);if(ul.is(':visible')){return;}
ul.bgiframe();var li=ul.parent();ul.trigger('jdMenuShow').positionBy({target:li[0],targetPos:(vertical===true||!li.parent().hasClass('jd_menu')?1:3),elementPos:0,hideAfterPosition:true});if(!ul.hasClass('jdm_events')){ul.addClass('jdm_events');addEvents(ul);}
li.addClass('jdm_active').siblings('li').find('> ul:eq(0):visible').each(function(){hideMenu(this);});if(animate===undefined){ul.show();}else{animate.apply(ul[0],[true]);}}
function hideMenu(ul,animate){var ul=$(ul);$('.bgiframe',ul).remove();ul.filter(':not(.jd_menu)').find('> li > ul:eq(0):visible').each(function(){hideMenu(this);}).end();if(animate===undefined){ul.hide()}else{animate.apply(ul[0],[false]);}
ul.trigger('jdMenuHide').parents('li:eq(0)').removeClass('jdm_active jdm_hover').end().find('> li').removeClass('jdm_active jdm_hover');}
$.fn.jdMenu=function(settings){var settings=$.extend({showDelay:200,hideDelay:500,disableLinks:true},settings);if(!$.isFunction(settings.onAnimate)){settings.onAnimate=undefined;}
return this.filter('ul.jd_menu').each(function(){$.data(this,'jdMenuSettings',$.extend({isVertical:$(this).hasClass('jd_menu_vertical')},settings));addEvents(this);});};$.fn.jdMenuUnbind=function(){$('ul.jdm_events',this).unbind('.jdmenu').find('> a').unbind('.jdmenu');};$.fn.jdMenuHide=function(){return this.filter('ul').each(function(){hideMenu(this);});};$(window).bind('click.jdmenu',function(){$('ul.jd_menu ul:visible').jdMenuHide();});})(jQuery);$(function(){$('ul.jd_menu').jdMenu();});(function($){var Range=function(x1,y1,x2,y2){this.x1=x1;this.x2=x2;this.y1=y1;this.y2=y2;};Range.prototype.contains=function(range){return(this.x1<=range.x1&&range.x2<=this.x2)&&(this.y1<=range.y1&&range.y2<=this.y2);};Range.prototype.transform=function(x,y){return new Range(this.x1+x,this.y1+y,this.x2+x,this.y2+y);};$.fn.positionBy=function(args){var date1=new Date();if(this.length==0){return this;}
var args=$.extend({target:null,targetPos:null,elementPos:null,x:null,y:null,positions:null,addClass:false,force:false,container:window,hideAfterPosition:false},args);if(args.x!=null){var tLeft=args.x;var tTop=args.y;var tWidth=0;var tHeight=0;}else{var $target=$($(args.target)[0]);var tWidth=$target.outerWidth();var tHeight=$target.outerHeight();var tOffset=$target.offset();var tLeft=tOffset.left;var tTop=tOffset.top;}
var tRight=tLeft+tWidth;var tBottom=tTop+tHeight;return this.each(function(){var $element=$(this);if(!$element.is(':visible')){$element.css({left:-3000,top:-3000}).show();}
var eWidth=$element.outerWidth();var eHeight=$element.outerHeight();var position=[];var next=[];position[0]=new Range(tRight,tTop,tRight+eWidth,tTop+eHeight);next[0]=[1,7,4];position[1]=new Range(tRight,tBottom-eHeight,tRight+eWidth,tBottom);next[1]=[0,6,4];position[2]=new Range(tRight,tBottom,tRight+eWidth,tBottom+eHeight);next[2]=[1,3,10];position[3]=new Range(tRight-eWidth,tBottom,tRight,tBottom+eHeight);next[3]=[1,6,10];position[4]=new Range(tLeft,tBottom,tLeft+eWidth,tBottom+eHeight);next[4]=[1,6,9];position[5]=new Range(tLeft-eWidth,tBottom,tLeft,tBottom+eHeight);next[5]=[6,4,9];position[6]=new Range(tLeft-eWidth,tBottom-eHeight,tLeft,tBottom);next[6]=[7,1,4];position[7]=new Range(tLeft-eWidth,tTop,tLeft,tTop+eHeight);next[7]=[6,0,4];position[8]=new Range(tLeft-eWidth,tTop-eHeight,tLeft,tTop);next[8]=[7,9,4];position[9]=new Range(tLeft,tTop-eHeight,tLeft+eWidth,tTop);next[9]=[0,7,4];position[10]=new Range(tRight-eWidth,tTop-eHeight,tRight,tTop);next[10]=[0,7,3];position[11]=new Range(tRight,tTop-eHeight,tRight+eWidth,tTop);next[11]=[0,10,3];position[12]=new Range(tRight-eWidth,tTop,tRight,tTop+eHeight);next[12]=[13,7,10];position[13]=new Range(tRight-eWidth,tBottom-eHeight,tRight,tBottom);next[13]=[12,6,3];position[14]=new Range(tLeft,tBottom-eHeight,tLeft+eWidth,tBottom);next[14]=[15,1,4];position[15]=new Range(tLeft,tTop,tLeft+eWidth,tTop+eHeight);next[15]=[14,0,9];if(args.positions!==null){var pos=args.positions[0];}else if(args.targetPos!=null&&args.elementPos!=null){var pos=[];pos[0]=[];pos[0][0]=15;pos[0][1]=7;pos[0][2]=8;pos[0][3]=9;pos[1]=[];pos[1][0]=0;pos[1][1]=12;pos[1][2]=10;pos[1][3]=11;pos[2]=[];pos[2][0]=2;pos[2][1]=3;pos[2][2]=13;pos[2][3]=1;pos[3]=[];pos[3][0]=4;pos[3][1]=5;pos[3][2]=6;pos[3][3]=14;var pos=pos[args.targetPos][args.elementPos];}
var ePos=position[pos];var fPos=pos;if(!args.force){$window=$(window);var sx=$window.scrollLeft();var sy=$window.scrollTop();var container=new Range(sx,sy,sx+$window.width(),sy+$window.height());var stack;if(args.positions){stack=args.positions;}else{stack=[pos];}
var test=[];while(stack.length>0){var p=stack.shift();if(test[p]){continue;}
test[p]=true;if(!container.contains(position[p])){if(args.positions===null){stack=jQuery.merge(stack,next[p]);}}else{ePos=position[p];break;}}}
$element.parents().each(function(){var $this=$(this);if($this.css('position')!='static'){var abs=$this.offset();ePos=ePos.transform(-abs.left,-abs.top);return false;}});var css={left:ePos.x1,top:ePos.y1};if(args.hideAfterPosition){css['display']='none';}
$element.css(css);if(args.addClass){$element.removeClass('positionBy0 positionBy1 positionBy2 positionBy3 positionBy4 positionBy5 '
+'positionBy6 positionBy7 positionBy8 positionBy9 positionBy10 positionBy11 '
+'positionBy12 positionBy13 positionBy14 positionBy15').addClass('positionBy'+p);}});};})(jQuery);;(function($){var helper={},current,title,tID,IE=$.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),track=false;$.tooltip={blocked:false,defaults:{delay:200,fade:false,showURL:true,extraClass:"",top:15,left:15,id:"tooltip"},block:function(){$.tooltip.blocked=!$.tooltip.blocked;}};$.fn.extend({tooltip:function(settings){settings=$.extend({},$.tooltip.defaults,settings);createHelper(settings);return this.each(function(){$.data(this,"tooltip",settings);this.tOpacity=helper.parent.css("opacity");this.tooltipText=this.title;$(this).removeAttr("title");this.alt="";}).mouseover(save).mouseout(hide).click(hide);},fixPNG:IE?function(){return this.each(function(){var image=$(this).css('backgroundImage');if(image.match(/^url\(["']?(.*\.png)["']?\)$/i)){image=RegExp.$1;$(this).css({'backgroundImage':'none','filter':"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+image+"')"}).each(function(){var position=$(this).css('position');if(position!='absolute'&&position!='relative')
$(this).css('position','relative');});}});}:function(){return this;},unfixPNG:IE?function(){return this.each(function(){$(this).css({'filter':'',backgroundImage:''});});}:function(){return this;},hideWhenEmpty:function(){return this.each(function(){$(this)[$(this).html()?"show":"hide"]();});},url:function(){return this.attr('href')||this.attr('src');}});function createHelper(settings){if(helper.parent)
return;helper.parent=$('<div id="'+settings.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide();if($.fn.bgiframe)
helper.parent.bgiframe();helper.title=$('h3',helper.parent);helper.body=$('div.body',helper.parent);helper.url=$('div.url',helper.parent);}
function settings(element){return $.data(element,"tooltip");}
function handle(event){if(settings(this).delay)
tID=setTimeout(show,settings(this).delay);else
show();track=!!settings(this).track;$(document.body).bind('mousemove',update);update(event);}
function save(){if($.tooltip.blocked||this==current||(!this.tooltipText&&!settings(this).bodyHandler))
return;current=this;title=this.tooltipText;if(settings(this).bodyHandler){helper.title.hide();var bodyContent=settings(this).bodyHandler.call(this);if(bodyContent.nodeType||bodyContent.jquery){helper.body.empty().append(bodyContent)}else{helper.body.html(bodyContent);}
helper.body.show();}else if(settings(this).showBody){var parts=title.split(settings(this).showBody);helper.title.html(parts.shift()).show();helper.body.empty();for(var i=0,part;(part=parts[i]);i++){if(i>0)
helper.body.append("<br/>");helper.body.append(part);}
helper.body.hideWhenEmpty();}else{helper.title.html(title).show();helper.body.hide();}
if(settings(this).showURL&&$(this).url())
helper.url.html($(this).url().replace('http://','')).show();else
helper.url.hide();helper.parent.addClass(settings(this).extraClass);if(settings(this).fixPNG)
helper.parent.fixPNG();handle.apply(this,arguments);}
function show(){tID=null;if((!IE||!$.fn.bgiframe)&&settings(current).fade){if(helper.parent.is(":animated"))
helper.parent.stop().show().fadeTo(settings(current).fade,current.tOpacity);else
helper.parent.is(':visible')?helper.parent.fadeTo(settings(current).fade,current.tOpacity):helper.parent.fadeIn(settings(current).fade);}else{helper.parent.show();}
update();}
function update(event){if($.tooltip.blocked)
return;if(event&&event.target.tagName=="OPTION"){return;}
if(!track&&helper.parent.is(":visible")){$(document.body).unbind('mousemove',update)}
if(current==null){$(document.body).unbind('mousemove',update);return;}
helper.parent.removeClass("viewport-right").removeClass("viewport-bottom");var left=helper.parent[0].offsetLeft;var top=helper.parent[0].offsetTop;if(event){left=event.pageX+settings(current).left;top=event.pageY+settings(current).top;var right='auto';if(settings(current).positionLeft){right=$(window).width()-left;left='auto';}
helper.parent.css({left:left,right:right,top:top});}
var v=viewport(),h=helper.parent[0];if(v.x+v.cx<h.offsetLeft+h.offsetWidth){left-=h.offsetWidth+20+settings(current).left;helper.parent.css({left:left+'px'}).addClass("viewport-right");}
if(v.y+v.cy<h.offsetTop+h.offsetHeight){top-=h.offsetHeight+20+settings(current).top;helper.parent.css({top:top+'px'}).addClass("viewport-bottom");}}
function viewport(){return{x:$(window).scrollLeft(),y:$(window).scrollTop(),cx:$(window).width(),cy:$(window).height()};}
function hide(event){if($.tooltip.blocked)
return;if(tID)
clearTimeout(tID);current=null;var tsettings=settings(this);function complete(){helper.parent.removeClass(tsettings.extraClass).hide().css("opacity","");}
if((!IE||!$.fn.bgiframe)&&tsettings.fade){if(helper.parent.is(':animated'))
helper.parent.stop().fadeTo(tsettings.fade,0,complete);else
helper.parent.stop().fadeOut(tsettings.fade,complete);}else
complete();if(settings(this).fixPNG)
helper.parent.unfixPNG();}})(jQuery);;(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert('blockUI requires jQuery v1.2.3 or later!  You are using v'+$.fn.jquery);return;}
$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){};var mode=document.documentMode||0;var setExpr=$.browser.msie&&(($.browser.version<8&&!mode)||mode<8);var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts);};$.unblockUI=function(opts){remove(window,opts);};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout==undefined)timeout=3000;$.blockUI({message:$m,fadeIn:700,fadeOut:1000,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS});};$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){if($.css(this,'position')=='static')
this.style.position='relative';if($.browser.msie)
this.style.zoom=1;install(this,opts);});};$.fn.unblock=function(opts){return this.each(function(){remove(this,opts);});};$.blockUI.version=2.33;$.blockUI.defaults={message:'<h1>Please wait...</h1>',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',color:'#000',border:'3px solid #aaa',backgroundColor:'#fff',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.6,cursor:'wait'},growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px','border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:true,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var full=(el==window);var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},$.blockUI.defaults,opts||{});opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{});var themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)
remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)
data.parent.removeChild(node);}
var z=opts.baseZ;var lyr1=($.browser.msie||opts.forceIframe)?$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>');var lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var lyr3,s;if(opts.theme&&full){s='<div class="blockUI blockMsg blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:fixed">'+'<div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(opts.theme){s='<div class="blockUI blockMsg blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:absolute">'+'<div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(full){s='<div class="blockUI blockMsg blockPage" style="z-index:'+z+';display:none;position:fixed"></div>';}
else{s='<div class="blockUI blockMsg blockElement" style="z-index:'+z+';display:none;position:absolute"></div>';}
lyr3=$(s);if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content');}
else
lyr3.css(css);}
if(!opts.applyPlatformOpacityRules||!($.browser.mozilla&&/Linux/.test(navigator.platform)))
lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if($.browser.msie||opts.forceIframe)
lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par);});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'});}
var expr=setExpr&&(!$.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel)
$('html,body').css('height','100%');if((ie6||!$.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth');var fixT=t?'(0 - '+t+')':0;var fixL=l?'(0 - '+l+')':0;}
$.each([lyr1,lyr2,lyr3],function(i,o){var s=o[0].style;s.position='absolute';if(i<2){full?s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression('height','this.parentNode.offsetHeight + "px"');full?s.setExpression('width','jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT);}
else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0;}
else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top):0;var expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression);}});}
if(msg){if(opts.theme)
lyr3.find('.ui-widget-content').append(msg);else
lyr3.append(msg);if(msg.jquery||msg.nodeType)
$(msg).show();}
if(($.browser.msie||opts.forceIframe)&&opts.showOverlay)
lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=(opts.showOverlay&&!msg)?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)
lyr2._fadeIn(opts.fadeIn,cb1);if(msg)
lyr3._fadeIn(opts.fadeIn,cb2);}
else{if(opts.showOverlay)
lyr2.show();if(msg)
lyr3.show();if(opts.onBlock)
opts.onBlock();}
bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(':input:enabled:visible',pageBlock);if(opts.focusInput)
setTimeout(focus,20);}
else
center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts);},opts.timeout);$(el).data('blockUI.timeout',to);}};function remove(el,opts){var full=(el==window);var $el=$(el);var data=$el.data('blockUI.history');var to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout');}
opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);var els;if(full)
els=$('body').children().filter('.blockUI').add('body > .blockUI');else
els=$('.blockUI',el);if(full)
pageBlock=pageBlockEls=null;if(opts.fadeOut){els.fadeOut(opts.fadeOut);setTimeout(function(){reset(els,data,opts,el);},opts.fadeOut);}
else
reset(els,data,opts,el);};function reset(els,data,opts,el){els.each(function(i,o){if(this.parentNode)
this.parentNode.removeChild(this);});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)
data.parent.appendChild(data.el);$(el).removeData('blockUI.history');}
if(typeof opts.onUnblock=='function')
opts.onUnblock(el,opts);};function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))
return;if(!full)
$el.data('blockUI.isBlocked',b);if(!opts.bindEvents||(b&&!opts.showOverlay))
return;var events='mousedown mouseup keydown keypress';b?$(document).bind(events,opts,handler):$(document).unbind(events,handler);};function handler(e){if(e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target==els[els.length-1];var back=e.shiftKey&&e.target==els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false;}}}
if($(e.target).parents('div.blockMsg').length>0)
return true;return $(e.target).parents().children().filter('div.blockUI').length==0;};function focus(back){if(!pageBlockEls)
return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)
e.focus();};function center(el,x,y){var p=el.parentNode,s=el.style;var l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth');var t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0';};function sz(el,p){return parseInt($.css(el,p))||0;};})(jQuery);jQuery.fn.extend({reverse:function(event){var events=$(this).data("events");var reverseEvent=new Array;for(var e in events[event]){reverseEvent.unshift(events[event][e]);}
events[event]=reverseEvent;return this;},stack:function(event,data,fn){return this.reverse(event).bind(event,data,fn).reverse(event);},hover:function(fnOver,fnOut,reverse){if(reverse){return this.stack('mouseenter',fnOver).stack('mouseout',fnOut);}else{return this.bind('mouseenter',fnOver).bind('mouseout',fnOut);}}});jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,change,select,"+"submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn,reverse){if(fn){return reverse?this.stack(name,fn):this.bind(name,fn);}else{return this.trigger(name);}};});(function($){$.i18n={};$.i18n.map={};$.i18n.properties=function(settings){var defaults={name:'Messages',language:'',path:'',mode:'vars',callback:function(){}};settings=$.extend(defaults,settings);if(settings.language===null||settings.language==''){settings.language=$.i18n.browserLang();}
if(settings.language===null){settings.language='';}
var files=getFiles(settings.name);for(i=0;i<files.length;i++){loadAndParseFile(settings.path+files[i]+'.properties',settings.language,settings.mode);if(settings.language.length>=2){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,2)+'.properties',settings.language,settings.mode);}
if(settings.language.length>=5){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,5)+'.properties',settings.language,settings.mode);}}
if(settings.callback){settings.callback();}};$.i18n.prop=function(key,placeHolderValues){var value=$.i18n.map[key];if(value==null){return'['+key+']';}
if(!placeHolderValues){return value;}else{for(var i=0;i<placeHolderValues.length;i++){var regexp=new RegExp('\\{('+i+')\\}',"g");value=value.replace(regexp,placeHolderValues[i]);}
return value;}};$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage);}
function loadAndParseFile(filename,language,mode){$.ajax({url:filename,async:false,contentType:"text/plain;charset=UTF-8",dataType:'text',success:function(data,status){var parsed='';var parameters=data.split(/\n/);var regPlaceHolder=/(\{\d+\})/g;var regRepPlaceHolder=/\{(\d+)\}/g;var unicodeRE=/(\\u.{4})/ig;for(var i=0;i<parameters.length;i++){parameters[i]=parameters[i].replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(parameters[i].length>0&&parameters[i].match("^#")!="#"){var pair=parameters[i].split('=');if(pair.length>0){var name=unescape(pair[0]).replace(/^\s\s*/,'').replace(/\s\s*$/,'');var value=pair.length==1?"":pair[1];for(var s=2;s<pair.length;s++){value+='='+pair[s];}
value=value.replace(/"/g,'\\"');value=value.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(mode=='map'||mode=='both'){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches){for(var u=0;u<unicodeMatches.length;u++){value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));}}
$.i18n.map[name]=value;}
if(mode=='vars'||mode=='both'){checkKeyNamespace(name);if(regPlaceHolder.test(value)){var parts=value.split(regPlaceHolder);var first=true;var fnArgs='';var usedArgs=[];for(var p=0;p<parts.length;p++){if(regPlaceHolder.test(parts[p])&&usedArgs.indexOf(parts[p])==-1){if(!first){fnArgs+=',';}
fnArgs+=parts[p].replace(regRepPlaceHolder,'v$1');usedArgs.push(parts[p]);first=false;}}
parsed+=name+'=function('+fnArgs+'){';var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+='return '+fnExpr+';'+'};';}else{parsed+=name+'="'+value+'";';}}}}}
eval(parsed);}});}
function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key)){var fullname='';var names=key.split(/\./);for(var i=0;i<names.length;i++){if(i>0){fullname+='.';}
fullname+=names[i];if(eval('typeof '+fullname+' == "undefined"')){eval(fullname+'={};');}}}}
function getFiles(names){return(names&&names.constructor==Array)?names:[names];}
function normaliseLanguageCode(lang){lang=lang.toLowerCase();if(lang.length>3){lang=lang.substring(0,3)+lang.substring(3).toUpperCase();}
return lang;}
function unescapeUnicode(str){var codes=[];var code=parseInt(str.substr(2),16);if(code>=0&&code<Math.pow(2,16)){codes.push(code);}
var unescaped='';for(var i=0;i<codes.length;++i){unescaped+=String.fromCharCode(codes[i]);}
return unescaped;}})(jQuery);
jQuery(function($){$.datepicker.regional['af']={closeText:'Selekteer',prevText:'Vorige',nextText:'Volgende',currentText:'Vandag',monthNames:['Januarie','Februarie','Maart','April','Mei','Junie','Julie','Augustus','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mrt','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sondag','Maandag','Dinsdag','Woensdag','Donderdag','Vrydag','Saterdag'],dayNamesShort:['Son','Maa','Din','Woe','Don','Vry','Sat'],dayNamesMin:['So','Ma','Di','Wo','Do','Vr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['af']);});
jQuery(function($){$.datepicker.regional['ar']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:[' ','','','','','','','','',' ',' ',' '],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ar']);});
jQuery(function($){$.datepicker.regional['az']={closeText:'Bala',prevText:'&#x3c;Geri',nextText:'rli&#x3e;',currentText:'Bugn',monthNames:['Yanvar','Fevral','Mart','Aprel','May','yun','yul','Avqust','Sentyabr','Oktyabr','Noyabr','Dekabr'],monthNamesShort:['Yan','Fev','Mar','Apr','May','yun','yul','Avq','Sen','Okt','Noy','Dek'],dayNames:['Bazar','Bazar ertsi','rnb axam','rnb','Cm axam','Cm','nb'],dayNamesShort:['B','Be','a','','Ca','C',''],dayNamesMin:['B','B','','','','C',''],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['az']);});
jQuery(function($){$.datepicker.regional['bg']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',nextBigText:'&#x3e;&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bg']);});
jQuery(function($){$.datepicker.regional['bs']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Juni','Juli','August','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bs']);});jQuery(function($){$.datepicker.regional['ca']={closeText:'Tancar',prevText:'&#x3c;Ant',nextText:'Seg&#x3e;',currentText:'Avui',monthNames:['Gener','Febrer','Mar&ccedil;','Abril','Maig','Juny','Juliol','Agost','Setembre','Octubre','Novembre','Desembre'],monthNamesShort:['Gen','Feb','Mar','Abr','Mai','Jun','Jul','Ago','Set','Oct','Nov','Des'],dayNames:['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'],dayNamesShort:['Dug','Dln','Dmt','Dmc','Djs','Dvn','Dsb'],dayNamesMin:['Dg','Dl','Dt','Dc','Dj','Dv','Ds'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ca']);});
jQuery(function($){$.datepicker.regional['cs']={closeText:'Zavt',prevText:'&#x3c;Dve',nextText:'Pozdji&#x3e;',currentText:'Nyn',monthNames:['leden','nor','bezen','duben','kvten','erven','ervenec','srpen','z','jen','listopad','prosinec'],monthNamesShort:['led','no','be','dub','kv','er','vc','srp','z','j','lis','pro'],dayNames:['nedle','pondl','ter','steda','tvrtek','ptek','sobota'],dayNamesShort:['ne','po','t','st','t','p','so'],dayNamesMin:['ne','po','t','st','t','p','so'],weekHeader:'Td',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['cs']);});
jQuery(function($){$.datepicker.regional['da']={closeText:'Luk',prevText:'&#x3c;Forrige',nextText:'Nste&#x3e;',currentText:'Idag',monthNames:['Januar','Februar','Marts','April','Maj','Juni','Juli','August','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uge',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['da']);});
jQuery(function($){$.datepicker.regional['de']={closeText:'schlieen',prevText:'&#x3c;zurck',nextText:'Vor&#x3e;',currentText:'heute',monthNames:['Januar','Februar','Mrz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],monthNamesShort:['Jan','Feb','Mr','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'],dayNames:['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'],dayNamesShort:['So','Mo','Di','Mi','Do','Fr','Sa'],dayNamesMin:['So','Mo','Di','Mi','Do','Fr','Sa'],weekHeader:'Wo',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['de']);});
jQuery(function($){$.datepicker.regional['el']={closeText:'',prevText:'',nextText:'',currentText:' ',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['el']);});
jQuery(function($){$.datepicker.regional['en-GB']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['en-GB']);});
jQuery(function($){$.datepicker.regional['eo']={closeText:'Fermi',prevText:'&lt;Anta',nextText:'Sekv&gt;',currentText:'Nuna',monthNames:['Januaro','Februaro','Marto','Aprilo','Majo','Junio','Julio','Agusto','Septembro','Oktobro','Novembro','Decembro'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Ag','Sep','Okt','Nov','Dec'],dayNames:['Dimano','Lundo','Mardo','Merkredo','ado','Vendredo','Sabato'],dayNamesShort:['Dim','Lun','Mar','Mer','a','Ven','Sab'],dayNamesMin:['Di','Lu','Ma','Me','a','Ve','Sa'],weekHeader:'Sb',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eo']);});jQuery(function($){$.datepicker.regional['es']={closeText:'Cerrar',prevText:'&#x3c;Ant',nextText:'Sig&#x3e;',currentText:'Hoy',monthNames:['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],monthNamesShort:['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],dayNames:['Domingo','Lunes','Martes','Mi&eacute;rcoles','Jueves','Viernes','S&aacute;bado'],dayNamesShort:['Dom','Lun','Mar','Mi&eacute;','Juv','Vie','S&aacute;b'],dayNamesMin:['Do','Lu','Ma','Mi','Ju','Vi','S&aacute;'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['es']);});
jQuery(function($){$.datepicker.regional['et']={closeText:'Sulge',prevText:'Eelnev',nextText:'Jrgnev',currentText:'Tna',monthNames:['Jaanuar','Veebruar','Mrts','Aprill','Mai','Juuni','Juuli','August','September','Oktoober','November','Detsember'],monthNamesShort:['Jaan','Veebr','Mrts','Apr','Mai','Juuni','Juuli','Aug','Sept','Okt','Nov','Dets'],dayNames:['Phapev','Esmaspev','Teisipev','Kolmapev','Neljapev','Reede','Laupev'],dayNamesShort:['Phap','Esmasp','Teisip','Kolmap','Neljap','Reede','Laup'],dayNamesMin:['P','E','T','K','N','R','L'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['et']);});
jQuery(function($){$.datepicker.regional['eu']={closeText:'Egina',prevText:'&#x3c;Aur',nextText:'Hur&#x3e;',currentText:'Gaur',monthNames:['Urtarrila','Otsaila','Martxoa','Apirila','Maiatza','Ekaina','Uztaila','Abuztua','Iraila','Urria','Azaroa','Abendua'],monthNamesShort:['Urt','Ots','Mar','Api','Mai','Eka','Uzt','Abu','Ira','Urr','Aza','Abe'],dayNames:['Igandea','Astelehena','Asteartea','Asteazkena','Osteguna','Ostirala','Larunbata'],dayNamesShort:['Iga','Ast','Ast','Ast','Ost','Ost','Lar'],dayNamesMin:['Ig','As','As','As','Os','Os','La'],weekHeader:'Wk',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eu']);});
jQuery(function($){$.datepicker.regional['fa']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:6,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fa']);});jQuery(function($){$.datepicker.regional['fi']={closeText:'Sulje',prevText:'&laquo;Edellinen',nextText:'Seuraava&raquo;',currentText:'T&auml;n&auml;&auml;n',monthNames:['Tammikuu','Helmikuu','Maaliskuu','Huhtikuu','Toukokuu','Kes&auml;kuu','Hein&auml;kuu','Elokuu','Syyskuu','Lokakuu','Marraskuu','Joulukuu'],monthNamesShort:['Tammi','Helmi','Maalis','Huhti','Touko','Kes&auml;','Hein&auml;','Elo','Syys','Loka','Marras','Joulu'],dayNamesShort:['Su','Ma','Ti','Ke','To','Pe','Su'],dayNames:['Sunnuntai','Maanantai','Tiistai','Keskiviikko','Torstai','Perjantai','Lauantai'],dayNamesMin:['Su','Ma','Ti','Ke','To','Pe','La'],weekHeader:'Vk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fi']);});
jQuery(function($){$.datepicker.regional['fo']={closeText:'Lat aftur',prevText:'&#x3c;Fyrra',nextText:'Nsta&#x3e;',currentText:' dag',monthNames:['Januar','Februar','Mars','Aprl','Mei','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sunnudagur','Mnadagur','Tsdagur','Mikudagur','Hsdagur','Frggjadagur','Leyardagur'],dayNamesShort:['Sun','Mn','Ts','Mik','Hs','Fr','Ley'],dayNamesMin:['Su','M','T','Mi','H','Fr','Le'],weekHeader:'Vk',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fo']);});
jQuery(function($){$.datepicker.regional['fr-CH']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr-CH']);});
jQuery(function($){$.datepicker.regional['fr']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr']);});
jQuery(function($){$.datepicker.regional['he']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['\'','\'','\'','\'','\'','\'',''],dayNamesMin:['\'','\'','\'','\'','\'','\'',''],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['he']);});
jQuery(function($){$.datepicker.regional['hr']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Sijeanj','Veljaa','Oujak','Travanj','Svibanj','Lipanj','Srpanj','Kolovoz','Rujan','Listopad','Studeni','Prosinac'],monthNamesShort:['Sij','Velj','Ou','Tra','Svi','Lip','Srp','Kol','Ruj','Lis','Stu','Pro'],dayNames:['Nedjelja','Ponedjeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Tje',dateFormat:'dd.mm.yy.',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hr']);});jQuery(function($){$.datepicker.regional['hu']={closeText:'bezrs',prevText:'&laquo;&nbsp;vissza',nextText:'elre&nbsp;&raquo;',currentText:'ma',monthNames:['Janur','Februr','Mrcius','prilis','Mjus','Jnius','Jlius','Augusztus','Szeptember','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mr','pr','Mj','Jn','Jl','Aug','Szep','Okt','Nov','Dec'],dayNames:['Vasrnap','Htf','Kedd','Szerda','Cstrtk','Pntek','Szombat'],dayNamesShort:['Vas','Ht','Ked','Sze','Cs','Pn','Szo'],dayNamesMin:['V','H','K','Sze','Cs','P','Szo'],weekHeader:'H',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hu']);});jQuery(function($){$.datepicker.regional['hy']={closeText:'',prevText:'&#x3c;.',nextText:'.&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hy']);});jQuery(function($){$.datepicker.regional['id']={closeText:'Tutup',prevText:'&#x3c;mundur',nextText:'maju&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','Nopember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agus','Sep','Okt','Nop','Des'],dayNames:['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],dayNamesShort:['Min','Sen','Sel','Rab','kam','Jum','Sab'],dayNamesMin:['Mg','Sn','Sl','Rb','Km','jm','Sb'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['id']);});jQuery(function($){$.datepicker.regional['is']={closeText:'Loka',prevText:'&#x3c; Fyrri',nextText:'N&aelig;sti &#x3e;',currentText:'&Iacute; dag',monthNames:['Jan&uacute;ar','Febr&uacute;ar','Mars','Apr&iacute;l','Ma&iacute','J&uacute;n&iacute;','J&uacute;l&iacute;','&Aacute;g&uacute;st','September','Okt&oacute;ber','N&oacute;vember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Ma&iacute;','J&uacute;n','J&uacute;l','&Aacute;g&uacute;','Sep','Okt','N&oacute;v','Des'],dayNames:['Sunnudagur','M&aacute;nudagur','&THORN;ri&eth;judagur','Mi&eth;vikudagur','Fimmtudagur','F&ouml;studagur','Laugardagur'],dayNamesShort:['Sun','M&aacute;n','&THORN;ri','Mi&eth;','Fim','F&ouml;s','Lau'],dayNamesMin:['Su','M&aacute;','&THORN;r','Mi','Fi','F&ouml;','La'],weekHeader:'Vika',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['is']);});jQuery(function($){$.datepicker.regional['it']={closeText:'Chiudi',prevText:'&#x3c;Prec',nextText:'Succ&#x3e;',currentText:'Oggi',monthNames:['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],monthNamesShort:['Gen','Feb','Mar','Apr','Mag','Giu','Lug','Ago','Set','Ott','Nov','Dic'],dayNames:['Domenica','Luned&#236','Marted&#236','Mercoled&#236','Gioved&#236','Venerd&#236','Sabato'],dayNamesShort:['Dom','Lun','Mar','Mer','Gio','Ven','Sab'],dayNamesMin:['Do','Lu','Ma','Me','Gi','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['it']);});
jQuery(function($){$.datepicker.regional['ja']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['1','2','3','4','5','6','7','8','9','10','11','12'],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ja']);});jQuery(function($){$.datepicker.regional['ko']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],monthNamesShort:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ko']);});jQuery(function($){$.datepicker.regional['lt']={closeText:'Udaryti',prevText:'&#x3c;Atgal',nextText:'Pirmyn&#x3e;',currentText:'iandien',monthNames:['Sausis','Vasaris','Kovas','Balandis','Gegu','Birelis','Liepa','Rugpjtis','Rugsjis','Spalis','Lapkritis','Gruodis'],monthNamesShort:['Sau','Vas','Kov','Bal','Geg','Bir','Lie','Rugp','Rugs','Spa','Lap','Gru'],dayNames:['sekmadienis','pirmadienis','antradienis','treiadienis','ketvirtadienis','penktadienis','etadienis'],dayNamesShort:['sek','pir','ant','tre','ket','pen','e'],dayNamesMin:['Se','Pr','An','Tr','Ke','Pe','e'],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lt']);});jQuery(function($){$.datepicker.regional['lv']={closeText:'Aizvrt',prevText:'Iepr',nextText:'Nka',currentText:'odien',monthNames:['Janvris','Februris','Marts','Aprlis','Maijs','Jnijs','Jlijs','Augusts','Septembris','Oktobris','Novembris','Decembris'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['svtdiena','pirmdiena','otrdiena','trediena','ceturtdiena','piektdiena','sestdiena'],dayNamesShort:['svt','prm','otr','tre','ctr','pkt','sst'],dayNamesMin:['Sv','Pr','Ot','Tr','Ct','Pk','Ss'],weekHeader:'Nav',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lv']);});jQuery(function($){$.datepicker.regional['ms']={closeText:'Tutup',prevText:'&#x3c;Sebelum',nextText:'Selepas&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Mac','April','Mei','Jun','Julai','Ogos','September','Oktober','November','Disember'],monthNamesShort:['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogo','Sep','Okt','Nov','Dis'],dayNames:['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'],dayNamesShort:['Aha','Isn','Sel','Rab','kha','Jum','Sab'],dayNamesMin:['Ah','Is','Se','Ra','Kh','Ju','Sa'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ms']);});
jQuery(function($){$.datepicker.regional.nl={closeText:'Sluiten',prevText:'',nextText:'',currentText:'Vandaag',monthNames:['januari','februari','maart','april','mei','juni','juli','augustus','september','oktober','november','december'],monthNamesShort:['jan','feb','maa','apr','mei','jun','jul','aug','sep','okt','nov','dec'],dayNames:['zondag','maandag','dinsdag','woensdag','donderdag','vrijdag','zaterdag'],dayNamesShort:['zon','maa','din','woe','don','vri','zat'],dayNamesMin:['zo','ma','di','wo','do','vr','za'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional.nl);});jQuery(function($){$.datepicker.regional['no']={closeText:'Lukk',prevText:'&laquo;Forrige',nextText:'Neste&raquo;',currentText:'I dag',monthNames:['Januar','Februar','Mars','April','Mai','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uke',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['no']);});jQuery(function($){$.datepicker.regional['pl']={closeText:'Zamknij',prevText:'&#x3c;Poprzedni',nextText:'Nastpny&#x3e;',currentText:'Dzi',monthNames:['Stycze','Luty','Marzec','Kwiecie','Maj','Czerwiec','Lipiec','Sierpie','Wrzesie','Padziernik','Listopad','Grudzie'],monthNamesShort:['Sty','Lu','Mar','Kw','Maj','Cze','Lip','Sie','Wrz','Pa','Lis','Gru'],dayNames:['Niedziela','Poniedziaek','Wtorek','roda','Czwartek','Pitek','Sobota'],dayNamesShort:['Nie','Pn','Wt','r','Czw','Pt','So'],dayNamesMin:['N','Pn','Wt','r','Cz','Pt','So'],weekHeader:'Tydz',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pl']);});jQuery(function($){$.datepicker.regional['pt-BR']={closeText:'Fechar',prevText:'&#x3c;Anterior',nextText:'Pr&oacute;ximo&#x3e;',currentText:'Hoje',monthNames:['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],monthNamesShort:['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],dayNames:['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],dayNamesShort:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],dayNamesMin:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pt-BR']);});
jQuery(function($){$.datepicker.regional['ro']={closeText:'nchide',prevText:'&laquo; Luna precedent',nextText:'Luna urmtoare &raquo;',currentText:'Azi',monthNames:['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie','Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'],monthNamesShort:['Ian','Feb','Mar','Apr','Mai','Iun','Iul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Duminic','Luni','Mari','Miercuri','Joi','Vineri','Smbt'],dayNamesShort:['Dum','Lun','Mar','Mie','Joi','Vin','Sm'],dayNamesMin:['Du','Lu','Ma','Mi','Jo','Vi','S'],weekHeader:'Spt',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ro']);});jQuery(function($){$.datepicker.regional['ru']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ru']);});jQuery(function($){$.datepicker.regional['sk']={closeText:'Zavrie',prevText:'&#x3c;Predchdzajci',nextText:'Nasledujci&#x3e;',currentText:'Dnes',monthNames:['Janur','Februr','Marec','Aprl','Mj','Jn','Jl','August','September','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Mj','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedel\'a','Pondelok','Utorok','Streda','tvrtok','Piatok','Sobota'],dayNamesShort:['Ned','Pon','Uto','Str','tv','Pia','Sob'],dayNamesMin:['Ne','Po','Ut','St','t','Pia','So'],weekHeader:'Ty',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sk']);});jQuery(function($){$.datepicker.regional['sl']={closeText:'Zapri',prevText:'&lt;Prej&#x161;nji',nextText:'Naslednji&gt;',currentText:'Trenutni',monthNames:['Januar','Februar','Marec','April','Maj','Junij','Julij','Avgust','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljek','Torek','Sreda','&#x10C;etrtek','Petek','Sobota'],dayNamesShort:['Ned','Pon','Tor','Sre','&#x10C;et','Pet','Sob'],dayNamesMin:['Ne','Po','To','Sr','&#x10C;e','Pe','So'],weekHeader:'Teden',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sl']);});
jQuery(function($){$.datepicker.regional['sq']={closeText:'mbylle',prevText:'&#x3c;mbrapa',nextText:'Prpara&#x3e;',currentText:'sot',monthNames:['Janar','Shkurt','Mars','Prill','Maj','Qershor','Korrik','Gusht','Shtator','Tetor','Nntor','Dhjetor'],monthNamesShort:['Jan','Shk','Mar','Pri','Maj','Qer','Kor','Gus','Sht','Tet','Nn','Dhj'],dayNames:['E Diel','E Hn','E Mart','E Mrkur','E Enjte','E Premte','E Shtune'],dayNamesShort:['Di','H','Ma','M','En','Pr','Sh'],dayNamesMin:['Di','H','Ma','M','En','Pr','Sh'],weekHeader:'Ja',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sq']);});
jQuery(function($){$.datepicker.regional['sr-SR']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Jun','Jul','Avgust','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Sreda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sre','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Sed',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr-SR']);});
jQuery(function($){$.datepicker.regional['sr']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr']);});
jQuery(function($){$.datepicker.regional['sv']={closeText:'Stng',prevText:'&laquo;Frra',nextText:'Nsta&raquo;',currentText:'Idag',monthNames:['Januari','Februari','Mars','April','Maj','Juni','Juli','Augusti','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNamesShort:['Sn','Mn','Tis','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mndag','Tisdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','M','Ti','On','To','Fr','L'],weekHeader:'Ve',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sv']);});
jQuery(function($){$.datepicker.regional['ta']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ta']);});
jQuery(function($){$.datepicker.regional['th']={closeText:'',prevText:'&laquo;&nbsp;',nextText:'&nbsp;&raquo;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['..','..','..','..','..','..','..','..','..','..','..','..'],dayNames:['','','','','','',''],dayNamesShort:['.','.','.','.','.','.','.'],dayNamesMin:['.','.','.','.','.','.','.'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['th']);});jQuery(function($){$.datepicker.regional['tr']={closeText:'kapat',prevText:'&#x3c;geri',nextText:'ileri&#x3e',currentText:'bugn',monthNames:['Ocak','ubat','Mart','Nisan','Mays','Haziran','Temmuz','Austos','Eyll','Ekim','Kasm','Aralk'],monthNamesShort:['Oca','ub','Mar','Nis','May','Haz','Tem','Au','Eyl','Eki','Kas','Ara'],dayNames:['Pazar','Pazartesi','Sal','aramba','Perembe','Cuma','Cumartesi'],dayNamesShort:['Pz','Pt','Sa','a','Pe','Cu','Ct'],dayNamesMin:['Pz','Pt','Sa','a','Pe','Cu','Ct'],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['tr']);});jQuery(function($){$.datepicker.regional['uk']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['uk']);});
jQuery(function($){$.datepicker.regional['vi']={closeText:'ng',prevText:'&#x3c;Trc',nextText:'Tip&#x3e;',currentText:'Hm nay',monthNames:['Thng Mt','Thng Hai','Thng Ba','Thng T','Thng Nm','Thng Su','Thng By','Thng Tm','Thng Chn','Thng Mi','Thng Mi Mt','Thng Mi Hai'],monthNamesShort:['Thng 1','Thng 2','Thng 3','Thng 4','Thng 5','Thng 6','Thng 7','Thng 8','Thng 9','Thng 10','Thng 11','Thng 12'],dayNames:['Ch Nht','Th Hai','Th Ba','Th T','Th Nm','Th Su','Th By'],dayNamesShort:['CN','T2','T3','T4','T5','T6','T7'],dayNamesMin:['CN','T2','T3','T4','T5','T6','T7'],weekHeader:'Tu',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['vi']);});jQuery(function($){$.datepicker.regional['zh-CN']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-CN']);});jQuery(function($){$.datepicker.regional['zh-HK']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-HK']);});
jQuery(function($){$.datepicker.regional['zh-TW']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-TW']);});var MetaLayer={getCurrentDate:function(){var currentDate=new Date();return MetaLayer.toDateString(currentDate);},getYesterdayDate:function(){var currentDate=new Date();currentDate.setDate(currentDate.getDate()-1);return MetaLayer.toDateString(currentDate);},getFirstDayOfYearDate:function(){var currentDate=new Date();return currentDate.getFullYear()+"-01-01";},getFirstDayOfLastMonth:function(){var currentDate=new Date();currentDate.setMonth(currentDate.getMonth()-1);currentDate.setDate(1);return MetaLayer.toDateString(currentDate);},getLastDayOfLastMonth:function(){var currentDate=new Date();currentDate.setDate(0);return MetaLayer.toDateString(currentDate);},getLastMonthDate:function(){var currentDate=new Date();var prevDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()-30);var prevMonth="0"+(prevDate.getMonth()+1);var prevDay="0"+(prevDate.getDate());var prevDateStr=prevDate.getFullYear()+"-"+(prevMonth.substring(prevMonth.length-2,prevMonth.length))+"-"+(prevDay.substring(prevDay.length-2,prevDay.length));return prevDateStr;},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());var dStr=d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));return dStr;},getMonth:function(){var currentDate=new Date();var currentMonth="0"+(currentDate.getMonth()+1);var currentDateStr=currentDate.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length));return currentDateStr;},getMdxMonth:function(){var currentDate=new Date();var currentDateStr="[Date].["+currentDate.getFullYear()+"].["+currentDate.getMonth()+"]";return currentDateStr;},getInitialMonth:function(){var c=new Date();c.setMonth(c.getMonth()-1);return c;},allValues:[["All","All"]]};jQuery.fn.check=function(mode){var mode=mode||'on';return this.each(function(){switch(mode){case'on':this.checked=true;break;case'off':this.checked=false;break;case'toggle':this.checked=!this.checked;break;}});};;(function($){var tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image(),imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,loadingTimer,loadingFrame=1,titleHeight=0,titleStr='',start_pos,final_pos,busy=false,fx=$.extend($('<div/>')[0],{prop:0}),isIE6=$.browser.msie&&$.browser.version<7&&!window.XMLHttpRequest,_abort=function(){loading.hide();imgPreloader.onerror=imgPreloader.onload=null;if(ajaxLoader){ajaxLoader.abort();}
tmp.empty();},_error=function(){if(false===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts)){loading.hide();busy=false;return;}
selectedOpts.titleShow=false;selectedOpts.width='auto';selectedOpts.height='auto';tmp.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');_process_inline();},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,emb,ret;_abort();selectedOpts=$.extend({},$.fn.fancybox.defaults,(typeof $(obj).data('fancybox')=='undefined'?selectedOpts:$(obj).data('fancybox')));ret=selectedOpts.onStart(selectedArray,selectedIndex,selectedOpts);if(ret===false){busy=false;return;}else if(typeof ret=='object'){selectedOpts=$.extend(selectedOpts,ret);}
title=selectedOpts.title||(obj.nodeName?$(obj).attr('title'):obj.title)||'';if(obj.nodeName&&!selectedOpts.orig){selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):$(obj);}
if(title===''&&selectedOpts.orig&&selectedOpts.titleFromAlt){title=selectedOpts.orig.attr('alt');}
href=selectedOpts.href||(obj.nodeName?$(obj).attr('href'):obj.href)||null;if((/^(?:javascript)/i).test(href)||href=='#'){href=null;}
if(selectedOpts.type){type=selectedOpts.type;if(!href){href=selectedOpts.content;}}else if(selectedOpts.content){type='html';}else if(href){if(href.match(imgRegExp)){type='image';}else if(href.match(swfRegExp)){type='swf';}else if($(obj).hasClass("iframe")){type='iframe';}else if(href.indexOf("#")===0){type='inline';}else{type='ajax';}}
if(!type){_error();return;}
if(type=='inline'){obj=href.substr(href.indexOf("#"));type=$(obj).length>0?'inline':'ajax';}
selectedOpts.type=type;selectedOpts.href=href;selectedOpts.title=title;if(selectedOpts.autoDimensions){if(selectedOpts.type=='html'||selectedOpts.type=='inline'||selectedOpts.type=='ajax'){selectedOpts.width='auto';selectedOpts.height='auto';}else{selectedOpts.autoDimensions=false;}}
if(selectedOpts.modal){selectedOpts.overlayShow=true;selectedOpts.hideOnOverlayClick=false;selectedOpts.hideOnContentClick=false;selectedOpts.enableEscapeButton=false;selectedOpts.showCloseButton=false;}
selectedOpts.padding=parseInt(selectedOpts.padding,10);selectedOpts.margin=parseInt(selectedOpts.margin,10);tmp.css('padding',(selectedOpts.padding+selectedOpts.margin));$('.fancybox-inline-tmp').unbind('fancybox-cancel').bind('fancybox-change',function(){$(this).replaceWith(content.children());});switch(type){case'html':tmp.html(selectedOpts.content);_process_inline();break;case'inline':if($(obj).parent().is('#fancybox-content')===true){busy=false;return;}
$('<div class="fancybox-inline-tmp" />').hide().insertBefore($(obj)).bind('fancybox-cleanup',function(){$(this).replaceWith(content.children());}).bind('fancybox-cancel',function(){$(this).replaceWith(tmp.children());});$(obj).appendTo(tmp);_process_inline();break;case'image':busy=false;$.fancybox.showActivity();imgPreloader=new Image();imgPreloader.onerror=function(){_error();};imgPreloader.onload=function(){busy=true;imgPreloader.onerror=imgPreloader.onload=null;_process_image();};imgPreloader.src=href;break;case'swf':selectedOpts.scrolling='no';str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>';emb='';$.each(selectedOpts.swf,function(name,val){str+='<param name="'+name+'" value="'+val+'"></param>';emb+=' '+name+'="'+val+'"';});str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"'+emb+'></embed></object>';tmp.html(str);_process_inline();break;case'ajax':busy=false;$.fancybox.showActivity();selectedOpts.ajax.win=selectedOpts.ajax.success;ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status>0){_error();}},success:function(data,textStatus,XMLHttpRequest){var o=typeof XMLHttpRequest=='object'?XMLHttpRequest:ajaxLoader;if(o.status==200){if(typeof selectedOpts.ajax.win=='function'){ret=selectedOpts.ajax.win(href,data,textStatus,XMLHttpRequest);if(ret===false){loading.hide();return;}else if(typeof ret=='string'||typeof ret=='object'){data=ret;}}
tmp.html(data);_process_inline();}}}));break;case'iframe':_show();break;}},_process_inline=function(){var
w=selectedOpts.width,h=selectedOpts.height;if(w.toString().indexOf('%')>-1){w=parseInt(($(window).width()-(selectedOpts.margin*2))*parseFloat(w)/100,10)+'px';}else{w=w=='auto'?'auto':w+'px';}
if(h.toString().indexOf('%')>-1){h=parseInt(($(window).height()-(selectedOpts.margin*2))*parseFloat(h)/100,10)+'px';}else{h=h=='auto'?'auto':h+'px';}
tmp.wrapInner('<div style="width:'+w+';height:'+h+';overflow: '+(selectedOpts.scrolling=='auto'?'auto':(selectedOpts.scrolling=='yes'?'scroll':'hidden'))+';position:relative;"></div>');selectedOpts.width=tmp.width();selectedOpts.height=tmp.height();_show();},_process_image=function(){selectedOpts.width=imgPreloader.width;selectedOpts.height=imgPreloader.height;$("<img />").attr({'id':'fancybox-img','src':imgPreloader.src,'alt':selectedOpts.title}).appendTo(tmp);_show();},_show=function(){var pos,equal;loading.hide();if(wrap.is(":visible")&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){$.event.trigger('fancybox-cancel');busy=false;return;}
busy=true;$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind('keydown.fb');if(wrap.is(":visible")&&currentOpts.titlePosition!=='outside'){wrap.css('height',wrap.height());}
currentArray=selectedArray;currentIndex=selectedIndex;currentOpts=selectedOpts;if(currentOpts.overlayShow){overlay.css({'background-color':currentOpts.overlayColor,'opacity':currentOpts.overlayOpacity,'cursor':currentOpts.hideOnOverlayClick?'pointer':'auto','height':$(document).height()});if(!overlay.is(':visible')){if(isIE6){$('select:not(#fancybox-tmp select)').filter(function(){return this.style.visibility!=='hidden';}).css({'visibility':'hidden'}).one('fancybox-cleanup',function(){this.style.visibility='inherit';});}
overlay.show();}}else{overlay.hide();}
final_pos=_get_zoom_to();_process_title();if(wrap.is(":visible")){$(close.add(nav_left).add(nav_right)).hide();pos=wrap.position(),start_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};equal=(start_pos.width==final_pos.width&&start_pos.height==final_pos.height);content.fadeTo(currentOpts.changeFade,0.3,function(){var finish_resizing=function(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish);};$.event.trigger('fancybox-change');content.empty().removeAttr('filter').css({'border-width':currentOpts.padding,'width':final_pos.width-currentOpts.padding*2,'height':selectedOpts.autoDimensions?'auto':final_pos.height-titleHeight-currentOpts.padding*2});if(equal){finish_resizing();}else{fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:finish_resizing});}});return;}
wrap.removeAttr("style");content.css('border-width',currentOpts.padding);if(currentOpts.transitionIn=='elastic'){start_pos=_get_zoom_from();content.html(tmp.contents());wrap.show();if(currentOpts.opacity){final_pos.opacity=0;}
fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish});return;}
if(currentOpts.titlePosition=='inside'&&titleHeight>0){title.show();}
content.css({'width':final_pos.width-currentOpts.padding*2,'height':selectedOpts.autoDimensions?'auto':final_pos.height-titleHeight-currentOpts.padding*2}).html(tmp.contents());wrap.css(final_pos).fadeIn(currentOpts.transitionIn=='none'?0:currentOpts.speedIn,_finish);},_format_title=function(title){if(title&&title.length){if(currentOpts.titlePosition=='float'){return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+title+'</td><td id="fancybox-title-float-right"></td></tr></table>';}
return'<div id="fancybox-title-'+currentOpts.titlePosition+'">'+title+'</div>';}
return false;},_process_title=function(){titleStr=currentOpts.title||'';titleHeight=0;title.empty().removeAttr('style').removeClass();if(currentOpts.titleShow===false){title.hide();return;}
titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr);if(!titleStr||titleStr===''){title.hide();return;}
title.addClass('fancybox-title-'+currentOpts.titlePosition).html(titleStr).appendTo('body').show();switch(currentOpts.titlePosition){case'inside':title.css({'width':final_pos.width-(currentOpts.padding*2),'marginLeft':currentOpts.padding,'marginRight':currentOpts.padding});titleHeight=title.outerHeight(true);title.appendTo(outer);final_pos.height+=titleHeight;break;case'over':title.css({'marginLeft':currentOpts.padding,'width':final_pos.width-(currentOpts.padding*2),'bottom':currentOpts.padding}).appendTo(outer);break;case'float':title.css('left',parseInt((title.width()-final_pos.width-40)/2,10)*-1).appendTo(wrap);break;default:title.css({'width':final_pos.width-(currentOpts.padding*2),'paddingLeft':currentOpts.padding,'paddingRight':currentOpts.padding}).appendTo(wrap);break;}
title.hide();},_set_navigation=function(){if(currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav){$(document).bind('keydown.fb',function(e){if(e.keyCode==27&&currentOpts.enableEscapeButton){e.preventDefault();$.fancybox.close();}else if((e.keyCode==37||e.keyCode==39)&&currentOpts.enableKeyboardNav&&e.target.tagName!=='INPUT'&&e.target.tagName!=='TEXTAREA'&&e.target.tagName!=='SELECT'){e.preventDefault();$.fancybox[e.keyCode==37?'prev':'next']();}});}
if(!currentOpts.showNavArrows){nav_left.hide();nav_right.hide();return;}
if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!==0){nav_left.show();}
if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!=(currentArray.length-1)){nav_right.show();}},_finish=function(){if(!$.support.opacity){content.get(0).style.removeAttribute('filter');wrap.get(0).style.removeAttribute('filter');}
if(selectedOpts.autoDimensions){content.css('height','auto');}
wrap.css('height','auto');if(titleStr&&titleStr.length){title.show();}
if(currentOpts.showCloseButton){close.show();}
_set_navigation();if(currentOpts.hideOnContentClick){content.bind('click',$.fancybox.close);}
if(currentOpts.hideOnOverlayClick){overlay.bind('click',$.fancybox.close);}
$(window).bind("resize.fb",$.fancybox.resize);if(currentOpts.centerOnScroll){$(window).bind("scroll.fb",$.fancybox.center);}
if(currentOpts.type=='iframe'){$('<iframe id="fancybox-frame" name="fancybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" '+($.browser.msie?'allowtransparency="true""':'')+' scrolling="'+selectedOpts.scrolling+'" src="'+currentOpts.href+'"></iframe>').appendTo(content);}
wrap.show();busy=false;$.fancybox.center();currentOpts.onComplete(currentArray,currentIndex,currentOpts);_preload_images();},_preload_images=function(){var href,objNext;if((currentArray.length-1)>currentIndex){href=currentArray[currentIndex+1].href;if(typeof href!=='undefined'&&href.match(imgRegExp)){objNext=new Image();objNext.src=href;}}
if(currentIndex>0){href=currentArray[currentIndex-1].href;if(typeof href!=='undefined'&&href.match(imgRegExp)){objNext=new Image();objNext.src=href;}}},_draw=function(pos){var dim={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*pos,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*pos,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*pos,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*pos,10)};if(typeof final_pos.opacity!=='undefined'){dim.opacity=pos<0.5?0.5:pos;}
wrap.css(dim);content.css({'width':dim.width-currentOpts.padding*2,'height':dim.height-(titleHeight*pos)-currentOpts.padding*2});},_get_viewport=function(){return[$(window).width()-(currentOpts.margin*2),$(window).height()-(currentOpts.margin*2),$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin];},_get_zoom_to=function(){var view=_get_viewport(),to={},resize=currentOpts.autoScale,double_padding=currentOpts.padding*2,ratio;if(currentOpts.width.toString().indexOf('%')>-1){to.width=parseInt((view[0]*parseFloat(currentOpts.width))/100,10);}else{to.width=currentOpts.width+double_padding;}
if(currentOpts.height.toString().indexOf('%')>-1){to.height=parseInt((view[1]*parseFloat(currentOpts.height))/100,10);}else{to.height=currentOpts.height+double_padding;}
if(resize&&(to.width>view[0]||to.height>view[1])){if(selectedOpts.type=='image'||selectedOpts.type=='swf'){ratio=(currentOpts.width)/(currentOpts.height);if((to.width)>view[0]){to.width=view[0];to.height=parseInt(((to.width-double_padding)/ratio)+double_padding,10);}
if((to.height)>view[1]){to.height=view[1];to.width=parseInt(((to.height-double_padding)*ratio)+double_padding,10);}}else{to.width=Math.min(to.width,view[0]);to.height=Math.min(to.height,view[1]);}}
to.top=parseInt(Math.max(view[3]-20,view[3]+((view[1]-to.height-40)*0.5)),10);to.left=parseInt(Math.max(view[2]-20,view[2]+((view[0]-to.width-40)*0.5)),10);return to;},_get_obj_pos=function(obj){var pos=obj.offset();pos.top+=parseInt(obj.css('paddingTop'),10)||0;pos.left+=parseInt(obj.css('paddingLeft'),10)||0;pos.top+=parseInt(obj.css('border-top-width'),10)||0;pos.left+=parseInt(obj.css('border-left-width'),10)||0;pos.width=obj.width();pos.height=obj.height();return pos;},_get_zoom_from=function(){var orig=selectedOpts.orig?$(selectedOpts.orig):false,from={},pos,view;if(orig&&orig.length){pos=_get_obj_pos(orig);from={width:pos.width+(currentOpts.padding*2),height:pos.height+(currentOpts.padding*2),top:pos.top-currentOpts.padding-20,left:pos.left-currentOpts.padding-20};}else{view=_get_viewport();from={width:currentOpts.padding*2,height:currentOpts.padding*2,top:parseInt(view[3]+view[1]*0.5,10),left:parseInt(view[2]+view[0]*0.5,10)};}
return from;},_animate_loading=function(){if(!loading.is(':visible')){clearInterval(loadingTimer);return;}
$('div',loading).css('top',(loadingFrame*-40)+'px');loadingFrame=(loadingFrame+1)%12;};$.fn.fancybox=function(options){if(!$(this).length){return this;}
$(this).data('fancybox',$.extend({},options,($.metadata?$(this).metadata():{}))).unbind('click.fb').bind('click.fb',function(e){e.preventDefault();if(busy){return;}
busy=true;$(this).blur();selectedArray=[];selectedIndex=0;var rel=$(this).attr('rel')||'';if(!rel||rel==''||rel==='nofollow'){selectedArray.push(this);}else{selectedArray=$("a[rel="+rel+"], area[rel="+rel+"]");selectedIndex=selectedArray.index(this);}
_start();return;});return this;};$.fancybox=function(obj){var opts;if(busy){return;}
busy=true;opts=typeof arguments[1]!=='undefined'?arguments[1]:{};selectedArray=[];selectedIndex=parseInt(opts.index,10)||0;if($.isArray(obj)){for(var i=0,j=obj.length;i<j;i++){if(typeof obj[i]=='object'){$(obj[i]).data('fancybox',$.extend({},opts,obj[i]));}else{obj[i]=$({}).data('fancybox',$.extend({content:obj[i]},opts));}}
selectedArray=jQuery.merge(selectedArray,obj);}else{if(typeof obj=='object'){$(obj).data('fancybox',$.extend({},opts,obj));}else{obj=$({}).data('fancybox',$.extend({content:obj},opts));}
selectedArray.push(obj);}
if(selectedIndex>selectedArray.length||selectedIndex<0){selectedIndex=0;}
_start();};$.fancybox.showActivity=function(){clearInterval(loadingTimer);loading.show();loadingTimer=setInterval(_animate_loading,66);};$.fancybox.hideActivity=function(){loading.hide();};$.fancybox.next=function(){return $.fancybox.pos(currentIndex+1);};$.fancybox.prev=function(){return $.fancybox.pos(currentIndex-1);};$.fancybox.pos=function(pos){if(busy){return;}
pos=parseInt(pos);selectedArray=currentArray;if(pos>-1&&pos<currentArray.length){selectedIndex=pos;_start();}else if(currentOpts.cyclic&&currentArray.length>1){selectedIndex=pos>=currentArray.length?0:currentArray.length-1;_start();}
return;};$.fancybox.cancel=function(){if(busy){return;}
busy=true;$.event.trigger('fancybox-cancel');_abort();selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts);busy=false;};$.fancybox.close=function(){if(busy||wrap.is(':hidden')){return;}
busy=true;if(currentOpts&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){busy=false;return;}
_abort();$(close.add(nav_left).add(nav_right)).hide();$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind('keydown.fb');content.find('iframe').attr('src',isIE6&&/^https/i.test(window.location.href||'')?'javascript:void(false)':'about:blank');if(currentOpts.titlePosition!=='inside'){title.empty();}
wrap.stop();function _cleanup(){overlay.fadeOut('fast');title.empty().hide();wrap.hide();$.event.trigger('fancybox-cleanup');content.empty();currentOpts.onClosed(currentArray,currentIndex,currentOpts);currentArray=selectedOpts=[];currentIndex=selectedIndex=0;currentOpts=selectedOpts={};busy=false;}
if(currentOpts.transitionOut=='elastic'){start_pos=_get_zoom_from();var pos=wrap.position();final_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};if(currentOpts.opacity){final_pos.opacity=1;}
title.empty().hide();fx.prop=1;$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:_cleanup});}else{wrap.fadeOut(currentOpts.transitionOut=='none'?0:currentOpts.speedOut,_cleanup);}};$.fancybox.resize=function(){if(overlay.is(':visible')){overlay.css('height',$(document).height());}
$.fancybox.center(true);};$.fancybox.center=function(){var view,align;if(busy){return;}
align=arguments[0]===true?1:0;view=_get_viewport();if(!align&&(wrap.width()>view[0]||wrap.height()>view[1])){return;}
wrap.stop().animate({'top':parseInt(Math.max(view[3]-20,view[3]+((view[1]-content.height()-40)*0.5)-currentOpts.padding)),'left':parseInt(Math.max(view[2]-20,view[2]+((view[0]-content.width()-40)*0.5)-currentOpts.padding))},typeof arguments[0]=='number'?arguments[0]:200);};$.fancybox.init=function(){if($("#fancybox-wrap").length){return;}
$('body').append(tmp=$('<div id="fancybox-tmp"></div>'),loading=$('<div id="fancybox-loading"><div></div></div>'),overlay=$('<div id="fancybox-overlay"></div>'),wrap=$('<div id="fancybox-wrap"></div>'));outer=$('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(wrap);outer.append(content=$('<div id="fancybox-content"></div>'),close=$('<a id="fancybox-close"></a>'),title=$('<div id="fancybox-title"></div>'),nav_left=$('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));close.click($.fancybox.close);loading.click($.fancybox.cancel);nav_left.click(function(e){e.preventDefault();$.fancybox.prev();});nav_right.click(function(e){e.preventDefault();$.fancybox.next();});if($.fn.mousewheel){wrap.bind('mousewheel.fb',function(e,delta){if(busy){e.preventDefault();}else if($(e.target).get(0).clientHeight==0||$(e.target).get(0).scrollHeight===$(e.target).get(0).clientHeight){e.preventDefault();$.fancybox[delta>0?'prev':'next']();}});}
if(!$.support.opacity){wrap.addClass('fancybox-ie');}
if(isIE6){loading.addClass('fancybox-ie6');wrap.addClass('fancybox-ie6');$('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||'')?'javascript:void(false)':'about:blank')+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer);}};$.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:'auto',width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:'transparent'},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:'#777',titleShow:true,titlePosition:'float',titleFormat:null,titleFromAlt:false,transitionIn:'fade',transitionOut:'fade',speedIn:300,speedOut:300,changeSpeed:300,changeFade:'fast',easingIn:'swing',easingOut:'swing',showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};$(document).ready(function(){$.fancybox.init();});})(jQuery);(function($,window,document){$.fn.dataTableSettings=[];var _aoSettings=$.fn.dataTableSettings;$.fn.dataTableExt={};var _oExt=$.fn.dataTableExt;_oExt.sVersion="1.7.4";_oExt.sErrMode="alert";_oExt.iApiIndex=0;_oExt.oApi={};_oExt.afnFiltering=[];_oExt.aoFeatures=[];_oExt.ofnSearch={};_oExt.afnSortData=[];_oExt.oStdClasses={"sPagePrevEnabled":"paginate_enabled_previous","sPagePrevDisabled":"paginate_disabled_previous","sPageNextEnabled":"paginate_enabled_next","sPageNextDisabled":"paginate_disabled_next","sPageJUINext":"","sPageJUIPrev":"","sPageButton":"paginate_button","sPageButtonActive":"paginate_active","sPageButtonStaticDisabled":"paginate_button","sPageFirst":"first","sPagePrevious":"previous","sPageNext":"next","sPageLast":"last","sStripOdd":"odd","sStripEven":"even","sRowEmpty":"dataTables_empty","sWrapper":"dataTables_wrapper","sFilter":"dataTables_filter","sInfo":"dataTables_info","sPaging":"dataTables_paginate paging_","sLength":"dataTables_length","sProcessing":"dataTables_processing","sSortAsc":"sorting_asc","sSortDesc":"sorting_desc","sSortable":"sorting","sSortableAsc":"sorting_asc_disabled","sSortableDesc":"sorting_desc_disabled","sSortableNone":"sorting_disabled","sSortColumn":"sorting_","sSortJUIAsc":"","sSortJUIDesc":"","sSortJUI":"","sSortJUIAscAllowed":"","sSortJUIDescAllowed":"","sSortJUIWrapper":"","sScrollWrapper":"dataTables_scroll","sScrollHead":"dataTables_scrollHead","sScrollHeadInner":"dataTables_scrollHeadInner","sScrollBody":"dataTables_scrollBody","sScrollFoot":"dataTables_scrollFoot","sScrollFootInner":"dataTables_scrollFootInner","sFooterTH":""};_oExt.oJUIClasses={"sPagePrevEnabled":"fg-button ui-button ui-state-default ui-corner-left","sPagePrevDisabled":"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled","sPageNextEnabled":"fg-button ui-button ui-state-default ui-corner-right","sPageNextDisabled":"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled","sPageJUINext":"ui-icon ui-icon-circle-arrow-e","sPageJUIPrev":"ui-icon ui-icon-circle-arrow-w","sPageButton":"fg-button ui-button ui-state-default","sPageButtonActive":"fg-button ui-button ui-state-default ui-state-disabled","sPageButtonStaticDisabled":"fg-button ui-button ui-state-default ui-state-disabled","sPageFirst":"first ui-corner-tl ui-corner-bl","sPagePrevious":"previous","sPageNext":"next","sPageLast":"last ui-corner-tr ui-corner-br","sStripOdd":"odd","sStripEven":"even","sRowEmpty":"dataTables_empty","sWrapper":"dataTables_wrapper","sFilter":"dataTables_filter","sInfo":"dataTables_info","sPaging":"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi "+"ui-buttonset-multi paging_","sLength":"dataTables_length","sProcessing":"dataTables_processing","sSortAsc":"ui-state-default","sSortDesc":"ui-state-default","sSortable":"ui-state-default","sSortableAsc":"ui-state-default","sSortableDesc":"ui-state-default","sSortableNone":"ui-state-default","sSortColumn":"sorting_","sSortJUIAsc":"css_right ui-icon ui-icon-triangle-1-n","sSortJUIDesc":"css_right ui-icon ui-icon-triangle-1-s","sSortJUI":"css_right ui-icon ui-icon-carat-2-n-s","sSortJUIAscAllowed":"css_right ui-icon ui-icon-carat-1-n","sSortJUIDescAllowed":"css_right ui-icon ui-icon-carat-1-s","sSortJUIWrapper":"DataTables_sort_wrapper","sScrollWrapper":"dataTables_scroll","sScrollHead":"dataTables_scrollHead ui-state-default","sScrollHeadInner":"dataTables_scrollHeadInner","sScrollBody":"dataTables_scrollBody","sScrollFoot":"dataTables_scrollFoot ui-state-default","sScrollFootInner":"dataTables_scrollFootInner","sFooterTH":"ui-state-default"};_oExt.oPagination={"two_button":{"fnInit":function(oSettings,nPaging,fnCallbackDraw)
{var nPrevious,nNext,nPreviousInner,nNextInner;if(!oSettings.bJUI)
{nPrevious=document.createElement('div');nNext=document.createElement('div');}
else
{nPrevious=document.createElement('a');nNext=document.createElement('a');nNextInner=document.createElement('span');nNextInner.className=oSettings.oClasses.sPageJUINext;nNext.appendChild(nNextInner);nPreviousInner=document.createElement('span');nPreviousInner.className=oSettings.oClasses.sPageJUIPrev;nPrevious.appendChild(nPreviousInner);}
nPrevious.className=oSettings.oClasses.sPagePrevDisabled;nNext.className=oSettings.oClasses.sPageNextDisabled;nPrevious.title=oSettings.oLanguage.oPaginate.sPrevious;nNext.title=oSettings.oLanguage.oPaginate.sNext;nPaging.appendChild(nPrevious);nPaging.appendChild(nNext);$(nPrevious).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"previous"))
{fnCallbackDraw(oSettings);}});$(nNext).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"next"))
{fnCallbackDraw(oSettings);}});$(nPrevious).bind('selectstart',function(){return false;});$(nNext).bind('selectstart',function(){return false;});if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.p=="undefined")
{nPaging.setAttribute('id',oSettings.sTableId+'_paginate');nPrevious.setAttribute('id',oSettings.sTableId+'_previous');nNext.setAttribute('id',oSettings.sTableId+'_next');}},"fnUpdate":function(oSettings,fnCallbackDraw)
{if(!oSettings.aanFeatures.p)
{return;}
var an=oSettings.aanFeatures.p;for(var i=0,iLen=an.length;i<iLen;i++)
{if(an[i].childNodes.length!==0)
{an[i].childNodes[0].className=(oSettings._iDisplayStart===0)?oSettings.oClasses.sPagePrevDisabled:oSettings.oClasses.sPagePrevEnabled;an[i].childNodes[1].className=(oSettings.fnDisplayEnd()==oSettings.fnRecordsDisplay())?oSettings.oClasses.sPageNextDisabled:oSettings.oClasses.sPageNextEnabled;}}}},"iFullNumbersShowPages":5,"full_numbers":{"fnInit":function(oSettings,nPaging,fnCallbackDraw)
{var nFirst=document.createElement('span');var nPrevious=document.createElement('span');var nList=document.createElement('span');var nNext=document.createElement('span');var nLast=document.createElement('span');nFirst.innerHTML=oSettings.oLanguage.oPaginate.sFirst;nPrevious.innerHTML=oSettings.oLanguage.oPaginate.sPrevious;nNext.innerHTML=oSettings.oLanguage.oPaginate.sNext;nLast.innerHTML=oSettings.oLanguage.oPaginate.sLast;var oClasses=oSettings.oClasses;nFirst.className=oClasses.sPageButton+" "+oClasses.sPageFirst;nPrevious.className=oClasses.sPageButton+" "+oClasses.sPagePrevious;nNext.className=oClasses.sPageButton+" "+oClasses.sPageNext;nLast.className=oClasses.sPageButton+" "+oClasses.sPageLast;nPaging.appendChild(nFirst);nPaging.appendChild(nPrevious);nPaging.appendChild(nList);nPaging.appendChild(nNext);nPaging.appendChild(nLast);$(nFirst).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"first"))
{fnCallbackDraw(oSettings);}});$(nPrevious).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"previous"))
{fnCallbackDraw(oSettings);}});$(nNext).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"next"))
{fnCallbackDraw(oSettings);}});$(nLast).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"last"))
{fnCallbackDraw(oSettings);}});$('span',nPaging).bind('mousedown',function(){return false;}).bind('selectstart',function(){return false;});if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.p=="undefined")
{nPaging.setAttribute('id',oSettings.sTableId+'_paginate');nFirst.setAttribute('id',oSettings.sTableId+'_first');nPrevious.setAttribute('id',oSettings.sTableId+'_previous');nNext.setAttribute('id',oSettings.sTableId+'_next');nLast.setAttribute('id',oSettings.sTableId+'_last');}},"fnUpdate":function(oSettings,fnCallbackDraw)
{if(!oSettings.aanFeatures.p)
{return;}
var iPageCount=_oExt.oPagination.iFullNumbersShowPages;var iPageCountHalf=Math.floor(iPageCount/2);var iPages=Math.ceil((oSettings.fnRecordsDisplay())/oSettings._iDisplayLength);var iCurrentPage=Math.ceil(oSettings._iDisplayStart/oSettings._iDisplayLength)+1;var sList="";var iStartButton,iEndButton,i,iLen;var oClasses=oSettings.oClasses;if(iPages<iPageCount)
{iStartButton=1;iEndButton=iPages;}
else
{if(iCurrentPage<=iPageCountHalf)
{iStartButton=1;iEndButton=iPageCount;}
else
{if(iCurrentPage>=(iPages-iPageCountHalf))
{iStartButton=iPages-iPageCount+1;iEndButton=iPages;}
else
{iStartButton=iCurrentPage-Math.ceil(iPageCount/2)+1;iEndButton=iStartButton+iPageCount-1;}}}
for(i=iStartButton;i<=iEndButton;i++)
{if(iCurrentPage!=i)
{sList+='<span class="'+oClasses.sPageButton+'">'+i+'</span>';}
else
{sList+='<span class="'+oClasses.sPageButtonActive+'">'+i+'</span>';}}
var an=oSettings.aanFeatures.p;var anButtons,anStatic,nPaginateList;var fnClick=function(){var iTarget=(this.innerHTML*1)-1;oSettings._iDisplayStart=iTarget*oSettings._iDisplayLength;fnCallbackDraw(oSettings);return false;};var fnFalse=function(){return false;};for(i=0,iLen=an.length;i<iLen;i++)
{if(an[i].childNodes.length===0)
{continue;}
var qjPaginateList=$('span:eq(2)',an[i]);qjPaginateList.html(sList);$('span',qjPaginateList).click(fnClick).bind('mousedown',fnFalse).bind('selectstart',fnFalse);anButtons=an[i].getElementsByTagName('span');anStatic=[anButtons[0],anButtons[1],anButtons[anButtons.length-2],anButtons[anButtons.length-1]];$(anStatic).removeClass(oClasses.sPageButton+" "+oClasses.sPageButtonActive+" "+oClasses.sPageButtonStaticDisabled);if(iCurrentPage==1)
{anStatic[0].className+=" "+oClasses.sPageButtonStaticDisabled;anStatic[1].className+=" "+oClasses.sPageButtonStaticDisabled;}
else
{anStatic[0].className+=" "+oClasses.sPageButton;anStatic[1].className+=" "+oClasses.sPageButton;}
if(iPages===0||iCurrentPage==iPages||oSettings._iDisplayLength==-1)
{anStatic[2].className+=" "+oClasses.sPageButtonStaticDisabled;anStatic[3].className+=" "+oClasses.sPageButtonStaticDisabled;}
else
{anStatic[2].className+=" "+oClasses.sPageButton;anStatic[3].className+=" "+oClasses.sPageButton;}}}}};_oExt.oSort={"string-asc":function(a,b)
{var x=a.toLowerCase();var y=b.toLowerCase();return((x<y)?-1:((x>y)?1:0));},"string-desc":function(a,b)
{var x=a.toLowerCase();var y=b.toLowerCase();return((x<y)?1:((x>y)?-1:0));},"html-asc":function(a,b)
{var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?-1:((x>y)?1:0));},"html-desc":function(a,b)
{var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?1:((x>y)?-1:0));},"date-asc":function(a,b)
{var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x==="")
{x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y==="")
{y=Date.parse("01/01/1970 00:00:00");}
return x-y;},"date-desc":function(a,b)
{var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x==="")
{x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y==="")
{y=Date.parse("01/01/1970 00:00:00");}
return y-x;},"numeric-asc":function(a,b)
{var x=(a=="-"||a==="")?0:a*1;var y=(b=="-"||b==="")?0:b*1;return x-y;},"numeric-desc":function(a,b)
{var x=(a=="-"||a==="")?0:a*1;var y=(b=="-"||b==="")?0:b*1;return y-x;}};_oExt.aTypes=[function(sData)
{if(sData.length===0)
{return'numeric';}
var sValidFirstChars="0123456789-";var sValidChars="0123456789.";var Char;var bDecimal=false;Char=sData.charAt(0);if(sValidFirstChars.indexOf(Char)==-1)
{return null;}
for(var i=1;i<sData.length;i++)
{Char=sData.charAt(i);if(sValidChars.indexOf(Char)==-1)
{return null;}
if(Char==".")
{if(bDecimal)
{return null;}
bDecimal=true;}}
return'numeric';},function(sData)
{var iParse=Date.parse(sData);if((iParse!==null&&!isNaN(iParse))||sData.length===0)
{return'date';}
return null;},function(sData)
{if(sData.indexOf('<')!=-1&&sData.indexOf('>')!=-1)
{return'html';}
return null;}];_oExt.fnVersionCheck=function(sVersion)
{var fnZPad=function(Zpad,count)
{while(Zpad.length<count){Zpad+='0';}
return Zpad;};var aThis=_oExt.sVersion.split('.');var aThat=sVersion.split('.');var sThis='',sThat='';for(var i=0,iLen=aThat.length;i<iLen;i++)
{sThis+=fnZPad(aThis[i],3);sThat+=fnZPad(aThat[i],3);}
return parseInt(sThis,10)>=parseInt(sThat,10);};_oExt._oExternConfig={"iNextUnique":0};$.fn.dataTable=function(oInit)
{function classSettings()
{this.fnRecordsTotal=function()
{if(this.oFeatures.bServerSide){return parseInt(this._iRecordsTotal,10);}else{return this.aiDisplayMaster.length;}};this.fnRecordsDisplay=function()
{if(this.oFeatures.bServerSide){return parseInt(this._iRecordsDisplay,10);}else{return this.aiDisplay.length;}};this.fnDisplayEnd=function()
{if(this.oFeatures.bServerSide){if(this.oFeatures.bPaginate===false||this._iDisplayLength==-1){return this._iDisplayStart+this.aiDisplay.length;}else{return Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay);}}else{return this._iDisplayEnd;}};this.oInstance=null;this.sInstance=null;this.oFeatures={"bPaginate":true,"bLengthChange":true,"bFilter":true,"bSort":true,"bInfo":true,"bAutoWidth":true,"bProcessing":false,"bSortClasses":true,"bStateSave":false,"bServerSide":false};this.oScroll={"sX":"","sXInner":"","sY":"","bCollapse":false,"bInfinite":false,"iLoadGap":100,"iBarWidth":0};this.aanFeatures=[];this.oLanguage={"sProcessing":"Processing...","sLengthMenu":"Show _MENU_ entries","sZeroRecords":"No matching records found","sEmptyTable":"No data available in table","sInfo":"Showing _START_ to _END_ of _TOTAL_ entries","sInfoEmpty":"Showing 0 to 0 of 0 entries","sInfoFiltered":"(filtered from _MAX_ total entries)","sInfoPostFix":"","sSearch":"Search:","sUrl":"","oPaginate":{"sFirst":"First","sPrevious":"Previous","sNext":"Next","sLast":"Last"},"fnInfoCallback":null};this.aoData=[];this.aiDisplay=[];this.aiDisplayMaster=[];this.aoColumns=[];this.iNextId=0;this.asDataSearch=[];this.oPreviousSearch={"sSearch":"","bRegex":false,"bSmart":true};this.aoPreSearchCols=[];this.aaSorting=[[0,'asc',0]];this.aaSortingFixed=null;this.asStripClasses=[];this.asDestoryStrips=[];this.sDestroyWidth=0;this.fnRowCallback=null;this.fnHeaderCallback=null;this.fnFooterCallback=null;this.aoDrawCallback=[];this.fnInitComplete=null;this.sTableId="";this.nTable=null;this.nTHead=null;this.nTFoot=null;this.nTBody=null;this.nTableWrapper=null;this.bInitialised=false;this.aoOpenRows=[];this.sDom='lfrtip';this.sPaginationType="two_button";this.iCookieDuration=60*60*2;this.sCookiePrefix="SpryMedia_DataTables_";this.fnCookieCallback=null;this.aoStateSave=[];this.aoStateLoad=[];this.oLoadedState=null;this.sAjaxSource=null;this.bAjaxDataGet=true;this.fnServerData=function(url,data,callback){$.ajax({"url":url,"data":data,"success":callback,"dataType":"json","cache":false,"error":function(xhr,error,thrown){if(error=="parsererror"){alert("DataTables warning: JSON data from server could not be parsed. "+"This is caused by a JSON formatting error.");}}});};this.fnFormatNumber=function(iIn)
{if(iIn<1000)
{return iIn;}
else
{var s=(iIn+""),a=s.split(""),out="",iLen=s.length;for(var i=0;i<iLen;i++)
{if(i%3===0&&i!==0)
{out=','+out;}
out=a[iLen-i-1]+out;}}
return out;};this.aLengthMenu=[10,25,50,100];this.iDraw=0;this.bDrawing=0;this.iDrawError=-1;this._iDisplayLength=10;this._iDisplayStart=0;this._iDisplayEnd=10;this._iRecordsTotal=0;this._iRecordsDisplay=0;this.bJUI=false;this.oClasses=_oExt.oStdClasses;this.bFiltered=false;this.bSorted=false;this.oInit=null;}
this.oApi={};this.fnDraw=function(bComplete)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof bComplete!='undefined'&&bComplete===false)
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
else
{_fnReDraw(oSettings);}};this.fnFilter=function(sInput,iColumn,bRegex,bSmart,bShowGlobal)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(!oSettings.oFeatures.bFilter)
{return;}
if(typeof bRegex=='undefined')
{bRegex=false;}
if(typeof bSmart=='undefined')
{bSmart=true;}
if(typeof bShowGlobal=='undefined')
{bShowGlobal=true;}
if(typeof iColumn=="undefined"||iColumn===null)
{_fnFilterComplete(oSettings,{"sSearch":sInput,"bRegex":bRegex,"bSmart":bSmart},1);if(bShowGlobal&&typeof oSettings.aanFeatures.f!='undefined')
{var n=oSettings.aanFeatures.f;for(var i=0,iLen=n.length;i<iLen;i++)
{$('input',n[i]).val(sInput);}}}
else
{oSettings.aoPreSearchCols[iColumn].sSearch=sInput;oSettings.aoPreSearchCols[iColumn].bRegex=bRegex;oSettings.aoPreSearchCols[iColumn].bSmart=bSmart;_fnFilterComplete(oSettings,oSettings.oPreviousSearch,1);}};this.fnSettings=function(nNode)
{return _fnSettingsFromNode(this[_oExt.iApiIndex]);};this.fnVersionCheck=_oExt.fnVersionCheck;this.fnSort=function(aaSort)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);oSettings.aaSorting=aaSort;_fnSort(oSettings);};this.fnSortListener=function(nNode,iColumn,fnCallback)
{_fnSortAttachListener(_fnSettingsFromNode(this[_oExt.iApiIndex]),nNode,iColumn,fnCallback);};this.fnAddData=function(mData,bRedraw)
{if(mData.length===0)
{return[];}
var aiReturn=[];var iTest;var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof mData[0]=="object")
{for(var i=0;i<mData.length;i++)
{iTest=_fnAddData(oSettings,mData[i]);if(iTest==-1)
{return aiReturn;}
aiReturn.push(iTest);}}
else
{iTest=_fnAddData(oSettings,mData);if(iTest==-1)
{return aiReturn;}
aiReturn.push(iTest);}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();if(typeof bRedraw=='undefined'||bRedraw)
{_fnReDraw(oSettings);}
return aiReturn;};this.fnDeleteRow=function(mTarget,fnCallBack,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i,iAODataIndex;iAODataIndex=(typeof mTarget=='object')?_fnNodeToDataIndex(oSettings,mTarget):mTarget;var oData=oSettings.aoData.splice(iAODataIndex,1);var iDisplayIndex=$.inArray(iAODataIndex,oSettings.aiDisplay);oSettings.asDataSearch.splice(iDisplayIndex,1);_fnDeleteIndex(oSettings.aiDisplayMaster,iAODataIndex);_fnDeleteIndex(oSettings.aiDisplay,iAODataIndex);if(typeof fnCallBack=="function")
{fnCallBack.call(this,oSettings,oData);}
if(oSettings._iDisplayStart>=oSettings.aiDisplay.length)
{oSettings._iDisplayStart-=oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
return oData;};this.fnClearTable=function(bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);_fnClearTable(oSettings);if(typeof bRedraw=='undefined'||bRedraw)
{_fnDraw(oSettings);}};this.fnOpen=function(nTr,sHtml,sClass)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);this.fnClose(nTr);var nNewRow=document.createElement("tr");var nNewCell=document.createElement("td");nNewRow.appendChild(nNewCell);nNewCell.className=sClass;nNewCell.colSpan=_fnVisbleColumns(oSettings);nNewCell.innerHTML=sHtml;var nTrs=$('tr',oSettings.nTBody);if($.inArray(nTr,nTrs)!=-1)
{$(nNewRow).insertAfter(nTr);}
oSettings.aoOpenRows.push({"nTr":nNewRow,"nParent":nTr});return nNewRow;};this.fnClose=function(nTr)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);for(var i=0;i<oSettings.aoOpenRows.length;i++)
{if(oSettings.aoOpenRows[i].nParent==nTr)
{var nTrParent=oSettings.aoOpenRows[i].nTr.parentNode;if(nTrParent)
{nTrParent.removeChild(oSettings.aoOpenRows[i].nTr);}
oSettings.aoOpenRows.splice(i,1);return 0;}}
return 1;};this.fnGetData=function(mRow)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof mRow!='undefined')
{var iRow=(typeof mRow=='object')?_fnNodeToDataIndex(oSettings,mRow):mRow;return oSettings.aoData[iRow]._aData;}
return _fnGetDataMaster(oSettings);};this.fnGetNodes=function(iRow)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof iRow!='undefined')
{return oSettings.aoData[iRow].nTr;}
return _fnGetTrNodes(oSettings);};this.fnGetPosition=function(nNode)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i;if(nNode.nodeName.toUpperCase()=="TR")
{return _fnNodeToDataIndex(oSettings,nNode);}
else if(nNode.nodeName.toUpperCase()=="TD")
{var iDataIndex=_fnNodeToDataIndex(oSettings,nNode.parentNode);var iCorrector=0;for(var j=0;j<oSettings.aoColumns.length;j++)
{if(oSettings.aoColumns[j].bVisible)
{if(oSettings.aoData[iDataIndex].nTr.getElementsByTagName('td')[j-iCorrector]==nNode)
{return[iDataIndex,j-iCorrector,j];}}
else
{iCorrector++;}}}
return null;};this.fnUpdate=function(mData,mRow,iColumn,bRedraw,bAction)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var iVisibleColumn;var sDisplay;var iRow=(typeof mRow=='object')?_fnNodeToDataIndex(oSettings,mRow):mRow;if(typeof mData!='object')
{sDisplay=mData;oSettings.aoData[iRow]._aData[iColumn]=sDisplay;if(oSettings.aoColumns[iColumn].fnRender!==null)
{sDisplay=oSettings.aoColumns[iColumn].fnRender({"iDataRow":iRow,"iDataColumn":iColumn,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});if(oSettings.aoColumns[iColumn].bUseRendered)
{oSettings.aoData[iRow]._aData[iColumn]=sDisplay;}}
iVisibleColumn=_fnColumnIndexToVisible(oSettings,iColumn);if(iVisibleColumn!==null)
{oSettings.aoData[iRow].nTr.getElementsByTagName('td')[iVisibleColumn].innerHTML=sDisplay;}}
else
{if(mData.length!=oSettings.aoColumns.length)
{_fnLog(oSettings,0,'An array passed to fnUpdate must have the same number of '+'columns as the table in question - in this case '+oSettings.aoColumns.length);return 1;}
for(var i=0;i<mData.length;i++)
{sDisplay=mData[i];oSettings.aoData[iRow]._aData[i]=sDisplay;if(oSettings.aoColumns[i].fnRender!==null)
{sDisplay=oSettings.aoColumns[i].fnRender({"iDataRow":iRow,"iDataColumn":i,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});if(oSettings.aoColumns[i].bUseRendered)
{oSettings.aoData[iRow]._aData[i]=sDisplay;}}
iVisibleColumn=_fnColumnIndexToVisible(oSettings,i);if(iVisibleColumn!==null)
{oSettings.aoData[iRow].nTr.getElementsByTagName('td')[iVisibleColumn].innerHTML=sDisplay;}}}
var iDisplayIndex=$.inArray(iRow,oSettings.aiDisplay);oSettings.asDataSearch[iDisplayIndex]=_fnBuildSearchRow(oSettings,oSettings.aoData[iRow]._aData);if(typeof bAction=='undefined'||bAction)
{_fnAjustColumnSizing(oSettings);}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnReDraw(oSettings);}
return 0;};this.fnSetColumnVis=function(iCol,bShow,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i,iLen;var iColumns=oSettings.aoColumns.length;var nTd,anTds;if(oSettings.aoColumns[iCol].bVisible==bShow)
{return;}
var nTrHead=$('>tr',oSettings.nTHead)[0];var nTrFoot=$('>tr',oSettings.nTFoot)[0];var anTheadTh=[];var anTfootTh=[];for(i=0;i<iColumns;i++)
{anTheadTh.push(oSettings.aoColumns[i].nTh);anTfootTh.push(oSettings.aoColumns[i].nTf);}
if(bShow)
{var iInsert=0;for(i=0;i<iCol;i++)
{if(oSettings.aoColumns[i].bVisible)
{iInsert++;}}
if(iInsert>=_fnVisbleColumns(oSettings))
{nTrHead.appendChild(anTheadTh[iCol]);if(nTrFoot)
{nTrFoot.appendChild(anTfootTh[iCol]);}
for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=oSettings.aoData[i]._anHidden[iCol];oSettings.aoData[i].nTr.appendChild(nTd);}}
else
{var iBefore;for(i=iCol;i<iColumns;i++)
{iBefore=_fnColumnIndexToVisible(oSettings,i);if(iBefore!==null)
{break;}}
nTrHead.insertBefore(anTheadTh[iCol],nTrHead.getElementsByTagName('th')[iBefore]);if(nTrFoot)
{nTrFoot.insertBefore(anTfootTh[iCol],nTrFoot.getElementsByTagName('th')[iBefore]);}
anTds=_fnGetTdNodes(oSettings);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=oSettings.aoData[i]._anHidden[iCol];oSettings.aoData[i].nTr.insertBefore(nTd,$('>td:eq('+iBefore+')',oSettings.aoData[i].nTr)[0]);}}
oSettings.aoColumns[iCol].bVisible=true;}
else
{nTrHead.removeChild(anTheadTh[iCol]);if(nTrFoot)
{nTrFoot.removeChild(anTfootTh[iCol]);}
anTds=_fnGetTdNodes(oSettings);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=anTds[(i*oSettings.aoColumns.length)+(iCol*1)];oSettings.aoData[i]._anHidden[iCol]=nTd;nTd.parentNode.removeChild(nTd);}
oSettings.aoColumns[iCol].bVisible=false;}
for(i=0,iLen=oSettings.aoOpenRows.length;i<iLen;i++)
{oSettings.aoOpenRows[i].nTr.colSpan=_fnVisbleColumns(oSettings);}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnAjustColumnSizing(oSettings);_fnDraw(oSettings);}
_fnSaveState(oSettings);};this.fnPageChange=function(sAction,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);_fnPageChange(oSettings,sAction);_fnCalculateEnd(oSettings);if(typeof bRedraw=='undefined'||bRedraw)
{_fnDraw(oSettings);}};this.fnDestroy=function()
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var nOrig=oSettings.nTableWrapper.parentNode;var nBody=oSettings.nTBody;var i,iLen;oSettings.bDestroying=true;for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{if(oSettings.aoColumns[i].bVisible===false)
{this.fnSetColumnVis(i,true);}}
$('tbody>tr>td.'+oSettings.oClasses.sRowEmpty,oSettings.nTable).parent().remove();if(oSettings.nTable!=oSettings.nTHead.parentNode)
{$('>thead',oSettings.nTable).remove();oSettings.nTable.appendChild(oSettings.nTHead);}
if(oSettings.nTFoot&&oSettings.nTable!=oSettings.nTFoot.parentNode)
{$('>tfoot',oSettings.nTable).remove();oSettings.nTable.appendChild(oSettings.nTFoot);}
oSettings.nTable.parentNode.removeChild(oSettings.nTable);$(oSettings.nTableWrapper).remove();oSettings.aaSorting=[];oSettings.aaSortingFixed=[];_fnSortingClasses(oSettings);$(_fnGetTrNodes(oSettings)).removeClass(oSettings.asStripClasses.join(' '));if(!oSettings.bJUI)
{$('th',oSettings.nTHead).removeClass([_oExt.oStdClasses.sSortable,_oExt.oStdClasses.sSortableAsc,_oExt.oStdClasses.sSortableDesc,_oExt.oStdClasses.sSortableNone].join(' '));}
else
{$('th',oSettings.nTHead).removeClass([_oExt.oStdClasses.sSortable,_oExt.oJUIClasses.sSortableAsc,_oExt.oJUIClasses.sSortableDesc,_oExt.oJUIClasses.sSortableNone].join(' '));$('th span',oSettings.nTHead).remove();}
nOrig.appendChild(oSettings.nTable);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nBody.appendChild(oSettings.aoData[i].nTr);}
oSettings.nTable.style.width=_fnStringToCss(oSettings.sDestroyWidth);$('>tr:even',nBody).addClass(oSettings.asDestoryStrips[0]);$('>tr:odd',nBody).addClass(oSettings.asDestoryStrips[1]);for(i=0,iLen=_aoSettings.length;i<iLen;i++)
{if(_aoSettings[i]==oSettings)
{_aoSettings.splice(i,1);}}
oSettings=null;};this.fnAdjustColumnSizing=function(bRedraw)
{_fnAjustColumnSizing(_fnSettingsFromNode(this[_oExt.iApiIndex]));if(typeof bRedraw=='undefined'||bRedraw)
{this.fnDraw(false);}};function _fnExternApiFunc(sFunc)
{return function(){var aArgs=[_fnSettingsFromNode(this[_oExt.iApiIndex])].concat(Array.prototype.slice.call(arguments));return _oExt.oApi[sFunc].apply(this,aArgs);};}
for(var sFunc in _oExt.oApi)
{if(sFunc)
{this[sFunc]=_fnExternApiFunc(sFunc);}}
function _fnInitalise(oSettings)
{var i,iLen;if(oSettings.bInitialised===false)
{setTimeout(function(){_fnInitalise(oSettings);},200);return;}
_fnAddOptionsHtml(oSettings);_fnDrawHead(oSettings);_fnProcessingDisplay(oSettings,true);if(oSettings.oFeatures.bAutoWidth)
{_fnCalculateColumnWidths(oSettings);}
for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{if(oSettings.aoColumns[i].sWidth!==null)
{oSettings.aoColumns[i].nTh.style.width=_fnStringToCss(oSettings.aoColumns[i].sWidth);}}
if(oSettings.oFeatures.bSort)
{_fnSort(oSettings);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
if(oSettings.sAjaxSource!==null&&!oSettings.oFeatures.bServerSide)
{oSettings.fnServerData.call(oSettings.oInstance,oSettings.sAjaxSource,[],function(json){for(i=0;i<json.aaData.length;i++)
{_fnAddData(oSettings,json.aaData[i]);}
oSettings.iInitDisplayStart=oSettings._iDisplayStart;if(oSettings.oFeatures.bSort)
{_fnSort(oSettings);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
_fnProcessingDisplay(oSettings,false);if(typeof oSettings.fnInitComplete=='function')
{oSettings.fnInitComplete.call(oSettings.oInstance,oSettings,json);}});return;}
if(!oSettings.oFeatures.bServerSide)
{_fnProcessingDisplay(oSettings,false);}}
function _fnLanguageProcess(oSettings,oLanguage,bInit)
{_fnMap(oSettings.oLanguage,oLanguage,'sProcessing');_fnMap(oSettings.oLanguage,oLanguage,'sLengthMenu');_fnMap(oSettings.oLanguage,oLanguage,'sEmptyTable');_fnMap(oSettings.oLanguage,oLanguage,'sZeroRecords');_fnMap(oSettings.oLanguage,oLanguage,'sInfo');_fnMap(oSettings.oLanguage,oLanguage,'sInfoEmpty');_fnMap(oSettings.oLanguage,oLanguage,'sInfoFiltered');_fnMap(oSettings.oLanguage,oLanguage,'sInfoPostFix');_fnMap(oSettings.oLanguage,oLanguage,'sSearch');if(typeof oLanguage.oPaginate!='undefined')
{_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sFirst');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sPrevious');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sNext');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sLast');}
if(typeof oLanguage.sEmptyTable=='undefined'&&typeof oLanguage.sZeroRecords!='undefined')
{_fnMap(oSettings.oLanguage,oLanguage,'sZeroRecords','sEmptyTable');}
if(bInit)
{_fnInitalise(oSettings);}}
function _fnAddColumn(oSettings,nTh)
{oSettings.aoColumns[oSettings.aoColumns.length++]={"sType":null,"_bAutoType":true,"bVisible":true,"bSearchable":true,"bSortable":true,"asSorting":['asc','desc'],"sSortingClass":oSettings.oClasses.sSortable,"sSortingClassJUI":oSettings.oClasses.sSortJUI,"sTitle":nTh?nTh.innerHTML:'',"sName":'',"sWidth":null,"sWidthOrig":null,"sClass":null,"fnRender":null,"bUseRendered":true,"iDataSort":oSettings.aoColumns.length-1,"sSortDataType":'std',"nTh":nTh?nTh:document.createElement('th'),"nTf":null};var iCol=oSettings.aoColumns.length-1;var oCol=oSettings.aoColumns[iCol];if(typeof oSettings.aoPreSearchCols[iCol]=='undefined'||oSettings.aoPreSearchCols[iCol]===null)
{oSettings.aoPreSearchCols[iCol]={"sSearch":"","bRegex":false,"bSmart":true};}
else
{if(typeof oSettings.aoPreSearchCols[iCol].bRegex=='undefined')
{oSettings.aoPreSearchCols[iCol].bRegex=true;}
if(typeof oSettings.aoPreSearchCols[iCol].bSmart=='undefined')
{oSettings.aoPreSearchCols[iCol].bSmart=true;}}
_fnColumnOptions(oSettings,iCol,null);}
function _fnColumnOptions(oSettings,iCol,oOptions)
{var oCol=oSettings.aoColumns[iCol];if(typeof oOptions!='undefined'&&oOptions!==null)
{if(typeof oOptions.sType!='undefined')
{oCol.sType=oOptions.sType;oCol._bAutoType=false;}
_fnMap(oCol,oOptions,"bVisible");_fnMap(oCol,oOptions,"bSearchable");_fnMap(oCol,oOptions,"bSortable");_fnMap(oCol,oOptions,"sTitle");_fnMap(oCol,oOptions,"sName");_fnMap(oCol,oOptions,"sWidth");_fnMap(oCol,oOptions,"sWidth","sWidthOrig");_fnMap(oCol,oOptions,"sClass");_fnMap(oCol,oOptions,"fnRender");_fnMap(oCol,oOptions,"bUseRendered");_fnMap(oCol,oOptions,"iDataSort");_fnMap(oCol,oOptions,"asSorting");_fnMap(oCol,oOptions,"sSortDataType");}
if(!oSettings.oFeatures.bSort)
{oCol.bSortable=false;}
if(!oCol.bSortable||($.inArray('asc',oCol.asSorting)==-1&&$.inArray('desc',oCol.asSorting)==-1))
{oCol.sSortingClass=oSettings.oClasses.sSortableNone;oCol.sSortingClassJUI="";}
else if($.inArray('asc',oCol.asSorting)!=-1&&$.inArray('desc',oCol.asSorting)==-1)
{oCol.sSortingClass=oSettings.oClasses.sSortableAsc;oCol.sSortingClassJUI=oSettings.oClasses.sSortJUIAscAllowed;}
else if($.inArray('asc',oCol.asSorting)==-1&&$.inArray('desc',oCol.asSorting)!=-1)
{oCol.sSortingClass=oSettings.oClasses.sSortableDesc;oCol.sSortingClassJUI=oSettings.oClasses.sSortJUIDescAllowed;}}
function _fnAddData(oSettings,aDataSupplied)
{if(aDataSupplied.length!=oSettings.aoColumns.length&&oSettings.iDrawError!=oSettings.iDraw)
{_fnLog(oSettings,0,"Added data (size "+aDataSupplied.length+") does not match known "+"number of columns ("+oSettings.aoColumns.length+")");oSettings.iDrawError=oSettings.iDraw;return-1;}
var aData=aDataSupplied.slice();var iThisIndex=oSettings.aoData.length;oSettings.aoData.push({"nTr":document.createElement('tr'),"_iId":oSettings.iNextId++,"_aData":aData,"_anHidden":[],"_sRowStripe":''});var nTd,sThisType;for(var i=0;i<aData.length;i++)
{nTd=document.createElement('td');if(aData[i]===null)
{aData[i]='';}
if(typeof oSettings.aoColumns[i].fnRender=='function')
{var sRendered=oSettings.aoColumns[i].fnRender({"iDataRow":iThisIndex,"iDataColumn":i,"aData":aData,"oSettings":oSettings});nTd.innerHTML=sRendered;if(oSettings.aoColumns[i].bUseRendered)
{oSettings.aoData[iThisIndex]._aData[i]=sRendered;}}
else
{nTd.innerHTML=aData[i];}
if(typeof aData[i]!='string')
{aData[i]+="";}
aData[i]=$.trim(aData[i]);if(oSettings.aoColumns[i].sClass!==null)
{nTd.className=oSettings.aoColumns[i].sClass;}
if(oSettings.aoColumns[i]._bAutoType&&oSettings.aoColumns[i].sType!='string')
{sThisType=_fnDetectType(oSettings.aoData[iThisIndex]._aData[i]);if(oSettings.aoColumns[i].sType===null)
{oSettings.aoColumns[i].sType=sThisType;}
else if(oSettings.aoColumns[i].sType!=sThisType)
{oSettings.aoColumns[i].sType='string';}}
if(oSettings.aoColumns[i].bVisible)
{oSettings.aoData[iThisIndex].nTr.appendChild(nTd);oSettings.aoData[iThisIndex]._anHidden[i]=null;}
else
{oSettings.aoData[iThisIndex]._anHidden[i]=nTd;}}
oSettings.aiDisplayMaster.push(iThisIndex);return iThisIndex;}
function _fnGatherData(oSettings)
{var iLoop,i,iLen,j,jLen,jInner,nTds,nTrs,nTd,aLocalData,iThisIndex,iRow,iRows,iColumn,iColumns;if(oSettings.sAjaxSource===null)
{nTrs=oSettings.nTBody.childNodes;for(i=0,iLen=nTrs.length;i<iLen;i++)
{if(nTrs[i].nodeName.toUpperCase()=="TR")
{iThisIndex=oSettings.aoData.length;oSettings.aoData.push({"nTr":nTrs[i],"_iId":oSettings.iNextId++,"_aData":[],"_anHidden":[],"_sRowStripe":''});oSettings.aiDisplayMaster.push(iThisIndex);aLocalData=oSettings.aoData[iThisIndex]._aData;nTds=nTrs[i].childNodes;jInner=0;for(j=0,jLen=nTds.length;j<jLen;j++)
{if(nTds[j].nodeName.toUpperCase()=="TD")
{aLocalData[jInner]=$.trim(nTds[j].innerHTML);jInner++;}}}}}
nTrs=_fnGetTrNodes(oSettings);nTds=[];for(i=0,iLen=nTrs.length;i<iLen;i++)
{for(j=0,jLen=nTrs[i].childNodes.length;j<jLen;j++)
{nTd=nTrs[i].childNodes[j];if(nTd.nodeName.toUpperCase()=="TD")
{nTds.push(nTd);}}}
if(nTds.length!=nTrs.length*oSettings.aoColumns.length)
{_fnLog(oSettings,1,"Unexpected number of TD elements. Expected "+
(nTrs.length*oSettings.aoColumns.length)+" and got "+nTds.length+". DataTables does "+"not support rowspan / colspan in the table body, and there must be one cell for each "+"row/column combination.");}
for(iColumn=0,iColumns=oSettings.aoColumns.length;iColumn<iColumns;iColumn++)
{if(oSettings.aoColumns[iColumn].sTitle===null)
{oSettings.aoColumns[iColumn].sTitle=oSettings.aoColumns[iColumn].nTh.innerHTML;}
var
bAutoType=oSettings.aoColumns[iColumn]._bAutoType,bRender=typeof oSettings.aoColumns[iColumn].fnRender=='function',bClass=oSettings.aoColumns[iColumn].sClass!==null,bVisible=oSettings.aoColumns[iColumn].bVisible,nCell,sThisType,sRendered;if(bAutoType||bRender||bClass||!bVisible)
{for(iRow=0,iRows=oSettings.aoData.length;iRow<iRows;iRow++)
{nCell=nTds[(iRow*iColumns)+iColumn];if(bAutoType)
{if(oSettings.aoColumns[iColumn].sType!='string')
{sThisType=_fnDetectType(oSettings.aoData[iRow]._aData[iColumn]);if(oSettings.aoColumns[iColumn].sType===null)
{oSettings.aoColumns[iColumn].sType=sThisType;}
else if(oSettings.aoColumns[iColumn].sType!=sThisType)
{oSettings.aoColumns[iColumn].sType='string';}}}
if(bRender)
{sRendered=oSettings.aoColumns[iColumn].fnRender({"iDataRow":iRow,"iDataColumn":iColumn,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});nCell.innerHTML=sRendered;if(oSettings.aoColumns[iColumn].bUseRendered)
{oSettings.aoData[iRow]._aData[iColumn]=sRendered;}}
if(bClass)
{nCell.className+=' '+oSettings.aoColumns[iColumn].sClass;}
if(!bVisible)
{oSettings.aoData[iRow]._anHidden[iColumn]=nCell;nCell.parentNode.removeChild(nCell);}
else
{oSettings.aoData[iRow]._anHidden[iColumn]=null;}}}}}
function _fnDrawHead(oSettings)
{var i,nTh,iLen,j,jLen;var iThs=oSettings.nTHead.getElementsByTagName('th').length;var iCorrector=0;if(iThs!==0)
{for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;if(oSettings.aoColumns[i].bVisible)
{if(oSettings.aoColumns[i].sTitle!=nTh.innerHTML)
{nTh.innerHTML=oSettings.aoColumns[i].sTitle;}}
else
{nTh.parentNode.removeChild(nTh);iCorrector++;}}}
else
{var nTr=document.createElement("tr");for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;nTh.innerHTML=oSettings.aoColumns[i].sTitle;if(oSettings.aoColumns[i].bVisible)
{if(oSettings.aoColumns[i].sClass!==null)
{nTh.className=oSettings.aoColumns[i].sClass;}
nTr.appendChild(nTh);}}
$(oSettings.nTHead).html('')[0].appendChild(nTr);}
if(oSettings.bJUI)
{for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;var nDiv=document.createElement('div');nDiv.className=oSettings.oClasses.sSortJUIWrapper;$(nTh).contents().appendTo(nDiv);nDiv.appendChild(document.createElement('span'));nTh.appendChild(nDiv);}}
var fnNoSelect=function(e){this.onselectstart=function(){return false;};return false;};if(oSettings.oFeatures.bSort)
{for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bSortable!==false)
{_fnSortAttachListener(oSettings,oSettings.aoColumns[i].nTh,i);$(oSettings.aoColumns[i].nTh).mousedown(fnNoSelect);}
else
{$(oSettings.aoColumns[i].nTh).addClass(oSettings.oClasses.sSortableNone);}}}
if(oSettings.nTFoot!==null)
{iCorrector=0;var nTfs=oSettings.nTFoot.getElementsByTagName('th');for(i=0,iLen=nTfs.length;i<iLen;i++)
{if(typeof oSettings.aoColumns[i]!='undefined')
{oSettings.aoColumns[i].nTf=nTfs[i-iCorrector];if(oSettings.oClasses.sFooterTH!=="")
{oSettings.aoColumns[i].nTf.className+=" "+oSettings.oClasses.sFooterTH;}
if(!oSettings.aoColumns[i].bVisible)
{nTfs[i-iCorrector].parentNode.removeChild(nTfs[i-iCorrector]);iCorrector++;}}}}}
function _fnDraw(oSettings)
{var i,iLen;var anRows=[];var iRowCount=0;var bRowError=false;var iStrips=oSettings.asStripClasses.length;var iOpenRows=oSettings.aoOpenRows.length;oSettings.bDrawing=true;if(typeof oSettings.iInitDisplayStart!='undefined'&&oSettings.iInitDisplayStart!=-1)
{if(oSettings.oFeatures.bServerSide)
{oSettings._iDisplayStart=oSettings.iInitDisplayStart;}
else
{oSettings._iDisplayStart=(oSettings.iInitDisplayStart>=oSettings.fnRecordsDisplay())?0:oSettings.iInitDisplayStart;}
oSettings.iInitDisplayStart=-1;_fnCalculateEnd(oSettings);}
if(oSettings.oFeatures.bServerSide&&!_fnAjaxUpdate(oSettings))
{return;}
else if(!oSettings.oFeatures.bServerSide)
{oSettings.iDraw++;}
if(oSettings.aiDisplay.length!==0)
{var iStart=oSettings._iDisplayStart;var iEnd=oSettings._iDisplayEnd;if(oSettings.oFeatures.bServerSide)
{iStart=0;iEnd=oSettings.aoData.length;}
for(var j=iStart;j<iEnd;j++)
{var aoData=oSettings.aoData[oSettings.aiDisplay[j]];var nRow=aoData.nTr;if(iStrips!==0)
{var sStrip=oSettings.asStripClasses[iRowCount%iStrips];if(aoData._sRowStripe!=sStrip)
{$(nRow).removeClass(aoData._sRowStripe).addClass(sStrip);aoData._sRowStripe=sStrip;}}
if(typeof oSettings.fnRowCallback=="function")
{nRow=oSettings.fnRowCallback.call(oSettings.oInstance,nRow,oSettings.aoData[oSettings.aiDisplay[j]]._aData,iRowCount,j);if(!nRow&&!bRowError)
{_fnLog(oSettings,0,"A node was not returned by fnRowCallback");bRowError=true;}}
anRows.push(nRow);iRowCount++;if(iOpenRows!==0)
{for(var k=0;k<iOpenRows;k++)
{if(nRow==oSettings.aoOpenRows[k].nParent)
{anRows.push(oSettings.aoOpenRows[k].nTr);}}}}}
else
{anRows[0]=document.createElement('tr');if(typeof oSettings.asStripClasses[0]!='undefined')
{anRows[0].className=oSettings.asStripClasses[0];}
var nTd=document.createElement('td');nTd.setAttribute('valign',"top");nTd.colSpan=_fnVisbleColumns(oSettings);nTd.className=oSettings.oClasses.sRowEmpty;if(typeof oSettings.oLanguage.sEmptyTable!='undefined'&&oSettings.fnRecordsTotal()===0)
{nTd.innerHTML=oSettings.oLanguage.sEmptyTable;}
else
{nTd.innerHTML=oSettings.oLanguage.sZeroRecords.replace('_MAX_',oSettings.fnFormatNumber(oSettings.fnRecordsTotal()));}
anRows[iRowCount].appendChild(nTd);}
if(typeof oSettings.fnHeaderCallback=='function')
{oSettings.fnHeaderCallback.call(oSettings.oInstance,$('>tr',oSettings.nTHead)[0],_fnGetDataMaster(oSettings),oSettings._iDisplayStart,oSettings.fnDisplayEnd(),oSettings.aiDisplay);}
if(typeof oSettings.fnFooterCallback=='function')
{oSettings.fnFooterCallback.call(oSettings.oInstance,$('>tr',oSettings.nTFoot)[0],_fnGetDataMaster(oSettings),oSettings._iDisplayStart,oSettings.fnDisplayEnd(),oSettings.aiDisplay);}
var
nAddFrag=document.createDocumentFragment(),nRemoveFrag=document.createDocumentFragment(),nBodyPar,nTrs;if(oSettings.nTBody)
{nBodyPar=oSettings.nTBody.parentNode;nRemoveFrag.appendChild(oSettings.nTBody);if(!oSettings.oScroll.bInfinite||!oSettings._bInitComplete||oSettings.bSorted||oSettings.bFiltered)
{nTrs=oSettings.nTBody.childNodes;for(i=nTrs.length-1;i>=0;i--)
{nTrs[i].parentNode.removeChild(nTrs[i]);}}
for(i=0,iLen=anRows.length;i<iLen;i++)
{nAddFrag.appendChild(anRows[i]);}
oSettings.nTBody.appendChild(nAddFrag);if(nBodyPar!==null)
{nBodyPar.appendChild(oSettings.nTBody);}}
for(i=0,iLen=oSettings.aoDrawCallback.length;i<iLen;i++)
{oSettings.aoDrawCallback[i].fn.call(oSettings.oInstance,oSettings);}
oSettings.bSorted=false;oSettings.bFiltered=false;oSettings.bDrawing=false;if(typeof oSettings._bInitComplete=="undefined")
{oSettings._bInitComplete=true;if(typeof oSettings.fnInitComplete=='function'&&(oSettings.oFeatures.bServerSide||oSettings.sAjaxSource===null))
{oSettings.fnInitComplete.call(oSettings.oInstance,oSettings);}}}
function _fnReDraw(oSettings)
{if(oSettings.oFeatures.bSort)
{_fnSort(oSettings,oSettings.oPreviousSearch);}
else if(oSettings.oFeatures.bFilter)
{_fnFilterComplete(oSettings,oSettings.oPreviousSearch);}
else
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}
function _fnAjaxUpdate(oSettings)
{if(oSettings.bAjaxDataGet)
{_fnProcessingDisplay(oSettings,true);var iColumns=oSettings.aoColumns.length;var aoData=[];var i;oSettings.iDraw++;aoData.push({"name":"sEcho","value":oSettings.iDraw});aoData.push({"name":"iColumns","value":iColumns});aoData.push({"name":"sColumns","value":_fnColumnOrdering(oSettings)});aoData.push({"name":"iDisplayStart","value":oSettings._iDisplayStart});aoData.push({"name":"iDisplayLength","value":oSettings.oFeatures.bPaginate!==false?oSettings._iDisplayLength:-1});var aNames=[];for(i=0;i<iColumns;i++)
{aNames.push(oSettings.aoColumns[i].sName);}
aoData.push({"name":"sNames","value":aNames.join(',')});if(oSettings.oFeatures.bFilter!==false)
{aoData.push({"name":"sSearch","value":oSettings.oPreviousSearch.sSearch});aoData.push({"name":"bRegex","value":oSettings.oPreviousSearch.bRegex});for(i=0;i<iColumns;i++)
{aoData.push({"name":"sSearch_"+i,"value":oSettings.aoPreSearchCols[i].sSearch});aoData.push({"name":"bRegex_"+i,"value":oSettings.aoPreSearchCols[i].bRegex});aoData.push({"name":"bSearchable_"+i,"value":oSettings.aoColumns[i].bSearchable});}}
if(oSettings.oFeatures.bSort!==false)
{var iFixed=oSettings.aaSortingFixed!==null?oSettings.aaSortingFixed.length:0;var iUser=oSettings.aaSorting.length;aoData.push({"name":"iSortingCols","value":iFixed+iUser});for(i=0;i<iFixed;i++)
{aoData.push({"name":"iSortCol_"+i,"value":oSettings.aaSortingFixed[i][0]});aoData.push({"name":"sSortDir_"+i,"value":oSettings.aaSortingFixed[i][1]});}
for(i=0;i<iUser;i++)
{aoData.push({"name":"iSortCol_"+(i+iFixed),"value":oSettings.aaSorting[i][0]});aoData.push({"name":"sSortDir_"+(i+iFixed),"value":oSettings.aaSorting[i][1]});}
for(i=0;i<iColumns;i++)
{aoData.push({"name":"bSortable_"+i,"value":oSettings.aoColumns[i].bSortable});}}
oSettings.fnServerData.call(oSettings.oInstance,oSettings.sAjaxSource,aoData,function(json){_fnAjaxUpdateDraw(oSettings,json);});return false;}
else
{return true;}}
function _fnAjaxUpdateDraw(oSettings,json)
{if(typeof json.sEcho!='undefined')
{if(json.sEcho*1<oSettings.iDraw)
{return;}
else
{oSettings.iDraw=json.sEcho*1;}}
if(!oSettings.oScroll.bInfinite||(oSettings.oScroll.bInfinite&&(oSettings.bSorted||oSettings.bFiltered)))
{_fnClearTable(oSettings);}
oSettings._iRecordsTotal=json.iTotalRecords;oSettings._iRecordsDisplay=json.iTotalDisplayRecords;var sOrdering=_fnColumnOrdering(oSettings);var bReOrder=(typeof json.sColumns!='undefined'&&sOrdering!==""&&json.sColumns!=sOrdering);if(bReOrder)
{var aiIndex=_fnReOrderIndex(oSettings,json.sColumns);}
for(var i=0,iLen=json.aaData.length;i<iLen;i++)
{if(bReOrder)
{var aData=[];for(var j=0,jLen=oSettings.aoColumns.length;j<jLen;j++)
{aData.push(json.aaData[i][aiIndex[j]]);}
_fnAddData(oSettings,aData);}
else
{_fnAddData(oSettings,json.aaData[i]);}}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bAjaxDataGet=false;_fnDraw(oSettings);oSettings.bAjaxDataGet=true;_fnProcessingDisplay(oSettings,false);}
function _fnAddOptionsHtml(oSettings)
{var nHolding=document.createElement('div');oSettings.nTable.parentNode.insertBefore(nHolding,oSettings.nTable);oSettings.nTableWrapper=document.createElement('div');oSettings.nTableWrapper.className=oSettings.oClasses.sWrapper;if(oSettings.sTableId!=='')
{oSettings.nTableWrapper.setAttribute('id',oSettings.sTableId+'_wrapper');}
var nInsertNode=oSettings.nTableWrapper;var aDom=oSettings.sDom.split('');var nTmp,iPushFeature,cOption,nNewNode,cNext,sAttr,j;for(var i=0;i<aDom.length;i++)
{iPushFeature=0;cOption=aDom[i];if(cOption=='<')
{nNewNode=document.createElement('div');cNext=aDom[i+1];if(cNext=="'"||cNext=='"')
{sAttr="";j=2;while(aDom[i+j]!=cNext)
{sAttr+=aDom[i+j];j++;}
if(sAttr=="H")
{sAttr="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix";}
else if(sAttr=="F")
{sAttr="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix";}
if(sAttr.indexOf('.')!=-1)
{var aSplit=sAttr.split('.');nNewNode.setAttribute('id',aSplit[0].substr(1,aSplit[0].length-1));nNewNode.className=aSplit[1];}
else if(sAttr.charAt(0)=="#")
{nNewNode.setAttribute('id',sAttr.substr(1,sAttr.length-1));}
else
{nNewNode.className=sAttr;}
i+=j;}
nInsertNode.appendChild(nNewNode);nInsertNode=nNewNode;}
else if(cOption=='>')
{nInsertNode=nInsertNode.parentNode;}
else if(cOption=='l'&&oSettings.oFeatures.bPaginate&&oSettings.oFeatures.bLengthChange)
{nTmp=_fnFeatureHtmlLength(oSettings);iPushFeature=1;}
else if(cOption=='f'&&oSettings.oFeatures.bFilter)
{nTmp=_fnFeatureHtmlFilter(oSettings);iPushFeature=1;}
else if(cOption=='r'&&oSettings.oFeatures.bProcessing)
{nTmp=_fnFeatureHtmlProcessing(oSettings);iPushFeature=1;}
else if(cOption=='t')
{nTmp=_fnFeatureHtmlTable(oSettings);iPushFeature=1;}
else if(cOption=='i'&&oSettings.oFeatures.bInfo)
{nTmp=_fnFeatureHtmlInfo(oSettings);iPushFeature=1;}
else if(cOption=='p'&&oSettings.oFeatures.bPaginate)
{nTmp=_fnFeatureHtmlPaginate(oSettings);iPushFeature=1;}
else if(_oExt.aoFeatures.length!==0)
{var aoFeatures=_oExt.aoFeatures;for(var k=0,kLen=aoFeatures.length;k<kLen;k++)
{if(cOption==aoFeatures[k].cFeature)
{nTmp=aoFeatures[k].fnInit(oSettings);if(nTmp)
{iPushFeature=1;}
break;}}}
if(iPushFeature==1&&nTmp!==null)
{if(typeof oSettings.aanFeatures[cOption]!='object')
{oSettings.aanFeatures[cOption]=[];}
oSettings.aanFeatures[cOption].push(nTmp);nInsertNode.appendChild(nTmp);}}
nHolding.parentNode.replaceChild(oSettings.nTableWrapper,nHolding);}
function _fnFeatureHtmlTable(oSettings)
{if(oSettings.oScroll.sX===""&&oSettings.oScroll.sY==="")
{return oSettings.nTable;}
var
nScroller=document.createElement('div'),nScrollHead=document.createElement('div'),nScrollHeadInner=document.createElement('div'),nScrollBody=document.createElement('div'),nScrollFoot=document.createElement('div'),nScrollFootInner=document.createElement('div'),nScrollHeadTable=oSettings.nTable.cloneNode(false),nScrollFootTable=oSettings.nTable.cloneNode(false),nThead=oSettings.nTable.getElementsByTagName('thead')[0],nTfoot=oSettings.nTable.getElementsByTagName('tfoot').length===0?null:oSettings.nTable.getElementsByTagName('tfoot')[0],oClasses=(typeof oInit.bJQueryUI!='undefined'&&oInit.bJQueryUI)?_oExt.oJUIClasses:_oExt.oStdClasses;nScrollHead.appendChild(nScrollHeadInner);nScrollFoot.appendChild(nScrollFootInner);nScrollBody.appendChild(oSettings.nTable);nScroller.appendChild(nScrollHead);nScroller.appendChild(nScrollBody);nScrollHeadInner.appendChild(nScrollHeadTable);nScrollHeadTable.appendChild(nThead);if(nTfoot!==null)
{nScroller.appendChild(nScrollFoot);nScrollFootInner.appendChild(nScrollFootTable);nScrollFootTable.appendChild(nTfoot);}
nScroller.className=oClasses.sScrollWrapper;nScrollHead.className=oClasses.sScrollHead;nScrollHeadInner.className=oClasses.sScrollHeadInner;nScrollBody.className=oClasses.sScrollBody;nScrollFoot.className=oClasses.sScrollFoot;nScrollFootInner.className=oClasses.sScrollFootInner;nScrollHead.style.overflow="hidden";nScrollHead.style.position="relative";nScrollFoot.style.overflow="hidden";nScrollBody.style.overflow="auto";nScrollHead.style.border="0";nScrollFoot.style.border="0";nScrollHeadInner.style.width="150%";nScrollHeadTable.removeAttribute('id');nScrollHeadTable.style.marginLeft="0";oSettings.nTable.style.marginLeft="0";if(nTfoot!==null)
{nScrollFootTable.removeAttribute('id');nScrollFootTable.style.marginLeft="0";}
var nCaptions=$('>caption',oSettings.nTable);for(var i=0,iLen=nCaptions.length;i<iLen;i++)
{nScrollHeadTable.appendChild(nCaptions[i]);}
if(oSettings.oScroll.sX!=="")
{nScrollHead.style.width=_fnStringToCss(oSettings.oScroll.sX);nScrollBody.style.width=_fnStringToCss(oSettings.oScroll.sX);if(nTfoot!==null)
{nScrollFoot.style.width=_fnStringToCss(oSettings.oScroll.sX);}
$(nScrollBody).scroll(function(e){nScrollHead.scrollLeft=this.scrollLeft;if(nTfoot!==null)
{nScrollFoot.scrollLeft=this.scrollLeft;}});}
if(oSettings.oScroll.sY!=="")
{nScrollBody.style.height=_fnStringToCss(oSettings.oScroll.sY);}
oSettings.aoDrawCallback.push({"fn":_fnScrollDraw,"sName":"scrolling"});if(oSettings.oScroll.bInfinite)
{$(nScrollBody).scroll(function(){if(!oSettings.bDrawing)
{if($(this).scrollTop()+$(this).height()>$(oSettings.nTable).height()-oSettings.oScroll.iLoadGap)
{if(oSettings.fnDisplayEnd()<oSettings.fnRecordsDisplay())
{_fnPageChange(oSettings,'next');_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}}});}
oSettings.nScrollHead=nScrollHead;oSettings.nScrollFoot=nScrollFoot;return nScroller;}
function _fnScrollDraw(o)
{var
nScrollHeadInner=o.nScrollHead.getElementsByTagName('div')[0],nScrollHeadTable=nScrollHeadInner.getElementsByTagName('table')[0],nScrollBody=o.nTable.parentNode,i,iLen,j,jLen,anHeadToSize,anHeadSizers,anFootSizers,anFootToSize,oStyle,iVis,iWidth,aApplied=[],iSanityWidth;var nTheadSize=o.nTable.getElementsByTagName('thead');if(nTheadSize.length>0)
{o.nTable.removeChild(nTheadSize[0]);}
if(o.nTFoot!==null)
{var nTfootSize=o.nTable.getElementsByTagName('tfoot');if(nTfootSize.length>0)
{o.nTable.removeChild(nTfootSize[0]);}}
nTheadSize=o.nTHead.cloneNode(true);o.nTable.insertBefore(nTheadSize,o.nTable.childNodes[0]);if(o.nTFoot!==null)
{nTfootSize=o.nTFoot.cloneNode(true);o.nTable.insertBefore(nTfootSize,o.nTable.childNodes[1]);}
var nThs=_fnGetUniqueThs(nTheadSize);for(i=0,iLen=nThs.length;i<iLen;i++)
{iVis=_fnVisibleToColumnIndex(o,i);nThs[i].style.width=o.aoColumns[iVis].sWidth;}
if(o.nTFoot!==null)
{_fnApplyToChildren(function(n){n.style.width="";},nTfootSize.getElementsByTagName('tr'));}
iSanityWidth=$(o.nTable).outerWidth();if(o.oScroll.sX==="")
{o.nTable.style.width="100%";if($.browser.msie&&$.browser.version<=7)
{o.nTable.style.width=_fnStringToCss($(o.nTable).outerWidth()-o.oScroll.iBarWidth);}}
else
{if(o.oScroll.sXInner!=="")
{o.nTable.style.width=_fnStringToCss(o.oScroll.sXInner);}
else if(iSanityWidth==$(nScrollBody).width()&&$(nScrollBody).height()<$(o.nTable).height())
{o.nTable.style.width=_fnStringToCss(iSanityWidth-o.oScroll.iBarWidth);if($(o.nTable).outerWidth()>iSanityWidth-o.oScroll.iBarWidth)
{o.nTable.style.width=_fnStringToCss(iSanityWidth);}}
else
{o.nTable.style.width=_fnStringToCss(iSanityWidth);}}
iSanityWidth=$(o.nTable).outerWidth();anHeadToSize=o.nTHead.getElementsByTagName('tr');anHeadSizers=nTheadSize.getElementsByTagName('tr');_fnApplyToChildren(function(nSizer,nToSize){oStyle=nSizer.style;oStyle.paddingTop="0";oStyle.paddingBottom="0";oStyle.borderTopWidth="0";oStyle.borderBottomWidth="0";oStyle.height=0;iWidth=$(nSizer).width();nToSize.style.width=_fnStringToCss(iWidth);aApplied.push(iWidth);},anHeadSizers,anHeadToSize);$(anHeadSizers).height(0);if(o.nTFoot!==null)
{anFootSizers=nTfootSize.getElementsByTagName('tr');anFootToSize=o.nTFoot.getElementsByTagName('tr');_fnApplyToChildren(function(nSizer,nToSize){oStyle=nSizer.style;oStyle.paddingTop="0";oStyle.paddingBottom="0";oStyle.borderTopWidth="0";oStyle.borderBottomWidth="0";iWidth=$(nSizer).width();nToSize.style.width=_fnStringToCss(iWidth);aApplied.push(iWidth);},anFootSizers,anFootToSize);$(anFootSizers).height(0);}
_fnApplyToChildren(function(nSizer){nSizer.innerHTML="";nSizer.style.width=_fnStringToCss(aApplied.shift());},anHeadSizers);if(o.nTFoot!==null)
{_fnApplyToChildren(function(nSizer){nSizer.innerHTML="";nSizer.style.width=_fnStringToCss(aApplied.shift());},anFootSizers);}
if($(o.nTable).outerWidth()<iSanityWidth)
{if(o.oScroll.sX==="")
{_fnLog(o,1,"The table cannot fit into the current element which will cause column"+" misalignment. It is suggested that you enable x-scrolling or increase the width"+" the table has in which to be drawn");}
else if(o.oScroll.sXInner!=="")
{_fnLog(o,1,"The table cannot fit into the current element which will cause column"+" misalignment. It is suggested that you increase the sScrollXInner property to"+" allow it to draw in a larger area, or simply remove that parameter to allow"+" automatic calculation");}}
if(o.oScroll.sY==="")
{if($.browser.msie&&$.browser.version<=7)
{nScrollBody.style.height=_fnStringToCss(o.nTable.offsetHeight+o.oScroll.iBarWidth);}}
if(o.oScroll.sY!==""&&o.oScroll.bCollapse)
{nScrollBody.style.height=_fnStringToCss(o.oScroll.sY);var iExtra=(o.oScroll.sX!==""&&o.nTable.offsetWidth>nScrollBody.offsetWidth)?o.oScroll.iBarWidth:0;if(o.nTable.offsetHeight<nScrollBody.offsetHeight)
{nScrollBody.style.height=_fnStringToCss($(o.nTable).height()+iExtra);}}
var iOuterWidth=$(o.nTable).outerWidth();nScrollHeadTable.style.width=_fnStringToCss(iOuterWidth);nScrollHeadInner.style.width=_fnStringToCss(iOuterWidth+o.oScroll.iBarWidth);nScrollHeadInner.parentNode.style.width=_fnStringToCss($(nScrollBody).width());if(o.nTFoot!==null)
{var
nScrollFootInner=o.nScrollFoot.getElementsByTagName('div')[0],nScrollFootTable=nScrollFootInner.getElementsByTagName('table')[0];nScrollFootInner.style.width=_fnStringToCss(o.nTable.offsetWidth+o.oScroll.iBarWidth);nScrollFootTable.style.width=_fnStringToCss(o.nTable.offsetWidth);}
if(o.bSorted||o.bFiltered)
{nScrollBody.scrollTop=0;}}
function _fnAjustColumnSizing(oSettings)
{if(oSettings.oFeatures.bAutoWidth===false)
{return false;}
_fnCalculateColumnWidths(oSettings);for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{oSettings.aoColumns[i].nTh.style.width=oSettings.aoColumns[i].sWidth;}}
function _fnFeatureHtmlFilter(oSettings)
{var nFilter=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.f=="undefined")
{nFilter.setAttribute('id',oSettings.sTableId+'_filter');}
nFilter.className=oSettings.oClasses.sFilter;var sSpace=oSettings.oLanguage.sSearch===""?"":" ";nFilter.innerHTML=oSettings.oLanguage.sSearch+sSpace+'<input type="text" />';var jqFilter=$("input",nFilter);jqFilter.val(oSettings.oPreviousSearch.sSearch.replace('"','&quot;'));jqFilter.keyup(function(e){var n=oSettings.aanFeatures.f;for(var i=0,iLen=n.length;i<iLen;i++)
{if(n[i]!=this.parentNode)
{$('input',n[i]).val(this.value);}}
if(this.value!=oSettings.oPreviousSearch.sSearch)
{_fnFilterComplete(oSettings,{"sSearch":this.value,"bRegex":oSettings.oPreviousSearch.bRegex,"bSmart":oSettings.oPreviousSearch.bSmart});}});jqFilter.keypress(function(e){if(e.keyCode==13)
{return false;}});return nFilter;}
function _fnFilterComplete(oSettings,oInput,iForce)
{_fnFilter(oSettings,oInput.sSearch,iForce,oInput.bRegex,oInput.bSmart);for(var i=0;i<oSettings.aoPreSearchCols.length;i++)
{_fnFilterColumn(oSettings,oSettings.aoPreSearchCols[i].sSearch,i,oSettings.aoPreSearchCols[i].bRegex,oSettings.aoPreSearchCols[i].bSmart);}
if(_oExt.afnFiltering.length!==0)
{_fnFilterCustom(oSettings);}
oSettings.bFiltered=true;oSettings._iDisplayStart=0;_fnCalculateEnd(oSettings);_fnDraw(oSettings);_fnBuildSearchArray(oSettings,0);}
function _fnFilterCustom(oSettings)
{var afnFilters=_oExt.afnFiltering;for(var i=0,iLen=afnFilters.length;i<iLen;i++)
{var iCorrector=0;for(var j=0,jLen=oSettings.aiDisplay.length;j<jLen;j++)
{var iDisIndex=oSettings.aiDisplay[j-iCorrector];if(!afnFilters[i](oSettings,oSettings.aoData[iDisIndex]._aData,iDisIndex))
{oSettings.aiDisplay.splice(j-iCorrector,1);iCorrector++;}}}}
function _fnFilterColumn(oSettings,sInput,iColumn,bRegex,bSmart)
{if(sInput==="")
{return;}
var iIndexCorrector=0;var rpSearch=_fnFilterCreateSearch(sInput,bRegex,bSmart);for(var i=oSettings.aiDisplay.length-1;i>=0;i--)
{var sData=_fnDataToSearch(oSettings.aoData[oSettings.aiDisplay[i]]._aData[iColumn],oSettings.aoColumns[iColumn].sType);if(!rpSearch.test(sData))
{oSettings.aiDisplay.splice(i,1);iIndexCorrector++;}}}
function _fnFilter(oSettings,sInput,iForce,bRegex,bSmart)
{var i;var rpSearch=_fnFilterCreateSearch(sInput,bRegex,bSmart);if(typeof iForce=='undefined'||iForce===null)
{iForce=0;}
if(_oExt.afnFiltering.length!==0)
{iForce=1;}
if(sInput.length<=0)
{oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();}
else
{if(oSettings.aiDisplay.length==oSettings.aiDisplayMaster.length||oSettings.oPreviousSearch.sSearch.length>sInput.length||iForce==1||sInput.indexOf(oSettings.oPreviousSearch.sSearch)!==0)
{oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);_fnBuildSearchArray(oSettings,1);for(i=0;i<oSettings.aiDisplayMaster.length;i++)
{if(rpSearch.test(oSettings.asDataSearch[i]))
{oSettings.aiDisplay.push(oSettings.aiDisplayMaster[i]);}}}
else
{var iIndexCorrector=0;for(i=0;i<oSettings.asDataSearch.length;i++)
{if(!rpSearch.test(oSettings.asDataSearch[i]))
{oSettings.aiDisplay.splice(i-iIndexCorrector,1);iIndexCorrector++;}}}}
oSettings.oPreviousSearch.sSearch=sInput;oSettings.oPreviousSearch.bRegex=bRegex;oSettings.oPreviousSearch.bSmart=bSmart;}
function _fnBuildSearchArray(oSettings,iMaster)
{oSettings.asDataSearch.splice(0,oSettings.asDataSearch.length);var aArray=(typeof iMaster!='undefined'&&iMaster==1)?oSettings.aiDisplayMaster:oSettings.aiDisplay;for(var i=0,iLen=aArray.length;i<iLen;i++)
{oSettings.asDataSearch[i]=_fnBuildSearchRow(oSettings,oSettings.aoData[aArray[i]]._aData);}}
function _fnBuildSearchRow(oSettings,aData)
{var sSearch='';var nTmp=document.createElement('div');for(var j=0,jLen=oSettings.aoColumns.length;j<jLen;j++)
{if(oSettings.aoColumns[j].bSearchable)
{var sData=aData[j];sSearch+=_fnDataToSearch(sData,oSettings.aoColumns[j].sType)+'  ';}}
if(sSearch.indexOf('&')!==-1)
{nTmp.innerHTML=sSearch;sSearch=nTmp.textContent?nTmp.textContent:nTmp.innerText;sSearch=sSearch.replace(/\n/g," ").replace(/\r/g,"");}
return sSearch;}
function _fnFilterCreateSearch(sSearch,bRegex,bSmart)
{var asSearch,sRegExpString;if(bSmart)
{asSearch=bRegex?sSearch.split(' '):_fnEscapeRegex(sSearch).split(' ');sRegExpString='^(?=.*?'+asSearch.join(')(?=.*?')+').*$';return new RegExp(sRegExpString,"i");}
else
{sSearch=bRegex?sSearch:_fnEscapeRegex(sSearch);return new RegExp(sSearch,"i");}}
function _fnDataToSearch(sData,sType)
{if(typeof _oExt.ofnSearch[sType]=="function")
{return _oExt.ofnSearch[sType](sData);}
else if(sType=="html")
{return sData.replace(/\n/g," ").replace(/<.*?>/g,"");}
else if(typeof sData=="string")
{return sData.replace(/\n/g," ");}
return sData;}
function _fnSort(oSettings,bApplyClasses)
{var aaSort=[];var oSort=_oExt.oSort;var aoData=oSettings.aoData;var iDataSort;var iDataType;var i,j,jLen;if(!oSettings.oFeatures.bServerSide&&(oSettings.aaSorting.length!==0||oSettings.aaSortingFixed!==null))
{if(oSettings.aaSortingFixed!==null)
{aaSort=oSettings.aaSortingFixed.concat(oSettings.aaSorting);}
else
{aaSort=oSettings.aaSorting.slice();}
for(i=0;i<aaSort.length;i++)
{var iColumn=aaSort[i][0];var iVisColumn=_fnColumnIndexToVisible(oSettings,iColumn);var sDataType=oSettings.aoColumns[iColumn].sSortDataType;if(typeof _oExt.afnSortData[sDataType]!='undefined')
{var aData=_oExt.afnSortData[sDataType](oSettings,iColumn,iVisColumn);for(j=0,jLen=aoData.length;j<jLen;j++)
{aoData[j]._aData[iColumn]=aData[j];}}}
if(!window.runtime)
{this.ClosureDataTables={"fn":function(){},"data":aoData,"sort":_oExt.oSort,"master":oSettings.aiDisplayMaster.slice()};var sDynamicSort="this.ClosureDataTables.fn = function(a,b){"+"var iTest, oSort=this.ClosureDataTables.sort, "+"aoData=this.ClosureDataTables.data, "+"aiOrig=this.ClosureDataTables.master;";for(i=0;i<aaSort.length-1;i++)
{iDataSort=oSettings.aoColumns[aaSort[i][0]].iDataSort;iDataType=oSettings.aoColumns[iDataSort].sType;sDynamicSort+="iTest = oSort['"+iDataType+"-"+aaSort[i][1]+"']"+"( aoData[a]._aData["+iDataSort+"], aoData[b]._aData["+iDataSort+"] ); if ( iTest === 0 )";}
if(aaSort.length>0)
{iDataSort=oSettings.aoColumns[aaSort[aaSort.length-1][0]].iDataSort;iDataType=oSettings.aoColumns[iDataSort].sType;sDynamicSort+="iTest = oSort['"+iDataType+"-"+aaSort[aaSort.length-1][1]+"']"+"( aoData[a]._aData["+iDataSort+"], aoData[b]._aData["+iDataSort+"] );"+"if (iTest===0) "+"return oSort['numeric-asc'](jQuery.inArray(a,aiOrig), jQuery.inArray(b,aiOrig)); "+"return iTest;}";eval(sDynamicSort);oSettings.aiDisplayMaster.sort(this.ClosureDataTables.fn);}
this.ClosureDataTables=undefined;}
else
{var aAirSort=[];var iLen=aaSort.length;for(i=0;i<iLen;i++)
{iDataSort=oSettings.aoColumns[aaSort[i][0]].iDataSort;aAirSort.push([iDataSort,oSettings.aoColumns[iDataSort].sType+'-'+aaSort[i][1]]);}
oSettings.aiDisplayMaster.sort(function(a,b){var iTest;for(var i=0;i<iLen;i++)
{iTest=oSort[aAirSort[i][1]](aoData[a]._aData[aAirSort[i][0]],aoData[b]._aData[aAirSort[i][0]]);if(iTest!==0)
{return iTest;}}
return 0;});}}
if(typeof bApplyClasses=='undefined'||bApplyClasses)
{_fnSortingClasses(oSettings);}
oSettings.bSorted=true;if(oSettings.oFeatures.bFilter)
{_fnFilterComplete(oSettings,oSettings.oPreviousSearch,1);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings._iDisplayStart=0;_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}
function _fnSortAttachListener(oSettings,nNode,iDataIndex,fnCallback)
{$(nNode).click(function(e){if(oSettings.aoColumns[iDataIndex].bSortable===false)
{return;}
var fnInnerSorting=function(){var iColumn,iNextSort;if(e.shiftKey)
{var bFound=false;for(var i=0;i<oSettings.aaSorting.length;i++)
{if(oSettings.aaSorting[i][0]==iDataIndex)
{bFound=true;iColumn=oSettings.aaSorting[i][0];iNextSort=oSettings.aaSorting[i][2]+1;if(typeof oSettings.aoColumns[iColumn].asSorting[iNextSort]=='undefined')
{oSettings.aaSorting.splice(i,1);}
else
{oSettings.aaSorting[i][1]=oSettings.aoColumns[iColumn].asSorting[iNextSort];oSettings.aaSorting[i][2]=iNextSort;}
break;}}
if(bFound===false)
{oSettings.aaSorting.push([iDataIndex,oSettings.aoColumns[iDataIndex].asSorting[0],0]);}}
else
{if(oSettings.aaSorting.length==1&&oSettings.aaSorting[0][0]==iDataIndex)
{iColumn=oSettings.aaSorting[0][0];iNextSort=oSettings.aaSorting[0][2]+1;if(typeof oSettings.aoColumns[iColumn].asSorting[iNextSort]=='undefined')
{iNextSort=0;}
oSettings.aaSorting[0][1]=oSettings.aoColumns[iColumn].asSorting[iNextSort];oSettings.aaSorting[0][2]=iNextSort;}
else
{oSettings.aaSorting.splice(0,oSettings.aaSorting.length);oSettings.aaSorting.push([iDataIndex,oSettings.aoColumns[iDataIndex].asSorting[0],0]);}}
_fnSort(oSettings);};if(!oSettings.oFeatures.bProcessing)
{fnInnerSorting();}
else
{_fnProcessingDisplay(oSettings,true);setTimeout(function(){fnInnerSorting();if(!oSettings.oFeatures.bServerSide)
{_fnProcessingDisplay(oSettings,false);}},0);}
if(typeof fnCallback=='function')
{fnCallback(oSettings);}});}
function _fnSortingClasses(oSettings)
{var i,iLen,j,jLen,iFound;var aaSort,sClass;var iColumns=oSettings.aoColumns.length;var oClasses=oSettings.oClasses;for(i=0;i<iColumns;i++)
{if(oSettings.aoColumns[i].bSortable)
{$(oSettings.aoColumns[i].nTh).removeClass(oClasses.sSortAsc+" "+oClasses.sSortDesc+" "+oSettings.aoColumns[i].sSortingClass);}}
if(oSettings.aaSortingFixed!==null)
{aaSort=oSettings.aaSortingFixed.concat(oSettings.aaSorting);}
else
{aaSort=oSettings.aaSorting.slice();}
for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bSortable)
{sClass=oSettings.aoColumns[i].sSortingClass;iFound=-1;for(j=0;j<aaSort.length;j++)
{if(aaSort[j][0]==i)
{sClass=(aaSort[j][1]=="asc")?oClasses.sSortAsc:oClasses.sSortDesc;iFound=j;break;}}
$(oSettings.aoColumns[i].nTh).addClass(sClass);if(oSettings.bJUI)
{var jqSpan=$("span",oSettings.aoColumns[i].nTh);jqSpan.removeClass(oClasses.sSortJUIAsc+" "+oClasses.sSortJUIDesc+" "+
oClasses.sSortJUI+" "+oClasses.sSortJUIAscAllowed+" "+oClasses.sSortJUIDescAllowed);var sSpanClass;if(iFound==-1)
{sSpanClass=oSettings.aoColumns[i].sSortingClassJUI;}
else if(aaSort[iFound][1]=="asc")
{sSpanClass=oClasses.sSortJUIAsc;}
else
{sSpanClass=oClasses.sSortJUIDesc;}
jqSpan.addClass(sSpanClass);}}
else
{$(oSettings.aoColumns[i].nTh).addClass(oSettings.aoColumns[i].sSortingClass);}}
sClass=oClasses.sSortColumn;if(oSettings.oFeatures.bSort&&oSettings.oFeatures.bSortClasses)
{var nTds=_fnGetTdNodes(oSettings);if(nTds.length>=iColumns)
{for(i=0;i<iColumns;i++)
{if(nTds[i].className.indexOf(sClass+"1")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(sClass+"1",""));}}
else if(nTds[i].className.indexOf(sClass+"2")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(sClass+"2",""));}}
else if(nTds[i].className.indexOf(sClass+"3")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(" "+sClass+"3",""));}}}}
var iClass=1,iTargetCol;for(i=0;i<aaSort.length;i++)
{iTargetCol=parseInt(aaSort[i][0],10);for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+iTargetCol].className+=" "+sClass+iClass;}
if(iClass<3)
{iClass++;}}}}
function _fnFeatureHtmlPaginate(oSettings)
{if(oSettings.oScroll.bInfinite)
{return null;}
var nPaginate=document.createElement('div');nPaginate.className=oSettings.oClasses.sPaging+oSettings.sPaginationType;_oExt.oPagination[oSettings.sPaginationType].fnInit(oSettings,nPaginate,function(oSettings){_fnCalculateEnd(oSettings);_fnDraw(oSettings);});if(typeof oSettings.aanFeatures.p=="undefined")
{oSettings.aoDrawCallback.push({"fn":function(oSettings){_oExt.oPagination[oSettings.sPaginationType].fnUpdate(oSettings,function(oSettings){_fnCalculateEnd(oSettings);_fnDraw(oSettings);});},"sName":"pagination"});}
return nPaginate;}
function _fnPageChange(oSettings,sAction)
{var iOldStart=oSettings._iDisplayStart;if(sAction=="first")
{oSettings._iDisplayStart=0;}
else if(sAction=="previous")
{oSettings._iDisplayStart=oSettings._iDisplayLength>=0?oSettings._iDisplayStart-oSettings._iDisplayLength:0;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
else if(sAction=="next")
{if(oSettings._iDisplayLength>=0)
{if(oSettings._iDisplayStart+oSettings._iDisplayLength<oSettings.fnRecordsDisplay())
{oSettings._iDisplayStart+=oSettings._iDisplayLength;}}
else
{oSettings._iDisplayStart=0;}}
else if(sAction=="last")
{if(oSettings._iDisplayLength>=0)
{var iPages=parseInt((oSettings.fnRecordsDisplay()-1)/oSettings._iDisplayLength,10)+1;oSettings._iDisplayStart=(iPages-1)*oSettings._iDisplayLength;}
else
{oSettings._iDisplayStart=0;}}
else
{_fnLog(oSettings,0,"Unknown paging action: "+sAction);}
return iOldStart!=oSettings._iDisplayStart;}
function _fnFeatureHtmlInfo(oSettings)
{var nInfo=document.createElement('div');nInfo.className=oSettings.oClasses.sInfo;if(typeof oSettings.aanFeatures.i=="undefined")
{oSettings.aoDrawCallback.push({"fn":_fnUpdateInfo,"sName":"information"});if(oSettings.sTableId!=='')
{nInfo.setAttribute('id',oSettings.sTableId+'_info');}}
return nInfo;}
function _fnUpdateInfo(oSettings)
{if(!oSettings.oFeatures.bInfo||oSettings.aanFeatures.i.length===0)
{return;}
var
iStart=oSettings._iDisplayStart+1,iEnd=oSettings.fnDisplayEnd(),iMax=oSettings.fnRecordsTotal(),iTotal=oSettings.fnRecordsDisplay(),sStart=oSettings.fnFormatNumber(iStart),sEnd=oSettings.fnFormatNumber(iEnd),sMax=oSettings.fnFormatNumber(iMax),sTotal=oSettings.fnFormatNumber(iTotal),sOut;if(oSettings.oScroll.bInfinite)
{sStart=oSettings.fnFormatNumber(1);}
if(oSettings.fnRecordsDisplay()===0&&oSettings.fnRecordsDisplay()==oSettings.fnRecordsTotal())
{sOut=oSettings.oLanguage.sInfoEmpty+oSettings.oLanguage.sInfoPostFix;}
else if(oSettings.fnRecordsDisplay()===0)
{sOut=oSettings.oLanguage.sInfoEmpty+' '+
oSettings.oLanguage.sInfoFiltered.replace('_MAX_',sMax)+
oSettings.oLanguage.sInfoPostFix;}
else if(oSettings.fnRecordsDisplay()==oSettings.fnRecordsTotal())
{sOut=oSettings.oLanguage.sInfo.replace('_START_',sStart).replace('_END_',sEnd).replace('_TOTAL_',sTotal)+
oSettings.oLanguage.sInfoPostFix;}
else
{sOut=oSettings.oLanguage.sInfo.replace('_START_',sStart).replace('_END_',sEnd).replace('_TOTAL_',sTotal)+' '+
oSettings.oLanguage.sInfoFiltered.replace('_MAX_',oSettings.fnFormatNumber(oSettings.fnRecordsTotal()))+
oSettings.oLanguage.sInfoPostFix;}
if(oSettings.oLanguage.fnInfoCallback!==null)
{sOut=oSettings.oLanguage.fnInfoCallback(oSettings,iStart,iEnd,iMax,iTotal,sOut);}
var n=oSettings.aanFeatures.i;for(var i=0,iLen=n.length;i<iLen;i++)
{$(n[i]).html(sOut);}}
function _fnFeatureHtmlLength(oSettings)
{if(oSettings.oScroll.bInfinite)
{return null;}
var sName=(oSettings.sTableId==="")?"":'name="'+oSettings.sTableId+'_length"';var sStdMenu='<select size="1" '+sName+'>';var i,iLen;if(oSettings.aLengthMenu.length==2&&typeof oSettings.aLengthMenu[0]=='object'&&typeof oSettings.aLengthMenu[1]=='object')
{for(i=0,iLen=oSettings.aLengthMenu[0].length;i<iLen;i++)
{sStdMenu+='<option value="'+oSettings.aLengthMenu[0][i]+'">'+
oSettings.aLengthMenu[1][i]+'</option>';}}
else
{for(i=0,iLen=oSettings.aLengthMenu.length;i<iLen;i++)
{sStdMenu+='<option value="'+oSettings.aLengthMenu[i]+'">'+
oSettings.aLengthMenu[i]+'</option>';}}
sStdMenu+='</select>';var nLength=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.l=="undefined")
{nLength.setAttribute('id',oSettings.sTableId+'_length');}
nLength.className=oSettings.oClasses.sLength;nLength.innerHTML=oSettings.oLanguage.sLengthMenu.replace('_MENU_',sStdMenu);$('select option[value="'+oSettings._iDisplayLength+'"]',nLength).attr("selected",true);$('select',nLength).change(function(e){var iVal=$(this).val();var n=oSettings.aanFeatures.l;for(i=0,iLen=n.length;i<iLen;i++)
{if(n[i]!=this.parentNode)
{$('select',n[i]).val(iVal);}}
oSettings._iDisplayLength=parseInt(iVal,10);_fnCalculateEnd(oSettings);if(oSettings.fnDisplayEnd()==oSettings.fnRecordsDisplay())
{oSettings._iDisplayStart=oSettings.fnDisplayEnd()-oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(oSettings._iDisplayLength==-1)
{oSettings._iDisplayStart=0;}
_fnDraw(oSettings);});return nLength;}
function _fnFeatureHtmlProcessing(oSettings)
{var nProcessing=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.r=="undefined")
{nProcessing.setAttribute('id',oSettings.sTableId+'_processing');}
nProcessing.innerHTML=oSettings.oLanguage.sProcessing;nProcessing.className=oSettings.oClasses.sProcessing;oSettings.nTable.parentNode.insertBefore(nProcessing,oSettings.nTable);return nProcessing;}
function _fnProcessingDisplay(oSettings,bShow)
{if(oSettings.oFeatures.bProcessing)
{var an=oSettings.aanFeatures.r;for(var i=0,iLen=an.length;i<iLen;i++)
{an[i].style.visibility=bShow?"visible":"hidden";}}}
function _fnVisibleToColumnIndex(oSettings,iMatch)
{var iColumn=-1;for(var i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible===true)
{iColumn++;}
if(iColumn==iMatch)
{return i;}}
return null;}
function _fnColumnIndexToVisible(oSettings,iMatch)
{var iVisible=-1;for(var i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible===true)
{iVisible++;}
if(i==iMatch)
{return oSettings.aoColumns[i].bVisible===true?iVisible:null;}}
return null;}
function _fnNodeToDataIndex(s,n)
{var i,iLen;for(i=s._iDisplayStart,iLen=s._iDisplayEnd;i<iLen;i++)
{if(s.aoData[s.aiDisplay[i]].nTr==n)
{return s.aiDisplay[i];}}
for(i=0,iLen=s.aoData.length;i<iLen;i++)
{if(s.aoData[i].nTr==n)
{return i;}}
return null;}
function _fnVisbleColumns(oS)
{var iVis=0;for(var i=0;i<oS.aoColumns.length;i++)
{if(oS.aoColumns[i].bVisible===true)
{iVis++;}}
return iVis;}
function _fnCalculateEnd(oSettings)
{if(oSettings.oFeatures.bPaginate===false)
{oSettings._iDisplayEnd=oSettings.aiDisplay.length;}
else
{if(oSettings._iDisplayStart+oSettings._iDisplayLength>oSettings.aiDisplay.length||oSettings._iDisplayLength==-1)
{oSettings._iDisplayEnd=oSettings.aiDisplay.length;}
else
{oSettings._iDisplayEnd=oSettings._iDisplayStart+oSettings._iDisplayLength;}}}
function _fnConvertToWidth(sWidth,nParent)
{if(!sWidth||sWidth===null||sWidth==='')
{return 0;}
if(typeof nParent=="undefined")
{nParent=document.getElementsByTagName('body')[0];}
var iWidth;var nTmp=document.createElement("div");nTmp.style.width=sWidth;nParent.appendChild(nTmp);iWidth=nTmp.offsetWidth;nParent.removeChild(nTmp);return(iWidth);}
function _fnCalculateColumnWidths(oSettings)
{var iTableWidth=oSettings.nTable.offsetWidth;var iUserInputs=0;var iTmpWidth;var iVisibleColumns=0;var iColums=oSettings.aoColumns.length;var i;var oHeaders=$('th',oSettings.nTHead);for(i=0;i<iColums;i++)
{if(oSettings.aoColumns[i].bVisible)
{iVisibleColumns++;if(oSettings.aoColumns[i].sWidth!==null)
{iTmpWidth=_fnConvertToWidth(oSettings.aoColumns[i].sWidthOrig,oSettings.nTable.parentNode);if(iTmpWidth!==null)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iTmpWidth);}
iUserInputs++;}}}
if(iColums==oHeaders.length&&iUserInputs===0&&iVisibleColumns==iColums&&oSettings.oScroll.sX===""&&oSettings.oScroll.sY==="")
{for(i=0;i<oSettings.aoColumns.length;i++)
{iTmpWidth=$(oHeaders[i]).width();if(iTmpWidth!==null)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iTmpWidth);}}}
else
{var
nCalcTmp=oSettings.nTable.cloneNode(false),nBody=document.createElement('tbody'),nTr=document.createElement('tr'),nDivSizing;nCalcTmp.removeAttribute("id");nCalcTmp.appendChild(oSettings.nTHead.cloneNode(true));if(oSettings.nTFoot!==null)
{nCalcTmp.appendChild(oSettings.nTFoot.cloneNode(true));_fnApplyToChildren(function(n){n.style.width="";},nCalcTmp.getElementsByTagName('tr'));}
nCalcTmp.appendChild(nBody);nBody.appendChild(nTr);var jqColSizing=$('thead th',nCalcTmp);if(jqColSizing.length===0)
{jqColSizing=$('tbody tr:eq(0)>td',nCalcTmp);}
jqColSizing.each(function(i){this.style.width="";var iIndex=_fnVisibleToColumnIndex(oSettings,i);if(iIndex!==null&&oSettings.aoColumns[iIndex].sWidthOrig!=="")
{this.style.width=oSettings.aoColumns[iIndex].sWidthOrig;}});for(i=0;i<iColums;i++)
{if(oSettings.aoColumns[i].bVisible)
{var nTd=_fnGetWidestNode(oSettings,i);if(nTd!==null)
{nTd=nTd.cloneNode(true);nTr.appendChild(nTd);}}}
var nWrapper=oSettings.nTable.parentNode;nWrapper.appendChild(nCalcTmp);if(oSettings.oScroll.sX!==""&&oSettings.oScroll.sXInner!=="")
{nCalcTmp.style.width=_fnStringToCss(oSettings.oScroll.sXInner);}
else if(oSettings.oScroll.sX!=="")
{nCalcTmp.style.width="";if($(nCalcTmp).width()<nWrapper.offsetWidth)
{nCalcTmp.style.width=_fnStringToCss(nWrapper.offsetWidth);}}
else if(oSettings.oScroll.sY!=="")
{nCalcTmp.style.width=_fnStringToCss(nWrapper.offsetWidth);}
nCalcTmp.style.visibility="hidden";_fnScrollingWidthAdjust(oSettings,nCalcTmp);var oNodes=$("tbody tr:eq(0)>td",nCalcTmp);if(oNodes.length===0)
{oNodes=$("thead tr:eq(0)>th",nCalcTmp);}
var iIndex,iCorrector=0,iWidth;for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible)
{iWidth=$(oNodes[iCorrector]).width();if(iWidth!==null&&iWidth>0)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iWidth);}
iCorrector++;}}
oSettings.nTable.style.width=_fnStringToCss($(nCalcTmp).outerWidth());nCalcTmp.parentNode.removeChild(nCalcTmp);}}
function _fnScrollingWidthAdjust(oSettings,n)
{if(oSettings.oScroll.sX===""&&oSettings.oScroll.sY!=="")
{var iOrigWidth=$(n).width();n.style.width=_fnStringToCss($(n).outerWidth()-oSettings.oScroll.iBarWidth);}
else if(oSettings.oScroll.sX!=="")
{n.style.width=_fnStringToCss($(n).outerWidth());}}
function _fnGetWidestNode(oSettings,iCol,bFast)
{if(typeof bFast=='undefined'||bFast)
{var iMaxLen=_fnGetMaxLenString(oSettings,iCol);var iFastVis=_fnColumnIndexToVisible(oSettings,iCol);if(iMaxLen<0)
{return null;}
return oSettings.aoData[iMaxLen].nTr.getElementsByTagName('td')[iFastVis];}
var
iMax=-1,i,iLen,iMaxIndex=-1,n=document.createElement('div');n.style.visibility="hidden";n.style.position="absolute";document.body.appendChild(n);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{n.innerHTML=oSettings.aoData[i]._aData[iCol];if(n.offsetWidth>iMax)
{iMax=n.offsetWidth;iMaxIndex=i;}}
document.body.removeChild(n);if(iMaxIndex>=0)
{var iVis=_fnColumnIndexToVisible(oSettings,iCol);var nRet=oSettings.aoData[iMaxIndex].nTr.getElementsByTagName('td')[iVis];if(nRet)
{return nRet;}}
return null;}
function _fnGetMaxLenString(oSettings,iCol)
{var iMax=-1;var iMaxIndex=-1;for(var i=0;i<oSettings.aoData.length;i++)
{var s=oSettings.aoData[i]._aData[iCol];if(s.length>iMax)
{iMax=s.length;iMaxIndex=i;}}
return iMaxIndex;}
function _fnStringToCss(s)
{if(s===null)
{return"0px";}
if(typeof s=='number')
{if(s<0)
{return"0px";}
return s+"px";}
var c=s.charCodeAt(s.length-1);if(c<0x30||c>0x39)
{return s;}
return s+"px";}
function _fnArrayCmp(aArray1,aArray2)
{if(aArray1.length!=aArray2.length)
{return 1;}
for(var i=0;i<aArray1.length;i++)
{if(aArray1[i]!=aArray2[i])
{return 2;}}
return 0;}
function _fnDetectType(sData)
{var aTypes=_oExt.aTypes;var iLen=aTypes.length;for(var i=0;i<iLen;i++)
{var sType=aTypes[i](sData);if(sType!==null)
{return sType;}}
return'string';}
function _fnSettingsFromNode(nTable)
{for(var i=0;i<_aoSettings.length;i++)
{if(_aoSettings[i].nTable==nTable)
{return _aoSettings[i];}}
return null;}
function _fnGetDataMaster(oSettings)
{var aData=[];var iLen=oSettings.aoData.length;for(var i=0;i<iLen;i++)
{aData.push(oSettings.aoData[i]._aData);}
return aData;}
function _fnGetTrNodes(oSettings)
{var aNodes=[];var iLen=oSettings.aoData.length;for(var i=0;i<iLen;i++)
{aNodes.push(oSettings.aoData[i].nTr);}
return aNodes;}
function _fnGetTdNodes(oSettings)
{var nTrs=_fnGetTrNodes(oSettings);var nTds=[],nTd;var anReturn=[];var iCorrector;var iRow,iRows,iColumn,iColumns;for(iRow=0,iRows=nTrs.length;iRow<iRows;iRow++)
{nTds=[];for(iColumn=0,iColumns=nTrs[iRow].childNodes.length;iColumn<iColumns;iColumn++)
{nTd=nTrs[iRow].childNodes[iColumn];if(nTd.nodeName.toUpperCase()=="TD")
{nTds.push(nTd);}}
iCorrector=0;for(iColumn=0,iColumns=oSettings.aoColumns.length;iColumn<iColumns;iColumn++)
{if(oSettings.aoColumns[iColumn].bVisible)
{anReturn.push(nTds[iColumn-iCorrector]);}
else
{anReturn.push(oSettings.aoData[iRow]._anHidden[iColumn]);iCorrector++;}}}
return anReturn;}
function _fnEscapeRegex(sVal)
{var acEscape=['/','.','*','+','?','|','(',')','[',']','{','}','\\','$','^'];var reReplace=new RegExp('(\\'+acEscape.join('|\\')+')','g');return sVal.replace(reReplace,'\\$1');}
function _fnDeleteIndex(a,iTarget)
{var iTargetIndex=-1;for(var i=0,iLen=a.length;i<iLen;i++)
{if(a[i]==iTarget)
{iTargetIndex=i;}
else if(a[i]>iTarget)
{a[i]--;}}
if(iTargetIndex!=-1)
{a.splice(iTargetIndex,1);}}
function _fnReOrderIndex(oSettings,sColumns)
{var aColumns=sColumns.split(',');var aiReturn=[];for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{for(var j=0;j<iLen;j++)
{if(oSettings.aoColumns[i].sName==aColumns[j])
{aiReturn.push(j);break;}}}
return aiReturn;}
function _fnColumnOrdering(oSettings)
{var sNames='';for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{sNames+=oSettings.aoColumns[i].sName+',';}
if(sNames.length==iLen)
{return"";}
return sNames.slice(0,-1);}
function _fnLog(oSettings,iLevel,sMesg)
{var sAlert=oSettings.sTableId===""?"DataTables warning: "+sMesg:"DataTables warning (table id = '"+oSettings.sTableId+"'): "+sMesg;if(iLevel===0)
{if(_oExt.sErrMode=='alert')
{alert(sAlert);}
else
{throw sAlert;}
return;}
else if(typeof console!='undefined'&&typeof console.log!='undefined')
{console.log(sAlert);}}
function _fnClearTable(oSettings)
{oSettings.aoData.splice(0,oSettings.aoData.length);oSettings.aiDisplayMaster.splice(0,oSettings.aiDisplayMaster.length);oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);_fnCalculateEnd(oSettings);}
function _fnSaveState(oSettings)
{if(!oSettings.oFeatures.bStateSave||typeof oSettings.bDestroying!='undefined')
{return;}
var i,iLen,sTmp;var sValue="{";sValue+='"iCreate":'+new Date().getTime()+',';sValue+='"iStart":'+oSettings._iDisplayStart+',';sValue+='"iEnd":'+oSettings._iDisplayEnd+',';sValue+='"iLength":'+oSettings._iDisplayLength+',';sValue+='"sFilter":"'+encodeURIComponent(oSettings.oPreviousSearch.sSearch)+'",';sValue+='"sFilterEsc":'+!oSettings.oPreviousSearch.bRegex+',';sValue+='"aaSorting":[ ';for(i=0;i<oSettings.aaSorting.length;i++)
{sValue+='['+oSettings.aaSorting[i][0]+',"'+oSettings.aaSorting[i][1]+'"],';}
sValue=sValue.substring(0,sValue.length-1);sValue+="],";sValue+='"aaSearchCols":[ ';for(i=0;i<oSettings.aoPreSearchCols.length;i++)
{sValue+='["'+encodeURIComponent(oSettings.aoPreSearchCols[i].sSearch)+'",'+!oSettings.aoPreSearchCols[i].bRegex+'],';}
sValue=sValue.substring(0,sValue.length-1);sValue+="],";sValue+='"abVisCols":[ ';for(i=0;i<oSettings.aoColumns.length;i++)
{sValue+=oSettings.aoColumns[i].bVisible+",";}
sValue=sValue.substring(0,sValue.length-1);sValue+="]";for(i=0,iLen=oSettings.aoStateSave.length;i<iLen;i++)
{sTmp=oSettings.aoStateSave[i].fn(oSettings,sValue);if(sTmp!=="")
{sValue=sTmp;}}
sValue+="}";_fnCreateCookie(oSettings.sCookiePrefix+oSettings.sInstance,sValue,oSettings.iCookieDuration,oSettings.sCookiePrefix,oSettings.fnCookieCallback);}
function _fnLoadState(oSettings,oInit)
{if(!oSettings.oFeatures.bStateSave)
{return;}
var oData,i,iLen;var sData=_fnReadCookie(oSettings.sCookiePrefix+oSettings.sInstance);if(sData!==null&&sData!=='')
{try
{oData=(typeof $.parseJSON=='function')?$.parseJSON(sData.replace(/'/g,'"')):eval('('+sData+')');}
catch(e)
{return;}
for(i=0,iLen=oSettings.aoStateLoad.length;i<iLen;i++)
{if(!oSettings.aoStateLoad[i].fn(oSettings,oData))
{return;}}
oSettings.oLoadedState=$.extend(true,{},oData);oSettings._iDisplayStart=oData.iStart;oSettings.iInitDisplayStart=oData.iStart;oSettings._iDisplayEnd=oData.iEnd;oSettings._iDisplayLength=oData.iLength;oSettings.oPreviousSearch.sSearch=decodeURIComponent(oData.sFilter);oSettings.aaSorting=oData.aaSorting.slice();oSettings.saved_aaSorting=oData.aaSorting.slice();if(typeof oData.sFilterEsc!='undefined')
{oSettings.oPreviousSearch.bRegex=!oData.sFilterEsc;}
if(typeof oData.aaSearchCols!='undefined')
{for(i=0;i<oData.aaSearchCols.length;i++)
{oSettings.aoPreSearchCols[i]={"sSearch":decodeURIComponent(oData.aaSearchCols[i][0]),"bRegex":!oData.aaSearchCols[i][1]};}}
if(typeof oData.abVisCols!='undefined')
{oInit.saved_aoColumns=[];for(i=0;i<oData.abVisCols.length;i++)
{oInit.saved_aoColumns[i]={};oInit.saved_aoColumns[i].bVisible=oData.abVisCols[i];}}}}
function _fnCreateCookie(sName,sValue,iSecs,sBaseName,fnCallback)
{var date=new Date();date.setTime(date.getTime()+(iSecs*1000));var aParts=window.location.pathname.split('/');var sNameFile=sName+'_'+aParts.pop().replace(/[\/:]/g,"").toLowerCase();var sFullCookie,oData;if(fnCallback!==null)
{oData=(typeof $.parseJSON=='function')?$.parseJSON(sValue):eval('('+sValue+')');sFullCookie=fnCallback(sNameFile,oData,date.toGMTString(),aParts.join('/')+"/");}
else
{sFullCookie=sNameFile+"="+encodeURIComponent(sValue)+"; expires="+date.toGMTString()+"; path="+aParts.join('/')+"/";}
var sOldName="",iOldTime=9999999999999;var iLength=_fnReadCookie(sNameFile)!==null?document.cookie.length:sFullCookie.length+document.cookie.length;if(iLength+10>4096)
{var aCookies=document.cookie.split(';');for(var i=0,iLen=aCookies.length;i<iLen;i++)
{if(aCookies[i].indexOf(sBaseName)!=-1)
{var aSplitCookie=aCookies[i].split('=');try{oData=eval('('+decodeURIComponent(aSplitCookie[1])+')');}
catch(e){continue;}
if(typeof oData.iCreate!='undefined'&&oData.iCreate<iOldTime)
{sOldName=aSplitCookie[0];iOldTime=oData.iCreate;}}}
if(sOldName!=="")
{document.cookie=sOldName+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+
aParts.join('/')+"/";}}
document.cookie=sFullCookie;}
function _fnReadCookie(sName)
{var
aParts=window.location.pathname.split('/'),sNameEQ=sName+'_'+aParts[aParts.length-1].replace(/[\/:]/g,"").toLowerCase()+'=',sCookieContents=document.cookie.split(';');for(var i=0;i<sCookieContents.length;i++)
{var c=sCookieContents[i];while(c.charAt(0)==' ')
{c=c.substring(1,c.length);}
if(c.indexOf(sNameEQ)===0)
{return decodeURIComponent(c.substring(sNameEQ.length,c.length));}}
return null;}
function _fnGetUniqueThs(nThead)
{var nTrs=nThead.getElementsByTagName('tr');if(nTrs.length==1)
{return nTrs[0].getElementsByTagName('th');}
var aLayout=[],aReturn=[];var ROWSPAN=2,COLSPAN=3,TDELEM=4;var i,j,k,iLen,jLen,iColumnShifted;var fnShiftCol=function(a,i,j){while(typeof a[i][j]!='undefined'){j++;}
return j;};var fnAddRow=function(i){if(typeof aLayout[i]=='undefined'){aLayout[i]=[];}};for(i=0,iLen=nTrs.length;i<iLen;i++)
{fnAddRow(i);var iColumn=0;var nTds=[];for(j=0,jLen=nTrs[i].childNodes.length;j<jLen;j++)
{if(nTrs[i].childNodes[j].nodeName.toUpperCase()=="TD"||nTrs[i].childNodes[j].nodeName.toUpperCase()=="TH")
{nTds.push(nTrs[i].childNodes[j]);}}
for(j=0,jLen=nTds.length;j<jLen;j++)
{var iColspan=nTds[j].getAttribute('colspan')*1;var iRowspan=nTds[j].getAttribute('rowspan')*1;if(!iColspan||iColspan===0||iColspan===1)
{iColumnShifted=fnShiftCol(aLayout,i,iColumn);aLayout[i][iColumnShifted]=(nTds[j].nodeName.toUpperCase()=="TD")?TDELEM:nTds[j];if(iRowspan||iRowspan===0||iRowspan===1)
{for(k=1;k<iRowspan;k++)
{fnAddRow(i+k);aLayout[i+k][iColumnShifted]=ROWSPAN;}}
iColumn++;}
else
{iColumnShifted=fnShiftCol(aLayout,i,iColumn);for(k=0;k<iColspan;k++)
{aLayout[i][iColumnShifted+k]=COLSPAN;}
iColumn+=iColspan;}}}
for(i=0,iLen=aLayout.length;i<iLen;i++)
{for(j=0,jLen=aLayout[i].length;j<jLen;j++)
{if(typeof aLayout[i][j]=='object')
{aReturn[j]=aLayout[i][j];}}}
return aReturn;}
function _fnScrollBarWidth()
{var inner=document.createElement('p');var style=inner.style;style.width="100%";style.height="200px";var outer=document.createElement('div');style=outer.style;style.position="absolute";style.top="0px";style.left="0px";style.visibility="hidden";style.width="200px";style.height="150px";style.overflow="hidden";outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow='scroll';var w2=inner.offsetWidth;if(w1==w2)
{w2=outer.clientWidth;}
document.body.removeChild(outer);return(w1-w2);}
function _fnApplyToChildren(fn,an1,an2)
{for(var i=0,iLen=an1.length;i<iLen;i++)
{for(var j=0,jLen=an1[i].childNodes.length;j<jLen;j++)
{if(an1[i].childNodes[j].nodeType==1)
{if(typeof an2!='undefined')
{fn(an1[i].childNodes[j],an2[i].childNodes[j]);}
else
{fn(an1[i].childNodes[j]);}}}}}
function _fnMap(oRet,oSrc,sName,sMappedName)
{if(typeof sMappedName=='undefined')
{sMappedName=sName;}
if(typeof oSrc[sName]!='undefined')
{oRet[sMappedName]=oSrc[sName];}}
this.oApi._fnExternApiFunc=_fnExternApiFunc;this.oApi._fnInitalise=_fnInitalise;this.oApi._fnLanguageProcess=_fnLanguageProcess;this.oApi._fnAddColumn=_fnAddColumn;this.oApi._fnColumnOptions=_fnColumnOptions;this.oApi._fnAddData=_fnAddData;this.oApi._fnGatherData=_fnGatherData;this.oApi._fnDrawHead=_fnDrawHead;this.oApi._fnDraw=_fnDraw;this.oApi._fnReDraw=_fnReDraw;this.oApi._fnAjaxUpdate=_fnAjaxUpdate;this.oApi._fnAjaxUpdateDraw=_fnAjaxUpdateDraw;this.oApi._fnAddOptionsHtml=_fnAddOptionsHtml;this.oApi._fnFeatureHtmlTable=_fnFeatureHtmlTable;this.oApi._fnScrollDraw=_fnScrollDraw;this.oApi._fnAjustColumnSizing=_fnAjustColumnSizing;this.oApi._fnFeatureHtmlFilter=_fnFeatureHtmlFilter;this.oApi._fnFilterComplete=_fnFilterComplete;this.oApi._fnFilterCustom=_fnFilterCustom;this.oApi._fnFilterColumn=_fnFilterColumn;this.oApi._fnFilter=_fnFilter;this.oApi._fnBuildSearchArray=_fnBuildSearchArray;this.oApi._fnBuildSearchRow=_fnBuildSearchRow;this.oApi._fnFilterCreateSearch=_fnFilterCreateSearch;this.oApi._fnDataToSearch=_fnDataToSearch;this.oApi._fnSort=_fnSort;this.oApi._fnSortAttachListener=_fnSortAttachListener;this.oApi._fnSortingClasses=_fnSortingClasses;this.oApi._fnFeatureHtmlPaginate=_fnFeatureHtmlPaginate;this.oApi._fnPageChange=_fnPageChange;this.oApi._fnFeatureHtmlInfo=_fnFeatureHtmlInfo;this.oApi._fnUpdateInfo=_fnUpdateInfo;this.oApi._fnFeatureHtmlLength=_fnFeatureHtmlLength;this.oApi._fnFeatureHtmlProcessing=_fnFeatureHtmlProcessing;this.oApi._fnProcessingDisplay=_fnProcessingDisplay;this.oApi._fnVisibleToColumnIndex=_fnVisibleToColumnIndex;this.oApi._fnColumnIndexToVisible=_fnColumnIndexToVisible;this.oApi._fnNodeToDataIndex=_fnNodeToDataIndex;this.oApi._fnVisbleColumns=_fnVisbleColumns;this.oApi._fnCalculateEnd=_fnCalculateEnd;this.oApi._fnConvertToWidth=_fnConvertToWidth;this.oApi._fnCalculateColumnWidths=_fnCalculateColumnWidths;this.oApi._fnScrollingWidthAdjust=_fnScrollingWidthAdjust;this.oApi._fnGetWidestNode=_fnGetWidestNode;this.oApi._fnGetMaxLenString=_fnGetMaxLenString;this.oApi._fnStringToCss=_fnStringToCss;this.oApi._fnArrayCmp=_fnArrayCmp;this.oApi._fnDetectType=_fnDetectType;this.oApi._fnSettingsFromNode=_fnSettingsFromNode;this.oApi._fnGetDataMaster=_fnGetDataMaster;this.oApi._fnGetTrNodes=_fnGetTrNodes;this.oApi._fnGetTdNodes=_fnGetTdNodes;this.oApi._fnEscapeRegex=_fnEscapeRegex;this.oApi._fnDeleteIndex=_fnDeleteIndex;this.oApi._fnReOrderIndex=_fnReOrderIndex;this.oApi._fnColumnOrdering=_fnColumnOrdering;this.oApi._fnLog=_fnLog;this.oApi._fnClearTable=_fnClearTable;this.oApi._fnSaveState=_fnSaveState;this.oApi._fnLoadState=_fnLoadState;this.oApi._fnCreateCookie=_fnCreateCookie;this.oApi._fnReadCookie=_fnReadCookie;this.oApi._fnGetUniqueThs=_fnGetUniqueThs;this.oApi._fnScrollBarWidth=_fnScrollBarWidth;this.oApi._fnApplyToChildren=_fnApplyToChildren;this.oApi._fnMap=_fnMap;var _that=this;return this.each(function()
{var i=0,iLen,j,jLen,k,kLen;for(i=0,iLen=_aoSettings.length;i<iLen;i++)
{if(_aoSettings[i].nTable==this)
{if(typeof oInit=='undefined'||(typeof oInit.bRetrieve!='undefined'&&oInit.bRetrieve===true))
{return _aoSettings[i].oInstance;}
else if(typeof oInit.bDestroy!='undefined'&&oInit.bDestroy===true)
{_aoSettings[i].oInstance.fnDestroy();break;}
else
{_fnLog(_aoSettings[i],0,"Cannot reinitialise DataTable.\n\n"+"To retrieve the DataTables object for this table, please pass either no arguments "+"to the dataTable() function, or set bRetrieve to true. Alternatively, to destory "+"the old table and create a new one, set bDestroy to true (note that a lot of "+"changes to the configuration can be made through the API which is usually much "+"faster).");return;}}
if(_aoSettings[i].sTableId!==""&&_aoSettings[i].sTableId==this.getAttribute('id'))
{_aoSettings.splice(i,1);break;}}
var oSettings=new classSettings();_aoSettings.push(oSettings);var bInitHandedOff=false;var bUsePassedData=false;var sId=this.getAttribute('id');if(sId!==null)
{oSettings.sTableId=sId;oSettings.sInstance=sId;}
else
{oSettings.sInstance=_oExt._oExternConfig.iNextUnique++;}
if(this.nodeName.toLowerCase()!='table')
{_fnLog(oSettings,0,"Attempted to initialise DataTables on a node which is not a "+"table: "+this.nodeName);return;}
oSettings.oInstance=_that;oSettings.nTable=this;oSettings.oApi=_that.oApi;oSettings.sDestroyWidth=$(this).width();if(typeof oInit!='undefined'&&oInit!==null)
{oSettings.oInit=oInit;_fnMap(oSettings.oFeatures,oInit,"bPaginate");_fnMap(oSettings.oFeatures,oInit,"bLengthChange");_fnMap(oSettings.oFeatures,oInit,"bFilter");_fnMap(oSettings.oFeatures,oInit,"bSort");_fnMap(oSettings.oFeatures,oInit,"bInfo");_fnMap(oSettings.oFeatures,oInit,"bProcessing");_fnMap(oSettings.oFeatures,oInit,"bAutoWidth");_fnMap(oSettings.oFeatures,oInit,"bSortClasses");_fnMap(oSettings.oFeatures,oInit,"bServerSide");_fnMap(oSettings.oScroll,oInit,"sScrollX","sX");_fnMap(oSettings.oScroll,oInit,"sScrollXInner","sXInner");_fnMap(oSettings.oScroll,oInit,"sScrollY","sY");_fnMap(oSettings.oScroll,oInit,"bScrollCollapse","bCollapse");_fnMap(oSettings.oScroll,oInit,"bScrollInfinite","bInfinite");_fnMap(oSettings.oScroll,oInit,"iScrollLoadGap","iLoadGap");_fnMap(oSettings,oInit,"asStripClasses");_fnMap(oSettings,oInit,"fnRowCallback");_fnMap(oSettings,oInit,"fnHeaderCallback");_fnMap(oSettings,oInit,"fnFooterCallback");_fnMap(oSettings,oInit,"fnCookieCallback");_fnMap(oSettings,oInit,"fnInitComplete");_fnMap(oSettings,oInit,"fnServerData");_fnMap(oSettings,oInit,"fnFormatNumber");_fnMap(oSettings,oInit,"aaSorting");_fnMap(oSettings,oInit,"aaSortingFixed");_fnMap(oSettings,oInit,"aLengthMenu");_fnMap(oSettings,oInit,"sPaginationType");_fnMap(oSettings,oInit,"sAjaxSource");_fnMap(oSettings,oInit,"iCookieDuration");_fnMap(oSettings,oInit,"sCookiePrefix");_fnMap(oSettings,oInit,"sDom");_fnMap(oSettings,oInit,"oSearch","oPreviousSearch");_fnMap(oSettings,oInit,"aoSearchCols","aoPreSearchCols");_fnMap(oSettings,oInit,"iDisplayLength","_iDisplayLength");_fnMap(oSettings,oInit,"bJQueryUI","bJUI");_fnMap(oSettings.oLanguage,oInit,"fnInfoCallback");if(typeof oInit.fnDrawCallback=='function')
{oSettings.aoDrawCallback.push({"fn":oInit.fnDrawCallback,"sName":"user"});}
if(typeof oInit.fnStateSaveCallback=='function')
{oSettings.aoStateSave.push({"fn":oInit.fnStateSaveCallback,"sName":"user"});}
if(typeof oInit.fnStateLoadCallback=='function')
{oSettings.aoStateLoad.push({"fn":oInit.fnStateLoadCallback,"sName":"user"});}
if(oSettings.oFeatures.bServerSide&&oSettings.oFeatures.bSort&&oSettings.oFeatures.bSortClasses)
{oSettings.aoDrawCallback.push({"fn":_fnSortingClasses,"sName":"server_side_sort_classes"});}
if(typeof oInit.bJQueryUI!='undefined'&&oInit.bJQueryUI)
{oSettings.oClasses=_oExt.oJUIClasses;if(typeof oInit.sDom=='undefined')
{oSettings.sDom='<"H"lfr>t<"F"ip>';}}
if(oSettings.oScroll.sX!==""||oSettings.oScroll.sY!=="")
{oSettings.oScroll.iBarWidth=_fnScrollBarWidth();}
if(typeof oInit.iDisplayStart!='undefined'&&typeof oSettings.iInitDisplayStart=='undefined')
{oSettings.iInitDisplayStart=oInit.iDisplayStart;oSettings._iDisplayStart=oInit.iDisplayStart;}
if(typeof oInit.bStateSave!='undefined')
{oSettings.oFeatures.bStateSave=oInit.bStateSave;_fnLoadState(oSettings,oInit);oSettings.aoDrawCallback.push({"fn":_fnSaveState,"sName":"state_save"});}
if(typeof oInit.aaData!='undefined')
{bUsePassedData=true;}
if(typeof oInit!='undefined'&&typeof oInit.aoData!='undefined')
{oInit.aoColumns=oInit.aoData;}
if(typeof oInit.oLanguage!='undefined')
{if(typeof oInit.oLanguage.sUrl!='undefined'&&oInit.oLanguage.sUrl!=="")
{oSettings.oLanguage.sUrl=oInit.oLanguage.sUrl;$.getJSON(oSettings.oLanguage.sUrl,null,function(json){_fnLanguageProcess(oSettings,json,true);});bInitHandedOff=true;}
else
{_fnLanguageProcess(oSettings,oInit.oLanguage,false);}}}
else
{oInit={};}
if(typeof oInit.asStripClasses=='undefined')
{oSettings.asStripClasses.push(oSettings.oClasses.sStripOdd);oSettings.asStripClasses.push(oSettings.oClasses.sStripEven);}
var bStripeRemove=false;var anRows=$('tbody>tr',this);for(i=0,iLen=oSettings.asStripClasses.length;i<iLen;i++)
{if(anRows.filter(":lt(2)").hasClass(oSettings.asStripClasses[i]))
{bStripeRemove=true;break;}}
if(bStripeRemove)
{oSettings.asDestoryStrips=['',''];if($(anRows[0]).hasClass(oSettings.oClasses.sStripOdd))
{oSettings.asDestoryStrips[0]+=oSettings.oClasses.sStripOdd+" ";}
if($(anRows[0]).hasClass(oSettings.oClasses.sStripEven))
{oSettings.asDestoryStrips[0]+=oSettings.oClasses.sStripEven;}
if($(anRows[1]).hasClass(oSettings.oClasses.sStripOdd))
{oSettings.asDestoryStrips[1]+=oSettings.oClasses.sStripOdd+" ";}
if($(anRows[1]).hasClass(oSettings.oClasses.sStripEven))
{oSettings.asDestoryStrips[1]+=oSettings.oClasses.sStripEven;}
anRows.removeClass(oSettings.asStripClasses.join(' '));}
var nThead=this.getElementsByTagName('thead');var anThs=nThead.length===0?[]:_fnGetUniqueThs(nThead[0]);var aoColumnsInit;if(typeof oInit.aoColumns=='undefined')
{aoColumnsInit=[];for(i=0,iLen=anThs.length;i<iLen;i++)
{aoColumnsInit.push(null);}}
else
{aoColumnsInit=oInit.aoColumns;}
for(i=0,iLen=aoColumnsInit.length;i<iLen;i++)
{if(typeof oInit.saved_aoColumns!='undefined'&&oInit.saved_aoColumns.length==iLen)
{if(aoColumnsInit[i]===null)
{aoColumnsInit[i]={};}
aoColumnsInit[i].bVisible=oInit.saved_aoColumns[i].bVisible;}
_fnAddColumn(oSettings,anThs?anThs[i]:null);}
if(typeof oInit.aoColumnDefs!='undefined')
{for(i=oInit.aoColumnDefs.length-1;i>=0;i--)
{var aTargets=oInit.aoColumnDefs[i].aTargets;if(!$.isArray(aTargets))
{_fnLog(oSettings,1,'aTargets must be an array of targets, not a '+(typeof aTargets));}
for(j=0,jLen=aTargets.length;j<jLen;j++)
{if(typeof aTargets[j]=='number'&&aTargets[j]>=0)
{while(oSettings.aoColumns.length<=aTargets[j])
{_fnAddColumn(oSettings);}
_fnColumnOptions(oSettings,aTargets[j],oInit.aoColumnDefs[i]);}
else if(typeof aTargets[j]=='number'&&aTargets[j]<0)
{_fnColumnOptions(oSettings,oSettings.aoColumns.length+aTargets[j],oInit.aoColumnDefs[i]);}
else if(typeof aTargets[j]=='string')
{for(k=0,kLen=oSettings.aoColumns.length;k<kLen;k++)
{if(aTargets[j]=="_all"||oSettings.aoColumns[k].nTh.className.indexOf(aTargets[j])!=-1)
{_fnColumnOptions(oSettings,k,oInit.aoColumnDefs[i]);}}}}}}
if(typeof aoColumnsInit!='undefined')
{for(i=0,iLen=aoColumnsInit.length;i<iLen;i++)
{_fnColumnOptions(oSettings,i,aoColumnsInit[i]);}}
for(i=0,iLen=oSettings.aaSorting.length;i<iLen;i++)
{if(oSettings.aaSorting[i][0]>=oSettings.aoColumns.length)
{oSettings.aaSorting[i][0]=0;}
var oColumn=oSettings.aoColumns[oSettings.aaSorting[i][0]];if(typeof oSettings.aaSorting[i][2]=='undefined')
{oSettings.aaSorting[i][2]=0;}
if(typeof oInit.aaSorting=="undefined"&&typeof oSettings.saved_aaSorting=="undefined")
{oSettings.aaSorting[i][1]=oColumn.asSorting[0];}
for(j=0,jLen=oColumn.asSorting.length;j<jLen;j++)
{if(oSettings.aaSorting[i][1]==oColumn.asSorting[j])
{oSettings.aaSorting[i][2]=j;break;}}}
_fnSortingClasses(oSettings);if(this.getElementsByTagName('thead').length===0)
{this.appendChild(document.createElement('thead'));}
if(this.getElementsByTagName('tbody').length===0)
{this.appendChild(document.createElement('tbody'));}
oSettings.nTHead=this.getElementsByTagName('thead')[0];oSettings.nTBody=this.getElementsByTagName('tbody')[0];if(this.getElementsByTagName('tfoot').length>0)
{oSettings.nTFoot=this.getElementsByTagName('tfoot')[0];}
if(bUsePassedData)
{for(i=0;i<oInit.aaData.length;i++)
{_fnAddData(oSettings,oInit.aaData[i]);}}
else
{_fnGatherData(oSettings);}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bInitialised=true;if(bInitHandedOff===false)
{_fnInitalise(oSettings);}});};})(jQuery,window,document);var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=true;var proto=new this;extend.call(proto,_instance);proto.base=function(){};delete Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing;}else if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto);}}};klass.ancestor=this;klass.extend=this.extend;klass.forEach=this.forEach;klass.implement=this.implement;klass.prototype=proto;klass.toString=this.toString;klass.valueOf=function(type){return(type=="object")?klass:constructor.valueOf();};extend.call(klass,_static);if(typeof klass.init=="function")klass.init();return klass;};Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&(typeof value=="function")&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};value.valueOf=function(type){return(type=="object")?value:method;};value.toString=Base.toString;}
this[source]=value;}else if(source){var extend=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){extend=this.extend||extend;}
var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key]);}}
for(var key in source){if(!proto[key])extend.call(this,key,source[key]);}}
return this;}};Base=Base.extend({constructor:function(){this.extend(arguments[0]);}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object){if(this.prototype[key]===undefined){block.call(context,object[key],key,object);}}},implement:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="function"){arguments[i](this.prototype);}else{this.prototype.extend(arguments[i]);}}
return this;},toString:function(){return String(this.valueOf());}});$.ajaxSetup({type:"POST",async:false,traditional:true,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=UTF-8"});if(!String.prototype.endsWith){String.prototype.endsWith=function(str){return(this.match(str+"$")==str);};}
if(!Object.keys){Object.keys=(function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length
return function(obj){if(typeof obj!=='object'&&typeof obj!=='function'||obj===null)throw new TypeError('Object.keys called on non-object')
var result=[]
for(var prop in obj){if(hasOwnProperty.call(obj,prop))result.push(prop)}
if(hasDontEnumBug){for(var i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i]))result.push(dontEnums[i])}}
return result}})()};if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined");}
var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!="[object Function]"){throw new TypeError(callback+" is not a function");}
if(thisArg){T=thisArg;}
A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}
k++;}
return A;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
if(!Array.prototype.lastIndexOf)
{Array.prototype.lastIndexOf=function(searchElement)
{"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(len===0)
return-1;var n=len;if(arguments.length>1)
{n=Number(arguments[1]);if(n!=n)
n=0;else if(n!=0&&n!=(1/0)&&n!=-(1/0))
n=(n>0||-1)*Math.floor(Math.abs(n));}
var k=n>=0?Math.min(n,len-1):len-Math.abs(n);for(;k>=0;k--)
{if(k in t&&t[k]===searchElement)
return k;}
return-1;};}
if(!Array.prototype.reduce){Array.prototype.reduce=function reduce(accumulator){var i,l=this.length,curr;if(typeof accumulator!=="function")
throw new TypeError("First argument is not callable");if((l==0||l===null)&&(arguments.length<=1))
throw new TypeError("Array length is 0 and no second argument");if(arguments.length<=1){curr=this[0];i=1;}
else{curr=arguments[1];}
for(i=i||0;i<l;++i){if(i in this)
curr=accumulator.call(undefined,curr,this[i],i,this);}
return curr;};}
var pathArray=window.location.pathname.split('/');var webAppPath;if(!(typeof(CONTEXT_PATH)=='undefined')){webAppPath=CONTEXT_PATH;}
if(webAppPath==undefined){webAppPath="/"+pathArray[1];}
if(webAppPath.endsWith("/")){webAppPath=webAppPath.substr(0,webAppPath.length-1);}
var GB_ANIMATION=true;var CDF_CHILDREN=1;var CDF_SELF=2;var ERROR_IMAGE=webAppPath+"/content/pentaho-cdf/resources/style/images/error.png";var CDF_ERROR_DIV='cdfErrorDiv';if($.blockUI){$.blockUI.defaults.fadeIn=0;$.blockUI.defaults.message='<div style="padding: 15px;"><img src="'+webAppPath+'/content/pentaho-cdf/resources/style/images/busy.gif" /><h3>Processing...</h3></div>';$.blockUI.defaults.css.left='40%';$.blockUI.defaults.css.top='30%';$.blockUI.defaults.css.marginLeft='85px';$.blockUI.defaults.css.width='170px';$.blockUI.defaults.css.opacity='.8';$.blockUI.defaults.css['-webkit-border-radius']='10px';$.blockUI.defaults.css['-moz-border-radius']='10px';}
var ERROR_CODES=[];ERROR_CODES["UNKNOWN"]=["ERROR: ","resources/style/images/error.jpg"];ERROR_CODES["0012"]=["No data available (MDXLookupRule did not execute successfully)","resources/style/images/alert.jpg"];ERROR_CODES["0006"]=["Could not establish a connection to the database","resources/style/images/error.jpg"];if(typeof $.SetImpromptuDefaults=='function')
$.SetImpromptuDefaults({prefix:'colsJqi',show:'slideDown'});var Dashboards={TRAFFIC_RED:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_red.png",TRAFFIC_YELLOW:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_yellow.png",TRAFFIC_GREEN:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_green.png",globalContext:true,escapeParameterValues:true,runningCalls:0,components:[],parameters:[],context:{},renderDelay:300,args:[],monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],i18nCurrentLanguageCode:null,i18nSupport:null};Dashboards.log=function(m,type){if(typeof console!="undefined"){if(type&&console[type]){console[type]("CDF: "+m);}else if(type==='exception'&&!console.exception){console.error(m.stack);}
else{console.log("CDF: "+m);}}};Dashboards.RefreshEngine=function(){var NO_REFRESH=0;var refreshQueue=new Array();var activeTimer=null;var globalRefreshPeriod=NO_REFRESH;var globalTimer=null;Dashboards.RefreshEngine.QueueItem=function(){return{nextRefresh:0,component:null};};var startGlobalRefresh=function(refreshPeriod){if(globalTimer!=null){clearInterval(globalTimer);globalTimer=null;}
globalRefreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;if(globalRefreshPeriod!=NO_REFRESH){globalTimer=setInterval("Dashboards.refreshEngine.fireGlobalRefresh()",globalRefreshPeriod*1000);}};var clearFromQueue=function(component){for(var i=0;i<refreshQueue.length;i++){if(refreshQueue[i].component==component){refreshQueue.splice(i,1);i--;}}};var clearQueue=function(){if(refreshQueue.length>0)refreshQueue.splice(0,refreshQueue.length);};var getSortedInsertPosition=function(coll,elem){var high=coll.length-1;var low=0;var mid;while(low<=high){mid=parseInt((low+high)/2)
if(coll[mid].nextRefresh>elem.nextRefresh){high=mid-1;}else if(coll[mid].nextRefresh<elem.nextRefresh){low=mid+1;}else{return mid;}}
return low;};var sortedInsert=function(rtArray,rtInfo){var pos=getSortedInsertPosition(rtArray,rtInfo);rtArray.splice(pos,0,rtInfo);};var stopTimer=function(){if(activeTimer!=null){clearTimeout(activeTimer);activeTimer=null;}};var restartTimer=function(){stopTimer();Dashboards.refreshEngine.fireRefresh();};var getCurrentTime=function(){var date=new Date();return date.getTime();};var isFirstInQueue=function(component){return refreshQueue.length>0&&refreshQueue[0].component==component;};var refreshComponent=function(component){Dashboards.update(component);};var insertInQueue=function(component){var time=getCurrentTime();if(!(component.refreshPeriod>0)){component.refreshPeriod=NO_REFRESH;}
if(component.refreshPeriod!=NO_REFRESH){var info=new Dashboards.RefreshEngine.QueueItem();info.nextRefresh=time+(component.refreshPeriod*1000);info.component=component;sortedInsert(refreshQueue,info);}};return{registerComponent:function(component,refreshPeriod){if(!component)return false;component.refreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;var wasFirst=isFirstInQueue(component);clearFromQueue(component);if(wasFirst)restartTimer();return true;},getRefreshPeriod:function(component){if(component&&component.refreshPeriod>0)return component.refreshPeriod;else return NO_REFRESH;},processComponent:function(component){clearFromQueue(component);insertInQueue(component);if(isFirstInQueue(component))restartTimer();return true;},processComponents:function(){clearQueue();for(var i=0;i<Dashboards.components.length;i++){insertInQueue(Dashboards.components[i]);}
restartTimer();return true;},fireRefresh:function(){activeTimer=null;var currentTime=getCurrentTime();while(refreshQueue.length>0&&refreshQueue[0].nextRefresh<=currentTime){var info=refreshQueue.shift();refreshComponent(info.component);}
if(refreshQueue.length>0){activeTimer=setTimeout("Dashboards.refreshEngine.fireRefresh()",refreshQueue[0].nextRefresh-currentTime);}},fireGlobalRefresh:function(){for(i=0;i<Dashboards.components.length;i++){var comp=Dashboards.components[i];if(!(comp.refreshPeriod>0)&&comp.type!="select"){refreshComponent(comp);}}},setGlobalRefresh:function(refreshPeriod){startGlobalRefresh(refreshPeriod);},getQueue:function(){return refreshQueue;}};};Dashboards.refreshEngine=new Dashboards.RefreshEngine();Dashboards.setGlobalContext=function(globalContext){Dashboards.globalContext=globalContext;};Dashboards.showProgressIndicator=function(){Dashboards.blockUIwithDrag();};Dashboards.hideProgressIndicator=function(){if(Dashboards.runningCalls<=0){$.unblockUI();Dashboards.showErrorTooltip();}};Dashboards.incrementRunningCalls=function(){Dashboards.runningCalls++;Dashboards.showProgressIndicator();};Dashboards.decrementRunningCalls=function(){Dashboards.runningCalls--;if(Dashboards.runningCalls<=0){Dashboards.hideProgressIndicator();Dashboards.runningCalls=0;}};Dashboards.bindControl=function(object){var objectType=typeof object["type"]=='function'?object.type():object.type;var classNames=[objectType,objectType.substring(0,1).toUpperCase()+objectType.substring(1),objectType.substring(0,1).toUpperCase()+objectType.substring(1)+'Component'];var objectImpl;for(var i=0;i<classNames.length&&(objectImpl==null||typeof objectImpl=='undefined');i++){try{eval('objectImpl = new '+classNames[i]);}catch(e){}}
if(typeof objectImpl=='undefined'){Dashboards.log("Object type "+object["type"]+" can't be mapped to a valid class","error");}else{$.extend(object,objectImpl);}};Dashboards.blockUIwithDrag=function(){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){$.blockUI.defaults.message='<div style="padding: 15px;"><img src="'+webAppPath+'/content/pentaho-cdf/resources/style/images/busy.gif" /><h3>'+Dashboards.i18nSupport.prop('processing.message')+'</h3></div>';}
$.blockUI();var handle=$('<div id="blockUIDragHandle" style="cursor: pointer; width: 170px; -webkit-border-radius: 5px; -moz-border-radius: 5px; background-color: rgba(0,0,0,0.25);" align="right"><a style="padding-right: 5px; text-decoration: none; color: black; font-weight: bold; font-color: black; font-size: 8pt" href="javascript:$.unblockUI()" title="Click to unblock">X</a></div>')
$("div.blockUI.blockMsg").prepend(handle);$("div.blockUI.blockMsg").draggable({handle:"#blockUIDragHandle"});};Dashboards.update=function(object){try{if(object.disabled){return;}
if(!(typeof(object.preExecution)=='undefined')){var ret=object.preExecution.apply(object);if(typeof ret!="undefined"&&!ret)
return;}
if(object.tooltip!=undefined){object._tooltip=typeof object["tooltip"]=='function'?object.tooltip():object.tooltip;}
if((object.update!=undefined)&&(typeof object['update']=='function')){object.update();this.refreshEngine.processComponent(object);}else{}
if(!(typeof(object.postExecution)=='undefined')){object.postExecution.apply(object);}
if(object._tooltip!=undefined){$("#"+object.htmlObject).attr("title",object._tooltip).tooltip({delay:0,track:true,fade:250});}}catch(e){this.log("Error updating "+object.name+":",'error');this.log(e,'exception');}};Dashboards.createAndCleanErrorDiv=function(){if($("#"+CDF_ERROR_DIV).length==0){$("body").append("<div id='"+CDF_ERROR_DIV+"'></div>");}
$("#"+CDF_ERROR_DIV).empty();};Dashboards.showErrorTooltip=function(){$(function(){$(".cdf_error").tooltip({delay:0,track:true,fade:250,showBody:" -- "})});};Dashboards.getComponent=function(name){for(i in this.components){if(this.components[i].name==name)
return this.components[i];}};Dashboards.getComponentByName=function(name){if(Dashboards.globalContext){return eval(name);}else{return Dashboards.getComponent(name);}};Dashboards.addComponents=function(components){for(var i=0;i<components.length;i++){Dashboards.bindControl(components[i]);}
this.components=this.components.concat(components);};Dashboards.registerEvent=function(ev,callback){if(typeof this.events=='undefined'){this.events={};}
this.events[ev]=callback;};Dashboards.addArgs=function(url){if(url!=undefined)
this.args=getURLParameters(url);};Dashboards.setI18nSupport=function(lc,i18nRef){if(i18nRef!=="undefined"&&lc!=="undefined"){Dashboards.i18nCurrentLanguageCode=lc;Dashboards.i18nSupport=i18nRef;}};Dashboards.init=function(components){this.loadStorage();if($.isArray(components)){Dashboards.addComponents(components);}
$(function(){Dashboards.initEngine();});};Dashboards.initEngine=function(){var components=this.components;var compCount=components.length;Dashboards.incrementRunningCalls();Dashboards.createAndCleanErrorDiv();if(typeof this.preInit=='function'){this.preInit();}
$(window).trigger('cdfAboutToLoad');var myself=this;setTimeout(function(){for(var i=0,len=components.length;i<len;i++){if(components[i].executeAtStart){Dashboards.update(components[i]);}}
$(window).trigger('cdfLoaded');if(typeof myself.postInit=='function'){myself.postInit();}
Dashboards.decrementRunningCalls();},Dashboards.renderDelay);};Dashboards.resetAll=function(){Dashboards.createAndCleanErrorDiv();var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){this.components[i].clear();}
var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){if(this.components[i].executeAtStart){this.update(this.components[i]);}}};Dashboards.processChange=function(object_name){var object=Dashboards.getComponentByName(object_name);var parameter=object.parameter;var value;if(typeof object['getValue']=='function'){value=object.getValue();}
if(value==null)
return;if(!(typeof(object.preChange)=='undefined')){var preChangeResult=object.preChange(value);value=preChangeResult!=undefined?preChangeResult:value;}
if(parameter){this.fireChange(parameter,value);}
if(!(typeof(object.postChange)=='undefined')){object.postChange(value);}};Dashboards.fireChange=function(parameter,value){Dashboards.createAndCleanErrorDiv();Dashboards.setParameter(parameter,value);var toUpdate=[];var workDone=false;for(var i=0,len=this.components.length;i<len;i++){if($.isArray(this.components[i].listeners)){for(var j=0;j<this.components[i].listeners.length;j++){if(this.components[i].listeners[j]==parameter&&!this.components[i].disabled){if(!workDone){workDone=true;Dashboards.incrementRunningCalls();}
toUpdate.push(this.components[i]);break;}}}}
setTimeout(function(){for(var i=0;i<toUpdate.length;i++){Dashboards.update(toUpdate[i]);}
if(workDone){Dashboards.decrementRunningCalls();}},Dashboards.renderDelay);};Dashboards.getParameterValue=function(parameterName){if(Dashboards.globalContext){return eval(parameterName);}else{return Dashboards.parameters[parameterName];}};Dashboards.getQueryParameter=function(parameterName){var queryString=window.location.search.substring(1);var parameterName=parameterName+"=";if(queryString.length>0){begin=queryString.indexOf(parameterName);if(begin!=-1){begin+=parameterName.length;end=queryString.indexOf("&",begin);if(end==-1){end=queryString.length}
return unescape(queryString.substring(begin,end));}
return"";}};Dashboards.setParameter=function(parameterName,parameterValue){if(parameterName==undefined||parameterName=="undefined"){Dashboards.log('Dashboards.setParameter: trying to set undefined!!','warn');return;}
if(Dashboards.globalContext){eval(parameterName+" = "+JSON.stringify(parameterValue));}else{if(Dashboards.escapeParameterValues){Dashboards.parameters[parameterName]=encode_prepare_arr(parameterValue);}else{Dashboards.parameters[parameterName]=parameterValue;}}};Dashboards.post=function(url,obj){var form='<form action="'+url+'" method="post">';for(o in obj){var v=(typeof obj[o]=='function'?obj[o]():obj[o]);if(typeof v=='string'){v=v.replace(/"/g,"\'")}
form+='"<input type="hidden" name="'+o+'" value="'+v+'"/>';}
form+='</form>';jQuery(form).appendTo('body').submit().remove();};Dashboards.clone=function clone(obj){var c=obj instanceof Array?[]:{};for(var i in obj){var prop=obj[i];if(typeof prop=='object'){if(prop instanceof Array){c[i]=[];for(var j=0;j<prop.length;j++){if(typeof prop[j]!='object'){c[i].push(prop[j]);}else{c[i].push(Dashboards.clone(prop[j]));}}}else{c[i]=Dashboards.clone(prop);}}else{c[i]=prop;}}
return c;};Dashboards.getArgValue=function(key)
{for(i=0;i<this.args.length;i++){if(this.args[i][0]==key){return this.args[i][1];}}
return undefined;};Dashboards.ev=function(o){return typeof o=='function'?o():o};Dashboards.callPentahoAction=function(obj,solution,path,action,parameters,callback){if(typeof callback=='function'){return Dashboards.pentahoAction(solution,path,action,parameters,function(json){callback(Dashboards.parseXActionResult(obj,json));});}
else{return Dashboards.parseXActionResult(obj,Dashboards.pentahoAction(solution,path,action,parameters,callback));}};Dashboards.urlAction=function(url,params,func){return Dashboards.executeAjax('xml',url,params,func);};Dashboards.executeAjax=function(returnType,url,params,func){if(typeof func=="function"){return $.ajax({url:url,type:"POST",dataType:returnType,async:true,data:params,complete:function(XMLHttpRequest,textStatus){func(XMLHttpRequest.responseXML);},error:function(XMLHttpRequest,textStatus,errorThrown){Dashboards.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});}
var result=$.ajax({url:url,type:"POST",dataType:returnType,async:false,data:params,error:function(XMLHttpRequest,textStatus,errorThrown){Dashboards.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});if(returnType=='xml'){return result.responseXML;}else{return result.responseText;}};Dashboards.pentahoAction=function(solution,path,action,params,func){return Dashboards.pentahoServiceAction('ServiceAction','xml',solution,path,action,params,func);};Dashboards.pentahoServiceAction=function(serviceMethod,returntype,solution,path,action,params,func){var url=webAppPath+"/"+serviceMethod;var arr={};arr.wrapper=false;arr.solution=solution;arr.path=path;arr.action=action;$.each(params,function(i,val){arr[val[0]]=val[1];});return Dashboards.executeAjax(returntype,url,arr,func);}
Dashboards.parseXActionResult=function(obj,html){var jXML=$(html);var error=jXML.find("SOAP-ENV\\:Fault");if(error.length==0){return jXML;}
var errorMessage="Error executing component "+obj.name;var errorDetails=new Array();errorDetails[0]=" Error details for component execution "+obj.name+" -- ";errorDetails[1]=error.find("SOAP-ENV\\:faultstring").find("SOAP-ENV\\:Text:eq(0)").text();error.find("SOAP-ENV\\:Detail").find("message").each(function(){errorDetails.push($(this).text())});if(errorDetails.length>8){errorDetails=errorDetails.slice(0,7);errorDetails.push("...");}
var out="<table class='errorMessageTable' border='0'><tr><td><img src='"+ERROR_IMAGE+"'></td><td><span class=\"cdf_error\" title=\" "+errorDetails.join('<br/>').replace(/"/g,"'")+"\" >"+errorMessage+" </span></td></tr></table/>";if(obj.visible==false){$("#"+CDF_ERROR_DIV).append("<br />"+out);}
else{$('#'+obj.htmlObject).html(out);}
return null;};Dashboards.setSettingsValue=function(name,object){var data={method:"set",key:name,value:JSON.stringify(object)};$.post("Settings",data,function(){});};Dashboards.getSettingsValue=function(key,value){var callback=typeof value=='function'?value:function(json){value=json;};$.getJSON("Settings?method=get&key="+key,callback);};Dashboards.fetchData=function(cd,params,callback){Dashboards.log('Dashboards.fetchData() is deprecated. Use Query objects instead','warn');if(cd!=undefined&&cd.dataAccessId!=undefined){for(param in params){cd['param'+params[param][0]]=Dashboards.getParameterValue(params[param][1]);}
$.post(webAppPath+"/content/cda/doQuery?",cd,function(json){callback(json);},'json');}
else if(cd!=undefined){var xactionFile=(cd.queryType=='cda')?"jtable-cda.xaction":"jtable.xaction";$.post(webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action="+xactionFile,cd,function(result){callback(result.values);},'json');}
else{callback([]);}};Dashboards.escapeHtml=function(input){var escaped=input.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");return escaped;};Dashboards.storage={};Dashboards.loadStorage=function(){if(Dashboards.context&&Dashboards.context.user==="anonymousUser"){return;}
var args={action:"read",_:(new Date()).getTime()};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){$.extend(Dashboards.storage,json);});};Dashboards.saveStorage=function(){if(Dashboards.context&&Dashboards.context.user==="anonymousUser"){return;}
var args={action:"store",storageValue:JSON.stringify(Dashboards.storage),_:(new Date()).getTime()};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){if(json.result!=true){Dashboards.log("Error saving storage",'error');}});};Dashboards.cleanStorage=function(){Dashboards.storage={};if(Dashboards.context&&Dashboards.context.user==="anonymousUser"){return;}
var args={action:"delete"};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){if(json.result!=true){Dashboards.log("Error deleting storage",'error');}});};Dashboards.propertiesArrayToObject=function(pArray){var obj={};for(p in pArray)if(pArray.hasOwnProperty(p)){var prop=pArray[p];obj[prop[0]]=prop[1];}
return obj;}
Dashboards.objectToPropertiesArray=function(obj){var pArray=[];for(key in obj)if(obj.hasOwnProperty(key)){pArray.push([key,obj[key]]);}
return pArray;}
function encode_prepare_arr(value){if(typeof value=="number"){return value;}else if($.isArray(value)){var a=new Array(value.length);$.each(value,function(i,val){a[i]=encode_prepare(val);});return a;}
else{return encode_prepare(value);}};function encode_prepare(s)
{if(s!=null){s=s.replace(/\+/g," ");if($.browser=="msie"||$.browser=="opera"){return Utf8.decode(s);}}
return s;};var Utf8={encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
function getURLParameters(sURL)
{if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");var arrURLParams=arrParams[1].split("&");var arrParam=[];for(i=0;i<arrURLParams.length;i++){var sParam=arrURLParams[i].split("=");if(sParam[0].indexOf("param",0)==0){var parameter=[sParam[0].substring(5,sParam[0].length),unescape(sParam[1])];arrParam.push(parameter);}}}
return arrParam;};function toFormatedString(value){value+='';x=value.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1))
x1=x1.replace(rgx,'$1'+','+'$2');return x1+x2;};function doCsvQuoting(value,separator,alwaysEscape){var QUOTE_CHAR='"';if(separator==null){return value;}
if(value==null){return null;}
if(value.indexOf(QUOTE_CHAR)>=0){value=value.replace(QUOTE_CHAR,QUOTE_CHAR.concat(QUOTE_CHAR));}
if(alwaysEscape||value.indexOf(separator)>=0){value=QUOTE_CHAR.concat(value,QUOTE_CHAR);}
return value;};sprintfWrapper={init:function(){if(typeof arguments=='undefined'){return null;}
if(arguments.length<1){return null;}
if(typeof arguments[0]!='string'){return null;}
if(typeof RegExp=='undefined'){return null;}
var string=arguments[0];var exp=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var matches=new Array();var strings=new Array();var convCount=0;var stringPosStart=0;var stringPosEnd=0;var matchPosEnd=0;var newString='';var match=null;while(match=exp.exec(string)){if(match[9]){convCount+=1;}
stringPosStart=matchPosEnd;stringPosEnd=exp.lastIndex-match[0].length;strings[strings.length]=string.substring(stringPosStart,stringPosEnd);matchPosEnd=exp.lastIndex;var negative=parseInt(arguments[convCount])<0?true:false;if(negative==0)negative=parseFloat(arguments[convCount])<0?true:false;matches[matches.length]={match:match[0],left:match[3]?true:false,sign:match[4]||'',pad:match[5]||' ',min:match[6]||0,precision:match[8],code:match[9]||'%',negative:negative,argument:String(arguments[convCount])};}
strings[strings.length]=string.substring(matchPosEnd);if(matches.length==0){return string;}
if((arguments.length-1)<convCount){return null;}
var code=null;var match=null;var i=null;for(i=0;i<matches.length;i++){var m=matches[i];if(m.code=='%'){substitution='%'}
else if(m.code=='b'){m.argument=String(Math.abs(parseInt(m.argument)).toString(2));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='c'){m.argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(m.argument)))));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='d'){m.argument=toFormatedString(String(Math.abs(parseInt(m.argument))));substitution=sprintfWrapper.convert(m);}
else if(m.code=='f'){m.argument=toFormatedString(String(Math.abs(parseFloat(m.argument)).toFixed(m.precision?m.precision:6)));substitution=sprintfWrapper.convert(m);}
else if(m.code=='o'){m.argument=String(Math.abs(parseInt(m.argument)).toString(8));substitution=sprintfWrapper.convert(m);}
else if(m.code=='s'){m.argument=m.argument.substring(0,m.precision?m.precision:m.argument.length)
substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='x'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m);}
else if(m.code=='X'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m).toUpperCase();}
else{substitution=m.match;}
newString+=strings[i];newString+=substitution;}
newString+=strings[i];return newString;},convert:function(match,nosign){if(nosign){match.sign='';}else{match.sign=match.negative?'-':match.sign;}
var l=match.min-match.argument.length+1-match.sign.length;var pad=new Array(l<0?0:l).join(match.pad);if(!match.left){if(match.pad=='0'||nosign){return match.sign+pad+match.argument;}else{return pad+match.sign+match.argument;}}else{if(match.pad=='0'||nosign){return match.sign+match.argument+pad.replace(/0/g,' ');}else{return match.sign+match.argument+pad;}}}}
sprintf=sprintfWrapper.init;Dashboards.normalizeAddInKey=function(key){if(key.indexOf('Component',key.length-'Component'.length)!==-1)
key=key.substring(0,key.length-'Component'.length);return key.charAt(0).toUpperCase()+key.substring(1);}
Dashboards.registerAddIn=function(component,slot,addIn){if(!this.addIns){this.addIns={};}
var key=this.normalizeAddInKey(component);if(!this.addIns[key]){this.addIns[key]={};}
if(!this.addIns[key][slot]){this.addIns[key][slot]={};}
this.addIns[key][slot][addIn.getName()]=addIn;};Dashboards.hasAddIn=function(component,slot,addIn){var key=this.normalizeAddInKey(component);return Boolean(this.addIns&&this.addIns[key]&&this.addIns[key][slot]&&this.addIns[key][slot][addIn]);};Dashboards.getAddIn=function(component,slot,addIn){var key=this.normalizeAddInKey(component);try{return this.addIns[key][slot][addIn];}catch(e){return null;}};Dashboards.setAddInDefaults=function(component,slot,addInName,defaults){var key=this.normalizeAddInKey(component);var addIn=this.getAddIn(key,slot,addInName);if(addIn){addIn.setDefaults(defaults);}};Dashboards.listAddIns=function(component,slot){var key=this.normalizeAddInKey(component);var addInList=[];try{var slot=this.addIns[key][slot];for(var addIn in slot)if(slot.hasOwnProperty(addIn)){addInList.push([addIn,slot[addIn].getLabel()]);}
return addInList;}catch(e){return[];}};Dashboards.safeClone=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options)if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=Dashboards.safeClone(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;}
Query=function(){var CDA_PATH=webAppPath+"/content/cda/doQuery?";var LEGACY_QUERY_PATH=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=jtable.xaction";var _mode='CDA';var _file='';var _id='';var _query='';var _callback=null;var _lastResultSet=null;var _page=0;var _pageSize=0;var _sortBy="";var _exportIframe=null;var _params=[];(function(args){switch(args.length){case 1:var cd=args[0];if(typeof cd.query!='undefined'){_mode='Legacy';_query=args[0];}else if(typeof cd.path!='undefined'&&typeof cd.dataAccessId!='undefined'){_mode='CDA';_file=cd.path;_id=cd.dataAccessId;if(typeof cd.sortBy=='string'&&cd.sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){_sortBy=cd.sortBy;}
if(cd.pageSize!=null){_pageSize=cd.pageSize;}}else{throw'InvalidQuery';}
break;case 2:_mode='CDA';var file=args[0];var id=args[1];if(typeof file!='string'||typeof id!='string'){throw'InvalidQuery';}else{_id=id;_file=file;}
break;default:throw"InvalidQuery";}}(arguments));var doQuery=function(outsideCallback){if(typeof _callback!='function'){throw'QueryNotInitialized';}
var url;var queryDefinition;var callback=(outsideCallback?outsideCallback:_callback);if(_mode=='CDA'){url=CDA_PATH;queryDefinition=buildQueryDefinition();}else if(_mode=='Legacy'){queryDefinition=_query;url=LEGACY_QUERY_PATH;}
$.post(url,queryDefinition,function(json){if(_mode=='Legacy'){json=eval("("+json+")");}
_lastResultSet=json;var clone=Dashboards.safeClone(true,{},_lastResultSet);if(_mode=='Legacy'){var newMetadata=[{"colIndex":0,"colType":"String","colName":"Name"}];for(var i=0;i<clone.metadata.length;i++){var x=i;newMetadata.push({"colIndex":x+1,"colType":"String","colName":clone.metadata[x]});}
clone.resultset=clone.values;clone.metadata=newMetadata;clone.values=null;}
callback(clone);});};function buildQueryDefinition(overrides){overrides=overrides||{};var queryDefinition={};var p=Dashboards.objectToPropertiesArray(Dashboards.safeClone({},Dashboards.propertiesArrayToObject(_params),overrides))
for(var param in p){if(p.hasOwnProperty(param)){var value;var name=p[param][0];value=Dashboards.getParameterValue(p[param][1]);if($.isArray(value)&&value.length==1&&(''+value[0]).indexOf(';')>=0){value=doCsvQuoting(value[0],';');}
if(typeof value=='function')value=value();queryDefinition['param'+name]=value;}}
queryDefinition.path=_file;queryDefinition.dataAccessId=_id;queryDefinition.pageSize=_pageSize;queryDefinition.pageStart=_page;queryDefinition.sortBy=_sortBy;return queryDefinition;};this.exportData=function(outputType,overrides,options){if(_mode!='CDA'){throw"UnsupportedOperation";}
if(!options){options={};}
var queryDefinition=buildQueryDefinition(overrides);queryDefinition.outputType=outputType;if(outputType=='csv'&&options.separator){queryDefinition.settingcsvSeparator=options.separator;}
if(options.filename){queryDefinition.settingattachmentName=options.filename;}
_exportIframe=_exportIframe||$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=CDA_PATH+$.param(queryDefinition);_exportIframe.appendTo($('body'));}
this.fetchData=function(params,callback){switch(arguments.length){case 0:if(_params&&_callback){return doQuery();}
break;case 1:if(typeof arguments[0]=="function"){return doQuery(arguments[0]);}else if(arguments[0]instanceof Array){_params=arguments[0];return doQuery();}
break;case 2:default:_params=params;_callback=callback;return doQuery();}
throw"InvalidInput";};this.lastResults=function(){if(_lastResultSet!==null){return Dashboards.safeClone(true,{},_lastResultSet);}else{throw"NoCachedResults";}};this.reprocessLastResults=function(outerCallback){if(_lastResultSet!==null){var clone=Dashboards.safeClone(true,{},_lastResultSet);var callback=outerCallback||_callback;return callback(clone);}else{throw"NoCachedResults";}};this.reprocessResults=function(outerCallback){if(_lastResultSet!==null){var clone=Dashboards.safeClone(true,{},_lastResultSet);var callback=(outsideCallback?outsideCallback:_callback);callback(_mode=='CDA'?clone:clone.values);}else{throw"NoCachedResults";}};this.setSortBy=function(sortBy){var newSort;if(sortBy===null||sortBy===undefined||sortBy===''){newSort='';}
else if(typeof sortBy=="string"){if(!sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){throw"InvalidSortExpression";}
newSort=sortBy.toUpperCase().split(',').filter(function(e){return e!=="";});}else if(sortBy instanceof Array){newSort=sortBy.map(function(d){return d.toUpperCase();});var invalidEntries=newSort.filter(function(e){return!e.match("^[0-9]+[adAD]?,?$")});if(invalidEntries.length>0){throw"InvalidSortExpression";}}
var same;if(newSort instanceof Array){same=newSort.length!=_sortBy.length;$.each(newSort,function(i,d){same=(same&&d==_sortBy[i]);if(!same){return false;}});}else{same=(newSort===_sortBy);}
_sortBy=newSort;return!same;};this.sortBy=function(sortBy,outsideCallback){var changed=this.setSortBy(sortBy);if(!changed){return false;}else if(_callback!==null){return doQuery(outsideCallback);}};this.setParameters=function(params){if((params instanceof Array)){_params=params;}else{throw"InvalidParameters";}};this.setCallback=function(callback){if(typeof callback=="function"){_callback=callback;}else{throw"InvalidCallback";}};this.nextPage=function(outsideCallback){if(_pageSize>0){_page+=_pageSize;return doQuery(outsideCallback);}else{throw"InvalidPageSize";}};this.prevPage=function(outsideCallback){if(_page>_pageSize){_page-=_pageSize;return doQuery(outsideCallback);}else if(_pageSize>0){_page=0;return doQuery(outsideCallback);}else{throw"AtBeggining";}};this.getPage=function(page,outsideCallback){if(page*_pageSize==_page){return false;}else if(typeof page=='number'&&page>=0){_page=page*_pageSize;return doQuery(outsideCallback);}else{throw"InvalidPage";}};this.setPageStartingAt=function(page){if(page==_page){return false;}else if(typeof page=='number'&&page>=0){_page=page;}else{throw"InvalidPage";}};this.pageStartingAt=function(page,outsideCallback){if(this.setPageStartingAt(page)){return doQuery(outsideCallback);}else{return false;}};this.setPageSize=function(pageSize){if(typeof pageSize=='number'&&pageSize>0){_pageSize=pageSize;}else{throw"InvalidPageSize";}};this.initPage=function(pageSize,outsideCallback){if(pageSize==_pageSize&&_page==0){return false;}else if(typeof pageSize=='number'&&pageSize>0){_page=0;_pageSize=pageSize;return doQuery(outsideCallback);}else{throw"InvalidPageSize";}};};(function(){function accessorDescriptor(field,fun)
{var desc={enumerable:true,configurable:true};desc[field]=fun;return desc;}
this.defineGetter=function defineGetter(obj,prop,get)
{if(Object.prototype.__defineGetter__)
return obj.__defineGetter__(prop,get);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("get",get));throw new Error("browser does not support getters");}
this.defineSetter=function defineSetter(obj,prop,set)
{if(Object.prototype.__defineSetter__)
return obj.__defineSetter__(prop,set);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("set",set));throw new Error("browser does not support setters");}})();BaseComponent=Base.extend({visible:true,clear:function(){$("#"+this.htmlObject).empty();},clone:function(parameterRemap,componentRemap,htmlRemap){var that;that=$.extend(true,{},this);if(that.parameters){that.parameters=that.parameters.map(function(param){if(param[1]in parameterRemap){return[param[0],parameterRemap[param[1]]];}else{return param;}});}
if(that.components){that.components=that.components.map(function(comp){if(comp in componentRemap){return componentRemap[comp];}else{return comp;}});}
that.htmlObject=!that.htmlObject?undefined:htmlRemap[that.htmlObject];if(that.listeners){that.listeners=that.listeners.map(function(param){if(param in parameterRemap){return parameterRemap[param];}else{return param;}});}
if(that.parameter&&that.parameter in parameterRemap){that.parameter=parameterRemap[that.parameter];}
return that;},getAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.getAddIn(type,slot,addIn);},hasAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.hasAddIn(type,slot,addIn);},getValuesArray:function(){var jXML;if(typeof(this.valuesArray)=='undefined'||this.valuesArray.length==0){if(typeof(this.queryDefinition)!='undefined'){var vid=(this.queryDefinition.queryType=="sql")?"sql":"none";if((this.queryDefinition.queryType=="mdx")&&(!this.valueAsId)){vid="mdx";}else if(this.queryDefinition.dataAccessId!==undefined&&!this.valueAsId){vid='cda';}
QueryComponent.makeQuery(this);var myArray=new Array();for(p in this.result)if(this.result.hasOwnProperty(p)){switch(vid){case"sql":myArray.push([this.result[p][0],this.result[p][1]]);break;case"mdx":myArray.push([this.result[p][1],this.result[p][0]]);break;case'cda':myArray.push([this.result[p][0],this.result[p][1]]);break;default:myArray.push([this.result[p][0],this.result[p][0]]);break;}}
return myArray;}else{var p=new Array(this.parameters?this.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=this.parameters[i][1]==""||this.parameters[i][1]=="NIL"?this.parameters[i][2]:Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
var myself=this;if(this.url){var arr={};$.each(p,function(i,val){arr[val[0]]=val[1];});jXML=Dashboards.parseXActionResult(myself,Dashboards.urlAction(this.url,arr));}else{jXML=Dashboards.callPentahoAction(myself,this.solution,this.path,this.action,p,null);}
var myArray=this.parseArray(jXML,false);return myArray;}}else{return this.valuesArray;}},parseArray:function(jData,includeHeader){if(jData===null){return[];}
if($(jData).find("CdaExport").size()>0){return this.parseArrayCda(jData,includeHeader);}
var myArray=new Array();var jHeaders=$(jData).find("COLUMN-HDR-ITEM");if(includeHeader&&jHeaders.size()>0){var _a=new Array();jHeaders.each(function(){_a.push($(this).text());});myArray.push(_a);}
var jDetails=$(jData).find("DATA-ROW");jDetails.each(function(){var _a=new Array();$(this).children("DATA-ITEM").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},parseArrayCda:function(jData,includeHeader){var myArray=new Array();var jHeaders=$(jData).find("ColumnMetaData");if(jHeaders.size()>0){if(includeHeader){var _a=new Array();jHeaders.each(function(){_a.push($(this).attr("name"));});myArray.push(_a);}}
var jDetails=$(jData).find("Row");jDetails.each(function(){var _a=new Array();$(this).children("Col").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},setAddInDefaults:function(slot,addIn,defaults){var type=typeof this.type=="function"?this.type():this.type;Dashboards.setAddInDefaults(type,slot,addIn,defaults)},setAddInOptions:function(slot,addIn,options){if(!this.addInOptions){this.addInOptions={};}
if(!this.addInOptions[slot]){this.addInOptions[slot]={};}
this.addInOptions[slot][addIn]=options},getAddInOptions:function(slot,addIn){var opts=null;try{opts=this.addInOptions[slot][addIn];}catch(e){}
return opts||{};}});var XactionComponent=BaseComponent.extend({update:function(){var myself=this;try{if(typeof(this.iframe)=='undefined'||!this.iframe){var p=new Array(this.parameters?this.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=this.parameters[i][1]==""?this.parameters[i][2]:Dashboards.getParameterValue(this.parameters[i][1]);if(this.value=="NIL"){this.value=this.parameters[i][2];}
p[i]=[key,value];}
if(typeof(this.serviceMethod)=='undefined'||this.serviceMethod=='ServiceAction'){var jXML=Dashboards.callPentahoAction(myself,this.solution,this.path,this.action,p,null);if(jXML!=null){$('#'+myself.htmlObject).html(jXML.find("ExecuteActivityResponse:first-child").text());}}else{var html=Dashboards.pentahoServiceAction(this.serviceMethod,'html',this.solution,this.path,this.action,p,null);$('#'+myself.htmlObject).html(html);}}else{var xactionIFrameHTML="<iframe id=\"iframe_"+this.htmlObject+"\""+" frameborder=\"0\""+" height=\"100%\""+" width=\"100%\" />";var iframe=$(xactionIFrameHTML);var url=webAppPath+"/ViewAction?wrapper=false"+"&solution="+this.solution+"&path="+this.path+"&action="+this.action;var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var arg="&"+encodeURIComponent(this.parameters[i][0])+"=";var val="";if(this.parameters[i][1]==""){val=encodeURIComponent(this.parameters[i][2]);}else{val=encodeURIComponent(Dashboards.getParameterValue(this.parameters[i][1]));if(val=="NIL"){val=encodeURIComponent(this.parameters[i][2])}}
url+=arg+val;}
if(!this.loading){this.loading=true;Dashboards.incrementRunningCalls();}
iframe.load(function(){if(this.contentWindow.document.body.innerHTML){myself.loading=false;Dashboards.decrementRunningCalls();}});$("#"+this.htmlObject).empty().append(iframe);iframe[0].contentWindow.location=url;}}catch(e){}}});var SelectBaseComponent=BaseComponent.extend({visible:false,update:function(){var ph=$("#"+this.htmlObject);var myArray=this.getValuesArray(),isMultiple=false;selectHTML="<select";if(this.size!=undefined){selectHTML+=" size='"+this.size+"'";}
if(this.type.toLowerCase().indexOf("selectmulti")!=-1){if(typeof(this.isMultiple)=='undefined'||this.isMultiple==true){selectHTML+=" multiple";isMultiple=true;}else
if(!this.isMultiple&&this.size==undefined){selectHTML+=" size='"+myArray.length+"'";}}
if(this.externalPlugin=="chosen"){selectHTML+=" class='chzn-select'";}
selectHTML+=">";var firstVal,currentVal=Dashboards.ev(Dashboards.getParameterValue(this.parameter)),currentIsValid=false;var hasCurrentVal=typeof currentVal!=undefined;var vid=!!this.valueAsId;var hasValueSelected=false;var isSelected=false;var currentValArray=[];if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else if(typeof(currentVal)=="string"){currentValArray=currentVal.split("|");}
for(var i=0,len=myArray.length;i<len;i++){if(myArray[i]!=null&&myArray[i].length>0){var ivid=vid||myArray[i][0]==null;var value,label;if(myArray[i].length>1){value=""+myArray[i][ivid?1:0];label=""+myArray[i][1];}else{value=""+myArray[i][0];label=""+myArray[i][0];}
if(i==0){firstVal=value;}
if(jQuery.inArray(value,currentValArray)>-1){currentIsValid=true;}
selectHTML+="<option value = '"+Dashboards.escapeHtml(value)+"' >"+Dashboards.escapeHtml(label)+"</option>";}}
selectHTML+="</select>";ph.html(selectHTML);if(isMultiple?!currentIsValid&&currentVal!=='':!currentIsValid){var replacementValue=(this.defaultIfEmpty)?firstVal:null;$("select",ph).val(replacementValue);Dashboards.setParameter(this.parameter,replacementValue);Dashboards.processChange(this.name);}else{$("select",ph).val(currentValArray);}
if(this.externalPlugin=="chosen"){ph.find("select.chzn-select").chosen();}
var myself=this;$("select",ph).change(function(){Dashboards.processChange(myself.name);});}});var SelectComponent=SelectBaseComponent.extend({defaultIfEmpty:true,getValue:function(){return $("#"+this.htmlObject+" select").val();}});var SelectMultiComponent=SelectBaseComponent.extend({getValue:function(){var ph=$("#"+this.htmlObject+" select");if(ph.hasClass("chzn-select")&&ph.val()==null)
return[];return ph.val();}});var JFreeChartComponent=BaseComponent.extend({update:function(){var xactionFile=(this.chartDefinition.queryType=='cda')?"jfreechart-cda.xaction":"jfreechart.xaction";this.callPentahoAction(xactionFile);},getParameters:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chartDefinition passed","error");return;}
if(typeof cd.titleKey!=="undefined"&&typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){cd.title=Dashboards.i18nSupport.prop(cd.titleKey);}
var cdaParameterString=null;if(cd.queryType=="cda"){if($.isArray(this.parameters)){var param;for(var i=0;i<this.parameters.length;i++){param=this.parameters[i];if($.isArray(param)&&param.length>=2){var name=param[0];var value=param[1];if(value){value=doCsvQuoting(value,'=');}
if(i==0)cdaParameterString="";else cdaParameterString+=";";cdaParameterString+=doCsvQuoting(name+"="+value,';');}}}}
var cd0=cd.chartOptions!=undefined?$.extend({},Dashboards.ev(cd.chartOptions),cd):cd;var parameters=[];for(p in cd0){var key=p;var value=typeof cd0[p]=='function'?cd0[p]():cd0[p];parameters.push([key,value]);}
if(cdaParameterString!=null){parameters.push(["cdaParameterString",cdaParameterString]);}
return parameters;},callPentahoAction:function(action){Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions",action,this.getParameters(),function(jXML){if(jXML!=null){if(myself.chartDefinition.caption!=undefined){myself.buildCaptionWrapper($(jXML.find("ExecuteActivityResponse:first-child").text()),action);}
else{$('#'+myself.htmlObject).html(jXML.find("ExecuteActivityResponse:first-child").text());}}
Dashboards.decrementRunningCalls();});},buildCaptionWrapper:function(chart,cdfComponent){var exportFile=function(type,cd){var xactionFile=(cd.queryType=='cda')?"jtable-cda.xaction":"jtable.xaction";var obj=$.extend({solution:"system",path:"pentaho-cdf/actions",action:xactionFile,exportType:type},cd);Dashboards.post(webAppPath+'/content/pentaho-cdf/Export',obj);};var myself=this;var cd=myself.chartDefinition;var captionOptions=$.extend({title:{title:cd.title!=undefined?cd.title:"Details",oclass:'title'},chartType:{title:"Chart Type",show:function(){return cd.chartType!='function'&&(cd.chartType=="BarChart"||cd.chartType=="PieChart")},icon:function(){return cd.chartType=="BarChart"?webAppPath+'/content/pentaho-cdf/resources/style/images/pie_icon.png':webAppPath+'/content/pentaho-cdf/resources/style/images/bar_icon.png';},oclass:'options',callback:function(){cd.chartType=cd.chartType=="BarChart"?"PieChart":"BarChart";myself.update();}},excel:{title:"Excel",icon:webAppPath+'/content/pentaho-cdf/resources/style/images/excel_icon.png',oclass:'options',callback:function(){exportFile("excel",cd);}},csv:{title:"CSV",icon:webAppPath+'/content/pentaho-cdf/resources/style/images/csv_icon.gif',oclass:'options',callback:function(){exportFile("csv",cd);}},zoom:{title:'Zoom',icon:webAppPath+'/content/pentaho-cdf/resources/style/images/magnify.png',oclass:'options',callback:function(){Dashboards.incrementRunningCalls();var parameters=myself.getParameters();var width=200,height=200;var urlTemplate,parameterName="";for(p in parameters){if(parameters[p][0]=='width'){width+=parameters[p][1];parameters[p]=['width',width]};if(parameters[p][0]=='height'){height+=parameters[p][1];parameters[p]=['height',height]};if(parameters[p][0]=='parameterName'){parameterName=parameters[p][1];parameters[p]=['parameterName','parameterValue']};if(parameters[p][0]=='urlTemplate'){urlTemplate=parameters[p][1];parameters[p]=['urlTemplate',"javascript:chartClick('"+myself.name+"','{parameterValue}');"]};}
myself.zoomCallBack=function(value){eval(urlTemplate.replace("{"+parameterName+"}",value));};Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions",cdfComponent,parameters,function(jXML){if(jXML!=null){var openWindow=window.open(webAppPath+"/content/pentaho-cdf/js/captify/zoom.html","_blank",'width='+(width+10)+',height='+(height+10));var maxTries=10;var loadChart=function(){if(openWindow.loadChart!=undefined)openWindow.loadChart(jXML.find("ExecuteActivityResponse:first-child").text())
else if(maxTries>0){maxTries-=1;setTimeout(loadChart,500);}};loadChart();}
Dashboards.decrementRunningCalls();});}},details:{title:'Details',icon:webAppPath+'/content/pentaho-cdf/resources/style/images/table.png',oclass:'options',callback:function(){myself.pivotDefinition={jndi:cd.jndi,catalog:cd.catalog,query:cd.query};PivotLinkComponent.openPivotLink(myself);}}},cd.caption);var captionId=myself.htmlObject+'caption';var caption=$('<div id="'+captionId+'" ></div>');chart.attr("id",myself.htmlObject+'image');chart.attr("rel",myself.htmlObject+"caption");chart.attr("class","captify");for(o in captionOptions){var show=captionOptions[o].show==undefined||(typeof captionOptions[o].show=='function'?captionOptions[o].show():captionOptions[o].show)?true:false;if(this.chartDefinition.queryType!="mdx"&&captionOptions[o].title=="Details"){show=false;};if(show){var icon=captionOptions[o].icon!=undefined?(typeof captionOptions[o].icon=='function'?captionOptions[o].icon():captionOptions[o].icon):undefined;var op=icon!=undefined?$('<image id ="'+captionId+o+'" src = "'+icon+'"></image>'):$('<span id ="'+captionId+o+'">'+captionOptions[o].title+'</span>');op.attr("class",captionOptions[o].oclass!=undefined?captionOptions[o].oclass:"options");op.attr("title",captionOptions[o].title);caption.append(op);}};$("#"+myself.htmlObject).empty();var bDetails=$('<div class="caption-details">Details</div>');$("#"+myself.htmlObject).append(bDetails);$("#"+myself.htmlObject).append(chart);$("#"+myself.htmlObject).append(caption);$('img.captify').captify($.extend({bDetails:bDetails,spanWidth:'95%',hideDelay:3000,hasButton:false,opacity:'0.5'},cd.caption));bDetails.one('capityFinished',function(e,wrapper){var chartOffset=chart.offset();var bDetailsOffset=bDetails.offset();if(chart.length>1){bDetails.bind("mouseenter",function(){$("#"+myself.htmlObject+'image').trigger('detailsClick',[this]);});bDetails.css("left",bDetails.position().left+$(chart[1]).width()-bDetails.width()-5);bDetails.css("top",bDetails.position().top+$(chart[1]).height()-bDetails.height());$(chart[1]).append(chart[0]);}
for(o in captionOptions)
if(captionOptions[o].callback!=undefined)
$("#"+captionId+o).bind("click",captionOptions[o].callback);});}});var DialComponent=JFreeChartComponent.extend({update:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chartDefinition passed","error");return;}
cd.chartType='DialChart';var intervals=cd.intervals;var colors=cd.colors;if(colors!=undefined&&intervals.length!=colors.length){Dashboards.log("Fatal - Number of intervals differs from number of colors","error");return;}
this.callPentahoAction(cd.queryType=='cda'?"jfreechartdial-cda.xaction":"jfreechartdial.xaction");}});var OpenFlashChartComponent=JFreeChartComponent.extend({callPentahoAction:function(){Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions","openflashchart.xaction",this.getParameters(),function(jXML){if(jXML!=null){var result=jXML.find("ExecuteActivityResponse:first-child").text().replace(/openflashchart/g,webAppPath+"/openflashchart");getDataFuntion=result.match(/getData.*\(\)/gi);$("#"+myself.htmlObject).html(result);}
Dashboards.decrementRunningCalls();});OpenFlashChartComponent.prototype.onClick=function(value){if(getDataFuntion!=null&&myself.chartDefinition.urlTemplate!=undefined&&myself.chartDefinition.parameterName!=undefined){myself.data=myself.data!=undefined?myself.data:eval('('+eval(getDataFuntion[0])+')');if(myself.data.x_axis!=undefined){var urlTemplate=myself.chartDefinition.urlTemplate.replace("{"+myself.chartDefinition.parameterName+"}",myself.data.x_axis.labels.labels[value]);eval(urlTemplate);}}};}});var TrafficComponent=BaseComponent.extend({update:function(){var cd=this.trafficDefinition;if(cd==undefined){Dashboards.log("Fatal - No trafficDefinition passed","error");return;}
var intervals=cd.intervals;if(intervals==undefined){cd.intervals=[-1,1];}
var parameters=[];for(p in cd){var key=p;var value=typeof cd[p]=='function'?cd[p]():cd[p];parameters.push([key,value]);}
Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions","traffic.xaction",parameters,function(result){var value=$(result).find("VALUE").text();var i=$("<img>").attr("src",value<=cd.intervals[0]?Dashboards.TRAFFIC_RED:(value>=cd.intervals[1]?Dashboards.TRAFFIC_GREEN:Dashboards.TRAFFIC_YELLOW));$('#'+myself.htmlObject).html(i);if(cd.showValue!=undefined&&cd.showValue==true){var tooltip="Value: "+value+" <br /><img align='middle' src='"+Dashboards.TRAFFIC_RED+"'/> &le; "+cd.intervals[0]+" &lt;  <img align='middle' src='"+Dashboards.TRAFFIC_YELLOW+"'/> &lt; "+cd.intervals[1]+" &le; <img align='middle' src='"+Dashboards.TRAFFIC_GREEN+"'/> <br/>"+(tooltip!=undefined?tooltip:"");$('#'+myself.htmlObject).attr("title",tooltip+(myself._tooltip!=undefined?myself._tooltip:"")).tooltip({delay:0,track:true,fade:250});}
Dashboards.decrementRunningCalls();});}});var TimePlotComponent=BaseComponent.extend({reset:function(){this.timeplot=undefined;this.chartDefinition.dateRangeInput=this.InitialDateRangeInput;this.listeners=this.InitialListeners;},update:function(){var cd=this.chartDefinition;this.InitialListeners=this.InitialListeners==undefined?this.listeners:this.InitialListeners;this.InitialDateRangeInput=this.InitialDateRangeInput==undefined?cd.dateRangeInput:this.InitialDateRangeInput;if(cd.updateOnDateRangeInputChange!=true&&this.timeplot!=undefined&&cd.dateRangeInput!=undefined){if(this.updateTimeplot!=false&&this.timeplot._plots.length>0){var lastEventPlot=this.timeplot._plots[this.timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(this.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(this.endDateParameter)+" 23:59:59",lastEventPlot._eventSource,"iso8601",this.geometry._earliestDate,this.geometry._latestDate);}
return;}
if(cd.dateRangeInput!=undefined&&this.timeplot==undefined){cd.dateRangeInput=Dashboards.getComponent(cd.dateRangeInput);this.startDateParameter=cd.dateRangeInput.parameter[0];this.endDateParameter=cd.dateRangeInput.parameter[1];this.listeners=this.listeners==undefined?[]:this.listeners;this.listeners=this.listeners.concat(this.startDateParameter).concat(this.endDateParameter);}
if(typeof Timeplot!="undefined"&&Dashboards.timePlotColors==undefined){Dashboards.timePlotColors=[new Timeplot.Color('#820000'),new Timeplot.Color('#13E512'),new Timeplot.Color('#1010E1'),new Timeplot.Color('#E532D1'),new Timeplot.Color('#1D2DE1'),new Timeplot.Color('#83FC24'),new Timeplot.Color('#A1D2FF'),new Timeplot.Color('#73F321')];}
var timePlotTimeGeometry=new Timeplot.DefaultTimeGeometry({gridColor:"#000000",axisLabelsPlacement:"top",gridType:"short",yAxisColor:"rgba(255,255,255,0)",gridColor:"rgba(100,100,100,1)"});var timePlotValueGeometry=new Timeplot.DefaultValueGeometry({gridColor:"#000000",min:0,axisLabelsPlacement:"left",gridType:"short",valueFormat:function(value){return toFormatedString(value);}});var timePlotEventSource=new Timeplot.DefaultEventSource();var eventSource2=new Timeplot.DefaultEventSource();var timePlot;var obj=this;if(cd==undefined){Dashboards.log("Fatal - No chart definition passed","error");return;}
if(cd.showValues==undefined){cd.showValues=true;}
var cols=typeof cd['columns']=='function'?cd['columns']():cd['columns'];if(cols==undefined||cols.length==0){Dashboards.log("Fatal - No 'columns' property passed in chartDefinition","error");return;}
var title=$('<div></div>');if(cd.title!=undefined){title.append('<span style="text-transform: lowercase;">'+cd.title+'&nbsp; &nbsp; &nbsp;</span>');}
var plotInfo=[];for(var i=0,j=0;i<cols.length;i++,j++){j=j>7?0:j;title.append('<span id="'+obj.name+'Plot'+i+'Header" style="color:'+Dashboards.timePlotColors[j].toHexString()+'">'+cols[i]+' &nbsp;&nbsp;</span>');var plotInfoOpts={id:obj.name+"Plot"+i,name:cols[i],dataSource:new Timeplot.ColumnSource(timePlotEventSource,i+1),valueGeometry:timePlotValueGeometry,timeGeometry:timePlotTimeGeometry,lineColor:Dashboards.timePlotColors[j],showValues:cd.showValues,hideZeroToolTipValues:cd.hideZeroToolTipValues!=undefined?cd.hideZeroToolTipValues:false,showValuesMode:cd.showValuesMode!=undefined?cd.showValuesMode:"header",toolTipFormat:function(value,plot){return plot._name+" = "+toFormatedString(value);},headerFormat:function(value,plot){return plot._name+" = "+toFormatedString(value)+"&nbsp;&nbsp;";}};if(cd.dots==true){plotInfoOpts.dotColor=Dashboards.timePlotColors[j];}
if(cd.fill==true){plotInfoOpts.fillColor=Dashboards.timePlotColors[j].transparency(0.5);}
plotInfo.push(new Timeplot.createPlotInfo(plotInfoOpts));}
var eventSource2=undefined;var eventSourcePlot=undefined;if(cd.dateRangeInput!=undefined||(cd.events&&cd.events.show==true)){this.rangeColor="00FF00";eventSource2=new Timeplot.DefaultEventSource();eventSourcePlot=Timeplot.createPlotInfo({id:cd.dateRangeInput!=undefined?"eventPlot":"events",eventSource:eventSource2,timeGeometry:timePlotTimeGeometry,lineColor:"#FF0000",rangeColor:this.rangeColor,getSelectedRegion:function(start,end){myself.updateDateRangeInput(start,end);}});plotInfo.push(eventSourcePlot);}
$("#"+this.htmlObject).html(title);$("#"+this.htmlObject).append("<div class='timeplot'></div>");if(cd.height>0){$("#"+this.htmlObject+" > div.timeplot").css("height",cd.height);}
if(cd.width>0){$("#"+this.htmlObject+" > div.timeplot").css("width",cd.width);}
timeplot=Timeplot.create($("#"+this.htmlObject+" > div.timeplot")[0],plotInfo);obj.timeplot=timeplot;obj.geometry=timePlotTimeGeometry;var parameters=[];for(p in cd){var key=p;var value=typeof cd[p]=='function'?cd[p]():cd[p];parameters.push(key+"="+value);}
var allData=undefined;var timePlotEventSourceUrl=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=timelinefeeder.xaction&"+parameters.join('&');var myself=this;if(cd.events&&cd.events.show==true){var parameters=[];for(p in cd.events){var key=p;var value=typeof cd.events[p]=='function'?cd.events[p]():cd.events[p];parameters.push(key+"="+value);}
var eventUrl=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=timelineeventfeeder.xaction&"+parameters.join('&');timeplot.loadText(timePlotEventSourceUrl,",",timePlotEventSource,null,null,function(range){timeplot.loadJSON(eventUrl,eventSource2,function(data){data.events=myself.filterEvents(data.events,range);if(cd.dateRangeInput){var lastEventPlot=timeplot._plots[timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(obj.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(obj.endDateParameter)+" 23:59:59",eventSource2,"iso8601",timePlotTimeGeometry._earliestDate,timePlotTimeGeometry._latestDate);}})});}
else
timeplot.loadText(timePlotEventSourceUrl,",",timePlotEventSource,null,null,function(){if(cd.dateRangeInput){var lastEventPlot=timeplot._plots[timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(obj.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(obj.endDateParameter)+" 23:59:59",eventSource2,"iso8601",timePlotTimeGeometry._earliestDate,timePlotTimeGeometry._latestDate);}});},filterEvents:function(events,range){var result=[];var min=MetaLayer.toDateString(new Date(range.earliestDate));var max=MetaLayer.toDateString(new Date(range.latestDate));for(i=0;i<events.length;i++){if(events[i].start>=min&&((events[i].end==undefined&&events[i].start<=max)||events[i].end<=max)){result.push(events[i]);}}
return result;},updateDateRangeInput:function(start,end){var toDateString=function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());return d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));};if(this.chartDefinition.dateRangeInput!=undefined){if(start>end){var aux=start;start=end;end=aux;}
Dashboards.setParameter(this.startDateParameter,toDateString(start));Dashboards.setParameter(this.endDateParameter,toDateString(end));this.updateTimeplot=false;Dashboards.update(this.chartDefinition.dateRangeInput);Dashboards.fireChange(this.startDateParameter,toDateString(start));this.updateTimeplot=true;}}});var TextComponent=BaseComponent.extend({update:function(){$("#"+this.htmlObject).html(this.expression());}});var TextInputComponent=BaseComponent.extend({update:function(){selectHTML="<input";selectHTML+=" type=test id='"+this.name+"' name='"+this.name+"' + value='"+
Dashboards.getParameterValue(this.parameter)+
(this.charWidth?("' + size='"+this.charWidth):"")+
(this.maxChars?("' + maxlength='"+this.maxChars):"")+"'>";$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});},getValue:function(){return $("#"+this.name).val();}});$(function(){$.datepicker.setDefaults($.datepicker.regional[''])});var DateInputComponent=BaseComponent.extend({update:function(){var format=(this.dateFormat==undefined||this.dateFormat==null)?'yy-mm-dd':this.dateFormat;var myself=this;var startDate,endDate;if(this.startDate=='TODAY')startDate=new Date();else if(this.startDate)startDate=$.datepicker.parseDate(format,this.startDate);if(this.endDate=='TODAY')endDate=new Date();else if(this.endDate)endDate=$.datepicker.parseDate(format,this.endDate);$("#"+this.htmlObject).html($("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter)).css("width","80px"));$(function(){$("#"+myself.htmlObject+" input").datepicker({dateFormat:format,changeMonth:true,changeYear:true,minDate:startDate,maxDate:endDate,onSelect:function(date,input){Dashboards.processChange(myself.name);}});if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){$("#"+myself.htmlObject+" input").datepicker('option',$.datepicker.regional[Dashboards.i18nCurrentLanguageCode]);}});},getValue:function(){return $("#"+this.name).val();}});var DateRangeInputComponent=BaseComponent.extend({update:function(){var dr;if(this.singleInput==undefined||this.singleInput==true){dr=$("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter[0])+" > "+Dashboards.getParameterValue(this.parameter[1])).css("width","170px");$("#"+this.htmlObject).html(dr);}else{dr=$("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter[0])).css("width","80px");$("#"+this.htmlObject).html(dr);dr.after($("<input/>").attr("id",this.name+"2").attr("value",Dashboards.getParameterValue(this.parameter[1])).css("width","80px"));if(this.inputSeparator!=undefined){dr.after(this.inputSeparator);}}
var offset=dr.offset();var myself=this;var earliestDate=this.earliestDate!=undefined?Dashboards.getParameterValue(this.earliestDate):Date.parse('-1years');var latestDate=this.latestDate!=undefined?Dashboards.getParameterValue(this.latestDate):Date.parse('+1years');var leftOffset=this.leftOffset!=undefined?this.leftOffset:0;var topOffset=this.topOffset!=undefined?this.topOffset:15;var changed,closed;function triggerWhenDone(){if(changed&&closed){myself.fireInputChange(myself.startValue,myself.endValue);changed=closed=false;}};$(function(){$("#"+myself.htmlObject+" input").daterangepicker({posX:offset.left+leftOffset,posY:offset.top+topOffset,earliestDate:earliestDate,latestDate:latestDate,dateFormat:'yy-mm-dd',onOpen:function(){changed=closed=false;myself.startValue=null;myself.endValue=null;},onDateSelect:function(rangeA,rangeB){changed=true;myself.storeChanges(rangeA,rangeB);triggerWhenDone();},onClose:function(){closed=true;triggerWhenDone();}});});},fireInputChange:function(start,end){if(this.preChange){this.preChange(start,end);}
if(this.parameter)
{if(this.parameter.length==2)Dashboards.setParameter(this.parameter[1],end);if(this.parameter.length>0)Dashboards.fireChange(this.parameter[0],start);}
if(this.postChange){this.postChange(start,end);}},storeChanges:function(start,end){this.startValue=start;this.endValue=end;}},{fireDateRangeInputChange:function(name,rangeA,rangeB){var object=Dashboards.getComponentByName(name);if(!(typeof(object.preChange)=='undefined')){object.preChange(rangeA,rangeB);}
var parameters=eval(name+".parameter");Dashboards.setParameter(parameters[1],rangeB);Dashboards.fireChange(parameters[0],rangeA);if(!(typeof(object.postChange)=='undefined')){object.postChange(rangeA,rangeB);}}});var MonthPickerComponent=BaseComponent.extend({update:function(){var selectHTML=this.getMonthPicker(this.name,this.size,this.initialDate,this.minDate,this.maxDate,this.months);$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);});},getValue:function(){var value=$("#"+this.name).val()
var year=value.substring(0,4);var month=parseInt(value.substring(5,7)-1);var d=new Date(year,month,1);var selectHTML=this.getMonthPicker(this.name,this.size,d,this.minDate,this.maxDate,this.months);$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);});return value;},getMonthPicker:function(object_name,object_size,initialDate,minDate,maxDate,monthCount){var selectHTML="<select";selectHTML+=" id='"+object_name+"'";if(minDate==undefined){minDate=new Date();minDate.setYear(1980);}
if(maxDate==undefined){maxDate=new Date();maxDate.setYear(2060);}
if(monthCount==undefined||monthCount==0){var monthsToAdd=(maxDate.getFullYear()-minDate.getFullYear())*12;monthCount=(maxDate.getMonth()-minDate.getMonth())+monthsToAdd;}
if(object_size!=undefined){selectHTML+=" size='"+object_size+"'";}
var currentDate=new Date(+initialDate);currentDate.setMonth(currentDate.getMonth()-monthCount/2-1);for(var i=0;i<=monthCount;i++){currentDate.setMonth(currentDate.getMonth()+1);if(currentDate>=minDate&&currentDate<=maxDate)
{selectHTML+="<option value = '"+currentDate.getFullYear()+"-"+this.zeroPad(currentDate.getMonth()+1,2)+"'";if(currentDate.getFullYear()==initialDate.getFullYear()&&currentDate.getMonth()==initialDate.getMonth()){selectHTML+="selected='selected'"}
selectHTML+="' >"+Dashboards.monthNames[currentDate.getMonth()]+" "+currentDate.getFullYear()+"</option>";}}
selectHTML+="</select>";return selectHTML;},zeroPad:function(num,size){var n="00000000000000"+num;return n.substring(n.length-size,n.length);}});var ToggleButtonBaseComponent=BaseComponent.extend({update:function(){var myArray=this.getValuesArray();selectHTML="";var currentVal=Dashboards.getParameterValue(this.parameter);currentVal=(typeof currentVal=='function')?currentVal():currentVal;var isSelected=false;var currentValArray=[];if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else if(typeof(currentVal)=="string"){currentValArray=currentVal.split("|");}
var vid=this.valueAsId==false?0:1;var hasCurrentVal=false;outer:for(var i=0;i<currentValArray.length;i++){for(var y=0;y<myArray.length;y++){if(currentValArray[i]==myArray[y][vid]){hasCurrentVal=true;break outer;}}}
if(!hasCurrentVal&&this.defaultIfEmpty){currentValArray=[myArray[0][vid]];this.currentVal=currentValArray;Dashboards.setParameter(this.parameter,currentValArray);Dashboards.processChange(this.name);}
selectHTML+="<ul class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'>"
for(var i=0,len=myArray.length;i<len;i++){selectHTML+="<li class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'><label><input onclick='ToggleButtonBaseComponent.prototype.callAjaxAfterRender(\""+this.name+"\")'";isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][vid];if(isSelected){break;}}
if(this.type=='radio'||this.type=='radioComponent'){if((i==0&&!hasCurrentVal)||(hasCurrentVal&&(myArray[i][vid]==currentVal))){selectHTML+=" CHECKED";}
selectHTML+=" type='radio'";}else{if((i==0&&!hasCurrentVal&&this.defaultIfEmpty)||(hasCurrentVal&&isSelected)){selectHTML+=" CHECKED";}
selectHTML+=" type='checkbox'";}
selectHTML+="class='"+this.name+"' name='"+this.name+"' value='"+myArray[i][vid]+"' /> "+myArray[i][1]+"</label></li>"+((this.separator==undefined||this.separator==null||this.separator=="null")?"":this.separator);}
selectHTML+="</ul>"
$("#"+this.htmlObject).html(selectHTML);this.currentVal=null;},callAjaxAfterRender:function(name){setTimeout(function(){Dashboards.processChange(name)},1);}});var RadioComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{return $("#"+this.htmlObject+" ."+this.name+":checked").val()}}});var CheckComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{var a=new Array()
$("#"+this.htmlObject+" ."+this.name+":checked").each(function(i,val){a.push($(this).val());});return a;}}});var MultiButtonComponent=ToggleButtonBaseComponent.extend({indexes:[],update:function(){var myArray=this.getValuesArray();this.cachedArray=myArray;var cssWrapperClass="pentaho-toggle-button pentaho-toggle-button-up "+((this.verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");selectHTML="";var firstVal;var valIdx=this.valueAsId?1:0;var lblIdx=1;if(this.isMultiple==undefined)this.isMultiple=false;var ph=$("<div>");for(var i=0,len=myArray.length;i<len;i++){var value=myArray[i][valIdx],label=myArray[i][lblIdx],classes=cssWrapperClass+this.getExtraCss(i,len,this.verticalOrientation),selector;value=(value==null?null:value.replace('"','&quot;'));label=(label==null?null:label.replace('"','&quot;'));if(i==0){firstVal=value;}
selectHTML="<div class='"+classes+"'><button name='"+this.name+"'>"+label+"</button  >"+"</div>";selector=$(selectHTML);var myself=this;(function(index){selector.click(function(){MultiButtonComponent.prototype.clickButton(myself.htmlObject,myself.name,index,myself.isMultiple,myself.verticalOrientation);});}(i));ph.append(selector);if(!(this.separator==undefined||this.separator==null||this.separator=="null")&&i!=myArray.length-1){ph.append(this.separator);}}
ph.appendTo($("#"+this.htmlObject).empty());var currentVal=Dashboards.ev(Dashboards.getParameterValue(this.parameter));var isSelected=false;var currentValArray;if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else{currentValArray=currentVal.toString().split("|");}
var foundDefault=false;this.clearSelections(this.htmlObject,this.name,this.verticalOrientation);for(var i=0;i<myArray.length;i++){isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][valIdx];if(isSelected){break;}}
if(($.isArray(currentVal)&&isSelected||isSelected)||(myArray[i][valIdx]==currentVal||myArray[i][lblIdx]==currentVal)){MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,i,this.isMultiple,this.verticalOrientation,true);foundDefault=true;if(!this.isMultiple){break;}}}
if(((!foundDefault&&!this.isMultiple)||(!foundDefault&&this.isMultiple&&this.defaultIfEmpty))&&myArray.length>0){if((currentVal==null||currentVal==""||(typeof(currentVal)=="object"&&currentVal.length==0))&&this.parameter){Dashboards.fireChange(this.parameter,(this.isMultiple)?[firstVal]:firstVal);}
MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,0,this.isMultiple,this.verticalOrientation,true);}
$(".pentaho-toggle-button").hover(function(){$(this).addClass("pentaho-toggle-button-up-hovering");},function(){$(this).removeClass("pentaho-toggle-button-up-hovering");});$(".pentaho-toggle-button button").hover(function(){$(this).parent().addClass("pentaho-toggle-button-up-hovering");},function(){});},getValue:function(){if(this.isMultiple){var indexes=MultiButtonComponent.prototype.getSelectedIndex(this.name);var a=new Array();if(indexes.length==undefined){a.push(this.getValueByIdx(indexes));}else{for(var i=0;i<indexes.length;i++){a.push(this.getValueByIdx(indexes[i]));}}
return a;}
else{return this.getValueByIdx(MultiButtonComponent.prototype.getSelectedIndex(this.name));}},getValueByIdx:function(idx){return this.cachedArray[idx][this.valueAsId?1:0];},getSelecetedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-down "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},getUnselectedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-up "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},clickButton:function(htmlObject,name,index,isMultiple,verticalOrientation,updateUIOnly){var cssWrapperClass=this.getUnselectedCss(verticalOrientation);var cssWrapperClassSelected=this.getSelecetedCss(verticalOrientation);var buttons=$("#"+htmlObject+" button");if(isMultiple){if(this.indexes[name]==undefined)this.indexes[name]=[];else if(!$.isArray(this.indexes[name]))this.indexes[name]=[this.indexes[name]];var disable=false;for(var i=0;i<this.indexes[name].length;++i){if(this.indexes[name][i]==index){disable=true;this.indexes[name].splice(i,1);break;}}
if(disable){buttons[index].parentNode.className=cssWrapperClass+this.getExtraCss(index,buttons.length,verticalOrientation);}else{buttons[index].parentNode.className=cssWrapperClassSelected+this.getExtraCss(index,buttons.length,verticalOrientation);this.indexes[name].push(index);}}
else{this.clearSelections(htmlObject,name,verticalOrientation);this.indexes[name]=index;buttons[index].parentNode.className=cssWrapperClassSelected+this.getExtraCss(index,buttons.length,verticalOrientation);}
if(!updateUIOnly){this.callAjaxAfterRender(name);}},clearSelections:function(htmlObject,name,verticalOrientation){var buttons=$("#"+htmlObject+" button");var cssWrapperClass=this.getUnselectedCss(verticalOrientation);for(var i=0;i<buttons.length;i++){buttons[i].parentNode.className=cssWrapperClass+this.getExtraCss(i,buttons.length,verticalOrientation);}
this.indexes[name]=[];},getExtraCss:function(index,count,verticalOrientation){var css="";if(index==0&&count==1){return" pentaho-toggle-button-single";}
if(index==0){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-first":" pentaho-toggle-button-horizontal-first");}else if(index==count-1){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-last":" pentaho-toggle-button-horizontal-last");}
return css;},getSelectedIndex:function(name){return this.indexes[name];}});var AutocompleteBoxComponent=BaseComponent.extend({searchedWord:'',result:[],queryServer:function(searchString){if(!this.parameters)this.parameters=[];if(this.searchParam){this.parameters=[[this.searchParam,this.getInnerParameterName()]];}
else if(this.parameters.length>0){this.parameters[0][1]=this.getInnerParameterName();}
if(this.maxResults){this.queryDefinition.pageSize=this.maxResults;}
Dashboards.setParameter(this.getInnerParameterName(),this.getTextBoxValue());QueryComponent.makeQuery(this);},getTextBoxValue:function(){return this.textbox.val();},getInnerParameterName:function(){return this.parameter+'_textboxValue';},update:function(){$("#"+this.htmlObject).empty();var initialValue=null;if(this.parameter){initialValue=Dashboards.getParameterValue(this.parameter);}
var myself=this;if(!Dashboards.getParameterValue(this.getInnerParameterName)){Dashboards.setParameter(this.getInnerParameterName(),'');}
var processChange=myself.processChange==undefined?function(objName){Dashboards.processChange(objName);}:function(objName){myself.processChange();};var processElementChange=myself.processElementChange==true?function(value){Dashboards.fireChange(myself.parameter,value);}:undefined;if(this.minTextLenght==undefined){this.minTextLenght=0;}
var opt={list:function(){var val=myself.textbox.val();if(val.length>=myself.minTextLenght&&!(val==''||val==myself.searchedWord||((myself.queryInfo!=null&&myself.result.length==myself.queryInfo.totalRows)&&myself.searchedWord!=''&&((myself.matchType=="fromStart")?val.indexOf(myself.searchedWord)==0:val.indexOf(myself.searchedWord)>-1))))
{myself.queryServer(val);myself.searchedWord=val;}
var list=[];for(p in myself.result)if(myself.result.hasOwnProperty(p)){var obj={};obj.text=myself.result[p][0];list.push(obj);}
return list;},matchType:myself.matchType==undefined?"fromStart":myself.matchType,processElementChange:processElementChange,processChange:function(obj,value){obj.value=value;processChange(obj.name);},multiSelection:myself.selectMulti==undefined?false:myself.selectMulti,checkValue:myself.checkValue==undefined?true:myself.checkValue,minTextLenght:myself.minTextLenght==undefined?0:myself.minTextLenght,scrollHeight:myself.scrollHeight,applyButton:myself.showApplyButton==undefined?true:myself.showApplyButton,tooltipMessage:myself.tooltipMessage==undefined?"Click it to Apply":myself.tooltipMessage,addTextElements:myself.addTextElements==undefined?true:myself.addTextElements,externalApplyButtonId:myself.externalApplyButtonId,parent:myself};this.autoBoxOpt=$("#"+this.htmlObject).autobox(opt);this.autoBoxOpt.setInitialValue(this.htmlObject,initialValue,this.name);this.textbox=$('#'+this.htmlObject+' input');},getValue:function(){return this.value;},processAutoBoxChange:function(){this.autoBoxOpt.processAutoBoxChange();}});var JpivotComponent=BaseComponent.extend({update:function(){if(this.iframeScrolling==undefined){this.iframeScrolling="no";}
var jpivotHTML="<iframe id=\"jpivot_"+this.htmlObject+"\" scrolling=\""+this.iframeScrolling+"\" onload=\"var dynamicHeight = this.contentWindow.document.body.offsetHeight+50; this.style.height = dynamicHeight + 'px';\" frameborder=\"0\" height=\""+this.iframeHeight+"\" width=\""+this.iframeWidth+"\" src=\"";jpivotHTML+=webAppPath+"/ViewAction?solution="+this.solution+"&path="+this.path+"&action="+this.action;var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var arg="&"+this.parameters[i][0]+"=";jpivotHTML+=arg+Dashboards.getParameterValue(this.parameters[i][1]);}
jpivotHTML+="\"></iframe>";$("#"+this.htmlObject).html(jpivotHTML);}});if($.fn.dataTableExt!=undefined){$.fn.dataTableExt.oApi.fnLengthChange=function(oSettings,iDisplay)
{oSettings._iDisplayLength=iDisplay;oSettings.oApi._fnCalculateEnd(oSettings);if(oSettings._iDisplayEnd==oSettings.aiDisplay.length)
{oSettings._iDisplayStart=oSettings._iDisplayEnd-oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(oSettings._iDisplayLength==-1)
{oSettings._iDisplayStart=0;}
oSettings.oApi._fnDraw(oSettings);$('select',oSettings.oFeatures.l).val(iDisplay);};}
var TableComponent=BaseComponent.extend({ph:undefined,update:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chart definition passed","error");return;}
cd["tableId"]=this.htmlObject+"Table";this.ph=$("#"+this.htmlObject);this.ph.empty();var myself=this;var croppedCd=$.extend({},cd);croppedCd.drawCallback=undefined;this.queryState=new Query(croppedCd);this.query=this.queryState;var sortBy=this.chartDefinition.sortBy||[],sortOptions=[];for(var i=0;i<sortBy.length;i++){var col=sortBy[i][0];var dir=sortBy[i][1];sortOptions.push(col+(dir=="asc"?"A":"D"));}
this.queryState.setSortBy(sortOptions);if(cd.paginateServerside){this.extraOptions=this.extraOptions||[];this.extraOptions.push(["bServerSide",true]);this.extraOptions.push(["bProcessing",true]);this.queryState.setPageSize(parseInt(cd.displayLength||10));this.queryState.setCallback(function(values){changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
myself.processTableComponentResponse(values);});this.queryState.setParameters(this.parameters);this.processTableComponentResponse();}else{this.queryState.fetchData(this.parameters,function(values){changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
myself.rawData=values;myself.processTableComponentResponse(values);});}},pagingCallback:function(url,params,callback,dataTable){function p(sKey){for(var i=0,iLen=params.length;i<iLen;i++){if(params[i].name==sKey){return params[i].value;}}
return null;}
var sortingCols=p("iSortingCols"),sort=[];if(sortingCols>0){for(var i=0;i<sortingCols;i++){var col=p("iSortCol_"+i);var dir=p("sSortDir_"+i);sort.push(col+(dir=="asc"?"A":"D"));}}
var query=this.queryState,myself=this;query.setSortBy(sort.join(","));query.setPageSize(parseInt(p("iDisplayLength")));query.setPageStartingAt(p("iDisplayStart"));query.fetchData(function(d){if(myself.postFetch){var mod=myself.postFetch(d,dataTable);if(typeof mod!=="undefined"){d=mod;}}
var response={iTotalRecords:d.queryInfo.totalRows,iTotalDisplayRecords:d.queryInfo.totalRows};response.aaData=d.resultset;response.sEcho=p("sEcho");myself.rawData=d;callback(response);});},processTableComponentResponse:function(json)
{var myself=this,cd=this.chartDefinition,extraOptions={};myself.ph.trigger('cdfTableComponentProcessResponse');if(typeof cd.colHeaders==="undefined"||cd.colHeaders.length==0)
cd.colHeaders=json.metadata.map(function(i){return i.colName});if(typeof cd.colTypes==="undefined"||cd.colTypes.length==0)
cd.colTypes=json.metadata.map(function(i){return i.colType.toLowerCase()});var dtData0=TableComponent.getDataTableOptions(cd),dtData;$.each(this.extraOptions?this.extraOptions:{},function(i,e){extraOptions[e[0]]=e[1];});dtData=$.extend(cd.dataTableOptions,dtData0,extraOptions);var myself=this;dtData.fnDrawCallback=function(dataTableSettings){var dataTable=this;myself.ph.find("tbody tr").each(function(row,tr){if(dataTable.fnGetPosition(tr)==null)
return true;$(tr).children("td:visible").each(function(col,td){var position=dataTable.fnGetPosition(td),rowIdx=position[0],colIdx=position[2];var colType=cd.colTypes[colIdx];var addIn=myself.getAddIn("colType",colType);if(addIn){var state={},target=$(td),results=myself.rawData;if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
state.rawData=results;state.tableData=dataTable.fnGetData();state.colIdx=colIdx;state.rowIdx=rowIdx;state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];if(cd.colFormats){state.colFormat=cd.colFormats[state.colIdx];}
state.target=target;addIn.call(td,state,myself.getAddInOptions("colType",addIn.getName()));}else if(cd.colFormats){var format=cd.colFormats[position[1]],value=myself.rawData.resultset[rowIdx][colIdx];if(format&&(typeof value!="undefined"&&value!==null)){$(td).text(sprintf(format,value));}}});});if(typeof cd.drawCallback=='function'){cd.drawCallback.apply(myself,arguments);}};if(json){dtData.aaData=json.resultset;}
if(dtData.bServerSide){dtData.fnServerData=function(u,p,c){myself.pagingCallback(u,p,c,this);};}
myself.ph.html("<table id='"+this.htmlObject+"Table' class=\"tableComponent\" width=\"100%\"></table>");this.dataTable=$("#"+this.htmlObject+'Table').dataTable(dtData);this.dataTable.anOpen=[];myself.ph.find('table').bind('click',function(e){if(typeof cd.clickAction==='function'||myself.expandOnClick){var state={},target=$(e.target),results=myself.queryState.lastResults();if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
var position=myself.dataTable.fnGetPosition(target.get(0));state.rawData=myself.rawData;state.tableData=myself.dataTable.fnGetData();state.colIdx=position[1];state.rowIdx=position[0];state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];state.target=target;state.colFormat=cd.colFormats[state.colIdx];if(myself.expandOnClick){myself.handleExpandOnClick(state);}
if(cd.clickAction)
cd.clickAction.call(myself,state);}});myself.ph.trigger('cdfTableComponentFinishRendering');},handleExpandOnClick:function(event){var myself=this,detailContainerObj=myself.expandContainerObject,activeclass="expandingClass";if(typeof activeclass==='undefined'){activeclass="activeRow";}
var obj=event.target.closest("tr");var a=event.target.closest("a");if(a.hasClass('info')){return;}else{var row=obj.get(0);var value=event.series;var htmlContent=$("#"+detailContainerObj).html();var anOpen=myself.dataTable.anOpen;var i=$.inArray(row,anOpen);if(obj.hasClass(activeclass)){obj.removeClass(activeclass);myself.dataTable.fnClose(row);anOpen.splice(i,1);}
else{for(var j=0;j<anOpen.length;j++){$(anOpen[j]).removeClass(activeclass);myself.dataTable.fnClose(anOpen[j]);anOpen.splice(j,1);}
obj.addClass(activeclass);var results=myself.queryState.lastResults();$(myself.expandParameters).each(function f(i,elt){Dashboards.fireChange(elt[1],results.resultset[event.rowIdx][parseInt(elt[0],10)]);});myself.dataTable.fnOpen(row,htmlContent,activeclass);anOpen.push(row);};};}},{getDataTableOptions:function(options){var dtData={};if(options.tableStyle=="themeroller"){dtData.bJQueryUI=true;}
dtData.bInfo=options.info;dtData.iDisplayLength=options.displayLength;dtData.bLengthChange=options.lengthChange;dtData.bPaginate=options.paginate;dtData.bSort=options.sort;dtData.bFilter=options.filter;dtData.sPaginationType=options.paginationType;dtData.sDom=options.sDom;dtData.aaSorting=options.sortBy;dtData.oLanguage=options.oLanguage;if(options.colHeaders!=undefined){dtData.aoColumns=new Array(options.colHeaders.length);for(var i=0;i<options.colHeaders.length;i++){dtData.aoColumns[i]={}
dtData.aoColumns[i].sClass="column"+i;};$.each(options.colHeaders,function(i,val){dtData.aoColumns[i].sTitle=val;if(val=="")dtData.aoColumns[i].bVisible=false;});if(options.colTypes!=undefined){$.each(options.colTypes,function(i,val){var col=dtData.aoColumns[i];if(val=="hidden")col.bVisible=false;col.sClass+=" "+val;col.sType=val;})};if(options.colFormats!=undefined){};var bAutoWidth=true;if(options.colWidths!=undefined){$.each(options.colWidths,function(i,val){if(val!=null){dtData.aoColumns[i].sWidth=val;bAutoWidth=false;}})};dtData.bAutoWidth=bAutoWidth;if(options.colSortable!=undefined){$.each(options.colSortable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSortable=false}})};if(options.colSearchable!=undefined){$.each(options.colSearchable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSearchable=false}})};}
return dtData;}});var CommentsComponent=BaseComponent.extend({update:function(){if(typeof this.firstResult=='undefined'){this.firstResult=0;}
if(typeof this.maxResults=='undefined'){this.maxResults=4;}
if(this.page==undefined){Dashboards.log("Fatal - no page definition passed","error");return;}
this.firePageUpdate();},firePageUpdate:function(json){var placeHolder=$("#"+this.htmlObject);placeHolder.empty();placeHolder.append('<div class="cdfCommentsWrapper ui-widget"><dl class="cdfCommentsBlock"/></div>');var myself=this;var args={action:"list",page:this.page,firstResult:this.firstResult,maxResults:this.maxResults+1};$.getJSON(webAppPath+"/content/pentaho-cdf/Comments",args,function(json){myself.processCommentsList(json);});},processCommentsList:function(json)
{var myself=this;var placeHolder=$("#"+this.htmlObject+" dl ");myself.addCommentContainer=$('<dt class="ui-widget-header comment-body"><textarea/></dt>'+'<dl class="ui-widget-header comment-footer">'+'<a class="cdfAddComment">Add Comment</a>'+' <a class="cdfCancelComment">Cancel</a></dl>');myself.addCommentContainer.find("a").addClass("ui-state-default");myself.addCommentContainer.find("a").hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");})
$(".cdfCancelComment",myself.addCommentContainer).bind('click',function(e){myself.addCommentContainer.hide("slow");myself.addCommentContainer.find("textarea").val('');});$(".cdfAddComment",myself.addCommentContainer).bind('click',function(e){var tarea=$("textarea",myself.addCommentContainer);var code=tarea.val();tarea.val('');var args={action:"add",page:myself.page,comment:code};$.getJSON(webAppPath+"/content/pentaho-cdf/Comments",args,function(json){myself.processCommentsAdd(json);});myself.addCommentContainer.hide("slow");});myself.addCommentContainer.hide();myself.addCommentContainer.appendTo(placeHolder);var addCodeStr='<div class="cdfAddComment"><a> Add comment</a></div>';$(addCodeStr).insertBefore(placeHolder).bind('click',function(e){myself.addCommentContainer.show("slow");$("textarea",myself.addCommentContainer).focus();});if(typeof json.error!='undefined'||typeof json.result=='undefined'){placeHolder.append('<span class="cdfNoComments">There was an error processing comments</span>');json.result=[];}else
if(json.result.length==0){placeHolder.append('<span class="cdfNoComments">No comments yet</span>');}
$.each(json.result.slice(0,this.maxResults),function(i,comment){var bodyClass=comment.isMe?"ui-widget-header":"ui-widget-content";placeHolder.append('<dt class="'+bodyClass+' comment-body"><p>'+comment.comment+'</p></dt>');placeHolder.append('<dl class="ui-widget-header comment-footer ">'+comment.user+",  "+comment.createdOn+'</dl>');});var paginationContent=$('<div class="cdfCommentsPagination ui-helper-clearfix"><ul class="ui-widget"></ul></div>');var ul=$("ul",paginationContent);if(this.firstResult>0){ul.append('<li class="ui-state-default ui-corner-all"><span class="cdfCommentPagePrev ui-icon ui-icon-carat-1-w"></a></li>');ul.find(".cdfCommentPagePrev").bind("click",function(){myself.firstResult-=myself.maxResults;myself.firePageUpdate();});}
if(this.maxResults<json.result.length){ul.append('<li class="ui-state-default ui-corner-all"><span class="cdfCommentPageNext ui-icon ui-icon-carat-1-e"></a></li>');ul.find(".cdfCommentPageNext").bind("click",function(){myself.firstResult+=myself.maxResults;myself.firePageUpdate();});}
paginationContent.insertAfter(placeHolder);},processCommentsAdd:function(json){var result=json.result;var placeHolder=$("#"+this.htmlObject+" dl ");var container=$('<dt class="ui-widget-header comment-body">'+result.comment+'</dt>'+'<dl class="ui-widget-header comment-footer">'+result.user+", "+result.createdOn+'</dl>');container.hide();container.insertAfter($("dl:eq(0)",placeHolder));container.show("slow");this.update();}});var PivotLinkComponent=BaseComponent.extend({update:function(){var title=this.tooltip==undefined?"View details in a Pivot table":this.tooltip;var link=$('<a class="pivotLink"> </a>').html(this.content).attr("href","javascript:PivotLinkComponent.openPivotLink("+this.name+")").attr("title",title);$("#"+this.htmlObject).empty();$("#"+this.htmlObject).html(link);$('a.pivotLink').tooltip({showURL:false,track:true,delay:1000,opacity:0.5});}},{openPivotLink:function(object){var url=webAppPath+"/Pivot?solution=system&path=pentaho-cdf/actions&action=jpivot.xaction&";var qd=object.pivotDefinition;var parameters=[];for(p in qd){var key=p;var value=typeof qd[p]=='function'?qd[p]():qd[p];parameters.push(key+"="+encodeURIComponent(value));}
url+=parameters.join("&");var _href=url.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()});}});var QueryComponent=BaseComponent.extend({visible:false,update:function(){QueryComponent.makeQuery(this);},warnOnce:function(){Dashboards.log("Warning: QueryComponent behaviour is due to change. See "+"http://http://www.webdetails.org/redmine/projects/cdf/wiki/QueryComponent"+" for more information");delete(this.warnOnce);}},{makeQuery:function(object){if(this.warnOnce){this.warnOnce();}
var cd=object.queryDefinition;if(cd==undefined){Dashboards.log("Fatal - No query definition passed","error");return;}
var query=new Query(cd);query.fetchData(object.parameters,function(values){changedValues=undefined;object.metadata=values.metadata;object.result=values.resultset!=undefined?values.resultset:values;object.queryInfo=values.queryInfo;if((typeof(object.postFetch)=='function')){changedValues=object.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
if(object.resultvar!=undefined){Dashboards.setParameter(object.resultvar,object.result);}
object.result=values.resultset!=undefined?values.resultset:values;if(typeof values.resultset!="undefined"){object.metadata=values.metadata;object.queryInfo=values.queryInfo;}});}});var MdxQueryGroupComponent=BaseComponent.extend({visible:false,update:function(){OlapUtils.updateMdxQueryGroup(this);}});var ExecuteXactionComponent=BaseComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV")o.wrap("<span/>");if(this.label!=undefined)o.text(this.label);o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executeXAction();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},executeXAction:function(){var url=webAppPath+"/ViewAction?solution="+this.solution+"&path="+this.path+"&action="+this.action+"&";var p=new Array(this.parameters.length);var parameters=[];for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);if($.isArray(value))
$(value).each(function(p){parameters.push(key+"="+encodeURIComponent(this));});else
parameters.push(key+"="+encodeURIComponent(value));}
url+=parameters.join("&");var _href=url.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()-50});}});var ButtonComponent=BaseComponent.extend({update:function(){var b=$("<button type='button'/>").text(this.label).unbind("click").bind("click",this.expression);if(typeof this.buttonStyle==="undefined"||this.buttonStyle==="themeroller")
b.button();b.appendTo($("#"+this.htmlObject).empty());}});var PrptComponent=BaseComponent.extend({update:function(){this.clear();var options=this.getOptions();if(options["dashboard-mode"]){var url=webAppPath+'/content/reporting';var myself=this;$.ajax({url:url,data:options,dataType:"html",success:function(json){$("#"+myself.htmlObject).html(json);}});}
else{var url=webAppPath+'/content/reporting/reportviewer/report.html';var encodeArray=function(k,v){var arr=[];for(var i=0;i<v.length;i++){arr.push(encodeURIComponent(k)+'='+encodeURIComponent(v[i]));}
return arr;};var a=[];$.each(options,function(k,v){if(typeof v=='object'){a.push.apply(a,encodeArray(k,v));}else{a.push(encodeURIComponent(k)+"="+encodeURIComponent(v));}});var myself=this;if(!this.loading){this.loading=true;Dashboards.incrementRunningCalls();}
var iframe=$("<iframe style='width:100%;height:100%;border:0px' frameborder='0' border='0' />");iframe.load(function(){if(this.contentWindow.document.body.innerHTML){myself.loading=false;Dashboards.decrementRunningCalls();}});$("#"+this.htmlObject).empty().append(iframe);iframe[0].contentWindow.location=url+"?"+a.join('&');}},getOptions:function(){var options={paginate:this.paginate||false,showParameters:this.showParameters||false,autoSubmit:(this.autoSubmit||this.executeAtStart)||false,"dashboard-mode":this.iframe==undefined?false:!this.iframe,solution:this.solution,path:this.path,action:this.action};if(this.paginate){options["output-target"]="table/html;page-mode=page";}else{options["output-target"]="table/html;page-mode=stream";}
$.map(this.parameters,function(k){options[k[0]]=k.length==3?k[2]:Dashboards.getParameterValue(k[1]);});options["output-type"]="";return options;}});var ExecutePrptComponent=PrptComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV")o.wrap("<span/>");if(this.label!=undefined)o.text(this.label);o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executePrptComponent();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},executePrptComponent:function(){var options=this.getOptions();var url=webAppPath+'/content/reporting/reportviewer/report.html';var a=[];var encodeArray=function(k,v){var arr=[];for(var i=0;i<v.length;i++){arr.push(encodeURIComponent(k)+'='+encodeURIComponent(v[i]));}
return arr;};$.each(options,function(k,v){if(typeof v=='object'){a.push.apply(a,encodeArray(k,v));}else{a.push(encodeURIComponent(k)+"="+encodeURIComponent(v));}});$.fancybox({type:"iframe",href:url+"?"+a.join('&'),width:$(window).width(),height:$(window).height()-50});}});var AnalyzerComponent=BaseComponent.extend({update:function(){this.clear();var options=this.getOptions();var url=webAppPath+'/content/analyzer/';var myself=this;this.viewOnly?url+='viewer':url+='editor';var height=this.height?this.height:"480px";var width=this.width?this.width:"100%";var iFrameHTML=this.generateIframe(this.htmlObject,url,options,height,width);$("#"+this.htmlObject).html(iFrameHTML);},getOptions:function(){var options={solution:this.solution,path:this.path,action:this.action,command:this.command==undefined?"open":this.command,showFieldList:this.showFieldList==undefined?false:this.showFieldList,frameless:this.frameless};$.map(this.parameters,function(k){options[k[0]]=k.length==3?k[2]:Dashboards.getParameterValue(k[1]);});return options;},generateIframe:function(htmlObject,url,parameters,height,width){var iFrameHTML='<iframe id="iframe_'+htmlObject+'"'+' frameborder="0"'+' height="'+height+'"'+' width="'+width+'"'+' src="'+url+"?";iFrameHTML+=$.param(parameters,true);iFrameHTML+="\"></iframe>";return iFrameHTML;}});var FreeformComponent=BaseComponent.extend({update:function(){var myself=this;this.customfunction(this.parameters||[]);}})
function AddIn(options){var myself=options;if(typeof options!="object"){throw TypeError;}
if(!options.label||!options.name||(!options.implementation&&!options.value)){throw TypeError;}
var _name=options.name,_label=options.label,_type=options.implementation?"scriptable":"static",_implementation=options.implementation,_defaults=options.defaults,_value=options.options;if(typeof options.init==='function'){options.init.call(myself);}
this.getLabel=function(){return _label;}
this.getName=function(){return _name;}
this.call=function(target,state,options){if(!_implementation){return Dashboards.clone(_value);}
options=typeof options=="function"?options(state):options;var evaluatedDefaults=typeof _defaults=="function"?_defaults(state):_defaults;var compiledOptions=jQuery.extend(true,{},evaluatedDefaults,options);try{return _implementation.call(myself,target,state,compiledOptions);}
catch(e){Dashboards.log("Addin Error ["+this.getName()+"]: "+e,"error");}};this.setDefaults=function(defaults){if(typeof defaults=='function'){_defaults=defaults;}
else{_defaults=jQuery.extend(true,{},_defaults,defaults);}};};(function(){var sparkline={name:"sparkline",label:"Sparkline",defaults:{type:'line'},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var t=$(tgt);t.sparkline(st.value.split(/,/),opt);t.removeClass("sparkline");}};Dashboards.registerAddIn("Table","colType",new AddIn(sparkline));var pvSparkline={name:"pvSparkline",label:"Protovis Sparkline",defaults:{height:10,strokeStyle:"#000",lineWidth:1,width:undefined,canvasMargin:2},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var ph=$(tgt),sparklineData=st.value,data=sparklineData.split(",");n=data.length,w=opt.width||ph.width(),h=opt.height,min=pv.min.index(data),max=pv.max.index(data);ph.empty();var container=$("<div></div>").appendTo(ph);var vis=new pv.Panel().canvas(container.get(0)).width(w).height(h).margin(opt.canvasMargin);vis.add(pv.Line).data(data).left(pv.Scale.linear(0,n-1).range(0,w).by(pv.index)).bottom(pv.Scale.linear(data).range(0,h)).strokeStyle(opt.strokeStyle).lineWidth(opt.lineWidth);vis.render();}};Dashboards.registerAddIn("Table","colType",new AddIn(pvSparkline));var dataBar={name:"dataBar",label:"Data Bar",defaults:{width:undefined,widthRatio:1,height:10,startColor:"#55A4D6",endColor:"#448FC8",backgroundImage:undefined,stroke:null,max:undefined,min:undefined,includeValue:false,absValue:true,valueFormat:function(v,format,st){return""+sprintf(format||"%.1f",v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var tblMax=Math.max.apply(Math,st.tableData.map(function(e){return e[st.colIdx];})),tblMin=Math.min.apply(Math,st.tableData.map(function(e){return e[st.colIdx];}));if(opt.absValue){var max=opt.max||Math.max(Math.abs(tblMax),Math.abs(tblMin)),min=opt.min||0,val=Math.abs(parseFloat(st.value));min=Math.max(min,0);}else{var max=opt.max||Math.max(0,tblMax),min=opt.min||Math.min(0,tblMin),val=parseFloat(st.value);}
var maxTotal=max-min;var cell=$(tgt);cell.empty();var ph=$("<div>&nbsp;</div>").addClass('dataBarContainer').appendTo(cell);var wtmp=opt.width||ph.width();wtmp*=opt.widthRatio;var htmp=opt.height;var leftVal=Math.min(val,0),rightVal=Math.max(val,0);var xx=pv.Scale.linear(min,max).range(0,wtmp);var paperSize=xx(Math.min(rightVal,max))-xx(min);paperSize=(paperSize>1)?paperSize:1;var paper=Raphael(ph.get(0),paperSize,htmp);var c=paper.rect(xx(leftVal),0,xx(rightVal)-xx(leftVal),htmp);c.attr({fill:opt.backgroundImage?"url('"+opt.backgroundImage+"')":"90-"+opt.startColor+"-"+opt.endColor,stroke:opt.stroke,title:"Value: "+st.value});if(opt.includeValue){var valph=$("<span></span>").addClass('value').append(opt.valueFormat(st.value,st.colFormat,st));valph.appendTo(ph);}}};Dashboards.registerAddIn("Table","colType",new AddIn(dataBar));var trendArrow={name:"trendArrow",label:"Trend Arrows",defaults:{good:true,includeValue:false,valueFormat:function(v,format,st){return sprintf(format||"%.1f",v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt),qualityClass=opt.good?"good":"bad",isNumeric=typeof st.value=="number"||(typeof st.value=="string"&&Number(st.value).toString()==st.value),trendClass=!isNumeric?"invalid":(st.value==0?"neutral":st.value<0?"down":"up");var trend=$("<div>&nbsp;</div>");trend.addClass('trend '+trendClass+' '+qualityClass);ph.empty();if(opt.includeValue){var valph=$("<div class='value'></div>").append(opt.valueFormat(st.value,st.colFormat,st));valph.appendTo(ph);}
ph.append(trend);}};Dashboards.registerAddIn("Table","colType",new AddIn(trendArrow));var link={name:"hyperlink",label:"Hyperlink",defaults:{openInNewTab:true,prependHttpIfNeeded:true,regexp:null,pattern:null,urlReference:2,labelReference:1},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt);var link,label;if(opt.pattern){var re=new RegExp(opt.pattern),results=re.exec(st.value);link=results[opt.urlReference];label=results[opt.labelReference];}else{link=st.value;label=st.value;}
if(opt.prependHttpIfNeeded&&!/^https?:\/\//.test(link)){link="http://"+link;}
if(opt.regexp==null||(new RegExp(opt.regexp).test(st.value))){var a=$("<a></a>").attr("href",link).addClass("hyperlinkAddIn");a.text(label);if(opt.openInNewTab){a.attr("target","_blank");}
ph.empty().append(a);}}};Dashboards.registerAddIn("Table","colType",new AddIn(link));var circle={name:"circle",label:"Circle",defaults:{canvasSize:10,radius:4,color:'black',title:function(st){return"Value: "+st.value;}},implementation:function(tgt,st,opt){var p=$(tgt).empty(),v=st.value,op,options={},w,paper;for(key in opt)if(opt.hasOwnProperty(key)){op=opt[key];options[key]=typeof op=='function'?op.call(this,st):op;}
w=options.canvasSize;paper=Raphael(tgt,options.canvasSize,options.canvasSize);var r=paper.circle(w/2,w/2,options.radius);r.attr({fill:options.color,opacity:1,"stroke-width":0,"title":options.title});}};Dashboards.registerAddIn("Table","colType",new AddIn(circle));var bullet={name:"cccBulletChart",label:"Bullet Chart",defaults:{height:40,animate:false,orientation:"horizontal",bulletSize:16,bulletSpacing:150,bulletMargin:5,bulletRanges:[30,80,100],extensionPoints:{"bulletMarker_shape":"triangle","bulletTitle_textStyle":"green","bulletMeasure_fillStyle":"black","bulletRuleLabel_font":"8px sans-serif","bulletRule_height":5}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},sort:function(){},implementation:function(tgt,st,opt){var chartOptions=$.extend(true,{},opt);var $tgt=$(tgt);var target=$("<span></span>").appendTo($tgt.empty());var values=st.value.split(",");var data=this.getData(values);chartOptions.canvas=target.get(0);chartOptions.width=chartOptions.width||$tgt.width();chartOptions.bulletMeasures=[values[0]];chartOptions.bulletMarkers=[values[1]];var chart=new pvc.BulletChart(chartOptions);chart.setData(data,{});chart.render();},getData:function(values){var dataSet={resultset:[values],metadata:[]},i;for(i=0;i<values.length;i++){dataSet.metadata.push({colIndex:i,colType:"String",colName:""});}
return dataSet;}};Dashboards.registerAddIn("Table","colType",new AddIn(bullet));var formattedText={name:"formattedText",label:"Formatted Text",defaults:{textFormat:function(v,st){return st.colFormat?sprintf(st.colFormat,v):v;}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var text=opt.textFormat.call(this,st.value,st,opt);$(tgt).empty().append(text);}};Dashboards.registerAddIn("Table","colType",new AddIn(formattedText));var localizedText={name:"localizedText",label:"Localized Text",defaults:{localize:function(v){return Dashboards.i18nSupport.prop(v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){var text=this.defaults.localize(st.value);$(tgt).empty().append(text);st.tableData[st.rowIdx][st.colIdx]=text;}}};Dashboards.registerAddIn("Table","colType",new AddIn(localizedText));})();var NavigatorBaseComponent=BaseComponent.extend({},{path:Dashboards.getQueryParameter("path"),solution:Dashboards.getQueryParameter("solution"),template:Dashboards.getQueryParameter("template"),navigatorResponse:-1,getSolutionJSON:function(solution){var json=NavigatorBaseComponent.navigatorResponse;var files=json.solution.folders;var locationArray;var found=0;for(i=0;i<files.length;i++){var file=files[i];if(NavigatorBaseComponent.solution==""||file.solution==NavigatorBaseComponent.solution){var solutionFiles=[];var subFolders=file.folders;if(subFolders!=undefined&&subFolders.length==undefined){solutionFiles.push(subFolders);}
else if(subFolders!=undefined&&subFolders.length>0){solutionFiles=solutionFiles.concat(subFolders);}
var subFiles=file.files;if(subFiles!=undefined&&subFiles.length==undefined){solutionFiles.push(subFiles);}
else if(subFiles!=undefined&&subFiles.length>0){solutionFiles=solutionFiles.concat(subFiles);}
return solutionFiles;}}
if(found==0){alert("Fatal: Solution "+solution+" not found in navigation object");return;}},browseContent:function(files,currentPath){for(var i=0;i<files.length;i++){var file=files[i];if(file.type=="FOLDER"&&file.path==currentPath){files=file.folders;if(files==undefined){return[];}
if(files.length==undefined){files=[files];}
return files;}}
alert("Fatal: path "+NavigatorBaseComponent.path+" not found in navigation object");return;},getParentSolution:function(){if(NavigatorBaseComponent.path.length>0){return NavigatorBaseComponent.solution;}else{return"";}},getParentPath:function(){var index=NavigatorBaseComponent.path.lastIndexOf("/");if(index==-1){return"";}
var parentPath=NavigatorBaseComponent.path.substring(0,NavigatorBaseComponent.path.lastIndexOf("/"));return parentPath;},isAncestor:function(solution,path){if(solution!=NavigatorBaseComponent.solution){return false;}else{return true;}}});var NavigatorComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=navigator&solution="+NavigatorBaseComponent.solution+"&path="+NavigatorBaseComponent.path,function(json){myself.processNavigatorResponse(json);});}
else{this.processNavigatorResponse(NavigatorBaseComponent.navigatorResponse);}},processNavigatorResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var files=this.includeSolutions?json.solution.folders:NavigatorBaseComponent.getSolutionJSON(NavigatorBaseComponent.solution);files.sort(function(a,b){return a.name>b.name});var ret=this.generateMenuFromArray(files,0);$("#"+this.htmlObject).html(ret);$(function(){$('ul.jd_menu').jdMenu({activateDelay:50,showDelay:50,disableLinks:false})});$('ul.jd_menu a').tooltip({showURL:false,track:true,delay:1000,opacity:0.5});},generateMenuFromArray:function(files,depth){var s="";if(files==undefined){return s;}
for(var i=0;i<files.length;i++){var file=files[i];s+=this.generateMenuFromFile(file,depth+1);}
if(s.length>0){var className;if(depth==0){var cls=(this.mode=='vertical')?"jd_menu jd_menu_slate jd_menu_vertical":"jd_menu jd_menu_slate";className="class=\""+cls+"\"";}
s="<ul "+className+">"+s+"</ul>";}
return s;},generateMenuFromFile:function(file,depth){var s="";if(file.visible==true){var classString=NavigatorBaseComponent.isAncestor(file.solution,file.path)?"class=\"ancestor\"":"";var _path="";if(file.path.length>0){_path="path="+file.path;}
var _template=NavigatorBaseComponent.template.length>0?"&amp;template="+NavigatorBaseComponent.template:"";if(file.link!=undefined){s+="<li><a "+classString+" title=\""+file.description+"\"  href=\""+webAppPath+file.link+"\">"+file.title+"</a>";}
else{s+="<li><a "+classString+" title=\""+file.description+"\"  href=\""+webAppPath+"/content/pentaho-cdf/RenderHTML?solution="+file.solution+"&amp;"+_path+_template+"\">"+file.title+"</a>";}
var files=file.folders||[];files.sort(function(a,b){return a.name>b.name});var childFiles=file.files||[];childFiles.sort(function(a,b){return a.name>b.name});var inner=this.generateMenuFromArray(files.concat(childFiles));if(inner.length>0){inner=" &raquo;"+inner;}
s+=inner+"</li>";}
return s;}});var ContentListComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;var path=this.mode!=4?NavigatorBaseComponent.path:NavigatorBaseComponent.getParentPath();$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=contentList&solution="+NavigatorBaseComponent.solution+"&path="+path,function(json){myself.processContentListResponse(json);});},processContentListResponse:function(json){$("#"+this.htmlObject).empty();var files=json.content||[];files.sort(function(a,b){var _a=(a.type=="FOLDER"?"000":"")+a.name;var _b=(b.type=="FOLDER"?"000":"")+b.name;return _a>_b});var container=$("<ul></ul>").attr("id","contentList-"+this.name).appendTo("#"+this.htmlObject);if(this.mode!=1&&this.mode!=4&&NavigatorBaseComponent.path!=""){var parentDir={name:"Up",title:"Up",type:"FOLDER",description:"Go to parent directory",visible:true,solution:NavigatorBaseComponent.getParentSolution(),path:NavigatorBaseComponent.getParentPath()};files.reverse().push(parentDir);files.reverse();}
var myself=this;$.each(files,function(i,val){if(myself.mode==1&&this.type=="FOLDER"){return true;}
if(myself.mode==2&&this.type!="FOLDER"){return true;}
if(this.visible==true){var cls="";var target="";var href="";var template=NavigatorBaseComponent.template.length>0?"&template="+NavigatorBaseComponent.template:"";if(this.type=="FOLDER"){cls="folder";href=webAppPath+"/content/pentaho-cdf/RenderHTML?solution="+this.solution+"&path="+this.path+template;}
else{if(this.url!=undefined){cls="action greybox";href=webAppPath+this.url;}
else
{cls="action greybox";href=webAppPath+this.link;}}
var anchor=$("<a></a>").attr("href",href).attr("target",target).attr("title",this.description).text(this.title)
$("<li></li>").attr("class",cls).appendTo(container).append(anchor);}});$('#contentList-'+this.name+' a').tooltip({showURL:false});$("li.greybox a").click(function(){var t=this.title||this.innerHTML||this.href;var _href=this.href.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()});return false;});}});var PageTitleComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=navigator&solution="+NavigatorBaseComponent.solution+"&path="+NavigatorBaseComponent.path,function(json){myself.processPageTitleResponse(json);});}
else{this.processPageTitleResponse(NavigatorBaseComponent.navigatorResponse);}},processPageTitleResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var _id=json.solution.id+"/"+NavigatorBaseComponent.solution+(NavigatorBaseComponent.path.length>1?(NavigatorBaseComponent.path.charAt(0)=='/'?NavigatorBaseComponent.path:'/'+NavigatorBaseComponent.path):"");var file=this.findPageTitleObject(json.solution.folders,_id);if(file.title!=undefined&&file.description!=undefined){$("#"+this.htmlObject).text(file.title+" - "+file.description);}},findPageTitleObject:function(folders,id){for(var i=0;i<folders.length;i++){var file=folders[i];if(file.id==id){return file;}
else if((id+"/").indexOf(file.id+"/")>=0){return this.findPageTitleObject(file.folders,id);}
else{continue;}}}});var DashboardsMap={markers:null,data:new Array(),dataIdx:0,messageElementId:null,selectedPointDetails:null,mapExpression:null,useMercator:'true',showToolTip:'false',search:function(object,idx){var record=this.data[idx];var place=record[1];var lat=place[0];var log=place[1];var placeDesc=place[2];var featureClass=object.featureClass!=undefined?'&featureClass='+object.featureClass:'';if(lat==''||log=='')
{placeDesc=placeDesc.replace(/&/g,",");request='http://ws.geonames.org/searchJSON?q='+encodeURIComponent(placeDesc)+'&maxRows=1'+featureClass+'&callback=DashboardsMap.getLocation';}
else
return DashboardsMap.getLocation({totalResultsCount:1,geonames:[{lat:lat,lng:log}]});aObj=new JSONscriptRequest(request);aObj.buildScriptTag();aObj.addScriptTag();},resetSearch:function(){map.removeLayer(markers);markers.destroy();markers=new OpenLayers.Layer.Markers("Markers");map.addLayer(markers);this.cleanMessages();dataIdx=0;this.data=new Array();},getLocation:function(jData){var record=this.data[dataIdx++];if(jData==null||jData.totalResultsCount==0){var placeNotFound=record[0];this.addMessage(placeNotFound);}
else{var geoname=jData.geonames[0];var marker=record[4];var icon=record[5];record[6]=geoname.lng;record[7]=geoname.lat;var marker=this.showMarker(marker,record);record[4]=marker;}
if(dataIdx>=this.data.length&&dataIdx>1){var extent=markers.getDataExtent();map.zoomToExtent(extent);}
if(dataIdx>=this.data.length&&dataIdx==1){map.setCenter(markers.markers[0].lonlat,4,false,false);}},showMarker:function(oldMarker,record){var icon;var size;var lon=record[6];var lat=record[7];if(record[5]instanceof Array){var icon_array=record[5];icon=icon_array[0];size=new OpenLayers.Size(icon_array[1],icon_array[2])}
else{icon=record[5];size=new OpenLayers.Size(21,25);}
var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);var iconObj=new OpenLayers.Icon(icon,size,offset);if(this.useMercator=='true'){marker=new OpenLayers.Marker(lonLatToMercator(new OpenLayers.LonLat(lon,lat)),iconObj);feature=new OpenLayers.Feature(markers,lonLatToMercator(new OpenLayers.LonLat(lon,lat)),record);}else{marker=new OpenLayers.Marker(new OpenLayers.LonLat(lon,lat),iconObj);feature=new OpenLayers.Feature(markers,new OpenLayers.LonLat(lon,lat),record);}
feature.marker=marker;marker.events.register('mousedown',feature,DashboardsMap.marker_click);if(this.showToolTip=='true'){marker.events.register('mouseover',feature,DashboardsMap.marker_over);marker.events.register('mouseout',feature,DashboardsMap.marker_out);ttips=new OpenLayers.Control.ToolTips({bgColor:"black",textColor:"white",bold:true,opacity:0.50});map.addControl(ttips);}
markers.addMarker(marker);return marker;},marker_click:function(evt){click_lonlat=this.lonlat;var record=this.data;if(DashboardsMap.showToolTip=='true'){ttips.hide();};Dashboards.fireChange("selectedPoint",record[0]);},marker_over:function(evt){record=this.data;ttips.show({html:record[0]+': '+record[2]});},marker_out:function(evt){ttips.hide();},updateInfoWindow:function(content){if(content!=null){var html=$(content).text();show_bubble(click_lonlat,html);}},updateMap:function(){var n=this.data.length;for(idx=0;idx<n;idx++){var value=this.data[idx][2];var markers=this.mapMarkers;var icon=eval(this.mapExpression);var marker=this.data[idx][4];this.data[idx][5]=icon;this.data[idx][4]=this.showMarker(marker,this.data[idx]);}},addMessage:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML=document.getElementById(this.messageElementId).innerHTML+msg+"\n <br />";},cleanMessages:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML="";}};var MapComponent=BaseComponent.extend({initMap:true,update:function(){var div='map';if(this.mapDiv!=null){div=this.mapDiv;}
var b_layer_control=true;var b_custom_map=false;var b_use_mercator=true;var str_custom_map="";if(this.showLayerSelector==false){b_layer_control=this.showLayerSelector}
if(this.showCustomMap){b_custom_map='true';str_custom_map=this.customMapCode}
if(this.useMercator==false){b_use_mercator='false'
DashboardsMap.useMercator='false';}
if(this.showToolTip==true){DashboardsMap.showToolTip='true';}else{DashboardsMap.showToolTip='false';}
if(this.initMap){init_map(div,this.initPosLon,this.initPosLat,this.initZoom,b_use_mercator,b_layer_control,b_custom_map,str_custom_map);DashboardsMap.messageElementId=this.messageElementId;this.initMap=false;}
DashboardsMap.resetSearch();var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
html=Dashboards.pentahoAction(this.solution,this.path,this.action,p,null);var myArray=this.parseArray(html,true);var len=myArray.length;if(len>1){var cols=myArray[0];var colslength=cols.length;for(var i=1;i<len;i++){var details;if(colslength>4){details=new Array(colslength-4);for(var j=4;j<colslength;j++){details[j-4]=[cols[j],myArray[i][j]];}}
var value=myArray[i][4];var markers=this.markers;DashboardsMap.mapExpression=this.expression();DashboardsMap.mapMarkers=markers;var icon=eval(this.expression());DashboardsMap.data.push(new Array(myArray[i][0],new Array(myArray[i][1],myArray[i][2],myArray[i][3]),value,details,null,icon,null,null));DashboardsMap.search(this,DashboardsMap.data.length-1);}}}});var MapBubbleComponent=BaseComponent.extend({update:function(){DashboardsMap.selectedPointDetails=null;for(var i=0;i<DashboardsMap.data.length;i++)
{if(Dashboards.getParameterValue("selectedPoint")==DashboardsMap.data[i][0])
{DashboardsMap.selectedPointDetails=DashboardsMap.data[i][3];break;}}
var parameters=Dashboards.clone(DashboardsMap.selectedPointDetails);if(this.parameters!=undefined)
var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);parameters.push([key,value]);}
DashboardsMap.updateInfoWindow(Dashboards.pentahoAction(this.solution,this.path,this.action,parameters,null));}});var OlapUtils={};var OlapUtils={mdxGroups:{},evolutionType:"Week"}
OlapUtils.initMdxQueryGroup=function(obj){var mdxQueryGroup=new OlapUtils.mdxQueryGroup(obj.name);for(m in obj.mdxQueries){mdxQueryGroup.addMdxQuery(obj.mdxQueries[m].name,obj.mdxQueries[m].query,obj.mdxQueries[m].dimension,obj.mdxQueries[m].axis,obj.mdxQueries[m].chart);}
OlapUtils.mdxGroups[obj.name]=mdxQueryGroup;if(("#"+obj.htmlObject+"_evolutionType")!=undefined)
$("#"+obj.htmlObject+"_evolutionType").html(mdxQueryGroup.printEvolutionType(obj.htmlObject+"_evolutionType"));return mdxQueryGroup;}
OlapUtils.updateMdxQueryGroup=function(obj){var mdxGroup=OlapUtils.mdxGroups[obj.name];if(mdxGroup==undefined){mdxGroup=OlapUtils.initMdxQueryGroup(obj);}
$("#"+obj.htmlObject).html(mdxGroup.printConditions());}
OlapUtils.buttonsDescription={"Drill Down":'Drill down to the selected value and add the condition to the other charts',"Drill Up":'Drill up and add the condition to the other charts','Focus':"Focus on this value, adding the conditions to the other charts",'Exclude':"Exclude this value from the chart","Expand":'Expand the depth of the chart, showing an extra sublevel',"Collapse":'Collapse all previous expansions to the top most level',"Reset All":'Reset all filters and conditions from this chart group, returning to the original conditions',"Cancel":"Cancel"}
OlapUtils.fireMdxGroupAction=function(mdxQueryGroup,idx,param1,param2,param3){if(param2!=undefined&&param3!=undefined){cType=Dashboards.ev(param1.chartType);if(cType=="AreaChart")
value=encode_prepare(param3);else
value=encode_prepare(param2);}
else
value=encode_prepare(param1);var mdxQueryGroup=OlapUtils.mdxGroups[mdxQueryGroup];if(value=='Others')
return;OlapUtils.lastClickedMdxQueryGroup=mdxQueryGroup;mdxQueryGroup.clickedIdx=idx;mdxQueryGroup.clickedValue=value;var clickedObj=mdxQueryGroup.mdxQueries[idx];var buttonsHash={"Drill Down":'drilldown',"Drill Up":'drillup','Focus':"focus",'Exclude':"filter","Expand":'expand',"Collapse":'collapse',"Reset All":'resetall',"Cancel":"cancel"};if(clickedObj.mdxQuery.axisDepth==0)
delete buttonsHash.Collapse;var rl=clickedObj.mdxQuery.query.rowLevels;var d=typeof rl=="function"?rl():rl;if(clickedObj.mdxQuery.axisPos+clickedObj.mdxQuery.axisDepth>=d.length-1){delete buttonsHash["Drill Down"];delete buttonsHash.Expand;}
else{delete buttonsHash.Focus;}
if(clickedObj.mdxQuery.axisPos==0)
delete buttonsHash["Drill Up"];if(clickedObj.mdxQuery.axisDepth>0){delete buttonsHash["Drill Down"];delete buttonsHash.Focus;delete buttonsHash.Exclude;}
var msg="Available conditions: <br/> <ul>";$.each(buttonsHash,function(key,value){msg+="<li>"+OlapUtils.buttonsDescription[key]+"</li>"});msg+="</ul>";$.prompt(msg,{buttons:buttonsHash,callback:OlapUtils.mdxQueryGroupActionCallback});}
OlapUtils.mdxQuery=function(hash){this.query={};this.originalHash={};this.update(hash);this.axisPos=0;this.axisDepth=0;};OlapUtils.mdxQuery.prototype.reset=function(){this.update(this.originalHash);};OlapUtils.mdxQuery.prototype.resetFilter=function(value){var rf=this.query["filters"]["rows"];var index=rf.indexOf(value);rf.splice(index,1);return index;}
OlapUtils.mdxQuery.prototype.resetFilters=function(){this.query["filters"]=Dashboards.clone((this.originalHash["filters"]||{rows:[],columns:[]}));}
OlapUtils.mdxQuery.prototype.resetCondition=function(key){delete this.query["members"][key];delete this.query["sets"][key];if(this.query["conditions"][key+"InitialValue"]!=undefined)
this.query["where"][key]=this.query["conditions"][key+"InitialValue"];else
delete this.query["where"][key];}
OlapUtils.mdxQuery.prototype.update=function(hash){this.originalHash=Dashboards.clone(hash);this.query["members"]=hash["members"]||[];this.query["sets"]=hash["sets"]||[];this.query["rows"]=hash["rows"]||"";this.query["rowDrill"]=hash["rowDrill"]||false;this.query["rowLevels"]=hash["rowLevels"]||[];this.query["orderBy"]=hash["orderBy"]||"";this.query["from"]=hash["from"]||"";this.query["columns"]=hash["columns"];this.query["columnDrill"]=hash["columnDrill"]||false;this.query["columnLevels"]=hash["columnLevels"]||[];this.query["nonEmptyRows"]=hash["nonEmptyRows"]&&true;this.query["nonEmptyColumns"]=hash["nonEmptyColumns"]&&true;this.query["swapRowsAndColumns"]=hash["swapRowsAndColumns"]||false;this.query["filters"]=hash["filters"]||{rows:[],columns:[]};this.query["where"]=hash["where"]||{};this.query["extra"]=hash["extra"]||{};this.query["conditions"]=[];this.query["drills"]=[];};OlapUtils.mdxQuery.prototype.clone=function(){var c=Dashboards.clone(this);return c;};OlapUtils.mdxQuery.prototype.generateAxisPart=function(axisDrill,axis,axisLevels,orderBy){if(axisDrill==false){return axis;}
var dim=axis.indexOf("].")==-1?axis:axis.substr(0,axis.indexOf("].")+1);var axisLevel=this.axisPos+this.axisDepth;if(axisLevel>axisLevels.length-1){axisLevel=axisLevels.length-1}
var q="Descendants("+axis+", "+dim+".["+axisLevels[axisLevel]+"],SELF)"
if(orderBy=="")
return q;return"Order("+q+", "+orderBy+" , BDESC)";}
OlapUtils.mdxQuery.prototype.getQuery=function(){var query="with ";var _eh=[];for(p in this.query){var key=p;var value=typeof this.query[p]=='function'?this.query[p]():this.query[p];_eh[key]=value;}
if(typeof _eh["sets"]=='object'||typeof _eh["members"]=='object'){for(s in _eh["sets"]){var value=typeof _eh["sets"][s]=='function'?_eh["sets"][s]():_eh["sets"][s];query+=" set "+value+" \n";}
for(m in _eh["members"]){var value=typeof _eh["members"][m]=='function'?_eh["members"][m]():_eh["members"][m];query+=" member "+value+" \n";}}
var columns=_eh["swapRowsAndColumns"]?_eh["rows"]:_eh["columns"];var columnLevels=_eh["swapRowsAndColumns"]?_eh["rowLevels"]:_eh["columnLevels"];var columnDrill=_eh["swapRowsAndColumns"]?_eh["rowDrill"]:_eh["columnDrill"];var rows=_eh["swapRowsAndColumns"]?_eh["columns"]:_eh["rows"];var rowLevels=_eh["swapRowsAndColumns"]?_eh["columnLevels"]:_eh["rowLevels"];var rowDrill=_eh["swapRowsAndColumns"]?_eh["columnDrill"]:_eh["rowDrill"];query+=" set rowSet as {"+this.generateAxisPart(rowDrill,rows,rowLevels,_eh.orderBy)+"} \n";query+=" set colSet as {"+this.generateAxisPart(columnDrill,columns,columnLevels,_eh.orderBy)+"} \n";var colFilter=[];var rowFilter=[];$.each(_eh["filters"]["rows"],function(j,k){rowFilter.push(_eh["rows"]+".Dimension.currentMember.Name <> '"+k+"' ");});if(_eh["swapRowsAndColumns"]){query+=" set rowFilter as "+(colFilter.length>0?"Filter(rowSet,"+colFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(rowFilter.length>0?"Filter(colSet,"+rowFilter.join(" and ")+" )":"colSet")+"\n";}
else{query+=" set rowFilter as "+(rowFilter.length>0?"Filter(rowSet,"+rowFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(colFilter.length>0?"Filter(colSet,"+colFilter.join(" and ")+" )":"colSet")+"\n";}
query+="select "+(_eh["nonEmptyRows"]?" NON EMPTY ":"")+" rowFilter on rows,\n ";query+=" "+(_eh["nonEmptyColumns"]?" NON EMPTY ":"")+" colFilter on columns\n ";query+=" from "+_eh["from"]+"\n";var whereArray=[];$.each(_eh["where"],function(key,obj){var el=typeof obj=='function'?obj():obj
if(el.length>0)whereArray.push(el);});if(whereArray.length>0){query+=" where ( "+whereArray.join(' , ')+" )";}
return query;}
OlapUtils.mdxQuery.prototype.exclude=function(value){this.query["filters"]["rows"].push(value);}
OlapUtils.mdxQuery.prototype.drillDown=function(value){this.resetFilters();this.query["drills"].push(this.query.rows);this.query.rows=value;this.axisPos++;}
OlapUtils.mdxQuery.prototype.drillUp=function(){this.axisPos--;return(this.query.rows=this.query["drills"].pop());}
OlapUtils.mdxQuery.prototype.addCondition=function(key,value){return this.addConditionAux(key,value,'focus');}
OlapUtils.mdxQuery.prototype.addInitialCondition=function(key,value){this.addConditionAux(key,value);}
OlapUtils.mdxQuery.prototype.removeFilter=function(key,value){this.removeCondition(key,value,'exclude');var lastExclude=true
for(v in this.query["conditions"][key]){lastExclude=false;break;}
if(lastExclude&&this.query["conditions"][key+"previousDrillValue"]!=undefined){this.addCondition(key,this.query["conditions"][key+"previousDrillValue"]);delete this.query["conditions"][key+"previousDrillValue"];}}
OlapUtils.mdxQuery.prototype.removeCondition=function(key,value,op){if(this.query["conditions"][key]!=undefined){if(this.query["conditions"][key][value]!=undefined)
delete this.query["conditions"][key][value];else{delete this.query["conditions"][key];this.resetCondition(key);return true;}}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";this.setCondition(key,condition,op);return false;}
OlapUtils.mdxQuery.prototype.removeConditions=function(key){this.query["conditions"][key]=[];this.resetCondition(key);}
OlapUtils.mdxQuery.prototype.replaceConditionsByDrill=function(key,value){if(this.query["conditions"][key]!=undefined)
this.query["conditions"][key]=[];return this.addConditionAux(key,value,'drill');}
OlapUtils.mdxQuery.prototype.replaceConditionByExclude=function(key,value){return this.addConditionAux(key,value,'exclude');}
OlapUtils.mdxQuery.prototype.addConditionAux=function(key,value,op){if(op==undefined){this.query["where"][key]=value;return;}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";if(this.query["conditions"][key]==undefined){this.query["conditions"][key]=[];if(this.query["where"][key]!=undefined)
this.query["conditions"][key+"InitialValue"]=this.query["where"][key];}
if(this.query["members"][key]==undefined){if(op=='exclude'){}
else
this.addMember(key,condition+" as Aggregate("+key+"Filter)");}
this.query["conditions"][key][value]=op
if(op!='exclude')
delete this.query["conditions"][key+"previousDrillValue"];if(op!='drill'){var aux=[];for(v in this.query["conditions"][key]){if(op=='exclude'&&this.query["conditions"][key+"previousDrillValue"]==undefined&&this.query["conditions"][key][v]=='drill'){this.query["conditions"][key+"previousDrillValue"]=v;}
if(this.query["conditions"][key][v]==op)aux[v]=op;}
this.query["conditions"][key]=aux;}
return this.setCondition(key,condition,op);}
OlapUtils.mdxQuery.prototype.setCondition=function(key,condition,op)
{var set=[];for(v in this.query["conditions"][key])
set.push(v);if(set.length>0){if(op=="focus"||op=="drill")
this.addSet(key,key+"Filter as {"+set.join(",")+"}");else{this.addMember(key,condition+" as ( ( "+set[0]+".parent) - ("+set.join(") - (")+"))");}
if(condition!=undefined)
this.query["where"][key]=condition;}
else
this.resetCondition(key);return set;}
OlapUtils.mdxQuery.prototype.addSet=function(key,set){this.query["sets"][key]=set;}
OlapUtils.mdxQuery.prototype.addMember=function(key,member){this.query["members"][key]=member;}
OlapUtils.lastClickedMdxQueryGroup;OlapUtils.mdxQueryGroup=function(name){this.name=name;this.mdxQueries={};this.clickedIdx=-1;this.clickedValue="";this.activeFilters={};this.activeConditions={};};OlapUtils.mdxQueryGroup.prototype.addMdxQuery=function(idx,mdxQuery,filterDimension,filterAxis,chartObject){this.mdxQueries[idx]={mdxQuery:mdxQuery,filterDimension:filterDimension,filterAxis:filterAxis,chartObject:chartObject};};OlapUtils.mdxQueryGroup.prototype.removeMdxQuery=function(idx){delete this.mdxQueries.idx;};OlapUtils.mdxQueryGroup.prototype.printConditions=function(){var out="";var filters=0;var conds=0;for(i in this.activeFilters){var a=this.activeFilters[i];if(a.length>0&&++filters==1)
out+="<i>Exclusions: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k[1]+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeFilter(\""+i+"\",\""+k[0]+"\")'>X</a>");++filters;});if(o.length>0)
out+=o.join(" , ")+" ;";}
for(i in this.activeConditions){var a=this.activeConditions[i];if(a.length>0&&++conds==1)
out+=" <i>Focus: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeCondition(\""+i+"\",\""+k+"\")'>X</a>");++conds;});if(o.length>0)
out+=o.join(" , ")+"; ";}
if((conds+filters)>2)
out+=" <a  style=\"padding-left:15px;\" href='javascript:OlapUtils.mdxGroups[\""+this.name+"\"].resetAll()'>Reset All</a>";return out;}
OlapUtils.mdxQueryGroup.prototype.printEvolutionType=function(object){var out="";var myArray=[["Week","Week"],["Month","Month"],["Year","Year"]];for(var i=0,len=myArray.length;i<len;i++){out+="<input onclick='OlapUtils.changeEvolutionType(\""+object+"radio\")'";if(i==0){out+=" CHECKED ";}
out+="type='radio' id='"+object+"radio' name='"+object+"radio' value="+myArray[i][1]+" /> "+myArray[i][1]+(object.separator==undefined?"":object.separator);}
return out;}
OlapUtils.mdxQueryGroup.prototype.drillDown=function(key,value){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i==key){obj.mdxQuery.drillDown(value);}
else
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.drillUp=function(key){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];var keyObj=this.mdxQueries[key];var value=keyObj.mdxQuery.drillUp();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(keyObj.mdxQuery.axisPos>0)
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);else
obj.mdxQuery.removeCondition(key,value,'drill');}
Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.replaceFocus=function(key,values){for(i in this.mdxQueries)
if(i!=key)
this.mdxQueries[i].mdxQuery.removeConditions(key);this.focus(key,values);}
OlapUtils.mdxQueryGroup.prototype.focus=function(key,values){var conditions=[];Dashboards.incrementRunningCalls();if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){if(i!=key){var obj=this.mdxQueries[i];for(i=0;i<values.length;i++){conditions=obj.mdxQuery.addCondition(key,values[i]);}
Dashboards.update(obj.chartObject);}}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.exclude=function(key,value){Dashboards.incrementRunningCalls();var members=value.split("].[");var memberValue=members[members.length-1].replace("]","");this.mdxQueries[key].mdxQuery.exclude(memberValue)
Dashboards.update(this.mdxQueries[key].chartObject);var a=this.activeFilters[key]||[];a.push([memberValue,value]);this.activeFilters[key]=a;for(i in this.mdxQueries){var query=this.mdxQueries[i];if(i!=key){query.mdxQuery.replaceConditionByExclude(key,value);Dashboards.update(query.chartObject);}}
if(this.activeConditions[key]!=undefined)
var indexCondition=this.activeConditions[key].indexOf(value);if(indexCondition>=0)
this.activeConditions[key].splice(indexCondition,1);Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.expand=function(key){this.mdxQueries[key].mdxQuery.axisDepth++;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.collapse=function(key){this.mdxQueries[key].mdxQuery.axisDepth--;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.resetAll=function(){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];obj.mdxQuery.reset();obj.mdxQuery.axisPos=0;obj.mdxQuery.axisDepth=0;Dashboards.update(obj.chartObject);}
this.activeFilters={};this.activeConditions={};Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeCondition=function(key,value){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(obj.mdxQuery.removeCondition(key,value,'focus')&&this.activeFilters[key]!=undefined)
delete this.activeFilters[key];}
else{obj.mdxQuery.query.rows=typeof obj.mdxQuery.originalHash.rows=='function'?obj.mdxQuery.originalHash.rows():obj.mdxQuery.originalHash.rows;obj.mdxQuery.axisPos=0;obj.mdxQuery.resetFilters();}
Dashboards.update(obj.chartObject);}
this.activeConditions[key].splice(this.activeConditions[key].indexOf(value),1);Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeFilter=function(key,value){Dashboards.incrementRunningCalls();var index=this.mdxQueries[key].mdxQuery.resetFilter(value);for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key)
obj.mdxQuery.removeFilter(key,this.activeFilters[key][index][1]);Dashboards.update(obj.chartObject);}
this.activeFilters[key].splice(index,1);if(this.activeFilters[key].length==0)
delete this.activeFilters[key];Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroupActionCallback=function(value,m){if(value=="cancel")
return;Dashboards.incrementRunningCalls();var mqg=OlapUtils.lastClickedMdxQueryGroup;var clickedObj=mqg.mdxQueries[mqg.clickedIdx];var axis=typeof clickedObj.mdxQuery.query.rows=='function'?clickedObj.mdxQuery.query.rows():clickedObj.mdxQuery.query.rows;if(value=="drilldown"){mqg.drillDown(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="drillup"){mqg.drillUp(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="focus"){mqg.focus(mqg.clickedIdx,[axis+".["+mqg.clickedValue+"]"]);}
else if(value=="filter"){mqg.exclude(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="expand"){mqg.expand(mqg.clickedIdx);}
else if(value=="collapse"){mqg.collapse(mqg.clickedIdx);}
else if(value=="resetall"){mqg.resetAll();}
Dashboards.update(Dashboards.getComponent(mqg.name));Dashboards.decrementRunningCalls();}
OlapUtils.getAxisPathString=function(axis,axisPath){var a=[];$.each(axisPath,function(i,v){a.push("["+v+"]");});return axis+"."+a.join(".");}
OlapUtils.changeEvolutionType=function(object){var value="";var selector=document.getElementsByName(object);for(var i=0,len=selector.length;i<len;i++){if(selector[i].checked){value=selector[i].value;continue;};}
this.fireChange("OlapUtils.evolutionType",value);}
OlapUtils.GenericMdxQuery=Base.extend({mdxQuery:undefined,options:{},tableDefaults:{},chartDefaults:{},genericDefaults:{dateDim:'[Date]',dateLevel:'[Date]',dateLevelMonth:'[Month]',from:'[CubeName]',nonEmptyRows:true,rowDrill:true,measuresDim:'[Measures]',orderBy:undefined,debug:false},constructor:function(options){},getQuery:function(){this.query=this.mdxQuery.getQuery();if(this.options.debug==true){alert(this.query);}
return this.query;},getDataTableOptions:function(options){$.extend(this.tableDefaults,options);return TableComponent.getDataTableOptions(this.tableDefaults);},getChartOptions:function(options){$.extend(this.chartDefaults,options);return this.chartDefaults;}});OlapUtils.EvolutionQuery=OlapUtils.GenericMdxQuery.extend({mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{baseDate:'2008-10-01',rows:'[Locale Codes]',rowLevels:['Code'],measure:'[Total Month Requests]',debug:false},tableDefaults:{colHeaders:["Dimension",'Total','% m/m','% m/m-12','Last 12 months'],colTypes:['string','numeric','numeric','numeric','sparkline'],colFormats:[null,'%.0f','%.2f','%.2f',null],colWidths:['100px','50px','50px','50px','80px'],displayLength:10,sparklineType:"line",sortBy:[[1,'desc']]},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;var thisPeriod=options.dateDim+".[This Period]";var lastPeriod=options.dateDim+".[Previous Period]";var lastYearPeriod=options.dateDim+".[Last Year Period]";var nonEmptyMeasure=".[Not Null Measure]";this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:""+options.measuresDim+nonEmptyMeasure+","+options.measuresDim+".[% m/m],"+options.measuresDim+".[% m/m-12],"+options.measuresDim+".[sparkdatamonths]",swapRowsAndColumns:false,orderBy:options.orderBy,sets:{"now":function(){return"now as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"]"},"oneMonthAgo":function(){return"oneMonthAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(60.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"},"oneYearAgo":function(){return"oneYearAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(395.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(365.0)"},"last12Months":function(){return"last12Months as LastPeriods(12.0, Ancestor("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.baseDate)+"],"+options.dateDim+"."+options.dateLevelMonth+")) "}},members:{todaysMonth:function(){return"[Date].[TodaysMonth] as Aggregate( now )"},notNullMeasure:function(){return""+options.measuresDim+nonEmptyMeasure+" as Iif(isEmpty("+options.measuresDim+"."+options.measure+"), 0 ,"+options.measure+") "},thisPeriodMeasure:function(){return""+options.measuresDim+".[This Period] as Aggregate(now*"+options.measuresDim+nonEmptyMeasure+") "},previousPeriodMeasure:function(){return""+options.measuresDim+".[Previous Period] as Aggregate(oneMonthAgo*"+options.measuresDim+nonEmptyMeasure+") "},lastYearPeriodMeasure:function(){return""+options.measuresDim+".[Last Year Period] as Aggregate(oneYearAgo*"+options.measuresDim+nonEmptyMeasure+") "},mmMeasure:function(){return""+options.measuresDim+".[% m/m] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Previous Period] - 1.0)  "},mm12Measure:function(){return""+options.measuresDim+".[% m/m-12] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Last Year Period] - 1.0)  "},sparkdatamonths:function(){return""+options.measuresDim+".[sparkdatamonths] as Generate([last12Months], Cast(("+options.measuresDim+nonEmptyMeasure+") + 0.0 as String), \" , \") "}},where:{dateBase:""+options.dateDim+".[TodaysMonth]"}};this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},queryBase:{}});OlapUtils.DimensionAnalysisQuery=OlapUtils.GenericMdxQuery.extend({chartTypesTranslation:{},translationHash:{},mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{startDate:'2008-10-01',endDate:'2008-11-01',rows:'[Product Operating Systems]',rowLevels:["Platform","Version"],measure:'[Total Requests]',defaultChartType:"bar",debug:false,where:{}},tableDefaults:{colHeaders:['Name','Value'],colTypes:['string','numeric'],colFormats:[null,'%.0f'],sortBy:[[1,'desc']],lengthChange:false},chartDefaults:{domainLabelRotationDir:"up",domainLabelRotation:"0",orientation:"horizontal",title:"",isStacked:"true",is3d:false,foregroundAlpha:0.8,showValues:true,chartType:function(){return this.parent.queryBase.extra.translationHash.chartType;},datasetType:function(){return this.parent.queryBase.extra.translationHash.datasetType;},includeLegend:function(){return this.parent.queryBase.extra.translationHash.includeLegend;},topCountAxis:function(){return this.parent.queryBase.extra.translationHash.axis[1];}},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;this.chartTypesTranslation={"pie":{type:"jFreeChartComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"bar":{type:"jFreeChartComponent",chartType:"BarChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"table":{type:"tableComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"trend":{type:"jFreeChartComponent",chartType:"AreaChart",datasetType:"TimeSeriesCollection",axis:["rows","columns"],member:"a",includeLegend:true}};this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:function(){return this.extra.translationHash["member"]},swapRowsAndColumns:function(){return this.extra.translationHash["axis"][0]=="rows"},orderBy:"Avg(a,"+options.measuresDim+"."+options.measure+")",sets:{"a":function(){return"a as '("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.startDate)+"]:"+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.endDate)+"])'"}},members:{daterange:""+options.dateDim+".[Date Range] as Aggregate(a)",average:""+options.measuresDim+".[Avg] as 'Avg(a,"+options.measuresDim+"."+options.measure+")'"},where:options.where,extra:{}};var _chart=Dashboards.clone(this);delete _chart.chartDefaults;this.chartDefaults.parent=_chart;this.setChartType(options.defaultChartType);this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},setChartType:function(chartType){this.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];this.chartDefaults.parent.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];},getComponentType:function(){return this.chartDefaults.parent.queryBase.extra.translationHash.type;},queryBase:{}});if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());var MetaLayer={getCurrentDate:function(){var currentDate=new Date();return MetaLayer.toDateString(currentDate);},getYesterdayDate:function(){var currentDate=new Date();currentDate.setDate(currentDate.getDate()-1);return MetaLayer.toDateString(currentDate);},getFirstDayOfYearDate:function(){var currentDate=new Date();return currentDate.getFullYear()+"-01-01";},getFirstDayOfLastMonth:function(){var currentDate=new Date();currentDate.setMonth(currentDate.getMonth()-1);currentDate.setDate(1);return MetaLayer.toDateString(currentDate);},getLastDayOfLastMonth:function(){var currentDate=new Date();currentDate.setDate(0);return MetaLayer.toDateString(currentDate);},getLastMonthDate:function(){var currentDate=new Date();var prevDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()-30);var prevMonth="0"+(prevDate.getMonth()+1);var prevDay="0"+(prevDate.getDate());var prevDateStr=prevDate.getFullYear()+"-"+(prevMonth.substring(prevMonth.length-2,prevMonth.length))+"-"+(prevDay.substring(prevDay.length-2,prevDay.length));return prevDateStr;},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());var dStr=d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));return dStr;},getMonth:function(){var currentDate=new Date();var currentMonth="0"+(currentDate.getMonth()+1);var currentDateStr=currentDate.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length));return currentDateStr;},getMdxMonth:function(){var currentDate=new Date();var currentDateStr="[Date].["+currentDate.getFullYear()+"].["+currentDate.getMonth()+"]";return currentDateStr;},getInitialMonth:function(){var c=new Date();c.setMonth(c.getMonth()-1);return c;},allValues:[["All","All"]]};jQuery.fn.check=function(mode){var mode=mode||'on';return this.each(function(){switch(mode){case'on':this.checked=true;break;case'off':this.checked=false;break;case'toggle':this.checked=!this.checked;break;}});};jQuery.fn.extend({captify:function(o,object){var o=$.extend({speedOver:'fast',speedOut:'normal',hideDelay:4000,animation:'slide',prefix:'',opacity:'0.35',className:'caption-bottom',position:'bottom',spanWidth:'100%'},o);$(this).each(function(){var img=this;$(this).load(function(){$this=img;if(this.hasInit){return false;}
this.hasInit=true;var close=0;var invoker;var captionLabelSrc=$('#'+$(this).attr('rel'));var captionLabelHTML=!captionLabelSrc.length?$(this).attr('alt'):captionLabelSrc.html();captionLabelSrc.remove();var toWrap=this.parent&&this.parent.tagName=='a'?this.parent:$(this);var wrapper=toWrap.wrap('<div></div>').parent();wrapper.css({overflow:'hidden',padding:0,fontSize:0.1})
wrapper.addClass('caption-wrapper');wrapper.width($(this).width());wrapper.height($(this).height());$.map(['top','right','bottom','left'],function(i){wrapper.css('margin-'+i,$(img).css('margin-'+i));$.map(['style','width','color'],function(j){var key='border-'+i+'-'+j;wrapper.css(key,$(img).css(key));});});$(img).css({border:'0 none'});var button=$('<div></div>').addClass('caption-button');if(o.hasButton){toWrap.parent().parent().prepend(button);}
var caption=$('div:last',wrapper.append('<div></div>')).addClass(o.className);var captionContent=$('div:last',wrapper.append('<div></div>')).addClass(o.className).append(o.prefix).append(captionLabelHTML);$('*',wrapper).css({margin:0}).show();var captionPositioning=jQuery.browser.msie?'static':'relative';caption.css({zIndex:1,position:captionPositioning,opacity:o.animation=='fade'?0:o.opacity,width:o.spanWidth});if(o.position=='bottom'){var vLabelOffset=parseInt(caption.css('border-top-width').replace('px',''))+parseInt(captionContent.css('padding-top').replace('px',''))-1;captionContent.css('paddingTop',vLabelOffset);}
captionContent.css({position:captionPositioning,zIndex:2,background:'none',border:'1 none',opacity:o.animation=='fade'?1:1,width:o.spanWidth});caption.width(captionContent.outerWidth());caption.height(captionContent.height());button.width($(img).outerWidth());var topBorderAdj=(o.position=='bottom'&&jQuery.browser.msie)?-4:0;var captionPosition=(o.position=='top')?{hide:-$(img).height()-caption.outerHeight()-1,show:-$(img).height()}:{hide:0,show:-caption.outerHeight()+topBorderAdj};captionContent.css('marginTop',-caption.outerHeight());caption.css('marginTop',captionPosition[o.animation=='fade'||o.animation=='always-on'?'show':'hide']);var cHide=function(){if(close){var props=o.animation=='fade'?{opacity:0}:{marginTop:captionPosition.hide};caption.animate(props,250,null,function(){close=false});invoker.animate(props,250);if(o.animation=='fade'){captionContent.animate({opacity:0},o.speedOver,null,function(){close=false});}}};if(o.animation!='always-on'){$(this).bind("detailsClick",function(e,obj){if(!close){close=true;invoker=$(obj);var props=o.animation=='fade'?{opacity:o.opacity}:{marginTop:captionPosition.show};caption.animate(props,o.speedOver);invoker.animate(props,o.speedOver);if(o.animation=='fade'){captionContent.animate({opacity:1},o.speedOver/2);}
window.setTimeout(cHide,o.hideDelay);}});}
o.bDetails.trigger('capityFinished',[this]);});});}});pen.define("cdf/lib/CCC/pvc-d1.0",["cdf/Base","cdf/lib/CCC/def","cdf/lib/CCC/protovis"],function(_Base,def,pv){var pvc=def.globalSpace('pvc',{debug:0});(function(){(function(){if((typeof window.location)!=='undefined'){var url=window.location.href;if(url&&(/\bdebug=true\b/).test(url)){var m=/\bdebugLevel=(\d+)/.exec(url);pvc.debug=m?(+m[1]):1;}}}());pvc.invisibleFill='rgba(127,127,127,0.00001)';var arraySlice=pvc.arraySlice=Array.prototype.slice;pvc.setDebug=function(level){level=+level;pvc.debug=isNaN(level)?0:level;syncTipsyLog();return pvc.debug;};pvc.log=function(m){if(pvc.debug&&typeof console!=="undefined"){console.log("[pvChart]: "+
(typeof m==='string'?m:JSON.stringify(m)));}};pvc.logError=function(e){if(e&&typeof e==='object'&&e.message){e=e.message;}
if(typeof console!="undefined"){console.log("[pvChart ERROR]: "+e);}else{throw new Error("[pvChart ERROR]: "+e);}};pv.error=pvc.logError;function syncTipsyLog(){var tip=pv.Behavior.tipsy;if(tip&&tip.setDebug){tip.setDebug(pvc.debug);tip.log=pvc.log;}}
syncTipsyLog();pvc.cloneMatrix=function(m){return m.map(function(d){return d.slice();});};pvc.orientation={vertical:'vertical',horizontal:'horizontal'};pvc.extendType=function(type,exts,names){if(exts){var exts2;var addExtension=function(ext,name){if(ext!==undefined){if(!exts2){exts2={};}
exts2[name]=def.fun.to(ext);}};if(names){names.forEach(function(name){addExtension(exts[name],name);});}else{def.each(addExtension);}
if(exts2){type.add(exts2);}}};pvc.Range=function(start,stop,step){if(arguments.length==1){stop=start;start=0;}
if(step==null){step=1;}
if((stop-start)/step==Infinity){throw new Error("range must be finite");}
this.stop=stop;this.start=start;this.step=step;};pvc.Range.prototype.forEach=function(fun,ctx){var i=0,j;if(this.step<0){while((j=this.start+this.step*i++)>this.stop){fun.call(ctx,j);}}else{while((j=this.start+this.step*i++)<this.stop){fun.call(ctx,j);}}};pvc.Range.prototype.map=function(fun,ctx){var result=[];this.forEach(function(j){result.push(fun.call(ctx,j));});return result;};pvc.defaultColorScheme=null;pvc.setDefaultColorScheme=function(colors){return pvc.defaultColorScheme=pvc.colorScheme(colors);};pvc.defaultColor=pv.Colors.category10()('?');pvc.colorScheme=function(colors){if(colors==null){return null;}
if(typeof colors==='function'){if(!colors.hasOwnProperty('range')){return colors;}
colors=colors.range();}else{colors=def.array.as(colors);}
if(!colors.length){return null;}
return function(){var scale=pv.colors(colors);scale.domain.apply(scale,arguments);return scale;};},pvc.createColorScheme=function(colors){return pvc.colorScheme(colors)||pvc.defaultColorScheme||pv.Colors.category10;};pvc.toGrayScale=function(color,alpha,maxGrayLevel,minGrayLevel){color=pv.color(color);var avg=0.299*color.r+0.587*color.g+0.114*color.b;if(maxGrayLevel===undefined){maxGrayLevel=200;}else if(maxGrayLevel==null){maxGrayLevel=255;}
if(minGrayLevel===undefined){minGrayLevel=30;}else if(minGrayLevel==null){minGrayLevel=0;}
var delta=(maxGrayLevel-minGrayLevel);if(delta<=0){avg=maxGrayLevel;}else{avg=minGrayLevel+(avg/255)*delta;}
if(alpha==null){alpha=color.opacity;}else if(alpha<0){alpha=(-alpha)*color.opacity;}
avg=Math.round(avg);return pv.rgb(avg,avg,avg,alpha);};pvc.removeTipsyLegends=function(){try{$('.tipsy').remove();}catch(e){}};pvc.createDateComparer=function(parser,key){if(!key){key=pv.identity;}
return function(a,b){return parser.parse(key(a))-parser.parse(key(b));};};pv.Format.createParser=function(pvFormat){function parse(value){return pvFormat.parse(value);}
return parse;};pv.Format.createFormatter=function(pvFormat){function format(value){return value!=null?pvFormat.format(value):"";}
return format;};pvc.buildIndexedId=function(prefix,index){if(index===0){return prefix;}
return prefix+""+(index+1);};pvc.parseLegendClickMode=function(clickMode){if(!clickMode){clickMode='none';}
switch(clickMode){case'toggleSelected':case'toggleVisible':case'none':break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'legendClickMode' option value: '"+clickMode+"'. Assuming 'none'.");}
clickMode='none';break;}
return clickMode;};pvc.parseShape=function(shape){if(shape){switch(shape){case'square':case'circle':case'diamond':case'triangle':case'cross':case'bar':break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'shape' option value: '"+shape+"'.");}
shape=null;break;}}
return shape;};pvc.parseAlign=function(side,align){var align2,isInvalid;if(side==='left'||side==='right'){align2=align&&pvc.BasePanel.verticalAlign[align];if(!align2){align2='middle';isInvalid=!!align;}}else{align2=align&&pvc.BasePanel.horizontalAlign[align];if(!align2){align2='center';isInvalid=!!align;}}
if(isInvalid&&pvc.debug>=2){pvc.log(def.format("Invalid alignment value '{0}'. Assuming '{1}'.",[align,align2]));}
return align2;};pvc.Sides=function(sides){if(sides!=null){this.setSides(sides);}};pvc.Sides.hnames='left right'.split(' ');pvc.Sides.vnames='top bottom'.split(' ');pvc.Sides.names='left right top bottom'.split(' ');pvc.Sides.namesSet=pv.dict(pvc.Sides.names,def.retTrue);pvc.parsePosition=function(side,defaultSide){if(side&&!def.hasOwn(pvc.Sides.namesSet,side)){if(!defaultSide){defaultSide='left';}
if(pvc.debug>=2){pvc.log(def.format("Invalid position value '{0}. Assuming '{1}'.",[side,defaultSide]));}
side=defaultSide;}
return side;};pvc.Sides.as=function(v){if(v!=null&&!(v instanceof pvc.Sides)){v=new pvc.Sides().setSides(v);}
return v;};pvc.Sides.prototype.setSides=function(sides){if(typeof sides==='string'){var comps=sides.split(/\s+/).map(function(comp){return pvc.PercentValue.parse(comp);});switch(comps.length){case 1:this.set('all',comps[0]);return this;case 2:this.set('top',comps[0]);this.set('left',comps[1]);this.set('right',comps[1]);this.set('bottom',comps[0]);return this;case 3:this.set('top',comps[0]);this.set('left',comps[1]);this.set('right',comps[1]);this.set('bottom',comps[2]);return this;case 4:this.set('top',comps[0]);this.set('right',comps[1]);this.set('bottom',comps[2]);this.set('left',comps[3]);return this;case 0:return this;}}else if(typeof sides==='number'){this.set('all',sides);return this;}else if(typeof sides==='object'){if(sides instanceof pvc.PercentValue){this.set('all',sides);}else{this.set('all',sides.all);for(var p in sides){if(p!=='all'&&pvc.Sides.namesSet.hasOwnProperty(p)){this.set(p,sides[p]);}}}
return this;}
if(pvc.debug){pvc.log("Invalid 'sides' value: "+JSON.stringify(sides));}
return this;};pvc.Sides.prototype.set=function(prop,value){value=pvc.PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc.Sides.names.forEach(function(p){this[p]=value;},this);}else if(def.hasOwn(pvc.Sides.namesSet,prop)){this[prop]=value;}}};pvc.Sides.prototype.resolve=function(width,height){if(typeof width==='object'){height=width.height;width=width.width;}
var sides={};pvc.Sides.names.forEach(function(side){var value=0;var sideValue=this[side];if(sideValue!=null){if(typeof(sideValue)==='number'){value=sideValue;}else{value=sideValue.resolve((side==='left'||side==='right')?width:height);}}
sides[side]=value;},this);sides.width=sides.left+sides.right;sides.height=sides.bottom+sides.top;return sides;};pvc.Sides.resolvedMax=function(a,b){var sides={};pvc.Sides.names.forEach(function(side){sides[side]=Math.max(a[side]||0,b[side]||0);});return sides;};pvc.PercentValue=function(pct){this.percent=pct;};pvc.PercentValue.prototype.resolve=function(total){return this.percent*total;};pvc.PercentValue.parse=function(value){if(value!=null&&value!==''){switch(typeof value){case'number':return value;case'string':var match=value.match(/^(.+?)\s*(%)?$/);if(match){var n=+match[1];if(!isNaN(n)){if(match[2]){if(n>=0){return new pvc.PercentValue(n/100);}}else{return n;}}}
break;case'object':if(value instanceof pvc.PercentValue){return value;}
break;}
if(pvc.debug){pvc.log(def.format("Invalid margins component '{0}'",[''+value]));}}};pvc.PercentValue.resolve=function(value,total){return(value instanceof pvc.PercentValue)?value.resolve(total):value;};var markRenderCore=pv.Mark.prototype.renderCore,markZOrder=pv.Mark.prototype.zOrder;pv.Mark.prototype.zOrder=function(zOrder){var borderPanel=this.borderPanel;if(borderPanel&&borderPanel!==this){return markZOrder.call(borderPanel,zOrder);}
return markZOrder.call(this,zOrder);};pv.Mark.prototype.renderCore=function(){var root=this.root;root._renderId=(root._renderId||0)+1;if(pvc.debug>=10){pvc.log("BEGIN RENDER "+root._renderId);}
markRenderCore.apply(this,arguments);if(pvc.debug>=10){pvc.log("END RENDER "+root._renderId);}};pv.Mark.prototype.renderId=function(){return this.root._renderId;};pv.Mark.prototype.intercept=function(prop,interceptor,extValue,noCast){if(extValue!==undefined){if(!noCast){this[prop](extValue);extValue=this.propertyValue(prop);}}else if(!this._intercepted||!this._intercepted[prop]){extValue=this.propertyValue(prop);}
if(extValue!==undefined){extValue=def.fun.to(extValue);}
function interceptProp(){var args=arraySlice.call(arguments);return interceptor.call(this,extValue,args);}
this[prop](interceptProp);(this._intercepted||(this._intercepted={}))[prop]=true;return this;};pv.Mark.prototype.lock=function(prop,value){if(value!==undefined){this[prop](value);}
(this._locked||(this._locked={}))[prop]=true;return this;};pv.Mark.prototype.isIntercepted=function(prop){return this._intercepted&&this._intercepted[prop];};pv.Mark.prototype.isLocked=function(prop){return this._locked&&this._locked[prop];};pv.Mark.prototype.addMargin=function(name,margin){if(margin!==0){var staticValue=def.nullyTo(this.propertyValue(name),0),fMeasure=pv.functor(staticValue);this[name](function(){return margin+fMeasure.apply(this,arraySlice.call(arguments));});}
return this;};pv.Mark.prototype.addMargins=function(margins){var all=def.get(margins,'all',0);this.addMargin('left',def.get(margins,'left',all));this.addMargin('right',def.get(margins,'right',all));this.addMargin('top',def.get(margins,'top',all));this.addMargin('bottom',def.get(margins,'bottom',all));return this;};pv.Mark.prototype.eachSignumInstance=function(fun,ctx){this.eachInstance(function(instance,t){if(instance.datum||instance.group){fun.call(ctx,instance,t);}});};pv.Transform.prototype.transformHPosition=function(left){return this.x+(this.k*left);};pv.Transform.prototype.transformVPosition=function(top){return this.y+(this.k*top);};pv.Transform.prototype.transformLength=function(length){return this.k*length;};pv.Mark.prototype.getInstanceShape=function(instance){return new Rect(instance.left,instance.top,instance.width,instance.height);};pv.Mark.prototype.getInstanceCenterPoint=function(instance){return pv.vector(instance.left+(instance.width||0)/2,instance.top+(instance.height||0)/2);};pv.Label.prototype.getInstanceShape=function(instance){var t=pvc.text;var size=t.getTextSize(instance.text,instance.font);return t.getLabelPolygon(size.width,size.height,instance.textAlign,instance.textBaseline,instance.textAngle,instance.textMargin).apply(pv.Transform.identity.translate(instance.left,instance.top));};pv.Wedge.prototype.getInstanceCenterPoint=function(instance){var midAngle=instance.startAngle+(instance.angle/2);var midRadius=(instance.outerRadius+instance.innerRadius)/2;var dotLeft=instance.left+midRadius*Math.cos(midAngle);var dotTop=instance.top+midRadius*Math.sin(midAngle);return pv.vector(dotLeft,dotTop);};pv.Wedge.prototype.getInstanceShape=function(instance){var center=this.getInstanceCenterPoint(instance);return new Circle(center.x,center.y,10);};pv.Dot.prototype.getInstanceShape=function(instance){var radius=instance.shapeRadius,cx=instance.left,cy=instance.top;switch(instance.shape){case'diamond':radius*=Math.SQRT2;case'square':case'cross':return new Rect(cx-radius,cy-radius,2*radius,2*radius);}
return new Circle(cx,cy,radius);};pv.Dot.prototype.getInstanceCenterPoint=function(instance){return pv.vector(instance.left,instance.top);};pv.Area.prototype.getInstanceShape=pv.Line.prototype.getInstanceShape=function(instance,nextInstance){return new Line(instance.left,instance.top,nextInstance.left,nextInstance.top);};pv.Area.prototype.getInstanceCenterPoint=pv.Line.prototype.getInstanceCenterPoint=function(instance,nextInstance){return pv.vector((instance.left+nextInstance.left)/2,(instance.top+nextInstance.top)/2);};var Size=def.type('pvc.Size').init(function(width,height){if(arguments.length===1){if(width!=null){this.setSize(width);}}else{if(width!=null){this.width=width;}
if(height!=null){this.height=height;}}}).add({setSize:function(size,keyArgs){if(typeof size==='string'){var comps=size.split(/\s+/).map(function(comp){return pvc.PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,'singleProp','all'),comps[0]);return this;case 2:this.set('width',comps[0]);this.set('height',comps[1]);return this;case 0:return this;}}else if(typeof size==='number'){this.set(def.get(keyArgs,'singleProp','all'),size);return this;}else if(typeof size==='object'){this.set('all',size.all);for(var p in size){if(p!=='all'){this.set(p,size[p]);}}
return this;}
if(pvc.debug){pvc.log("Invalid 'size' value: "+JSON.stringify(size));}
return this;},set:function(prop,value){if(value!=null&&def.hasOwn(pvc.Size.namesSet,prop)){value=pvc.PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc.Size.names.forEach(function(p){this[p]=value;},this);}else{this[prop]=value;}}}},clone:function(){return new Size(this.width,this.height);},intersect:function(size){return new Size(Math.min(this.width,size.width),Math.min(this.height,size.height));},resolve:function(refSize){var size={};pvc.Size.names.forEach(function(length){var lengthValue=this[length];if(lengthValue!=null){if(typeof(lengthValue)==='number'){size[length]=lengthValue;}else if(refSize){var refLength=refSize[length];if(refLength!=null){size[length]=lengthValue.resolve(refLength);}}}},this);return size;}});pvc.Size.names=['width','height'];pvc.Size.namesSet=pv.dict(pvc.Size.names,def.retTrue);pvc.Size.as=function(v){if(v!=null&&!(v instanceof Size)){v=new Size().setSize(v);}
return v;};var Offset=def.type('pvc.Offset').init(function(x,y){if(arguments.length===1){if(x!=null){this.setOffset(x);}}else{if(x!=null){this.x=x;}
if(y!=null){this.y=y;}}}).add({setOffset:function(offset,keyArgs){if(typeof offset==='string'){var comps=offset.split(/\s+/).map(function(comp){return pvc.PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,'singleProp','all'),comps[0]);return this;case 2:this.set('x',comps[0]);this.set('y',comps[1]);return this;case 0:return this;}}else if(typeof offset==='number'){this.set(def.get(keyArgs,'singleProp','all'),offset);return this;}else if(typeof offset==='object'){this.set('all',offset.all);for(var p in offset){if(p!=='all'){this.set(p,offset[p]);}}
return this;}
if(pvc.debug){pvc.log("Invalid 'offset' value: "+JSON.stringify(offset));}
return this;},set:function(prop,value){if(value!=null&&def.hasOwn(pvc.Offset.namesSet,prop)){value=pvc.PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc.Offset.names.forEach(function(p){this[p]=value;},this);}else{this[prop]=value;}}}},resolve:function(refSize){var offset={};pvc.Size.names.forEach(function(length){var offsetProp=pvc.Offset.namesSizeToOffset[length];var offsetValue=this[offsetProp];if(offsetValue!=null){if(typeof(offsetValue)==='number'){offset[offsetProp]=offsetValue;}else if(refSize){var refLength=refSize[length];if(refLength!=null){offset[offsetProp]=offsetValue.resolve(refLength);}}}},this);return offset;}});pvc.Offset.names=['x','y'];pvc.Offset.namesSet=pv.dict(pvc.Offset.names,def.retTrue);pvc.Offset.namesSizeToOffset={width:'x',height:'y'};pvc.Offset.namesSidesToOffset={left:'x',right:'x',top:'y',bottom:'y'};pvc.Offset.as=function(v){if(v!=null&&!(v instanceof Offset)){v=new Offset().setOffset(v);}
return v;};var Shape=def.type('pvc.Shape').add({transform:function(t){return this.clone().apply(t);}});def.mixin(pv.Vector.prototype,Shape.prototype,{set:function(x,y){this.x=x||0;this.y=y||0;},clone:function(){return new pv.Vector(this.x,this.y);},apply:function(t){this.x=t.transformHPosition(this.x);this.y=t.transformVPosition(this.y);return this;},intersectsRect:function(rect){return(this.x>=rect.x)&&(this.x<=rect.x2)&&(this.y>=rect.y)&&(this.y<=rect.y2);}});var Rect=def.type('pvc.Rect',Shape).init(function(x,y,dx,dy){this.set(x,y,dx,dy);}).add({set:function(x,y,dx,dy){this.x=x||0;this.y=y||0;this.dx=dx||0;this.dy=dy||0;this.calc();},calc:function(){if(this.dx<0){this.dx=-this.dx;this.x=this.x-this.dx;}
if(this.dy<0){this.dy=-this.dy;this.y=this.y-this.dy;}
this.x2=this.x+this.dx;this.y2=this.y+this.dy;this._sides=null;},clone:function(){return new Rect(this.x,this.y,this.dx,this.dy);},apply:function(t){this.x=t.transformHPosition(this.x);this.y=t.transformVPosition(this.y);this.dx=t.transformLength(this.dx);this.dy=t.transformLength(this.dy);this.calc();return this;},containsPoint:function(x,y){return this.x<x&&x<this.x2&&this.y<y&&y<this.y2;},intersectsRect:function(rect){return(this.x2>rect.x)&&(this.x<rect.x2)&&(this.y2>rect.y)&&(this.y<rect.y2);},sides:function(){if(!this._sides){var x=this.x,y=this.y,x2=this.x2,y2=this.y2;this._sides=[new Line(x,y,x2,y),new Line(x2,y,x2,y2),new Line(x,y2,x2,y2),new Line(x,y,x,y2)];}
return this._sides;}});var Circle=def.type('pvc.Circle',Shape).init(function(x,y,radius){this.x=x||0;this.y=y||0;this.radius=radius||0;}).add({clone:function(){return new Circle(this.x,this.y,this.radius);},apply:function(t){this.x=t.transformHPosition(this.x);this.y=t.transformVPosition(this.y);this.radius=t.transformLength(this.radius);return this;},intersectsRect:function(rect){var dx2=rect.dx/2,dy2=rect.dy/2;var circleDistX=Math.abs(this.x-rect.x-dx2),circleDistY=Math.abs(this.y-rect.y-dy2);if((circleDistX>dx2+this.radius)||(circleDistY>dy2+this.radius)){return false;}
if(circleDistX<=dx2||circleDistY<=dy2){return true;}
var sqCornerDistance=Math.pow(circleDistX-dx2,2)+
Math.pow(circleDistY-dy2,2);return sqCornerDistance<=(this.radius*this.radius);}});var Line=def.type('pvc.Line',Shape).init(function(x,y,x2,y2){this.x=x||0;this.y=y||0;this.x2=x2||0;this.y2=y2||0;}).add({clone:function(){return new pvc.Line(this.x,this.y,this.x2,this.x2);},apply:function(t){this.x=t.transformHPosition(this.x);this.y=t.transformVPosition(this.y);this.x2=t.transformHPosition(this.x2);this.y2=t.transformVPosition(this.y2);return this;},intersectsRect:function(rect){if(!rect){return false;}
var sides=rect.sides();for(var i=0;i<4;i++){if(this.intersectsLine(sides[i])){return true;}}
return false;},intersectsLine:function(b){var a=this,x21=a.x2-a.x,y21=a.y2-a.y,x43=b.x2-b.x,y43=b.y2-b.y,denom=y43*x21-x43*y21;if(denom===0){return false;}
var y13=a.y-b.y,x13=a.x-b.x,numa=(x43*y13-y43*x13),numb=(x21*y13-y21*x13);if(denom===0){return(numa===0)&&(numb===0);}
var ua=numa/denom;if(ua<0||ua>1){return false;}
var ub=numb/denom;if(ub<0||ub>1){return false;}
return true;}});var Polygon=def.type('pvc.Polygon',Shape).init(function(corners){this._corners=corners||[];}).add({_sides:null,_bbox:null,corners:function(){return this._corners;},clone:function(){return new Polygon(this.corners().slice());},apply:function(t){delete this._sides;delete this._bbox;var corners=this.corners();for(var i=0,L=corners.length;i<L;i++){corners[i].apply(t);}
return this;},intersectsRect:function(rect){var i,L;var corners=this.corners();L=corners.length;for(i=0;i<L;i++){if(corners[i].intersectsRect(rect)){return true;}}
var sides=this.sides();L=sides.length;for(i=0;i<L;i++){if(sides[i].intersectsRect(rect)){return true;}}
return false;},sides:function(){var sides=this._sides;if(!sides){sides=this._sides=[];var corners=this.corners();var L=corners.length;if(L){var prevCorner=corners[0];for(var i=1;i<L;i++){var corner=corners[i];sides.push(new Line(prevCorner.x,prevCorner.y,corner.x,corner.y));}}}
return sides;},bbox:function(){var bbox=this._bbox;if(!bbox){var min,max;this.corners().forEach(function(corner,index){if(min==null){min=pv.vector(corner.x,corner.y);}else{if(corner.x<min.x){min.x=corner.x;}
if(corner.y<min.y){min.y=corner.y;}}
if(max==null){max=pv.vector(corner.x,corner.y);}else{if(corner.x>max.x){max.x=corner.x;}
if(corner.y>max.y){max.y=corner.y;}}});bbox=this._bbox=new pvc.Rect(min.x,min.y,max.x-min.x,max.y-min.y);}
return this._bbox;}});}());pv.Behavior.selector=function(autoRefresh,mark){var scene,index,mprev,inited,events,m1,redrawThis=(arguments.length>0)?autoRefresh:true;function mousedown(d,e){if(mark==null){index=this.index;scene=this.scene;}else{index=mark.index;scene=mark.scene;}
if(!events){var root=this.root.scene.$g;events=[[root,"mousemove",pv.listen(root,"mousemove",mousemove)],[root,"mouseup",pv.listen(root,"mouseup",mouseup)],[document,"mousemove",pv.listen(document,"mousemove",mousemove)],[document,"mouseup",pv.listen(document,"mouseup",mouseup)]];}
m1=this.mouse();mprev=m1;this.selectionRect=new pvc.Rect(m1.x,m1.y);pv.Mark.dispatch("selectstart",scene,index,e);}
function mousemove(e){if(!scene){return;}
e.stopPropagation();scene.mark.context(scene,index,function(){var m2=this.mouse();if(mprev){var dx=m2.x-mprev.x;var dy=m2.y-mprev.y;var len=dx*dx+dy*dy;if(len<=2){return;}
mprev=m2;}
var x=m1.x;var y=m1.y;this.selectionRect.set(x,y,m2.x-x,m2.y-y);if(redrawThis){this.render();}
pv.Mark.dispatch("select",scene,index,e);});}
function mouseup(e){var lscene=scene;if(lscene){if(events){events.forEach(function(registration){pv.unlisten.apply(pv,registration);});events=null;}
e.stopPropagation();var lmark=lscene.mark;if(lmark){pv.Mark.dispatch("selectend",lscene,index,e);lmark.selectionRect=null;}
mprev=null;scene=null;}}
return mousedown;};(function($){$.support.svg=$.support.svg||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");}(jQuery));def.scope(function(){var _currentFontSizeCache;function createCache(){return new pvc.text.FontSizeCache();}
function useCache(cache,fun,ctx){(cache instanceof pvc.text.FontSizeCache)||def.fail.operationInvalid("Not a valid text cache.");var prevCache=_currentFontSizeCache;_currentFontSizeCache=cache;try{return fun.call(ctx);}finally{_currentFontSizeCache=prevCache;}}
function getTextSize(text,font){if(text==null){text="";}else{text=""+text;}
var bbox=_currentFontSizeCache&&_currentFontSizeCache.get(font,text);if(!bbox){bbox=getTextSizeCore(text,font);_currentFontSizeCache&&_currentFontSizeCache.put(font,text,bbox);}
return bbox;}
function getTextLength(text,font){return getTextSize(text,font).width;}
function getTextHeight(text,font){return getTextSize(text,font).height;}
function getFontSize(font){if(pv.renderer()==='batik'){var sty=document.createElementNS('http://www.w3.org/2000/svg','text').style;sty.setProperty('font',font);return parseInt(sty.getProperty('font-size'),10);}
var holder=getTextSizePlaceholder();holder.css('font',font);return parseInt(holder.css('font-size'),10);}
function getFitInfo(w,h,text,font,diagMargin){if(text===''){return{h:true,v:true,d:true};}
var len=getTextLength(text,font);return{h:len<=w,v:len<=h,d:len<=Math.sqrt(w*w+h*h)-diagMargin};}
function trimToWidthB(len,text,font,trimTerminator,before){len+=getTextLength(trimTerminator,font);return trimToWidth(len,text,font,trimTerminator,before);}
function trimToWidth(len,text,font,trimTerminator,before){if(text===''){return text;}
var textLen=getTextLength(text,font);if(textLen<=len){return text;}
if(textLen>len*1.5){return trimToWidthBin(len,text,font,trimTerminator,before);}
while(textLen>len){text=before?text.slice(1):text.slice(0,text.length-1);textLen=getTextLength(text,font);}
return before?(trimTerminator+text):(text+trimTerminator);}
function justifyText(text,lineWidth,font){var lines=[];if(lineWidth<getTextLength('a',font)){return lines;}
var words=(text||'').split(/\s+/);var line="";while(words.length){var word=words.shift();if(word){var nextLine=line?(line+" "+word):word;if(pvc.text.getTextLength(nextLine,font)>lineWidth){if(line){lines.push(line);}
line=word;}else{line=nextLine;}}}
if(line){lines.push(line);}
return lines;}
function getLabelPolygon(textWidth,textHeight,align,baseline,angle,margin){var x,y;switch(baseline){case"middle":y=textHeight/2;break;case"top":y=margin+textHeight;break;case"bottom":y=-margin;break;}
switch(align){case"right":x=-margin-textWidth;break;case"center":x=-textWidth/2;break;case"left":x=margin;break;}
var bl=pv.vector(x,y);var br=bl.plus(textWidth,0);var tr=br.plus(0,-textHeight);var tl=bl.plus(0,-textHeight);if(angle!==0){bl=bl.rotate(angle);br=br.rotate(angle);tl=tl.rotate(angle);tr=tr.rotate(angle);}
return new pvc.Polygon([bl,br,tl,tr]);}
function getLabelBBox(textWidth,textHeight,align,baseline,angle,margin){var polygon=getLabelPolygon(textWidth,textHeight,align,baseline,angle,margin);var corners=polygon.corners();var bbox;if(angle===0){var min=corners[2];var max=corners[1];bbox=new pvc.Rect(min.x,min.y,max.x-min.x,max.y-min.y);}else{bbox=polygon.bbox();}
bbox.sourceCorners=corners;bbox.sourceAngle=angle;bbox.sourceAlign=align;bbox.sourceTextWidth=textWidth;return bbox;}
var $textSizePlaceholder=null,_svgText=null,_svgTextFont=null,textSizePlaceholderId='cccTextSizeTest_'+new Date().getTime();function getTextSizeCore(text,font){if(!text){return{width:0,height:0};}
switch(pv.renderer()){case'vml':return getTextSizeVML(text,font);case'batik':return getTextSizeCGG(text,font);}
return getTextSizeSVG(text,font);}
function getTextSizeSVG(text,font){if(!_svgText){var holder=getTextSizePlaceholder();var svgElem=pv.SvgScene.create('svg');svgElem.setAttribute('font-size','10px');svgElem.setAttribute('font-family','sans-serif');_svgText=pv.SvgScene.create('text');svgElem.appendChild(_svgText);holder[0].appendChild(svgElem);}
if(!font){font=null;}
if(_svgTextFont!==font){_svgTextFont=font;pv.SvgScene.setStyle(_svgText,{'font':font});}
var textNode=_svgText.firstChild;if(textNode){textNode.nodeValue=''+text;}else{if(pv.renderer()==="svgweb"){_svgText.appendChild(document.createTextNode(''+text,true));}else{_svgText.appendChild(document.createTextNode(''+text));}}
var box=_svgText.getBBox();return{width:box.width,height:box.height};}
function getTextSizePlaceholder(){if(!$textSizePlaceholder||!$textSizePlaceholder.parent().length){$textSizePlaceholder=$(textSizePlaceholderId);if(!$textSizePlaceholder.length){$textSizePlaceholder=$('<div>').attr('id',textSizePlaceholderId).css('position','absolute').css('visibility','hidden').css('width','auto').css('height','auto');$('body').append($textSizePlaceholder);}}
return $textSizePlaceholder;}
function getTextSizeCGG(text,font){var fontInfo=getFontInfoCGG(font);return{width:getTextLenCGG(text,fontInfo.family,fontInfo.size,fontInfo.style,fontInfo.weight),height:getTextHeightCGG(text,fontInfo.family,fontInfo.size,fontInfo.style,fontInfo.weight)};}
var _cggFontCache,_cggFontTextElem;function getFontInfoCGG(font){var fontInfo=_cggFontCache&&_cggFontCache[font];if(!fontInfo){if(!_cggFontTextElem){_cggFontTextElem=document.createElementNS('http://www.w3.org/2000/svg','text');}
var sty=_cggFontTextElem.style;sty.setProperty('font',font);var family=''+sty.getProperty('font-family');if(!family){family='sans-serif';}else if(family.length>2){var quote=family.charAt(0);if(quote==='"'||quote==="'"){family=family.substr(1,family.length-2);}}
fontInfo={family:family,size:''+sty.getProperty('font-size'),style:''+sty.getProperty('font-style'),weight:''+sty.getProperty('font-weight')};}
return fontInfo;}
function getTextSizeVML(text,font){var box=pv.Vml.text_dims(text,font);return{width:box.width,height:box.height};}
function trimToWidthBin(len,text,font,trimTerminator,before){var ilen=text.length,high=ilen-2,low=0,mid,textLen;while(low<=high&&high>0){mid=Math.ceil((low+high)/2);var textMid=before?text.slice(ilen-mid):text.slice(0,mid);textLen=getTextLength(textMid,font);if(textLen>len){high=mid-1;}else if(getTextLength(before?text.slice(ilen-mid-1):text.slice(0,mid+1),font)<len){low=mid+1;}else{return before?(trimTerminator+textMid):(textMid+trimTerminator);}}
return before?(trimTerminator+text.slice(ilen-high)):(text.slice(0,high)+trimTerminator);}
def.type('pvc.text.FontSizeCache').init(function(){this._fontsCache={};}).add({_getFont:function(font){return def.getOwn(this._fontsCache,font||'')||(this._fontsCache[font||'']={});},get:function(font,text){return def.getOwn(this._getFont(font),text||'');},put:function(font,text,size){return this._getFont(font)[text||'']=size;}});def.copyOwn(pvc.text,{createCache:createCache,useCache:useCache,getTextSize:getTextSize,getTextLength:getTextLength,getFontSize:getFontSize,getTextHeight:getTextHeight,getFitInfo:getFitInfo,trimToWidth:trimToWidth,trimToWidthB:trimToWidthB,justify:justifyText,getLabelBBox:getLabelBBox,getLabelPolygon:getLabelPolygon});});def.scope(function(){pvc.color={scale:colorScale,scales:colorScales};function colorScales(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');var type=keyArgs.type||def.fail.argumentRequired('keyArgs.type');switch(type){case'linear':return new pvc.color.LinearScalesBuild(keyArgs).buildMap();case'discrete':return new pvc.color.DiscreteScalesBuild(keyArgs).buildMap();case'normal':return new pvc.color.NormalScalesBuild(keyArgs).buildMap();}
throw def.error.argumentInvalid('scaleType',"Unexistent scale type '{0}'.",[type]);}
function colorScale(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');var type=keyArgs.type||def.fail.argumentRequired('keyArgs.type');switch(type){case'linear':return new pvc.color.LinearScalesBuild(keyArgs).build();case'discrete':return new pvc.color.DiscreteScalesBuild(keyArgs).build();case'normal':return new pvc.color.NormalScalesBuild(keyArgs).build();}
throw def.error.argumentInvalid('scaleType',"Unexistent scale type '{0}'.",[type]);}
def.type('pvc.color.ScalesBuild').init(function(keyArgs){this.keyArgs=keyArgs;this.data=keyArgs.data||def.fail.argumentRequired('keyArgs.data');this.domainDimName=keyArgs.colorDimension||def.fail.argumentRequired('keyArgs.colorDimension');this.domainDim=this.data.dimensions(this.domainDimName);var dimType=this.domainDim.type;if(!dimType.isComparable){this.domainComparer=null;pvc.log("Color value dimension should be comparable. Generated color scale may be invalid.");}else{this.domainComparer=function(a,b){return dimType.compare(a,b);};}
this.nullRangeValue=keyArgs.nullColor?pv.color(keyArgs.nullColor):pv.Color.transparent;this.domainRangeCountDif=0;}).add({build:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var domain=this._getDomain();return this._createScale(domain);},buildMap:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var createCategoryScale;if(this.keyArgs.normPerBaseCategory){createCategoryScale=function(leafData){var domain=this._ensureDomain(null,false,leafData);return this._createScale(domain);};}else{var domain=this._getDomain(),scale=this._createScale(domain);createCategoryScale=def.fun.constant(scale);}
return this._createCategoryScalesMap(createCategoryScale);},_createScale:def.method({isAbstract:true}),_createCategoryScalesMap:function(createCategoryScale){return this.data.leafs().object({name:function(leafData){return leafData.absKey;},value:createCategoryScale,context:this});},_getRange:function(){var keyArgs=this.keyArgs,range=keyArgs.colorRange||['red','yellow','green'];if(keyArgs.minColor!=null&&keyArgs.maxColor!=null){range=[keyArgs.minColor,keyArgs.maxColor];}else if(keyArgs.minColor!=null){range.unshift(keyArgs.minColor);}else if(keyArgs.maxColor!=null){range.push(keyArgs.maxColor);}
return range.map(function(c){return pv.color(c);});},_getDataExtent:function(data){var extent=data.dimensions(this.domainDimName).extent({visible:true});if(!extent){return null;}
var min=extent.min.value,max=extent.max.value;if(max==min){if(max>=1){min=max-1;}else{max=min+1;}}
return{min:min,max:max};},_getDomain:function(){var domain=this.keyArgs.colorRangeInterval;if(domain!=null){if(this.domainComparer){domain.sort(this.domainComparer);}
if(domain.length>this.desiredDomainCount){domain=domain.slice(0,this.desiredDomainCount);}}else{domain=[];}
return this._ensureDomain(domain,true,this.data);},_ensureDomain:function(domain,doDomainPadding,data){var extent;if(domain&&doDomainPadding){var domainPointsMissing=this.desiredDomainCount-domain.length;if(domainPointsMissing>0){extent=this._getDataExtent(data);if(extent){switch(domainPointsMissing){case 1:if(this.domainComparer){def.array.insert(domain,extent.max,this.domainComparer);}else{domain.push(extent.max);}
break;case 2:if(this.domainComparer){def.array.insert(domain,extent.min,this.domainComparer);def.array.insert(domain,extent.max,this.domainComparer);}else{domain.unshift(extent.min);domain.push(extent.max);}
break;default:if(pvc.debug>=2){pvc.log("Ignoring option 'colorRangeInterval' due to unsupported length."+
def.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,domain.length]));}
domain=null;}}}}
if(!domain){extent||(extent=this._getDataExtent(data));if(extent){var min=extent.min,max=extent.max;var step=(max-min)/(this.desiredDomainCount-1);domain=pv.range(min,max+step,step);}}
return domain;}});def.type('pvc.color.LinearScalesBuild',pvc.color.ScalesBuild).add({_createScale:function(domain){var scale=pv.Scale.linear();if(domain){scale.domain.apply(scale,domain);}
scale.range.apply(scale,this.range);return scale;}});def.type('pvc.color.DiscreteScalesBuild',pvc.color.ScalesBuild).init(function(keyArgs){this.base(keyArgs);this.domainRangeCountDif=1;}).add({_createScale:function(domain){var Dl=domain.length-1,range=this.range,nullRangeValue=this.nullRangeValue,Rl=range.length-1;function scale(val){if(val==null){return nullRangeValue;}
for(var i=0;i<Dl;i++){if(val<=domain[i+1]){return range[i];}}
return range[Rl];}
return scale;}});});def.scope(function(){function options(specs,context){specs||def.fail.argumentRequired('specs');var _infos={};def.each(specs,function(spec,name){var info=new OptionInfo(name,option,context,spec);_infos[info.name]=info;var aliases=info.alias;if(aliases){aliases.forEach(function(alias){_infos[alias]=info;});}});function resolve(name){var info=def.getOwn(_infos,name)||def.fail.operationInvalid("Undefined option '{0}'",[name]);return info.resolve();}
function option(name,noDefault){var info=resolve(name);return noDefault&&!info.isSpecified?undefined:info.value;}
function isSpecified(name){return resolve(name).isSpecified;}
function specify(opts){return set(opts,false);}
function defaults(opts){return set(opts,true);}
function getDefaultValue(name){return resolve(name)._defaultValue;}
function set(opts,isDefault){for(var name in opts){var info=def.getOwn(_infos,name);if(info){var value=opts[name];if(value!==undefined){info.set(name,isDefault);}}}
return option;}
option.option=option;option.isSpecified=isSpecified;option.defaultValue=getDefaultValue;option.specify=specify;option.defaults=defaults;return option;}
pvc.options=options;var OptionInfo=def.type().init(function(name,option,context,spec){this.name=name;this._context=context;this.option=option;this.cast=def.get(spec,'cast');var value=def.get(spec,'value');if(value!==undefined){this._defaultValue=this.value=value;}
this.resolveCore=def.get(spec,'resolve');if(!this.resolveCore){this.isResolved=true;}
this.alias=def.array.as(def.get(spec,'alias'));}).add({isSpecified:false,isResolved:false,value:undefined,_defaultValue:undefined,resolve:function(){if(!this.isResolved){this.isResolved=true;this.resolveCore(this._context);}
return this;},specify:function(value){return this.set(value,false);},defaultValue:function(defaultValue){if(defaultValue!==undefined){this.set(defaultValue,true);}
return this._defaultValue;},set:function(value,isDefault){if(value!=null){if(this.cast){value=this.cast(value,this._context);}}
if(!isDefault){this.isSpecified=true;this.isResolved=true;this.value=value;}else{this._defaultValue=value;if(!this.isSpecified){this.value=value;}}
return this;}});});def.global.NoDataException=function(){};pvc.data={visibleKeyArgs:{visible:true}};function data_disposeChildList(list,parentProp){if(list){list.forEach(function(child){if(parentProp){child[parentProp]=null;}
child.dispose();});list.length=0;}}
function data_addColChild(parent,childrenProp,child,parentProp){(child&&!child[parentProp])||def.assert("Must not have a '"+parentProp+"'.");child[parentProp]=parent;(parent[childrenProp]||(parent[childrenProp]=[])).push(child);}
function data_removeColChild(parent,childrenProp,child,parentProp){(child&&(!child[parentProp]||child[parentProp]===parent))||def.assert("Not a child");var children=parent[childrenProp];if(children){var index=children.indexOf(child);if(index>=0){def.array.removeAt(children,index);}}
child[parentProp]=null;}
def.type('pvc.data.DimensionType').init(function(complexType,name,keyArgs){this.complexType=complexType;this.name=name;this.label=def.get(keyArgs,'label')||def.firstUpperCase(name);var groupAndLevel=pvc.data.DimensionType.splitDimensionGroupName(name);this.group=groupAndLevel[0];this.groupLevel=def.nullyTo(groupAndLevel[1],0);if(this.label.indexOf('{')>=0){this.label=def.format(this.label,[this.groupLevel+1]);}
this.playedVisualRoles=new def.Map();this.isHidden=!!def.get(keyArgs,'isHidden');var valueType=def.get(keyArgs,'valueType')||null;var valueTypeName=pvc.data.DimensionType.valueTypeName(valueType);var cast=def.getOwn(pvc.data.DimensionType.cast,valueTypeName,null);this.valueType=valueType;this.valueTypeName=valueTypeName;this.cast=cast;this.isDiscrete=def.get(keyArgs,'isDiscrete');if(this.isDiscrete==null){this.isDiscrete=(this.valueType!==Number&&this.valueType!==Date);}else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&(this.valueType!==Number&&this.valueType!==Date)){throw def.error.argumentInvalid('isDiscrete',"The only supported continuous value types are Number and Date.");}}
this._converter=def.get(keyArgs,'converter')||null;if(!this._converter){var rawFormat=def.get(keyArgs,'rawFormat');if(rawFormat){switch(this.valueType){case Number:this._converter=pv.Format.createParser(pv.Format.number().fractionDigits(0,2));break;case Date:this._converter=pv.Format.createParser(pv.Format.date(rawFormat));break;}}}
this._key=def.get(keyArgs,'key')||null;this._comparer=def.get(keyArgs,'comparer');if(this._comparer===undefined){switch(this.valueType){case Number:if(!this.isDiscrete){this._comparer=def.compare;}
break;case Date:this._comparer=def.compare;break;default:this._comparer=null;}}
this.isComparable=this._comparer!=null;this._formatter=def.get(keyArgs,'formatter')||null;if(!this._formatter){switch(this.valueType){case Number:this._formatter=pv.Format.createFormatter(pv.Format.number().fractionDigits(0,2));break;case Date:var format=def.get(keyArgs,'format')||"%Y/%m/%d";this._formatter=pv.Format.createFormatter(pv.Format.date(format));break;}}}).add({compare:function(a,b){if(a==null){if(b==null){return 0;}
return-1;}else if(b==null){return 1;}
return this._comparer.call(null,a,b);},comparer:function(reverse){if(!this.isComparable){return null;}
var me=this;if(reverse){return this._reverseComparer||(this._reverseComparer=function(a,b){return me.compare(b,a);});}
return this._directComparer||(this._directComparer=function(a,b){return me.compare(a,b);});},atomComparer:function(reverse){if(reverse){return this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer());}
return this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer());},_createReverseAtomComparer:function(){if(!this.isComparable){return atom_idComparerReverse;}
var me=this;function reverseAtomComparer(a,b){if(a===b){return 0;}
return me.compare(b.value,a.value);}
return reverseAtomComparer;},_createDirectAtomComparer:function(){if(!this.isComparable){return atom_idComparer;}
var me=this;function directAtomComparer(a,b){if(a===b){return 0;}
return me.compare(a.value,b.value);}
return directAtomComparer;},formatter:function(){return this._formatter;},converter:function(){return this._converter;},playingPercentVisualRole:function(){return def.query(this.playedVisualRoles.values()).any(function(visualRole){return visualRole.isPercent;});}});pvc.data.DimensionType.cast={'Date':function(value){return value instanceof Date?value:new Date(value);},'Number':function(value){value=Number(value);return isNaN(value)?null:value;},'String':String,'Boolean':Boolean,'Object':Object,'Any':null};pvc.data.DimensionType.dimensionGroupName=function(dimName){return dimName.replace(/^(.*?)(\d*)$/,"$1");};pvc.data.DimensionType.splitDimensionGroupName=function(dimName){var match=/^(.*?)(\d*)$/.exec(dimName);var index=null;if(match[2]){index=Number(match[2]);if(index<=1){index=1;}else{index--;}}
return[match[1],index];};pvc.data.DimensionType.valueTypeName=function(valueType){if(valueType==null){return"Any";}
switch(valueType){case Boolean:return'Boolean';case Number:return'Number';case String:return'String';case Object:return'Object';case Date:return'Date';default:throw def.error.argumentInvalid('valueType',"Invalid valueType function: '{0}'.",[valueType]);}};pvc.data.DimensionType.dimensionGroupLevelName=function(baseDimName,level){return baseDimName+(level>=1?(level+1):'');};pvc.data.DimensionType.extendSpec=function(dimName,dimSpec,keyArgs){var dimGroup=pvc.data.DimensionType.dimensionGroupName(dimName),userDimGroupsSpec=def.get(keyArgs,'dimensionGroups');if(userDimGroupsSpec){var groupDimSpec=userDimGroupsSpec[dimGroup];if(groupDimSpec){dimSpec=def.create(groupDimSpec,dimSpec);}}
if(!dimSpec){dimSpec={};}
switch(dimGroup){case'category':var isCategoryTimeSeries=def.get(keyArgs,'isCategoryTimeSeries',false);if(isCategoryTimeSeries){if(dimSpec.valueType===undefined){dimSpec.valueType=Date;}}
break;case'value':if(dimSpec.valueType===undefined){dimSpec.valueType=Number;}
if(dimSpec.valueType===Number){if(dimSpec.formatter===undefined&&!dimSpec.format){dimSpec.formatter=def.get(keyArgs,'valueNumberFormatter');}}
break;default:if(dimName==='dataPart'){if(dimSpec.isDiscrete===undefined){dimSpec.isDiscrete=true;}
if(dimSpec.isHidden===undefined){dimSpec.isHidden=true;}
if(dimSpec.comparer===undefined){dimSpec.comparer=def.compare;}}
break;}
if(dimSpec.converter===undefined&&dimSpec.valueType===Date&&!dimSpec.rawFormat){dimSpec.rawFormat=def.get(keyArgs,'timeSeriesFormat');}
return dimSpec;};function dimType_addVisualRole(visualRole){this.playedVisualRoles.set(visualRole.name,visualRole);compType_dimensionRolesChanged.call(this.type,this);}
function dimType_removeVisualRole(visualRole){this.playedVisualRoles.rem(visualRole.name);compType_dimensionRolesChanged.call(this.type,this);}
def.type('pvc.data.ComplexType').init(function(dimTypeSpecs){this._dims={};this._dimsList=[];this._dimsNames=[];this._dimsByGroup={};this._dimsNamesByGroup={};if(dimTypeSpecs){for(var name in dimTypeSpecs){this.addDimension(name,dimTypeSpecs[name]);}}}).add({describe:function(){var out=["\n------------------------------------------"];out.push("Complex Type Information");this._dimsList.forEach(function(type){var features=[];features.push(type.valueTypeName);if(type.isComparable){features.push("comparable");}
if(!type.isDiscrete){features.push("continuous");}
if(type.isHidden){features.push("hidden");}
out.push("  "+type.name+" ("+features.join(', ')+")");});out.push("------------------------------------------");return out.join("\n");},dimensions:function(name,keyArgs){if(name==null){return this._dims;}
var dimType=def.getOwn(this._dims,name,null);if(!dimType&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid('name',"Undefined dimension '{0}'",[name]);}
return dimType;},dimensionsList:function(){return this._dimsList;},dimensionsNames:function(){return this._dimsNames;},groupDimensions:function(group,keyArgs){var dims=def.getOwn(this._dimsByGroup,group);if(!dims&&def.get(keyArgs,'assertExists',true)){throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);}
return dims;},groupDimensionsNames:function(group,keyArgs){var dimNames=def.getOwn(this._dimsNamesByGroup,group);if(!dimNames&&def.get(keyArgs,'assertExists',true)){throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);}
return dimNames;},addDimension:function(name,dimTypeSpec){name||def.fail.argumentRequired('name');!def.hasOwn(this._dims,name)||def.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[name]);var dimension=new pvc.data.DimensionType(this,name,dimTypeSpec);this._dims[name]=dimension;this._dimsList.push(dimension);this._dimsNames.push(name);var group=dimension.group;if(group){var groupDims=def.getOwn(this._dimsByGroup,group),groupDimsNames;if(!groupDims){groupDims=this._dimsByGroup[group]=[];groupDimsNames=this._dimsNamesByGroup[group]=[];}else{groupDimsNames=this._dimsNamesByGroup[group];}
var level=def.array.insert(groupDimsNames,name,def.compare);def.array.insertAt(groupDims,~level,dimension);}
this._isPctRoleDimTypeMap=null;return dimension;},getPlayingPercentVisualRoleDimensionMap:function(){var map=this._isPctRoleDimTypeMap;if(!map){map=this._isPctRoleDimTypeMap=new def.Map(def.query(def.own(this._dims)).where(function(dimType){return dimType.playingPercentVisualRole();}).object({name:function(dimType){return dimType.name;}}));}
return map;}});function compType_dimensionRolesChanged(dimType){this._isPctRoleDimTypeMap=null;}
def.type('pvc.data.TranslationOper').init(function(complexType,source,metadata,options){this.complexType=complexType;this.source=source;this.metadata=metadata||{};this.options=options||{};if(pvc.debug>=3){this._logSource();}
this._initType();}).add({_logSource:def.method({isAbstract:true}),virtualItemSize:function(){return this.metadata.length;},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount;},defReader:function(dimReaderSpec){dimReaderSpec||def.fail.argumentRequired('readerSpec');var dimNames=dimReaderSpec.names;if(typeof dimNames==='string'){dimNames=dimNames.split(/\s*\,\s*/);}else{dimNames=def.array.as(dimNames);}
var hasDims=!!(dimNames&&dimNames.length);if(hasDims){dimNames.forEach(function(name){name||def.fail.argumentRequired('readers[i].names');name=name.replace(/^\s*(.+?)\s*$/,"$1");!def.hasOwn(this._userUsedDims,name)||def.fail.argumentInvalid('readers[i].names',"Dimension name '{0}' is already being read.",[name]);this._userUsedDims[name]=true;this.ensureDimensionType(name);},this);}
var indexes=def.array.as(dimReaderSpec.indexes);if(indexes){indexes.forEach(this._userUseIndex,this);}
var reader=dimReaderSpec.reader;if(!reader){if(hasDims){this._userCreateReaders(dimNames,indexes);}}else{hasDims||def.fail.argumentRequired('reader.names',"Required argument when a reader function is specified.");this._userRead(this._wrapReader(reader,dimNames),dimNames);}},configureType:def.method({isAbstract:true}),_initType:function(){this._userDimsReaders=[];this._userDimsReadersByDim={};this._userItem=[];this._userDefDims={};this._userUsedDims={};this._userUsedIndexes={};this._userUsedIndexesCount=0;var userDimsSpec=this.options.dimensions;for(var dimName in userDimsSpec){this._userDefDimension(dimName,userDimsSpec[dimName]);}
var userDimReaders=this.options.readers;if(userDimReaders){userDimReaders.forEach(this.defReader,this);}
var multiChartIndexes=this.options.multiChartIndexes;if(multiChartIndexes!=null){this.defReader({names:'multiChart',indexes:multiChartIndexes});}},_userDefDimension:function(name,userDimSpec){name||def.fail.argumentInvalid('dimensions[i]',"Invalid dimension name.");!def.hasOwn(this._userDefDims,name)||def.fail.argumentInvalid('dimensions[i]',"A dimension with name '{0}' is already defined.",[name]);this._userDefDims[name]=true;this.ensureDimensionType(name,userDimSpec);},_userUseIndex:function(index){index=+index;(index>=0)||def.fail.argumentInvalid('index',"Invalid reader index: '{0}'.",[index]);!def.hasOwn(this._userUsedIndexes,index)||def.fail.argumentInvalid('index',"Virtual item index '{0}' is already assigned.",[index]);this._userUsedIndexes[index]=true;this._userUsedIndexesCount++;this._userItem[index]=true;},_userCreateReaders:function(dimNames,indexes){if(!indexes){indexes=[];}
var I=indexes.length,N=dimNames.length,dimName;if(N>I){var nextIndex=I>0?(indexes[I-1]+1):0;do{nextIndex=this._nextAvailableItemIndex(nextIndex);indexes[I]=nextIndex;this._userUseIndex(nextIndex);I++;}while(N>I);}
var L=(I===N)?N:(N-1);for(var n=0;n<L;n++){dimName=dimNames[n];this._userRead(this._propGet(dimName,indexes[n]),dimName);}
if(L<N){var splitGroupName=pvc.data.DimensionType.splitDimensionGroupName(dimNames[N-1]),groupName=splitGroupName[0],level=def.nullyTo(splitGroupName[1],0);for(var i=L;i<I;i++,level++){dimName=pvc.data.DimensionType.dimensionGroupLevelName(groupName,level);if(i>L){!def.hasOwn(this._userUsedDims,dimName)||def.fail.argumentInvalid('readers[i].names',"Dimension name '{0}' of last dimension group name is already being read.",[dimName]);this._userUsedDims[dimName]=true;}
this._userRead(this._propGet(dimName,indexes[i]),dimName);}}},_userRead:function(reader,dimNames){def.fun.is(reader)||def.fail.argumentInvalid('reader',"Reader must be a function.");if(def.array.is(dimNames)){dimNames.forEach(function(name){this._userDimsReadersByDim[name]=reader;},this);}else{this._userDimsReadersByDim[dimNames]=reader;}
this._userDimsReaders.push(reader);},_wrapReader:function(reader,dimNames){var me=this,dimensions,data;function createDimensions(){data=me.data;dimensions=dimNames.map(function(dimName){return data.dimensions(dimName);});dimensions.unshift(null);return dimensions;}
function read(item){(dimensions||createDimensions())[0]=item;return reader.apply(data,dimensions);}
return read;},_filterDimensionReader:function(reader,dimName){function extractDimensionReader(item){var atoms=reader(item);if(atoms instanceof Array){return def.query(atoms).first(function(atom){return atom.dimension.name===dimName;});}
if(atoms.dimension.name===dimName){return atoms;}}
return extractDimensionReader;},execute:function(data){this.data=data;return this._executeCore();},_executeCore:function(){var dimsReaders=this._getDimensionsReaders();return def.query(this._getItems()).select(function(item){return this._readItem(null,item,dimsReaders);},this);},_getItems:function(){return this.source;},_getDimensionsReaders:function(){return this._userDimsReaders;},_readItem:function(atoms,item,dimsReaders){atoms=atoms||[];if(pvc.debug>=4){pvc.log('virtual item: '+JSON.stringify(item));}
var r=0,R=dimsReaders.length,a=0,data=this.data;while(r<R){var result=dimsReaders[r++].call(data,item);if(result!=null){if(result instanceof Array){var j=0,J=result.length;while(j<J){if(result.value!=null){atoms[a++]=result[j];}
j++;}}else if(result.value!=null){atoms[a++]=result;}}}
atoms.length=a;if(pvc.debug>=4){var atomsMap=def.query(atoms).object({name:function(atom){return atom.dimension.name;},value:function(atom){return{id:atom.id,v:atom.value,f:atom.label};}});pvc.log('  -> atoms: '+JSON.stringify(atomsMap));}
return atoms;},_propGet:function(dimName,prop,keyArgs){var me=this,dimension;if(def.get(keyArgs,'ensureDim',true)){this.ensureDimensionType(dimName);}
function propGet(item){return(dimension||(dimension=me.data.dimensions(dimName))).intern(item[prop]);}
return propGet;},_constGet:function(dimName,constRawValue,keyArgs){var me=this,constAtom;if(def.get(keyArgs,'ensureDim',true)){this.ensureDimensionType(dimName);}
function constGet(){return constAtom||(constAtom=me.data.dimensions(dimName).intern(constRawValue));}
return constGet;},_nextAvailableItemIndex:function(index,L){if(index==null){index=0;}
if(L==null){L=Infinity;}
while(index<L&&def.hasOwn(this._userItem,index)){index++;}
return index<L?index:-1;},ensureDimensionType:function(dimName,dimSpec){var dimType=this.complexType.dimensions(dimName,{assertExists:false});if(!dimType){this.defDimensionType(dimName,dimSpec);}},defDimensionType:function(dimName,dimSpec){dimSpec=pvc.data.DimensionType.extendSpec(dimName,dimSpec,this.options);return this.complexType.addDimension(dimName,dimSpec);}});def.type('pvc.data.MatrixTranslationOper',pvc.data.TranslationOper).add({_logSource:function(){pvc.log("ROWS ("+this.source.length+")");if(this.source){def.query(this.source).take(10).each(function(row,index){pvc.log("row "+index+": "+JSON.stringify(row));});}
pvc.log("COLS ("+this.metadata.length+")");if(this.metadata){this.metadata.forEach(function(col){pvc.log("column {"+"index: "+col.colIndex+", name: "+col.colName+", label: "+col.colLabel+", type: "+col.colType+"}");});}},_createSecondAxisSeriesKeySet:function(secondAxisSeriesIndexes,seriesKeys){var secondAxisSeriesKeySet=null,seriesCount=seriesKeys.length;def.query(secondAxisSeriesIndexes).each(function(indexText){var seriesIndex=+indexText;if(isNaN(seriesIndex)){throw def.error.argumentInvalid('secondAxisSeriesIndexes',"Element is not a number '{0}'.",[indexText]);}
if(seriesIndex<0){if(seriesIndex<=-seriesCount){throw def.error.argumentInvalid('secondAxisSeriesIndexes',"Index is out of range '{0}'.",[seriesIndex]);}
seriesIndex=seriesCount+seriesIndex;}else if(seriesIndex>=seriesCount){throw def.error.argumentInvalid('secondAxisSeriesIndexes',"Index is out of range '{0}'.",[seriesIndex]);}
if(!secondAxisSeriesKeySet){secondAxisSeriesKeySet={};}
secondAxisSeriesKeySet[seriesKeys[seriesIndex]]=true;});return secondAxisSeriesKeySet;},_dataPartGet:function(calcAxis2SeriesKeySet,seriesReader){var me=this;this.ensureDimensionType('dataPart');var dataPartDimension,axis2SeriesKeySet,part1Atom,part2Atom;function dataPartGet(item){if(!dataPartDimension){axis2SeriesKeySet=calcAxis2SeriesKeySet();dataPartDimension=me.data.dimensions('dataPart');if(pvc.debug>=3&&axis2SeriesKeySet){pvc.log("Second axis series values: "+
JSON.stringify(def.keys(axis2SeriesKeySet)));}}
var seriesAtom=seriesReader(item);if(def.hasOwn(axis2SeriesKeySet,seriesAtom.key)){return part2Atom||(part2Atom=dataPartDimension.intern("1"));}
return part1Atom||(part1Atom=dataPartDimension.intern("0"));}
return dataPartGet;}});def.type('pvc.data.CrosstabTranslationOper',pvc.data.MatrixTranslationOper).init(function(complexType,source,metadata,options){this.base(complexType,source,metadata,options);this._separator=this.options.separator||'~';this._measureData();}).add({virtualItemSize:function(){return this.R+this.C+this.M;},_executeCore:function(){if(!this.metadata.length){return def.query();}
var dimsReaders=this._getDimensionsReaders();var item=new Array(this.virtualItemSize()),itemCrossGroupIndex=this._itemCrossGroupIndex,me=this;function updateVItemCrossGroup(crossGroupId,source){var itemIndex=itemCrossGroupIndex[crossGroupId],sourceIndex=0,depth=me[crossGroupId];while((depth--)>0){item[itemIndex++]=source[sourceIndex++];}}
function updateVItemMeasure(line,cg){var itemIndex=itemCrossGroupIndex.M,cgIndexes=me._colGroupsIndexes[cg],depth=me.M;for(var i=0;i<depth;i++){var lineIndex=cgIndexes[i];item[itemIndex++]=lineIndex!=null?line[lineIndex]:null;}}
function expandLine(line){updateVItemCrossGroup('R',line);return def.query(this._colGroups).select(function(colGroup,cg){updateVItemCrossGroup('C',colGroup);updateVItemMeasure(line,cg);return this._readItem(null,item,dimsReaders);},this);}
return def.query(this._lines).selectMany(expandLine,this);},_measureData:function(){var lines=pvc.cloneMatrix(this.source);this._lines=lines;this.R=1;this.C=1;this.M=1;this.measuresDirection=null;var colNames;if(this.options.seriesInRows){colNames=this.metadata.map(function(d){return d.colName;});lines.unshift(colNames);pv.transpose(lines);colNames=lines.shift();colNames.forEach(function(value,i){colNames[i]={v:value};});}else if(this.options.compatVersion<=1){colNames=this.metadata.map(function(d){return{v:d.colName};});}else{colNames=this.metadata.map(function(d){return{v:d.colName,f:d.colLabel};});}
var categoriesCount;if(!this.options.isMultiValued){categoriesCount=def.get(this.options,'categoriesCount',1);this.R=categoriesCount;this._colGroups=colNames.slice(this.R);this._colGroupsIndexes=new Array(this._colGroups.length);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];this._colGroupsIndexes[cg]=[this.R+cg];},this);}else{var measuresInColumns=def.get(this.options,'measuresInColumns',true);if(measuresInColumns||this.options.measuresIndex==null){categoriesCount=def.get(this.options,'categoriesCount',1);this.R=categoriesCount;var encodedColGroups=colNames.slice(this.R),L=encodedColGroups.length;if(L>0){if(measuresInColumns){this.measuresDirection='columns';this._processEncodedColGroups(encodedColGroups);}else{this._colGroups=encodedColGroups;this._colGroupsIndexes=[];this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=this._splitEncodedColGroupCell(colGroup);this._colGroupsIndexes[cg]=[this.R+cg];},this);}
this.C=this._colGroups[0].length;}}else{this.measuresDirection='rows';this.R=+this.options.measuresIndex;var measuresCount=this.options.measuresCount;if(measuresCount==null){measuresCount=1;}
this.M=measuresCount;this._colGroups=colNames.slice(this.R+1);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];},this);}
if(this.C===1&&!this._userUsedDims.dataPart){var axis2SeriesIndexes=this.options.secondAxisSeriesIndexes;if(axis2SeriesIndexes!=null){var seriesKeys=this._colGroups.map(function(colGroup){return''+colGroup[0].v;});this._axis2SeriesKeySet=this._createSecondAxisSeriesKeySet(axis2SeriesIndexes,seriesKeys);}}}
this._itemCrossGroupIndex={'C':0,'R':this.C,'M':this.C+this.R};if(pvc.debug>=3){pvc.log("Crosstab translator "+JSON.stringify({R:this.R,C:this.C,M:this.M}));}},_splitEncodedColGroupCell:function(colGroup){var values=colGroup.v,labels=colGroup.f;if(values==null){values=[];labels=undefined;}else{values=values.split(this._separator);labels=labels&&labels.split(this._separator);}
return values.map(function(value,index){return{v:value,f:labels&&labels[index]};});},_processEncodedColGroups:function(encodedColGroups){var L=encodedColGroups.length||def.assert("Must have columns"),colGroups=[],colGroup,measuresInfo={},measuresInfoList=[];for(var i=0;i<L;i++){var colGroupCell=encodedColGroups[i],encColGroupValues=colGroupCell.v,sepIndex=colGroupCell.v.lastIndexOf(this._separator),meaName,colGroupValues;if(sepIndex<0){meaName=encColGroupValues;encColGroupValues='';colGroupValues=[];}else{meaName=encColGroupValues.substring(sepIndex+1);encColGroupValues=encColGroupValues.substring(0,sepIndex);colGroupValues=encColGroupValues.split(this._separator);var colGroupLabels;if(colGroupCell.f!=null){colGroupLabels=colGroupCell.f.split(this._separator);colGroupLabels.pop();}
colGroupValues.forEach(function(value,index){var label=colGroupLabels&&colGroupLabels[index];colGroupValues[index]={v:value,f:label};});}
if(!colGroup||colGroup.encValues!==encColGroupValues){colGroup={index:i,encValues:encColGroupValues,values:colGroupValues,measureNames:[meaName]};colGroups.push(colGroup);}else{colGroup.measureNames.push(meaName);}
var currMeaIndex=(i-colGroup.index),meaInfo=def.getOwn(measuresInfo,meaName);if(!meaInfo){measuresInfo[meaName]=meaInfo={name:meaName,groupIndex:currMeaIndex,index:i};measuresInfoList.push(meaInfo);}else if(currMeaIndex>meaInfo.groupIndex){meaInfo.groupIndex=currMeaIndex;}}
measuresInfoList.sort(function(infoa,infob){return def.compare(infoa.groupIndex,infob.groupIndex)||def.compare(infoa.index,infob.index);});measuresInfoList.forEach(function(meaInfo2,index){meaInfo2.groupIndex=index;});var CG=colGroups.length,colGroupsValues=new Array(CG),colGroupsIndexes=new Array(CG),M=measuresInfoList.length,R=this.R;colGroups.map(function(colGroup2,cg){colGroupsValues[cg]=colGroup2.values;var meaIndexes=colGroupsIndexes[cg]=new Array(M);colGroup2.measureNames.forEach(function(meaName2,index){meaIndexes[measuresInfo[meaName2].groupIndex]=R+colGroup2.index+index;});});this._colGroups=colGroupsValues;this._colGroupsIndexes=colGroupsIndexes;this.M=M;},configureType:function(){if(this.measuresDirection==='rows'){throw def.error.notImplemented();}
var me=this,index=0;function add(dimGroupName,crossGroup,level,count){var crossEndIndex=me._itemCrossGroupIndex[crossGroup]+count;while(count>0){var dimName=pvc.data.DimensionType.dimensionGroupLevelName(dimGroupName,level);if(!me._userUsedDims[dimName]){index=me._nextAvailableItemIndex(index);if(index>=crossEndIndex){return;}
me._userItem[index]=true;var reader=me._propGet(dimName,index);me._userDimsReaders.push(reader);!def.hasOwn(me._userDimsReadersByDim,dimName)||def.assert("Dimension already being read.");me._userDimsReadersByDim[dimName]=reader;count--;}
level++;}}
if(this.C>0){add('series','C',0,this.C);}
if(this.R>0){add('category','R',0,this.R);}
if(!this._userUsedDims.value){add('value','M',0,this.M);}
if(this._axis2SeriesKeySet){var seriesReader=this._userDimsReadersByDim.series;if(seriesReader){var calcAxis2SeriesKeySet=def.fun.constant(this._axis2SeriesKeySet);seriesReader=this._filterDimensionReader(seriesReader,'series');this._userDimsReaders.push(this._dataPartGet(calcAxis2SeriesKeySet,seriesReader));}}}});def.type('pvc.data.RelationalTranslationOper',pvc.data.MatrixTranslationOper).add({configureType:function(){var me=this;function add(dimGet,dim){me._userDimsReaders.push(dimGet);if(dim){!def.hasOwn(me._userDimsReadersByDim,dim)||def.assert("Dimension already being read.");me._userDimsReadersByDim[dim]=dimGet;}}
var L=this.metadata.length,unmappedColCount=L-this._userUsedIndexesCount;if(unmappedColCount>0){var valuesColIndexes;if(!this._userUsedDims.value&&this.options.isMultiValued&&(valuesColIndexes=this.options.measuresIndexes)!=null){this.defReader({names:'value',indexes:valuesColIndexes});unmappedColCount=L-this._userUsedIndexesCount;}
if(unmappedColCount>0){var dimName,autoColDims=!this.options.seriesInRows?['value','category','series']:['value','series','category'];autoColDims=autoColDims.filter(function(dimName2){return!this._userUsedDims[dimName2];},this).slice(0,unmappedColCount);unmappedColCount-=autoColDims.length;if(unmappedColCount>0){var desiredCatCount=def.get(this.options,'categoriesCount',1);if(desiredCatCount>1){var catIndex=autoColDims.indexOf('category');if(catIndex<0){if(this.options.seriesInRows){catIndex=autoColDims.length;}else{catIndex=autoColDims.indexOf('value')+1;}}else{catIndex++;}
var catLevel=1;while(catLevel<desiredCatCount){dimName=pvc.data.DimensionType.dimensionGroupLevelName('category',catLevel++);if(!this._userUsedDims[dimName]){def.array.insertAt(autoColDims,catIndex++,dimName);}}}}
var index=0;while(autoColDims.length&&(dimName=autoColDims.pop())){index=this._nextAvailableItemIndex(index);this._userItem[index]=true;add(this._propGet(dimName,index),dimName);index++;}}}
var axis2SeriesIndexes=this.options.secondAxisSeriesIndexes;if(axis2SeriesIndexes!=null){var seriesReader=this._userDimsReadersByDim.series;if(seriesReader){add(relTransl_dataPartGet.call(this,axis2SeriesIndexes,seriesReader));}}}});function relTransl_dataPartGet(secondAxisSeriesIndexes,seriesReader){var me=this;seriesReader=this._filterDimensionReader(seriesReader,'series');function calcAxis2SeriesKeySet(){var seriesKeys=def.query(me.source).select(function(item){var atom=seriesReader(item);return(atom&&atom.key)||null;}).distinct().array();return me._createSecondAxisSeriesKeySet(secondAxisSeriesIndexes,seriesKeys);}
return this._dataPartGet(calcAxis2SeriesKeySet,seriesReader);}
def.type('pvc.data.Atom').init(function(dimension,value,label,rawValue,key){this.dimension=dimension;this.id=value==null?0:def.nextId();this.value=value;this.label=label;this.rawValue=rawValue;this.key=key;this.globalKey=dimension.name+":"+key;}).add({toString:function(){return this.label;}});function atom_idComparer(a,b){return a.id-b.id;}
function atom_idComparerReverse(a,b){return b.id-a.id;}var complex_nextId=1;def.type('pvc.data.Complex').init(function(source,atoms,atomsBase,wantLabel){this.id=complex_nextId++;var owner;if(source){owner=source.owner;if(!atomsBase){atomsBase=source.atoms;}}
this.owner=owner||this;this.atoms=atomsBase?Object.create(atomsBase):{};if(!atoms){this.value=null;this.key='';if(wantLabel){this.label="";}}else{var asserts=pvc.debug>=6;var atomsMap=this.atoms;var count=0;var singleAtom;var i;var L=atoms.length;for(i=0;i<L;i++){var atom=atoms[i]||def.fail.argumentRequired('atom');var value=atom.value;if(value!=null){var name=atom.dimension.name;if(!atomsBase||atom!==atomsBase[name]){if(asserts){if(atom.dimension!==owner.dimensions(name)){throw def.error.operationInvalid("Invalid atom dimension '{0}'.",[name]);}
if(def.hasOwnProp.call(atomsMap,name)){throw def.error.operationInvalid("An atom of the same dimension has already been added '{0}'.",[name]);}}
count++;atomsMap[name]=atom;if(count===1){singleAtom=atom;}}}}
if(count===1){this.value=singleAtom.value;this.key=singleAtom.globalKey;if(wantLabel){this.label=singleAtom.label;}}else{var dimNames=owner.type._dimsNames;var key,label,aLabel;var labelSep=owner.labelSep;L=dimNames.length;for(i=0;i<L;i++){var dimName=dimNames[i];if(def.hasOwnProp.call(atomsMap,dimName)){var atom=atomsMap[dimName];if(i){key+=','+atom.globalKey;}else{key=atom.globalKey;}
if(wantLabel){if(label){label+=labelSep+atom.label;}else{label=atom.label;}}}}
this.value=this.key=key;if(wantLabel){this.label=label;}}}}).add({labelSep:" ~ ",label:null,ensureLabel:function(){var label=this.label;if(label!=null){label="";var labelSep=this.owner.labelSep;def.eachOwn(this.atoms,function(atom){var alabel=atom.label;if(alabel){if(label){label+=labelSep+alabel;}else{label=alabel;}}});this.label=label;}
return label;},view:function(dimNames){return new pvc.data.ComplexView(this,dimNames);},toString:function(){var s=[''+this.constructor.typeName];if(this.index!=null){s.push("#"+this.index);}
this.owner.type.dimensionsNames().forEach(function(name){s.push(name+": "+JSON.stringify(this.atoms[name].value));},this);return s.join(" ");}});def.type('pvc.data.ComplexView',pvc.data.Complex).init(function(source,ownDimNames){this.source=source;var viewDimNames=this.viewDimNames=[];var sourceAtoms=source.atoms,ownSourceAtoms=[];ownDimNames.forEach(function(dimName){if(def.hasOwnProp.call(sourceAtoms,dimName)){ownSourceAtoms.push(sourceAtoms[dimName]);viewDimNames.push(dimName);}});this.base(source,ownSourceAtoms,source.owner.atoms,true);}).add({values:function(){return this.viewDimNames.map(function(dimName){return this.atoms[dimName].value;},this);}});def.type('pvc.data.Datum',pvc.data.Complex).init(function(data,atoms,isNull){this.base(data.owner,atoms,data.atoms);if(isNull){this.isNull=true;}}).add({isSelected:false,isVisible:true,isNull:false,setSelected:function(select){if(this.isNull){return false;}
select=(select==null)||!!select;var changed=this.isSelected!==select;if(changed){if(!select){delete this.isSelected;}else{this.isSelected=true;}
data_onDatumSelectedChanged.call(this.owner,this,select);}
return changed;},toggleSelected:function(){return this.setSelected(!this.isSelected);},setVisible:function(visible){if(this.isNull){return false;}
visible=(visible==null)||!!visible;var changed=this.isVisible!==visible;if(changed){this.isVisible=visible;data_onDatumVisibleChanged.call(this.owner,this,visible);}
return changed;},toggleVisible:function(){return this.setVisible(!this.isVisible);}});function datum_deselect(){delete this.isSelected;}
def.type('pvc.data.Dimension').init(function(data,type){this.data=data;this.type=type;this.root=this;this.owner=this;var name=type.name;this.name=name;this._atomComparer=type.atomComparer();this._atomsByKey={};if(data.isOwner()){this._atoms=[];dim_createVirtualNullAtom.call(this);}else{var parentData=data.parent;var source;if(parentData){source=parentData._dimensions[name];dim_addChild.call(source,this);this.root=data.parent.root;}else{parentData=data.linkParent;parentData||def.assert("Data must have a linkParent");source=parentData._dimensions[name];dim_addLinkChild.call(source,this);}
this._nullAtom=this.owner._nullAtom;this._lazyInit=function(){this._lazyInit=null;var datums=this.data._datums;var L=datums.length;var atomsByKey=this._atomsByKey;for(var i=0;i<L;i++){var atom=datums[i].atoms[name];atomsByKey[atom.key]=atom;}
this._atoms=source.atoms().filter(function(atom){return def.hasOwnProp.call(atomsByKey,atom.key);});};}}).add({parent:null,linkParent:null,_children:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:false,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){if(this._lazyInit){this._lazyInit();}
return this._atoms.length;},isVisible:function(atom){if(this._lazyInit){this._lazyInit();}
def.hasOwn(this._atomsByKey,atom.key)||def.assert("Atom must exist in this dimension.");return dim_getVisibleDatumsCountMap.call(this)[atom.key]>0;},atoms:function(keyArgs){if(this._lazyInit){this._lazyInit();}
var visible=def.get(keyArgs,'visible');if(visible==null){return this._atoms;}
visible=!!visible;this._visibleAtoms||(this._visibleAtoms={});return this._visibleAtoms[visible]||(this._visibleAtoms[visible]=dim_calcVisibleAtoms.call(this,visible));},indexes:function(keyArgs){if(this._lazyInit){this._lazyInit();}
var visible=def.get(keyArgs,'visible');if(visible==null){return pv.range(0,this._atoms.length);}
visible=!!visible;this._visibleIndexes||(this._visibleIndexes={});return this._visibleIndexes[visible]||(this._visibleIndexes[visible]=dim_calcVisibleIndexes.call(this,visible));},atom:function(value){if(value==null||value===''){return this._nullAtom;}
if(value instanceof pvc.data.Atom){return value;}
if(this._lazyInit){this._lazyInit();}
var key=this.type._key?this.type._key.call(null,value):value;return this._atomsByKey[key]||null;},extent:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;if(!L){return undefined;}
var offset=this._nullAtom&&atoms[0].value==null?1:0;return(L>offset)?{min:atoms[offset],max:atoms[L-1]}:undefined;},min:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;if(!L){return undefined;}
var offset=this._nullAtom&&atoms[0].value==null?1:0;return(L>offset)?atoms[offset]:undefined;},max:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;return L&&atoms[L-1].value!=null?atoms[L-1]:undefined;},sum:function(keyArgs){var isAbs=!!def.get(keyArgs,'abs',false),zeroIfNone=def.get(keyArgs,'zeroIfNone',true),key=dim_buildDatumsFilterKey(keyArgs)+':'+isAbs;var sum=def.getOwn(this._sumCache,key);if(sum===undefined){var dimName=this.name;sum=this.data.datums(null,keyArgs).reduce(function(sum2,datum){var value=datum.atoms[dimName].value;if(isAbs&&value<0){value=-value;}
return sum2!=null?(sum2+value):value;},null);(this._sumCache||(this._sumCache={}))[key]=sum;}
return zeroIfNone?(sum||0):sum;},percent:function(atomOrValue,keyArgs){var value=(atomOrValue instanceof pvc.data.Atom)?atomOrValue.value:atomOrValue;if(!value){return 0;}
var sum=this.sum(def.create(keyArgs,{abs:true}));return sum?(Math.abs(value)/sum):0;},percentOverParent:function(keyArgs){var value=this.sum(keyArgs);if(!value){return 0;}
var parentData=this.data.parent;if(!parentData){return 0;}
var sum=parentData.dimensionsSumAbs(this.name,keyArgs);return sum?(Math.abs(value)/sum):0;},format:function(value,sourceValue){return""+(this.type._formatter?this.type._formatter.call(null,value,sourceValue):"");},intern:function(sourceValue){(this.owner===this)||def.assert("Can only internalize on an owner dimension.");if(sourceValue==null||sourceValue===''){return this._nullAtom||dim_createNullAtom.call(this,sourceValue);}
var type=this.type;var value,label;if(type._converter){value=type._converter.call(null,sourceValue);}else if(typeof sourceValue==='object'&&('v'in sourceValue)){value=sourceValue.v;label=sourceValue.f;}else{value=sourceValue;}
if(value==null||value===''){return this._nullAtom||dim_createNullAtom.call(this,sourceValue);}
if(type.cast){value=type.cast.call(null,value);if(value==null||value===''){return this._nullAtom||dim_createNullAtom.call(this);}}
var key=''+(type._key?type._key.call(null,value):value);key||def.fail.operationInvalid("Only a null value can have an empty key.");var atom=this._atomsByKey[key];if(atom){return atom;}
if(label==null){if(type._formatter){label=type._formatter.call(null,value,sourceValue);}else{label=value;}}
label=""+label;if(!label&&pvc.debug>=2){pvc.log("Only the null value should have an empty label.");}
atom=new pvc.data.Atom(this,value,label,sourceValue,key);def.array.insert(this._atoms,atom,this._atomComparer);dim_clearVisiblesCache.call(this);this._atomsByKey[key]=atom;return atom;},dispose:function(){if(!this._disposed){data_disposeChildList(this._children,'parent');data_disposeChildList(this._linkChildren,'linkParent');if(this.parent){dim_removeChild.call(this.parent,this);}
if(this.linkParent){dim_removeLinkChild.call(this.linkParent,this);}
dim_clearVisiblesCache.call(this);this._lazyInit=null;this._atoms=this._nullAtom=this._virtualNullAtom=null;this._disposed=true;}}});function dim_buildDatumsFilterKey(keyArgs){var visible=def.get(keyArgs,'visible'),selected=def.get(keyArgs,'selected');return(visible==null?null:!!visible)+':'+(selected==null?null:!!selected);}
function dim_createNullAtom(sourceValue){(this.owner===this)||def.assert("Can only create atoms on an owner dimension.");if(!this._nullAtom){var label=""+(this.type._formatter?this.type._formatter.call(null,null,sourceValue):"");this._nullAtom=new pvc.data.Atom(this,null,label,null,'');this._atomsByKey['']=this._nullAtom;this._atoms.unshift(this._nullAtom);this.data._atomsBase[this.name]=this._nullAtom;}
return this._nullAtom;}
function dim_createVirtualNullAtom(){(this.owner===this)||def.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){var label=""+(this.type._formatter?this.type._formatter.call(null,null,null):"");this._virtualNullAtom=new pvc.data.Atom(this,null,label,null,'');this.data._atomsBase[this.name]=this._virtualNullAtom;}
return this._virtualNullAtom;}
function dim_unintern(atom){(this.owner===this)||def.assert("Can only unintern atoms on an owner dimension.");(atom&&atom.dimension===this)||def.assert("Not an interned atom");if(atom===this._virtualNullAtom){return;}
var key=atom.key;if(this._atomsByKey[key]===atom){def.array.remove(this._atoms,atom,this._atomComparer);delete this._atomsByKey[key];if(!key){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom;}}
dim_clearVisiblesCache.call(this);}
function dim_clearVisiblesCache(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null;}
function dim_onDatumsChanged(){dim_clearVisiblesCache.call(this);}
function dim_addChild(child){data_addColChild(this,'_children',child,'parent');child.owner=this.owner;}
function dim_removeChild(child){data_removeColChild(this,'_children',child,'parent');}
function dim_addLinkChild(linkChild){data_addColChild(this,'_linkChildren',linkChild,'linkParent');linkChild.owner=this.owner;}
function dim_removeLinkChild(linkChild){data_removeColChild(this,'_linkChildren',linkChild,'linkParent');}
function dim_onDatumVisibleChanged(datum,visible){var map;if(!this._disposed&&(map=this._atomVisibleDatumsCount)){var atom=datum.atoms[this.name],key=atom.key;def.hasOwn(this._atomsByKey,key)||def.assert("Atom must exist in this dimension.");var count=map[key];(visible||(count>0))||def.assert("Must have had accounted for at least one visible datum.");map[key]=(count||0)+(visible?1:-1);this._visibleAtoms=this._sumCache=this._visibleIndexes=null;}}
function dim_getVisibleDatumsCountMap(){var map=this._atomVisibleDatumsCount;if(!map){map={};this.data.datums(null,{visible:true}).each(function(datum){var atom=datum.atoms[this.name],key=atom.key;map[key]=(map[key]||0)+1;},this);this._atomVisibleDatumsCount=map;}
return map;}
function dim_calcVisibleIndexes(visible){var indexes=[];this._atoms.forEach(function(atom,index){if(this.isVisible(atom)===visible){indexes.push(index);}},this);return indexes;}
function dim_calcVisibleAtoms(visible){return def.query(this._atoms).where(function(atom){return this.isVisible(atom)===visible;},this).array();}
def.type('pvc.data.Data',pvc.data.Complex).init(function(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');this._dimensions={};this._visibleDatums=new def.Map();var owner,atoms,atomsBase,parent=this.parent=keyArgs.parent||null;if(parent){this.root=parent.root;this.depth=parent.depth+1;this.type=parent.type;this._datums=keyArgs.datums||def.fail.argumentRequired('datums');owner=parent.owner;atoms=keyArgs.atoms||def.fail.argumentRequired('atoms');atomsBase=parent.atoms;}else{this.root=this;var linkParent=keyArgs.linkParent||null;if(linkParent){owner=linkParent.owner;this.type=owner.type;this._datums=keyArgs.datums||linkParent._datums.slice();this._leafs=[];atomsBase=linkParent.atoms;data_addLinkChild.call(linkParent,this);}else{owner=this;atomsBase={};if(keyArgs.labelSep){this.labelSep=keyArgs.labelSep;}
this.type=keyArgs.type||def.fail.argumentRequired('type');this._selectedDatums=new def.Map();}}
data_syncDatumsState.call(this);this.owner=owner;this._atomsBase=atomsBase;this.type.dimensionsList().forEach(this._initDimension,this);this.base(owner,atoms,atomsBase,true);pv.Dom.Node.call(this,null);delete this.nodeValue;this._children=this.childNodes;if(parent){data_addChild.call(parent,this);if(parent.absLabel){this.absLabel=def.string.join(owner.labelSep,parent.absLabel,this.label);}else{this.absLabel=this.label;}
if(parent.absKey){this.absKey=def.string.join(",",parent.absKey,this.key);}else{this.absKey=this.key;}}else{this.absLabel=this.label;this.absKey=this.key;}}).add(pv.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_freeDimensionNames:null,_children:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_childrenKeyDimName:null,_visibleDatums:null,_selectedDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_datums:null,_datumsById:null,depth:0,label:"",absLabel:"",_disposed:false,_isFlattenGroup:false,_initDimension:function(dimType){this._dimensions[dimType.name]=new pvc.data.Dimension(this,dimType);},dimensions:function(name,keyArgs){if(name==null){return this._dimensions;}
var dim=def.getOwn(this._dimensions,name);if(!dim&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid('name',"Undefined dimension '{0}'.",[name]);}
return dim;},freeDimensionNames:function(){if(!this._freeDimensionNames){var free=this._freeDimensionNames=[];def.eachOwn(this._dimensions,function(dim,dimName){var atom=this.atoms[dimName];if(!(atom instanceof pvc.data.Atom)||atom.value==null){free.push(dimName);}},this);}
return this._freeDimensionNames;},isOwner:function(){return this.owner===this;},children:function(keyArgs){if(!this._children){return def.query();}
var key=def.get(keyArgs,'key');if(key!=null){var child=def.getOwn(this._childrenByKey,key);if(!child&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid("Undefined child data with key '{0}'.",[key]);}
return child;}
return def.query(this._children);},childCount:function(){return this._children?this._children.length:0;},leafs:function(){return def.query(this._leafs);},dispose:function(){if(!this._disposed){data_disposeChildLists.call(this);def.eachOwn(this._dimensions,function(dimension){dimension.dispose();});if(this.parent){this.parent.removeChild(this);this.parent=null;}
if(this.linkParent){data_removeLinkChild.call(this.linkParent,this);}
this._disposed=true;}}});function data_disposeChildLists(){data_disposeChildList(this._children,'parent');data_disposeChildList(this._linkChildren,'linkParent');this._childrenByKey=null;this._groupByCache=null;if(this._selectedDatums){this._selectedDatums.clear();}}
function data_assertIsOwner(){this.isOwner()||def.fail("Can only be called on the owner data.");}
pvc.data.Data.add({load:function(atomz,keyArgs){data_assertIsOwner.call(this);var whereFun=def.get(keyArgs,'where');var isNullFun=def.get(keyArgs,'isNull');var isReload=!!this._datums;if(isReload){data_disposeChildLists.call(this);this._datums=data_reloadDatums.call(this,atomz,whereFun,isNullFun);}else{this._datums=data_loadDatums.call(this,atomz,whereFun,isNullFun);}
data_syncDatumsState.call(this);if(isReload){def.eachOwn(this._dimensions,function(dimension){dim_onDatumsChanged.call(dimension);});}
this._leafs=this._datums;}});function data_loadDatums(atomz,whereFun,isNullFun){var dimNames=this.type.dimensionsNames(),visitedAtomsKeySetByDimension=pv.dict(dimNames,function(){return{};}),needGC=false;function createDatum(atoms){var datum=new pvc.data.Datum(this,atoms);if(isNullFun&&isNullFun(datum)){datum.isNull=true;}
if(whereFun&&!whereFun(datum)){needGC=true;return null;}
var datoms=datum.atoms;for(var dimName in datoms){var atom=datoms[dimName];if(atom){var dim=atom.dimension;if(dim._virtualNullAtom===atom){dim.intern(null);}
visitedAtomsKeySetByDimension[dimName][atom.key]=true;}}
return datum;}
var datums=def.query(atomz).select(createDatum,this).where(def.notNully).distinct(function(datum){return datum.key;}).array();if(needGC){def.eachOwn(this._dimensions,function(dimension){var visitedAtomsKeySet=visitedAtomsKeySetByDimension[dimension.name];var uninternAtoms=dimension.atoms().filter(function(atom){return!def.hasOwn(visitedAtomsKeySet,atom.key);});uninternAtoms.forEach(function(atom){dim_unintern.call(dimension,atom);});});}
return datums;}
function data_reloadDatums(atomz,whereFun,isNullFun){var datumsByKey=def.query(this._datums).uniqueIndex(function(datum){return datum.key;});var dimNames=this.type.dimensionsNames();var visitedAtomsKeySetByDimension=pv.dict(dimNames,function(){return{};});function internDatum(atoms){var newDatum=new pvc.data.Datum(this,atoms);if(isNullFun&&isNullFun(datum)){datum.isNull=true;}
if(whereFun&&!whereFun(newDatum)){return null;}
def.each(newDatum.atoms,function(atom){if(atom){var dim=atom.dimension;if(dim._virtualNullAtom===atom){dim.intern(null);}
visitedAtomsKeySetByDimension[atom.dimension.name][atom.key]=true;}});var datum=datumsByKey[newDatum.key];if(!datum){datumsByKey[newDatum.key]=datum=newDatum;}
return datum;}
var datums=def.query(atomz).select(internDatum,this).where(def.notNully).array();def.eachOwn(this._dimensions,function(dimension){var visitedAtomsKeySet=visitedAtomsKeySetByDimension[dimension.name];var uninternAtoms=dimension.atoms().filter(function(atom){return!def.hasOwn(visitedAtomsKeySet,atom.key);});uninternAtoms.forEach(function(atom){dim_unintern.call(dimension,atom);});});return datums;}
function data_addChild(child){this.appendChild(child);(this._childrenByKey||(this._childrenByKey={}))[child.key]=child;}
function data_addLinkChild(linkChild){data_addColChild(this,'_linkChildren',linkChild,'linkParent');}
function data_removeLinkChild(linkChild){data_removeColChild(this,'_linkChildren',linkChild,'linkParent');}
pvc.data.Data.add({selectedCount:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).count();}
return this._selectedDatums.count;},selectedDatums:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).array();}
return this._selectedDatums.values();},visibleCount:function(){return this._visibleDatums.count;},clearSelected:function(funFilter){data_assertIsOwner.call(this);if(!this._selectedDatums.count){return false;}
var changed;if(funFilter){changed=false;this._selectedDatums.values().filter(funFilter).forEach(function(datum){changed=true;datum_deselect.call(datum);this._selectedDatums.rem(datum.id);},this);}else{changed=true;this._selectedDatums.values().forEach(function(datum){datum_deselect.call(datum);});this._selectedDatums.clear();}
return changed;}});function data_onDatumSelectedChanged(datum,selected){!datum.isNull||def.assert("Null datums do not notify selected changes");if(selected){this._selectedDatums.set(datum.id,datum);}else{this._selectedDatums.rem(datum.id);}
this._sumAbsCache=null;}
function data_onDatumVisibleChanged(datum,visible){if(def.hasOwn(this._datumsById,datum.id)){!datum.isNull||def.assert("Null datums do not notify visible changes");if(visible){this._visibleDatums.set(datum.id,datum);}else{this._visibleDatums.rem(datum.id);}
this._sumAbsCache=null;def.eachOwn(this._dimensions,function(dimension){dim_onDatumVisibleChanged.call(dimension,datum,visible);});this._children.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible);});if(this._linkChildren){this._linkChildren.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible);});}}}
function data_syncDatumsState(){if(this._selectedDatums){this._selectedDatums.clear();}
this._visibleDatums.clear();this._datumsById={};this._sumAbsCache=null;if(this._datums){this._datums.forEach(data_onReceiveDatum,this);}}
function data_addDatum(datum){if(!def.hasOwn(this._datumsById,datum.id)){this._datums.push(datum);data_onReceiveDatum.call(this,datum);}}
function data_onReceiveDatum(datum){var id=datum.id;this._datumsById[id]=datum;if(!datum.isNull){var selectedDatums;if(datum.isSelected&&(selectedDatums=this._selectedDatums)){selectedDatums.set(id,datum);}
if(datum.isVisible){this._visibleDatums.set(id,datum);}}}
pvc.data.Data.setSelected=function(datums,selected){var anyChanged=false;if(datums){def.query(datums).each(function(datum){if(datum.setSelected(selected)){anyChanged=true;}});}
return anyChanged;};pvc.data.Data.toggleSelected=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array();}
var allSelected=def.query(datums).all(function(datum){return datum.isNull||datum.isSelected;});return this.setSelected(datums,!allSelected);};pvc.data.Data.setVisible=function(datums,visible){var anyChanged=false;if(datums){def.query(datums).each(function(datum){if(datum.setVisible(visible)){anyChanged=true;}});}
return anyChanged;};pvc.data.Data.toggleVisible=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array();}
var allVisible=def.query(datums).all(function(datum){return datum.isVisible;});return pvc.data.Data.setVisible(datums,!allVisible);};def.type('pvc.data.GroupingSpec').init(function(levelSpecs,type,keyArgs){this.type=type||null;var ids=[];this.hasCompositeLevels=false;this.levels=def.query(levelSpecs||undefined).where(function(levelSpec){return levelSpec.dimensions.length>0;}).select(function(levelSpec){ids.push(levelSpec.id);if(!this.hasCompositeLevels&&levelSpec.dimensions.length>1){this.hasCompositeLevels=true;}
return levelSpec;},this).array();this.depth=this.levels.length;this.isSingleLevel=this.depth===1;this.isSingleDimension=this.isSingleLevel&&!this.hasCompositeLevels;this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null;this.flatteningMode=def.get(keyArgs,'flatteningMode')||null;this.flattenRootLabel=def.get(keyArgs,'flattenRootLabel')||'';this.id=(this.flatteningMode||'')+"##"+
this.flattenRootLabel+"##"+
ids.join('||');}).add({bind:function(type){this.type=type||def.fail.argumentRequired('type');this.dimensions().each(function(dimSpec){dimSpec.bind(type);});},dimensions:function(){return def.query(this.levels).selectMany(function(level){return level.dimensions;});},dimensionNames:function(){if(!this._dimNames){this._dimNames=this.dimensions().select(function(dimSpec){return dimSpec.name;}).array();}
return this._dimNames;},view:function(complex){return complex.view(this.dimensionNames());},isDiscrete:function(){return!this.isSingleDimension||this.firstDimension.type.isDiscrete;},isNull:function(){return!this.levels.length;},ensure:function(keyArgs){var grouping=this,flatteningMode=def.get(keyArgs,'flatteningMode');if(flatteningMode){if(flatteningMode==='singleLevel'){return grouping.singleLevelGrouping(keyArgs);}
var flattenRootLabel=def.get(keyArgs,'flattenRootLabel')||'';if(this.flatteningMode!==flatteningMode||(this.flattenRootLabel!==flattenRootLabel)){grouping=new pvc.data.GroupingSpec(grouping.levels,grouping.type,{flatteningMode:flatteningMode,flattenRootLabel:flattenRootLabel});}}
if(def.get(keyArgs,'reverse',false)){grouping=grouping.reversed();}
return grouping;},singleLevelGrouping:function(keyArgs){var reverse=!!def.get(keyArgs,'reverse',false);if(this.isSingleLevel&&!reverse){return this;}
this._singleLevelGrouping||(this._singleLevelGrouping={});var singleLevel=this._singleLevelGrouping[reverse];if(!singleLevel){var dimSpecs=this.dimensions().select(function(dimSpec){return reverse?new pvc.data.GroupingDimensionSpec(dimSpec.name,!dimSpec.reverse,dimSpec.type.complexType):dimSpec;});var levelSpec=new pvc.data.GroupingLevelSpec(dimSpecs);singleLevel=new pvc.data.GroupingSpec([levelSpec],this.type,{flatteningMode:this.flatteningMode});this._singleLevelGrouping[reverse]=singleLevel;}
return singleLevel;},reversed:function(){var reverseGrouping=this._reverseGrouping;if(!reverseGrouping){var levelSpecs=def.query(this.levels).select(function(levelSpec){var dimSpecs=def.query(levelSpec.dimensions).select(function(dimSpec){return new pvc.data.GroupingDimensionSpec(dimSpec.name,!dimSpec.reverse,dimSpec.type.complexType);});return new pvc.data.GroupingLevelSpec(dimSpecs);});reverseGrouping=new pvc.data.GroupingSpec(levelSpecs,this.type,{flatteningMode:this.flatteningMode});this._reverseGrouping=reverseGrouping;}
return reverseGrouping;},toString:function(){return def.query(this.levels).select(function(level){return''+level;}).array().join(', ');}});def.type('pvc.data.GroupingLevelSpec').init(function(dimSpecs){var ids=[];this.dimensions=def.query(dimSpecs).select(function(dimSpec){ids.push(dimSpec.id);return dimSpec;}).array();this.id=ids.join(',');this.depth=this.dimensions.length;var me=this;this.comparer=function(a,b){return me.compare(a,b);};}).add({compare:function(a,b){for(var i=0,D=this.depth;i<D;i++){var result=this.dimensions[i].compareDatums(a,b);if(result!==0){return result;}}
return 0;},key:function(datum){var keys=[];var atoms=[];var datoms=datum.atoms;var dims=this.dimensions;for(var i=0,D=this.depth;i<D;i++){var atom=datoms[dims[i].name];atoms.push(atom);keys.push(atom.globalKey);}
return{key:keys.join(','),atoms:atoms};},toString:function(){return def.query(this.dimensions).select(function(dimSpec){return''+dimSpec;}).array().join('|');}});def.type('pvc.data.GroupingDimensionSpec').init(function(name,reverse,type){this.name=name;this.reverse=!!reverse;this.id=this.name+":"+(this.reverse?'0':'1');if(type){this.bind(type);}}).add({type:null,comparer:null,bind:function(type){type||def.fail.argumentRequired('type');this.type=type.dimensions(this.name);this.comparer=this.type.atomComparer(this.reverse);},compareDatums:function(a,b){var result=this.comparer(a.atoms[this.name],b.atoms[this.name]);if(result!==0){return result;}
return 0;},toString:function(){return this.name+(this.reverse?' desc':'');}});pvc.data.GroupingSpec.parse=function(specText,type){if(!specText){return new pvc.data.GroupingSpec(null,type);}
var levels;if(def.array.is(specText)){levels=specText;}else if(def.string.is(specText)){levels=specText.split(/\s*,\s*/);}
var levelSpecs=def.query(levels).select(function(levelText){var dimSpecs=groupSpec_parseGroupingLevel(levelText,type);return new pvc.data.GroupingLevelSpec(dimSpecs);});return new pvc.data.GroupingSpec(levelSpecs,type);};var groupSpec_matchDimSpec=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;function groupSpec_parseGroupingLevel(groupLevelText,type){def.string.is(groupLevelText)||def.fail.argumentInvalid('groupLevelText',"Invalid grouping specification.");return def.query(groupLevelText.split(/\s*\|\s*/)).where(def.truthy).select(function(dimSpecText){var match=groupSpec_matchDimSpec.exec(dimSpecText)||def.fail.argumentInvalid('groupLevelText',"Invalid grouping level syntax '{0}'.",[dimSpecText]),name=match[1],order=(match[2]||'').toLowerCase(),reverse=order==='desc';var dimSpec=new pvc.data.GroupingDimensionSpec(name,reverse,type);return dimSpec;});}
def.type('pvc.data.DataOper').init(function(linkParent,keyArgs){this._linkParent=linkParent;}).add({key:null,execute:def.method({isAbstract:true})});def.type('pvc.data.GroupingOper',pvc.data.DataOper).init(function(linkParent,groupingSpecs,keyArgs){groupingSpecs||def.fail.argumentRequired('groupingSpecs');this.base(linkParent,keyArgs);this._where=def.get(keyArgs,'where');this._visible=def.get(keyArgs,'visible',null);this._selected=def.get(keyArgs,'selected',null);this._isNull=def.get(keyArgs,'isNull',null);var hasKey=this._selected==null,whereKey='';if(this._where){whereKey=def.get(keyArgs,'whereKey');if(!whereKey){if(!keyArgs||whereKey===null){hasKey=false;}else{whereKey=''+def.nextId('dataOperWhereKey');keyArgs.whereKey=whereKey;}}}
var ids=[];this._groupSpecs=def.array.as(groupingSpecs).map(function(groupSpec){if(groupSpec instanceof pvc.data.GroupingSpec){if(groupSpec.type!==linkParent.type){throw def.error.argumentInvalid('groupingSpecText',"Invalid associated complex type.");}}else{groupSpec=pvc.data.GroupingSpec.parse(groupSpec,linkParent.type);}
ids.push(groupSpec.id);return groupSpec;});if(hasKey){this.key=ids.join('!!')+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+whereKey;}}).add({execute:function(){var datumsQuery=data_whereState(def.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where});var rootNode=this._group(datumsQuery);return this._generateData(rootNode,this._linkParent);},_group:function(datumsQuery){var root={isRoot:true,treeHeight:def.query(this._groupSpecs).select(function(spec){var levelCount=spec.levels.length;if(!levelCount){return 0;}
return!!spec.flatteningMode?1:levelCount;}).reduce(def.add,0),datums:[]};if(root.treeHeight>0){this._groupSpecRecursive(root,datumsQuery,0);}
return root;},_groupSpecRecursive:function(specParent,specDatums,specIndex){var groupSpec=this._groupSpecs[specIndex],levelSpecs=groupSpec.levels,D=levelSpecs.length,nextSpecIndex=specIndex+1,isLastSpec=!(nextSpecIndex<this._groupSpecs.length),doFlatten=!!groupSpec.flatteningMode,isPostOrder=doFlatten&&(groupSpec.flatteningMode==='tree-post'),specGroupParent;D||def.fail.operationInvalid("Must have levels");if(doFlatten){specParent.children=[];specParent.childrenByKey={};specGroupParent={key:'',atoms:[],datums:[],label:groupSpec.flattenRootLabel};if(!isPostOrder){specParent.children.push(specGroupParent);specParent.childrenByKey['']=specGroupParent;}}else{specGroupParent=specParent;}
groupLevelRecursive.call(this,specGroupParent,specDatums,0);if(doFlatten){if(isPostOrder){specParent.children.push(specGroupParent);}
specParent.datums=specGroupParent.datums;}
function groupLevelRecursive(groupParent,datums,specDepth){var levelSpec=levelSpecs[specDepth],groupChildren=[],firstDatums=[],groupInfos=[],datumsByKey={};if(!doFlatten){groupParent.children=[];groupParent.childrenKeyDimName=levelSpec.dimensions[0].name;}
def.query(datums).each(function(datum){var groupInfo=levelSpec.key(datum);if(groupInfo!=null){var key=groupInfo.key,keyDatums=datumsByKey[key];if(keyDatums){keyDatums.push(datum);}else{keyDatums=datumsByKey[key]=[datum];groupInfo.datums=keyDatums;var datumIndex=def.array.insert(firstDatums,datum,levelSpec.comparer);def.array.insertAt(groupInfos,~datumIndex,groupInfo);}}},this);var isLastSpecLevel=specDepth===D-1;groupInfos.forEach(function(groupInfo){var child=Object.create(groupInfo);child.datums=isLastSpec&&isLastSpecLevel?groupInfo.datums:[];var key;if(!doFlatten){groupParent.children.push(child);}else{child.atoms=groupParent.atoms.concat(child.atoms);key=def.query(child.atoms).where(function(atom){return atom.value!=null;}).select(function(atom){return atom.globalKey;}).array().join(',');if(def.hasOwn(specParent.childrenByKey,key)){groupChildren.push({datums:groupInfo.datums});return;}
if(!isPostOrder){specParent.children.push(child);specParent.childrenByKey[key]=child;groupParent.isFlattenGroup=true;}}
if(!isLastSpecLevel){groupLevelRecursive.call(this,child,groupInfo.datums,specDepth+1);}else if(!isLastSpec){this._groupSpecRecursive(child,groupInfo.datums,nextSpecIndex);}
groupChildren.push(child);if(doFlatten&&isPostOrder){specParent.children.push(child);specParent.childrenByKey[key]=child;groupParent.isFlattenGroup=true;}},this);var willRecurseParent=doFlatten&&!isLastSpec;datums=willRecurseParent?[]:groupParent.datums;groupChildren.forEach(function(child){def.array.append(datums,child.datums);});if(willRecurseParent){this._groupSpecRecursive(groupParent,datums,nextSpecIndex);}
return groupChildren;}},_generateData:function(node,parentData){var data;if(node.isRoot){data=new pvc.data.Data({linkParent:parentData,datums:node.datums});data.treeHeight=node.treeHeight;}else{data=new pvc.data.Data({parent:parentData,atoms:node.atoms,datums:node.datums});}
if(node.isFlattenGroup){data._isFlattenGroup=true;var label=node.label;if(label){data.label+=label;data.absLabel+=label;}}
var childNodes=node.children;if(childNodes&&childNodes.length){data._childrenKeyDimName=node.childrenKeyDimName;childNodes.forEach(function(childNode){this._generateData(childNode,data);},this);}else if(!node.isRoot){var leafs=data.root._leafs;data.leafIndex=leafs.length;leafs.push(data);}
return data;}});pvc.data.Data.add({count:function(){return this._datums.length;},groupBy:function(groupingSpecText,keyArgs){var groupOper=new pvc.data.GroupingOper(this,groupingSpecText,keyArgs),cacheKey=groupOper.key,groupByCache,data;if(cacheKey){groupByCache=this._groupByCache;data=groupByCache&&groupByCache[cacheKey];}
if(!data){if(pvc.debug>=7){pvc.log("[GroupBy] "+(cacheKey?("Cache key not found: '"+cacheKey+"'"):"No Cache key"));}
data=groupOper.execute();if(cacheKey){(groupByCache||(this._groupByCache={}))[cacheKey]=data;}}else if(pvc.debug>=7){pvc.log("[GroupBy] Cache key hit '"+cacheKey+"'");}
return data;},flattenBy:function(role,keyArgs){var grouping=role.flattenedGrouping(keyArgs)||def.fail.operationInvalid("Role is unbound.");return this.groupBy(grouping,keyArgs);},where:function(whereSpec,keyArgs){var datums=this.datums(whereSpec,keyArgs).array();return new pvc.data.Data({linkParent:this,datums:datums});},datums:function(whereSpec,keyArgs){if(!whereSpec){return data_whereState(def.query(this._datums),keyArgs);}
whereSpec=data_processWhereSpec.call(this,whereSpec,keyArgs);return data_where.call(this,whereSpec,keyArgs);},datum:function(whereSpec,keyArgs){whereSpec||def.fail.argumentRequired('whereSpec');whereSpec=data_processWhereSpec.call(this,whereSpec,keyArgs);var datum=data_where.call(this,whereSpec,keyArgs).first()||null;if(!datum&&def.get(keyArgs,'createNull')&&whereSpec.length){var sourceDatumFilter=whereSpec[0],atoms=[];for(var dimName in this._dimensions){var dimAtoms=sourceDatumFilter[dimName];if(dimAtoms){atoms.push(dimAtoms[0]);}}
datum=new pvc.data.Datum(this,atoms,true);}
return datum;},firstDatum:function(){return this._datums.length?this._datums[0]:null;},dimensionsSumAbs:function(dimName,keyArgs){var key=dimName+":"+dim_buildDatumsFilterKey(keyArgs),sum=def.getOwn(this._sumAbsCache,key);if(sum==null){sum=this.children().where(function(childData){return!childData._isFlattenGroup;}).select(function(childData){return Math.abs(childData.dimensions(dimName).sum(keyArgs));},this).reduce(def.add,0);(this._sumAbsCache||(this._sumAbsCache={}))[key]=sum;}
return sum;}});function data_processWhereSpec(whereSpec){var whereProcSpec=[];whereSpec=def.array.as(whereSpec);if(whereSpec){whereSpec.forEach(processDatumFilter,this);}
return whereProcSpec;function processDatumFilter(datumFilter){if(datumFilter!=null){(typeof datumFilter==='object')||def.fail.invalidArgument('datumFilter');var datumProcFilter={},any=false;for(var dimName in datumFilter){var atoms=processDimensionFilter.call(this,dimName,datumFilter[dimName]);if(atoms){any=true;datumProcFilter[dimName]=atoms;}}
if(any){whereProcSpec.push(datumProcFilter);}}}
function processDimensionFilter(dimName,values){var dimension=this.dimensions(dimName),atoms=def.query(values).select(function(value){return dimension.atom(value);}).where(def.notNully).distinct(function(atom){return atom.key;}).array();return atoms.length?atoms:null;}}
function data_whereState(q,keyArgs){var selected=def.get(keyArgs,'selected'),visible=def.get(keyArgs,'visible'),where=def.get(keyArgs,'where'),isNull=def.get(keyArgs,'isNull');if(visible!=null){q=q.where(function(datum){return datum.isVisible===visible;});}
if(isNull!=null){q=q.where(function(datum){return datum.isNull===isNull;});}
if(selected!=null){q=q.where(function(datum){return datum.isSelected===selected;});}
if(where){q=q.where(where);}
return q;}
function data_where(whereSpec,keyArgs){var orderBys=def.array.as(def.get(keyArgs,'orderBy')),datumKeyArgs=def.create(keyArgs||{},{orderBy:null});var query=def.query(whereSpec).selectMany(function(datumFilter,index){if(orderBys){datumKeyArgs.orderBy=orderBys[index];}
return data_whereDatumFilter.call(this,datumFilter,datumKeyArgs);},this);return query.distinct(function(datum){return datum.id;});}
function data_whereDatumFilter(datumFilter,keyArgs){var groupingSpecText=keyArgs.orderBy;if(!groupingSpecText){groupingSpecText=Object.keys(datumFilter).sort().join(',');}else{if(groupingSpecText.indexOf("|")>=0){throw def.error.argumentInvalid('keyArgs.orderBy',"Multi-dimension order by is not supported.");}}
var rootData=this.groupBy(groupingSpecText,keyArgs),H=rootData.treeHeight;var stateStack=[];return def.query(function(){var state;if(!this._data){this._data=rootData;this._dimAtomsOrQuery=def.query(datumFilter[rootData._childrenKeyDimName]);}else if(this._datumsQuery){this._data||def.assert("Must have a current data");stateStack.length||def.assert("Must have a parent data");!this._dimAtomsOrQuery||def.assert();if(this._datumsQuery.next()){this.item=this._datumsQuery.item;return 1;}
this._datumsQuery=null;state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;}
this._dimAtomsOrQuery||def.assert("Invalid programmer");this._data||def.assert("Must have a current data");var depth=stateStack.length;do{while(this._dimAtomsOrQuery.next()){var dimAtomOr=this._dimAtomsOrQuery.item,childData=this._data._childrenByKey[dimAtomOr.globalKey];if(childData&&(depth<H-1||childData._datums.length)){stateStack.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery});this._data=childData;if(depth<H-1){this._dimAtomsOrQuery=def.query(datumFilter[childData._childrenKeyDimName]);depth++;}else{this._dimAtomsOrQuery=null;this._datumsQuery=def.query(childData._datums);this._datumsQuery.next();this.item=this._datumsQuery.item;return 1;}}}
if(!depth){return 0;}
state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;depth--;}while(true);return 0;});}pvc.data.Data.add({getInfo:function(){var out=["\n------------------------------------------"];out.push("Dataset Information");def.eachOwn(this.dimensions(),function(dimension,name){var count=dimension.count(),type=dimension.type,features=[];features.push(type.valueTypeName);if(type.isComparable){features.push("comparable");}
if(!type.isDiscrete){features.push("continuous");}
if(type.isHidden){features.push("hidden");}
out.push("  "+
name+" ("+features.join(', ')+")"+" ("+count+")\n\t"+
dimension.atoms().slice(0,10).map(function(atom){return atom.label;}).join(", ")+
(count>10?"...":""));});out.push("------------------------------------------");return out.join("\n");},getValues:function(){return pv.range(0,this.getCategoriesSize()).map(function(categIndex){return this._getValuesForCategoryIndex(categIndex);},this);},_getDimensionValues:function(name){return this.dimensions(name).atoms().map(function(atom){return atom.value;});},_getDimensionVisibleValues:function(name){return this.dimensions(name).atoms({visible:true}).map(function(atom){return atom.value;});},getSeries:function(){return this._getDimensionValues('series');},getVisibleSeriesIndexes:function(){return this.dimensions('series').indexes({visible:true});},getVisibleCategoriesIndexes:function(){return this.dimensions('category').indexes({visible:true});},getVisibleSeries:function(){return this._getDimensionVisibleValues('series');},getCategories:function(){return this._getDimensionValues('category');},getVisibleCategories:function(){return this._getDimensionVisibleValues('category');},_getValuesForCategoryIndex:function(categIdx){var categAtom=this.dimensions('category').atoms()[categIdx];var datumsBySeriesKey=this.datums({category:categAtom}).uniqueIndex(function(datum){return datum.atoms.series.key;});return this.dimensions('series').atoms().map(function(atom){var datum=def.getOwn(datumsBySeriesKey,atom.key);return datum?datum.atoms.value.value:null;});},getSeriesSize:function(){var dim=this.dimensions('series',{assertExists:false});return dim?dim.count():0;},getCategoriesSize:function(){var dim=this.dimensions('category',{assertExists:false});return dim?dim.count():0;}});def.type('pvc.visual.Role').init(function(name,keyArgs){this.name=name;this.label=def.get(keyArgs,'label')||name;if(def.get(keyArgs,'isRequired',false)){this.isRequired=true;}
if(def.get(keyArgs,'autoCreateDimension',false)){this.autoCreateDimension=true;}
var defaultDimensionName=def.get(keyArgs,'defaultDimensionName');if(defaultDimensionName){this.defaultDimensionName=defaultDimensionName;}
if(!defaultDimensionName&&this.autoCreateDimension){throw def.error.argumentRequired('defaultDimensionName');}
var requireSingleDimension;var requireIsDiscrete=def.get(keyArgs,'requireIsDiscrete');if(requireIsDiscrete!=null){if(!requireIsDiscrete){requireSingleDimension=true;}}
if(requireSingleDimension!=null){requireSingleDimension=def.get(keyArgs,'requireSingleDimension',false);if(requireSingleDimension){if(def.get(keyArgs,'isMeasure',false)){this.isMeasure=true;if(def.get(keyArgs,'isPercent',false)){this.isPercent=true;}}
var valueType=def.get(keyArgs,'valueType',null);if(valueType!==this.valueType){this.valueType=valueType;}}}
if(requireSingleDimension!==this.requireSingleDimension){this.requireSingleDimension=requireSingleDimension;}
if(requireIsDiscrete!=this.requireIsDiscrete){this.requireIsDiscrete=!!requireIsDiscrete;}
var flatteningMode=def.get(keyArgs,'flatteningMode');if(flatteningMode&&flatteningMode!=this.flatteningMode){this.flatteningMode=flatteningMode;}}).add({isRequired:false,requireSingleDimension:false,valueType:null,requireIsDiscrete:null,isMeasure:false,isPercent:false,defaultDimensionName:null,grouping:null,flatteningMode:'singleLevel',flattenRootLabel:'',autoCreateDimension:false,isReversed:false,label:null,firstDimensionName:function(){return this.grouping&&this.grouping.firstDimension.name;},firstDimension:function(){return this.grouping&&this.grouping.firstDimension.type;},setIsReversed:function(isReversed){if(!isReversed){delete this.isReversed;}else{this.isReversed=true;}},setFlatteningMode:function(flatteningMode){if(!flatteningMode||flatteningMode==='singleLevel'){delete this.flatteningMode;}else{this.flatteningMode=flatteningMode;}},setFlattenRootLabel:function(flattenRootLabel){if(!flattenRootLabel){delete this.flattenRootLabel;}else{this.flattenRootLabel=flattenRootLabel;}},flatten:function(data,keyArgs){if(this.grouping){return data.flattenBy(this,keyArgs);}},flattenedGrouping:function(keyArgs){var grouping=this.grouping;if(grouping){keyArgs=def.setDefaults(keyArgs,'flatteningMode',this.flatteningMode,'flattenRootLabel',this.flattenRootLabel);return grouping.ensure(keyArgs);}},select:function(data,keyArgs){var grouping=this.grouping;if(grouping){return data.groupBy(grouping.ensure(keyArgs),keyArgs);}},view:function(complex){var grouping=this.grouping;if(grouping){return grouping.view(complex);}},preBind:function(groupingSpec){this.__grouping=groupingSpec;return this;},isPreBound:function(){return!!this.__grouping;},isBound:function(){return!!this.grouping;},postBind:function(type){var grouping=this.__grouping;if(grouping){delete this.__grouping;grouping.bind(type);this.bind(grouping);}
return this;},bind:function(groupingSpec){if(groupingSpec){if(groupingSpec.isNull()){groupingSpec=null;}else{if(this.requireSingleDimension&&!groupingSpec.isSingleDimension){throw def.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);}
var valueType=this.valueType;var requireIsDiscrete=this.requireIsDiscrete;groupingSpec.dimensions().each(function(dimSpec){var dimType=dimSpec.type;if(valueType&&dimType.valueType!==valueType){throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,dimType.name,pvc.data.DimensionType.valueTypeName(valueType),dimType.valueTypeName]);}
if(requireIsDiscrete!=null&&dimType.isDiscrete!==requireIsDiscrete){throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,dimType.name,requireIsDiscrete?'discrete':'continuous']);}},this);}}
if(this.grouping){this.grouping.dimensions().each(function(dimSpec){if(dimSpec.type){dimType_removeVisualRole.call(dimSpec.type,this);}},this);}
this.grouping=groupingSpec;if(this.grouping){if(this.isReversed){this.grouping=this.grouping.reversed();}
this.grouping.dimensions().each(function(dimSpec){dimType_addVisualRole.call(dimSpec.type,this);},this);}
return this;}});def.type('pvc.visual.Scene').init(function(parent,keyArgs){if(pvc.debug>=4){this.id=def.nextId('scene');}
this._renderId=0;this.renderState={};pv.Dom.Node.call(this,null);this.parent=parent||null;this.root=this;if(parent){var index=def.get(keyArgs,'index',null);parent.insertAt(this,index);this.root=parent.root;}else{this._active=null;this._panel=def.get(keyArgs,'panel')||def.fail.argumentRequired('panel',"Argument is required on root scene.");}
var group=def.get(keyArgs,'group',null),datum;if(group){datum=group._datums[0];}else{datum=def.get(keyArgs,'datum');}
this.datum=datum||null;this.group=group;var source=(datum||group);this.atoms=source?source.atoms:null;this.vars=parent?Object.create(parent.vars):{};}).add(pv.Dom.Node).add({datums:function(){return this.group?this.group.datums():(this.datum?def.query(this.datum):def.query());},format:function(mask){return def.format(mask,this._formatScope,this);},_formatScope:function(prop){if(prop.charAt(0)==='#'){prop=prop.substr(1).split('.');if(prop.length>2){throw def.error.operationInvalid("Scene format mask is invalid.");}
var atom=this.atoms[prop[0]];if(atom){if(prop.length>1){switch(prop[1]){case'value':return atom.value;case'label':break;default:throw def.error.operationInvalid("Scene format mask is invalid.");}}
return atom;}
return null;}
return def.getPath(this.vars,prop);},isRoot:function(){return this.root===this;},panel:function(){return this.root._panel;},chart:function(){return this.root._panel.chart;},compatVersion:function(){return this.root._panel.compatVersion();},children:function(){if(!this.childNodes){return def.query();}
return def.query(this.childNodes);},anyInteraction:function(){return(!!this.root._active||this.anySelected());},isActive:false,setActive:function(isActive){if(this.isActive!==(!!isActive)){rootScene_setActive.call(this.root,this.isActive?null:this);}},clearActive:function(){return rootScene_setActive.call(this.root,null);},anyActive:function(){return!!this.root._active;},active:function(){return this.root._active;},activeSeries:function(){var active=this.active();return active&&active.vars.series.value;},isActiveSeries:function(){if(this.isActive){return true;}
var activeSeries;return(activeSeries=this.activeSeries())!=null&&(activeSeries===this.vars.series.value);},isSelected:function(){return this._selectedData().is;},anySelected:function(){return this._selectedData().any;},_selectedData:function(){return this.renderState._selectedData||(this.renderState._selectedData=this._createSelectedData());},_createSelectedData:function(){var any=this.panel().chart.data.owner.selectedCount()>0,isSelected=any&&this.datums().any(function(datum){return datum.isSelected;});return{any:any,is:isSelected};}});function scene_renderId(renderId){if(this._renderId!==renderId){if(pvc.debug>=7){pvc.log({sceneId:this.id,oldRenderId:this._renderId,newRenderId:renderId});}
this._renderId=renderId;this.renderState={};}}
function rootScene_setActive(scene){if(this._active!==scene){if(this._active){scene_setActive.call(this._active,false);}
this._active=scene||null;if(this._active){scene_setActive.call(this._active,true);}
return true;}
return false;}
function scene_setActive(isActive){if(this.isActive!==(!!isActive)){if(!isActive){delete this.isActive;}else{this.isActive=true;}}}
pvc.visual.ValueLabelVar=function(value,label){this.value=value;this.label=label;};pvc.visual.ValueLabelVar.prototype.toString=function(){var label=this.label||this.value;return typeof label!=='string'?(''+label):label;};def.type('pvc.visual.Sign').init(function(panel,pvMark,keyArgs){this.chart=panel.chart;this.panel=panel;this.pvMark=pvMark;this.extensionId=def.get(keyArgs,'extensionId');this.isActiveSeriesAware=!!this.chart.visualRoles('series',{assertExists:false})&&def.get(keyArgs,'activeSeriesAware',true);pvMark.localProperty('_scene',Object).localProperty('group',Object);this.lockValue('_scene',function(scene){return scene;}).lockValue('group',function(scene){return scene.group;}).lockValue('datum',function(scene){return scene.datum;});pvMark.sign=this;pvMark.__buildInstance=pvMark.buildInstance;pvMark.buildInstance=this._dispatchBuildInstance;}).postInit(function(panel,pvMark,keyArgs){this._addInteractive(keyArgs);}).add({_addInteractive:function(keyArgs){var panel=this.panel,pvMark=this.pvMark,options=this.chart.options;if(!def.get(keyArgs,'noTooltips',false)&&options.showTooltips){this.panel._addPropTooltip(pvMark);}
this.selectable=!def.get(keyArgs,'noSelect',false)&&options.selectable;this.hoverable=!def.get(keyArgs,'noHover',false)&&options.hoverable;this.clickable=!def.get(keyArgs,'noClick',false)&&panel._shouldHandleClick();this.doubleClickable=!def.get(keyArgs,'noDoubleClick',false)&&options.doubleClickAction;this.interactive=this.selectable||this.hoverable;if(this.hoverable){var onEvent,offEvent;onEvent='mouseover';offEvent='mouseout';pvMark.event(onEvent,function(scene){scene.setActive(true);if(!panel.topRoot.rubberBand||panel.isAnimating()){panel._renderInteractive();}}).event(offEvent,function(scene){if(scene.clearActive()){if(!panel.topRoot.rubberBand||panel.isAnimating()){panel._renderInteractive();}}});}
if(this.clickable){panel._addPropClick(pvMark);}
if(this.doubleClickable){panel._addPropDoubleClick(pvMark);}},_dispatchBuildInstance:function(instance){this.sign._buildInstance(this,instance);},_buildInstance:function(mark,instance){this.pvInstance=instance;var scene=instance.data;this.scene=scene;scene_renderId.call(scene,mark.renderId());this.state={};mark.__buildInstance.call(mark,instance);},intercept:function(name,method,noCast){if(typeof method!=='function'){method=def.methodCaller(''+method);}
var me=this;this.pvMark.intercept(name,function(fun,args){var prevExtFun=me._extFun,prevExtArgs=me._extArgs;me._extFun=fun;me._extArgs=args;try{return method.apply(me,args);}finally{me._extFun=prevExtFun;me._extArgs=prevExtArgs;}},this._getExtension(name),noCast);return this;},delegate:function(dv){var result;if(this._extFun){result=this._extFun.apply(this,this._extArgs);if(result===undefined){result=dv;}}else{result=dv;}
return result;},hasDelegate:function(){return!!this._extFun;},lockDimensions:function(){this.pvMark.lock('left').lock('right').lock('top').lock('bottom').lock('width').lock('height');return this;},lock:function(name,method){if(typeof method!=='function'){method=def.methodCaller(''+method,this);}else{method=method.bind(this);}
return this.lockValue(name,method);},lockValue:function(name,value){this.pvMark.lock(name,value);return this;},optional:function(name,method){if(typeof method!=='function'){method=def.methodCaller(''+method,this);}else{method=method.bind(this);}
return this.optionalValue(name,method);},optionalValue:function(name,value){this.pvMark[name](value);return this;},_getExtension:function(name){return this.panel._getExtension(this.extensionId,name);},_versionedExtFun:function(prop,extPointFun,version){return extPointFun;},color:function(type){var color=this.baseColor(type);if(color===null){return null;}
if(this.interactive&&this.scene.anyInteraction()){color=this.interactiveColor(type,color);}else{color=this.normalColor(type,color);}
return color;},baseColor:function(type){var color=this.delegate();if(color===undefined){color=this.defaultColor(type);}
return color;},_initDefaultColorSceneScale:function(){var colorAxis=this.panel.defaultColorAxis();if(colorAxis){return colorAxis.sceneScale({nullToZero:false});}
return def.fun.constant(pvc.defaultColor);},defaultColorSceneScale:function(){return this._defaultColorSceneScale||(defaultColorSceneScale=this._initDefaultColorSceneScale());},defaultColor:function(type){return this.defaultColorSceneScale()(this.scene);},normalColor:function(type,color){return color;},interactiveColor:function(type,color){return color;},dimColor:function(type,color){return pvc.toGrayScale(color,-0.3,null,null);}});def.type('pvc.visual.Dot',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Dot);this.base(panel,pvMark,keyArgs);if(!def.get(keyArgs,'freePosition',false)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp);this.lock(orthoPosProp,'y').lock(basePosProp,'x');}
this.intercept('shape','shape').intercept('shapeRadius','radius').intercept('shapeSize','size').optionalValue('strokeDasharray',null).optionalValue('lineWidth',1.5).intercept('fillStyle','fillColor').intercept('strokeStyle','strokeColor');}).add({y:function(){return 0;},x:function(){return 0;},shape:function(){return this.delegate();},radius:function(){this.state.radius=this.delegate();},size:function(){var size=this.baseSize();if(this.interactive&&this.scene.anyInteraction()){size=this.interactiveSize(size);}else{size=this.normalSize(size);}
return size;},baseSize:function(){var radius=this.state.radius;if(radius!=null){return radius*radius;}
return this.delegate(12);},normalSize:function(size){return size;},interactiveSize:function(size){if(this.scene.isActive){return Math.max(size,5)*2.5;}
return size;},fillColor:function(){return this.color('fill');},strokeColor:function(){return this.color('stroke');},interactiveColor:function(type,color){var scene=this.scene;if(scene.isActive){if(type==='stroke'){return color.brighter(1);}}else if(scene.anySelected()&&!scene.isSelected()){if(this.isActiveSeriesAware&&scene.isActiveSeries()){return pv.Color.names.darkgray.darker().darker();}
switch(type){case'fill':case'stroke':return this.dimColor(type,color);}}
return this.base(type,color);}});def.type('pvc.visual.Line',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Line);this.base(panel,pvMark,keyArgs);this.lockValue('segmented',true).lockValue('antialias',true);if(!def.get(keyArgs,'freePosition',false)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp);this.lock(orthoPosProp,'y').lock(basePosProp,'x');}
this.intercept('strokeStyle','strokeColor').intercept('lineWidth','strokeWidth');}).add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'noHover',true,'noTooltips',true);this.base(keyArgs);},y:function(){return 0;},x:function(){return 0;},strokeWidth:function(){var strokeWidth=this.baseStrokeWidth();if(this.interactive&&this.scene.anyInteraction()){strokeWidth=this.interactiveStrokeWidth(strokeWidth);}else{strokeWidth=this.normalStrokeWidth(strokeWidth);}
return strokeWidth;},baseStrokeWidth:function(){return this.delegate(1.5);},normalStrokeWidth:function(strokeWidth){return strokeWidth;},interactiveStrokeWidth:function(strokeWidth){if(this.isActiveSeriesAware&&this.scene.isActiveSeries()){return Math.max(1,strokeWidth)*2.5;}
return strokeWidth;},strokeColor:function(){return this.color('stroke');},interactiveColor:function(type,color){var scene=this.scene;if(scene.anySelected()&&!scene.isSelected()){if(this.isActiveSeriesAware&&scene.isActiveSeries()){return pv.Color.names.darkgray.darker().darker();}
if(type==='stroke'){return this.dimColor(type,color);}}
return this.base(type,color);}});def.type('pvc.visual.Area',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Area);this.base(panel,pvMark,keyArgs);var antialias=def.get(keyArgs,'antialias',true),segmented=def.get(keyArgs,'segmented',true);this.lockValue('segmented',segmented).lockValue('antialias',antialias);if(!def.get(keyArgs,'freePosition',false)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp),orthoLenProp=panel.anchorOrthoLength(orthoPosProp);this.lock(basePosProp,'x').lock(orthoPosProp,'y').lock(orthoLenProp,'dy');}
this.intercept('fillStyle','fillColor');if(segmented&&antialias){this.lock('strokeStyle','fixAntialiasStrokeColor').lock('lineWidth','fixAntialiasStrokeWidth');}else{this.lockValue('strokeStyle',null).lockValue('lineWidth',0);}}).add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'noHover',true,'noTooltips',true);this.base(keyArgs);},x:function(){return 0;},y:function(){return 0;},dy:function(){return 0;},fixAntialiasStrokeColor:function(){return this.pvMark.fillStyle();},fillColor:function(){return this.color('fill');},interactiveColor:function(type,color){if(type==='fill'){if(this.scene.anySelected()&&!this.scene.isSelected()){return this.dimColor(type,color);}}
return this.base(type,color);},fixAntialiasStrokeWidth:function(){var color=this.pvMark.strokeStyle();return(!color||color.a<1)?0.00001:1;}});def.type('pvc.visual.Bar',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Bar);this.base(panel,pvMark,keyArgs);this.normalStroke=def.get(keyArgs,'normalStroke',false);this.intercept('fillStyle','fillColor').intercept('strokeStyle','strokeColor').intercept('lineWidth','strokeWidth');}).add({fillColor:function(){return this.color('fill');},strokeColor:function(){return this.color('stroke');},normalColor:function(type,color){if(type==='stroke'&&!this.normalStroke){return null;}
return color;},interactiveColor:function(type,color){var scene=this.scene;if(type==='stroke'){if(scene.isActive){return color.brighter(1.3).alpha(0.7);}
if(!this.normalStroke){return null;}
if(scene.anySelected()&&!scene.isSelected()){if(this.isActiveSeriesAware&&scene.isActiveSeries()){return pv.Color.names.darkgray.darker().darker();}
return this.dimColor(type,color);}}else if(type==='fill'){if(scene.isActive){return color.brighter(0.2).alpha(0.8);}
if(scene.anySelected()&&!scene.isSelected()){if(this.isActiveSeriesAware&&scene.isActiveSeries()){return pv.Color.names.darkgray.darker(2).alpha(0.8);}
return this.dimColor(type,color);}}
return this.base(type,color);},strokeWidth:function(){var strokeWidth=this.baseStrokeWidth();if(this.interactive&&this.scene.anyInteraction()){strokeWidth=this.interactiveStrokeWidth(strokeWidth);}else{strokeWidth=this.normalStrokeWidth(strokeWidth);}
return strokeWidth;},baseStrokeWidth:function(){var value=this.delegate();if(value===undefined){value=this.defaultStrokeWidth();}
return value;},defaultStrokeWidth:function(){return 0.5;},normalStrokeWidth:function(strokeWidth){return strokeWidth;},interactiveStrokeWidth:function(strokeWidth){if(this.scene.isActive){return Math.max(1,strokeWidth)*1.3;}
return strokeWidth;}});pv.PieSlice=function(){pv.Wedge.call(this);};pv.PieSlice.prototype=pv.extend(pv.Wedge);pv.PieSlice.prototype.midAngle=function(){var instance=this.instance();return instance.startAngle+(instance.angle/2);};def.type('pvc.visual.PieSlice',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.PieSlice);this.base(panel,pvMark,keyArgs);this._activeOffsetRadius=def.get(keyArgs,'activeOffsetRadius',0);this._center=def.get(keyArgs,'center');this.intercept('fillStyle','fillColor').intercept('strokeStyle','strokeColor').optionalValue('lineWidth',0.6).intercept('angle','angle').lock('bottom','y').lock('left','x').lockValue('top',null).lockValue('right',null);}).add({angle:function(){return 0;},x:function(){return this._center.x+this._offsetSlice('cos');},y:function(){return this._center.y-this._offsetSlice('sin');},_offsetSlice:function(fun){var offset=this._getOffsetRadius();if(offset!==0){offset=offset*Math[fun](this.pvMark.midAngle());}
return offset;},_getOffsetRadius:function(){var offset=this.state.offsetRadius;if(offset==null){offset=(this.state.offsetRadius=this.offsetRadius()||0);}
return offset;},fillColor:function(){return this.color('fill');},strokeColor:function(){return this.color('stroke');},defaultColor:function(type){if(type==='stroke'){return null;}
return this.base(type);},interactiveColor:function(type,color){var scene=this.scene;if(scene.isActive){switch(type){case'fill':return color.brighter(0.2).alpha(0.8);case'stroke':return color.brighter(1.3).alpha(0.7);}}else if(scene.anySelected()&&!scene.isSelected()){switch(type){case'fill':return this.dimColor(type,color);}}
return this.base(type,color);},offsetRadius:function(){var offsetRadius=this.baseOffsetRadius();if(this.interactive&&this.scene.anyInteraction()){offsetRadius=this.interactiveOffsetRadius(offsetRadius);}else{offsetRadius=this.normalOffsetRadius(offsetRadius);}
return offsetRadius;},baseOffsetRadius:function(){return 0;},normalOffsetRadius:function(offsetRadius){return offsetRadius;},interactiveOffsetRadius:function(offsetRadius){if(this.scene.isActive){return offsetRadius+this._activeOffsetRadius;}
return offsetRadius;}});def.type('pvc.visual.Rule',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Rule);this.base(panel,pvMark,keyArgs);this.intercept('strokeStyle','strokeColor').intercept('lineWidth','strokeWidth');}).add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'noHover',true,'noSelect',true,'noTooltips',true,'noClick',true,'noDoubleClick',true);this.base(keyArgs);},strokeWidth:function(){var strokeWidth=this.baseStrokeWidth();if(this.interactive&&this.scene.anyInteraction()){strokeWidth=this.interactiveStrokeWidth(strokeWidth);}else{strokeWidth=this.normalStrokeWidth(strokeWidth);}
return strokeWidth;},baseStrokeWidth:function(){var value=this.delegate();if(value===undefined){value=this.defaultStrokeWidth();}
return value;},defaultStrokeWidth:function(){return 1;},normalStrokeWidth:function(strokeWidth){return strokeWidth;},interactiveStrokeWidth:function(strokeWidth){if(this.scene.isActive){return Math.max(1,strokeWidth)*2.2;}
return strokeWidth;},strokeColor:function(){return this.color('stroke');},interactiveColor:function(type,color){var scene=this.scene;if(!scene.isActive&&scene.anySelected()&&!scene.isSelected()){return this.dimColor(type,color);}
return this.base(type,color);}});def.type('pvc.visual.Context').init(function(panel,mark,event){this.chart=panel.chart;this.panel=panel;visualContext_update.call(this,mark,event);}).add({isPinned:false,pin:function(){this.isPinned=true;return this;},getV1Series:function(){var s;return this.scene.atoms&&(s=this.scene.atoms[this.panel._getV1DimName('series')])&&s.rawValue;},getV1Category:function(){var c;return this.scene.atoms&&(c=this.scene.atoms[this.panel._getV1DimName('category')])&&c.rawValue;},getV1Value:function(){var v;return this.scene.atoms&&(v=this.scene.atoms[this.panel._getV1DimName('value')])&&v.value;}});function visualContext_update(mark,event){this.sign=mark.sign||null;this.event=event||null;this.index=mark.index;this.pvMark=mark;var instance=mark.instance(),scene=instance._scene;if(!scene){var group=instance.group,datum=group?null:instance.datum;scene=new pvc.visual.Scene(null,{panel:this.panel,group:group,datum:datum});}
this.scene=scene;}
var axis_optionsDef;def.scope(function(){def.type('pvc.visual.Axis').init(function(chart,type,index,dataCells,keyArgs){dataCells||def.fail.argumentRequired('dataCells');this.chart=chart;this.type=type;this.index=index==null?0:index;this.dataCells=def.array.as(dataCells);this.dataCell=this.dataCells[0];this.role=this.dataCell&&this.dataCell.role;this.scaleType=groupingScaleType(this.role.grouping);this.id=pvc.visual.Axis.getId(this.type,this.index);this.option=pvc.options(this._getOptionsDefinition(),this);this._checkRoleCompatibility();this.setScale(def.get(keyArgs,'scale',null));}).add({isVisible:true,setScale:function(scale){this.scale=scale;if(scale){scale.type=this.scaleType;}
return this;},scaleType:function(){return groupingScaleType(this.role.grouping);},sceneScale:function(keyArgs){var varName=def.get(keyArgs,'sceneVarName')||this.role.name,grouping=this.role.grouping;if(grouping.isSingleDimension&&grouping.firstDimension.type.valueType===Number){var scale=this.scale,nullToZero=def.get(keyArgs,'nullToZero',true);var by=function(scene){var value=scene.vars[varName].value;if(value==null){if(!nullToZero){return value;}
value=0;}
return scale(value);};def.copy(by,scale);return by;}
return this.scale.by1(function(scene){return scene.vars[varName].value;});},_getOptionsDefinition:function(){return axis_optionsDef;},_checkRoleCompatibility:function(){var L=this.dataCells.length;if(L>1){var grouping=this.role.grouping,i;if(this.scaleType==='Discrete'){for(i=1;i<L;i++){if(grouping.id!==this.dataCells[i].role.grouping.id){throw def.error.operationInvalid("Discrete roles on the same axis must have equal groupings.");}}}else{if(!grouping.firstDimension.type.isComparable){throw def.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.");}
for(i=1;i<L;i++){if(this.scaleType!==groupingScaleType(this.dataCells[i].role.grouping)){throw def.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.");}}}}}});pvc.visual.Axis.getId=function(type,index){if(index===0){return type;}
return type+""+(index+1);};function groupingScaleType(grouping){return grouping.isDiscrete()?'Discrete':(grouping.firstDimension.type.valueType===Date?'Timeseries':'Continuous');}
axis_optionsDef={};});def.scope(function(){var $VA=pvc.visual.Axis;def.type('pvc.visual.CartesianAxis',$VA).init(function(chart,type,index,dataCells,keyArgs){this.base(chart,type,index,dataCells,keyArgs);var options=chart.options;this.orientation=$VCA.getOrientation(this.type,options.orientation);this.orientedId=$VCA.getOrientedId(this.orientation,this.index);this.v1OptionId=$VCA.getV1OptionId(this.orientation,this.index);if(this.index!==1){this.isVisible=options['show'+def.firstUpperCase(this.orientedId)+'Scale'];}else{this.isVisible=!!options.secondAxisIndependentScale;}}).add({setScale:function(scale){if(this.scale){delete this.domain;delete this.ticks;delete this._roundingPaddings;}
this.base(scale);if(scale){if(!scale.isNull&&this.scaleType!=='Discrete'){this.domain=scale.domain();if(this.scaleType==='Continuous'){var roundMode=this.option('DomainRoundMode');if(roundMode==='nice'){scale.nice();}}}}
return this;},setTicks:function(ticks){var scale=this.scale;(scale&&!scale.isNull)||def.fail.operationInvalid("Scale must be set and non-null.");this.ticks=ticks;if(scale.type==='Continuous'&&this.option('DomainRoundMode')==='tick'){delete this._roundingPaddings;var tickCount=ticks&&ticks.length;if(tickCount){this.scale.domain(ticks[0],ticks[tickCount-1]);}else{this.scale.domain(this.domain[0],this.domain[1]);}}},setScaleRange:function(size){var scale=this.scale;scale.min=0;scale.max=size;scale.size=size;if(scale.type==='Discrete'){if(scale.domain().length>0){var bandRatio=this.chart.options.panelSizeRatio||0.8;scale.splitBandedCenter(scale.min,scale.max,bandRatio);}}else{scale.range(scale.min,scale.max);}
if(pvc.debug>=4){pvc.log("Scale: "+JSON.stringify(def.copyOwn(scale)));}
return scale;},getScaleRoundingPaddings:function(){var roundingPaddings=this._roundingPaddings;if(!roundingPaddings){roundingPaddings={begin:0,end:0};var scale=this.scale;var roundMode;while(scale&&!scale.isNull&&scale.type==='Continuous'&&(roundMode=this.option('DomainRoundMode'))!=='none'){var currDomain=scale.domain();var origDomain=this.domain||def.assert("Must be set");var currLength=currDomain[1]-currDomain[0];if(currLength){var dif=origDomain[0]-currDomain[0];if(dif>0){roundingPaddings.begin=dif/currLength;}
dif=currDomain[1]-origDomain[1];if(dif>0){roundingPaddings.end=dif/currLength;}}
break;}
this._roundingPaddings=roundingPaddings;}
return roundingPaddings;},_getOptionsDefinition:function(){return cartAxis_optionsDef;}});var $VCA=pvc.visual.CartesianAxis;$VCA.getOrientation=function(type,chartOrientation){return((type==='base')===(chartOrientation==='vertical'))?'x':'y';};$VCA.getOrientedId=function(orientation,index){switch(index){case 0:return orientation;case 1:return"second"+orientation.toUpperCase();}
return orientation+""+(index+1);};$VCA.getV1OptionId=function(orientation,index){switch(index){case 0:return orientation;case 1:return"second";}
return orientation+""+(index+1);};function chartOption(name){return this.chart.options[name];}
function resolvers(list){return function(axis){for(var i=0,L=list.length;i<L;i++){if(list[i].call(this,axis)===true){return true;}}};}
function axisSpecify(getAxisPropValue){return axisResolve(getAxisPropValue,'specify');}
function axisDefault(getAxisPropValue){return axisResolve(getAxisPropValue,'defaultValue');}
function axisResolve(getAxisPropValue,operation){return function(axis){var value=getAxisPropValue.call(axis,this.name,this);if(value!==undefined){this[operation||'specify'](value);return true;}};}
axisSpecify.byId=axisSpecify(function(name){return chartOption.call(this,this.id+"Axis"+name);});axisSpecify.byV1OptionId=axisSpecify(function(name){return chartOption.call(this,this.v1OptionId+'Axis'+name);});axisSpecify.byCommonId=axisSpecify(function(name){return chartOption.call(this,'axis'+name);});var resolveNormal=resolvers([axisSpecify.byId,axisSpecify.byV1OptionId,axisSpecify.byCommonId]);var specNormal={resolve:resolveNormal};var fixedMinMaxSpec={resolve:resolvers([axisSpecify.byId,axisSpecify.byV1OptionId,axisSpecify(function(name){if(!this.index&&this.type==='ortho'){return chartOption.call(this,this.id+name);}}),axisSpecify.byCommonId]),cast:Number2};var cartAxis_optionsDef=def.create(axis_optionsDef,{Composite:{resolve:resolvers([axisSpecify(function(name){if(this.index>0){return false;}
return chartOption.call(this,'useCompositeAxis');}),resolveNormal]),cast:Boolean,value:false},Size:{resolve:resolveNormal,cast:Number2},SizeMax:specNormal,Position:{resolve:resolvers([resolveNormal,axisDefault(function(name){if(this.index>0){var optionId0=$VCA.getV1OptionId(this.orientation,0);var position0=chartOption.call(this,optionId0+'Axis'+name)||'left';return pvc.BasePanel.oppositeAnchor[position0];}})])},FixedMin:fixedMinMaxSpec,FixedMax:fixedMinMaxSpec,OriginIsZero:{resolve:resolvers([resolveNormal,axisSpecify(function(name){switch(this.index){case 0:return chartOption.call(this,'originIsZero');case 1:return chartOption.call(this,'secondAxisOriginIsZero');}})]),cast:Boolean,value:true},Offset:{resolve:resolvers([axisSpecify.byId,axisSpecify.byV1OptionId,axisSpecify(function(name){switch(this.index){case 0:return chartOption.call(this,'axisOffset');case 1:return chartOption.call(this,'secondAxisOffset');}})]),cast:Number2},LabelSpacingMin:{resolve:resolveNormal,cast:Number2,value:1},OverlappedLabelsHide:{resolve:resolveNormal,cast:Boolean,value:false},OverlappedLabelsMaxPct:{resolve:resolveNormal,cast:Number2,value:0.2},FullGrid:{resolve:resolveNormal,cast:Boolean,value:false},FullGridCrossesMargin:{resolve:resolveNormal,cast:Boolean,value:true},EndLine:{resolve:resolveNormal,cast:Boolean},ZeroLine:{resolve:resolveNormal,cast:Boolean,value:true},RuleCrossesMargin:{resolve:resolveNormal,cast:Boolean,value:true},DesiredTickCount:{resolve:resolveNormal,cast:Number2},MinorTicks:{resolve:resolveNormal,cast:Boolean,value:true},DomainRoundMode:{resolve:resolveNormal,cast:String,value:'none'},TickExponentMin:{resolve:resolveNormal,cast:Number2},TickExponentMax:{resolve:resolveNormal,cast:Number2},Title:{resolve:resolveNormal,cast:String},TitleSize:{resolve:resolveNormal,cast:Number2},TitleSizeMax:specNormal,TitleFont:{resolve:resolveNormal,cast:String},TitleMargins:specNormal,TitlePaddings:specNormal,TitleAlign:{resolve:resolveNormal,cast:String},Font:{resolve:resolveNormal,cast:String},ClickAction:specNormal,DoubleClickAction:specNormal});function Number2(value){if(value!=null){value=+value;if(isNaN(value)){value=null;}}
return value;}});def.scope(function(){var $VA=pvc.visual.Axis;def.type('pvc.visual.ColorAxis',$VA).init(function(chart,type,index,dataCells,keyArgs){this.base(chart,type,index,dataCells,keyArgs);this.optionId=pvc.buildIndexedId('legend',this.index);var options=chart.options;var colorsFactory;if(this.index===1){var useOwnColors=options.secondAxisOwnColors;if(useOwnColors==null){useOwnColors=chart.compatVersion()<=1;}
if(useOwnColors){colorsFactory=pvc.createColorScheme(options.secondAxisColor);}}else{colorsFactory=pvc.createColorScheme(options.colors);}
this.hasOwnColors=!!colorsFactory;if(!colorsFactory){var color0Axis=chart.axes.color;colorsFactory=color0Axis?color0Axis.colorsFactory:null;}
this.colorsFactory=colorsFactory;if(this.role.isBound()){var dataCell=this.dataCell;var domainData=chart.partData(dataCell.dataPartValues).flattenBy(dataCell.role);var scale;if(!this.hasOwnColors){var color0Axis=chart.axes.color;scale=color0Axis?color0Axis.scale:null;}
if(!scale){this.hasOwnColors=true;var domainValues=domainData.children().select(function(child){return child.value;}).array();scale=colorsFactory(domainValues);}
this.setScale(scale);this.domainData=domainData;}
this.isVisible=this.option('Visible');}).add({legendBulletGroupScene:null,_getOptionsDefinition:function(){return colorAxis_optionsDef;},_getOptionByOptionId:function(name){return chartOption.call(this,this.optionId+name);}});var $VCA=pvc.visual.ColorAxis;function chartOption(name){return this.chart.options[name];}
function resolve(fun,operation){return function(axis){var value=fun.call(axis,this.name,this);if(value!==undefined){this[operation||'specify'](value);return true;}};}
resolve.byOptionId=resolve($VCA.prototype._getOptionByOptionId);function resolveNormal(axis){return resolve.byOptionId.call(this,axis);}
function castSize(size,axis){if(!def.object.is(size)){var position=this.option('Position');size=new pvc.Size().setSize(size,{singleProp:pvc.BasePanel.orthogonalLength[position]});}
return size;}
function castAlign(align,axis){var position=this.option('Position');return pvc.parseAlign(position,align);}
var colorAxis_optionsDef=def.create(axis_optionsDef,{Visible:{resolve:resolveNormal,cast:Boolean,value:true},Position:{resolve:resolveNormal,cast:pvc.parsePosition,value:'bottom'},Size:{resolve:resolveNormal,cast:castSize},SizeMax:{resolve:resolveNormal,cast:castSize},Align:{resolve:function(axis){if(!resolve.byOptionId.call(this,axis)){var position=this.option('Position');var align;if(position!=='top'&&position!=='bottom'){align='top';}else if(axis.chart.compatVersion()<=1){align='left';}
this.defaultValue(align);}},cast:castAlign},Font:{resolve:resolveNormal,cast:String},Margins:{resolve:function(axis){if(!resolve.byOptionId.call(this,axis)){if(axis.chart.compatVersion()>1){var position=this.option('Position');var margins=def.set({},pvc.BasePanel.oppositeAnchor[position],5);this.defaultValue(margins);}}},cast:pvc.Sides.as},Paddings:{resolve:resolveNormal,cast:pvc.Sides.as,value:5},Font:{resolve:resolveNormal,cast:String,value:'10px sans-serif'},ClickMode:{resolve:resolveNormal,cast:pvc.parseLegendClickMode,value:'toggleVisible'},DrawLine:{resolve:resolveNormal,cast:Boolean,value:false},DrawMarker:{resolve:resolveNormal,cast:Boolean,value:true},Shape:{resolve:resolveNormal,cast:pvc.parseShape}});function Number2(value){if(value!=null){value=+value;if(isNaN(value)){value=null;}}
return value;}});def.space('pvc.visual.legend',function(legend){legend.buildKey=function(legendType,dataCell){return legendType+'|'+
dataCell.role.name+'|'+
(dataCell.dataPartValues!=null?dataCell.dataPartValues:'');};});def.type('pvc.visual.legend.BulletRootScene',pvc.visual.Scene).init(function(parent,keyArgs){this.base(parent,keyArgs);var markerDiam=def.get(keyArgs,'markerSize',15);var padding=new pvc.Sides(def.get(keyArgs,'padding',5)).resolve(markerDiam,markerDiam);def.set(this.vars,'horizontal',def.get(keyArgs,'horizontal',false),'font',def.get(keyArgs,'font'),'markerSize',markerDiam,'textMargin',def.get(keyArgs,'textMargin',6),'padding',padding);}).add({layout:function(layoutInfo){var clientSize=layoutInfo.clientSize;if(!(clientSize.width>0&&clientSize.height>0)){return new pvc.Size(0,0);}
var markerDiam=this.vars.markerSize;var textLeft=markerDiam+this.vars.textMargin;var padding=this.vars.padding;var a_width=this.vars.horizontal?'width':'height';var a_height=pvc.BasePanel.oppositeLength[a_width];var maxRowWidth=clientSize[a_width];var row;var rows=[];var contentSize={width:0,height:0};this.childNodes.forEach(function(groupScene){groupScene.childNodes.forEach(layoutItem,this);},this);if(!row){return new pvc.Size(0,0);}
commitRow(true);def.set(this.vars,'rows',rows,'rowCount',row,'size',contentSize);var isV1Compat=this.compatVersion()<=1;var requestSize=def.set({},a_width,isV1Compat?clientSize[a_width]:contentSize.width,a_height,Math.min(contentSize.height,clientSize[a_height]));return requestSize;function layoutItem(itemScene){var textSize=itemScene.labelTextSize();var hidden=!textSize||!textSize.width||!textSize.height;itemScene.isHidden=hidden;if(hidden){return;}
var widthMargin=0;var itemClientSize={width:textLeft+textSize.width+widthMargin,height:Math.max(textSize.height,markerDiam)};var isFirstInRow;if(!row){row=new pvc.visual.legend.BulletItemSceneRow(0);isFirstInRow=true;}else{isFirstInRow=!row.items.length;}
var newRowWidth=row.size.width+itemClientSize[a_width];if(!isFirstInRow){newRowWidth+=padding[a_width];}
if(!isFirstInRow&&(newRowWidth>maxRowWidth)){commitRow(false);newRowWidth=itemClientSize[a_width];}
var rowSize=row.size;rowSize.width=newRowWidth;rowSize.height=Math.max(rowSize.height,itemClientSize[a_height]);var rowItemIndex=row.items.length;row.items.push(itemScene);def.set(itemScene.vars,'row',row,'rowIndex',rowItemIndex,'clientSize',itemClientSize);}
function commitRow(isLast){var rowSize=row.size;contentSize.height+=rowSize.height;if(rows.length){contentSize.height+=padding[a_height];}
contentSize.width=Math.max(contentSize.width,rowSize.width);rows.push(row);if(!isLast){row=new pvc.visual.legend.BulletItemSceneRow(rows.length);}}},defaultGroupSceneType:function(){var GroupType=this._bulletGroupType;if(!GroupType){GroupType=def.type(pvc.visual.legend.BulletGroupScene);this._bulletGroupType=GroupType;}
return GroupType;},createGroup:function(keyArgs){var GroupType=this.defaultGroupSceneType();return new GroupType(this,keyArgs);}});def.type('pvc.visual.legend.BulletItemSceneRow').init(function(index){this.index=index;this.items=[];this.size={width:0,height:0};});def.type('pvc.visual.legend.BulletGroupScene',pvc.visual.Scene).init(function(rootScene,keyArgs){this.base(rootScene,keyArgs);this.extensionPrefix=def.get(keyArgs,'extensionPrefix')||'legend';this._renderer=def.get(keyArgs,'renderer');this.colorAxis=def.get(keyArgs,'colorAxis');this.clickMode=def.get(keyArgs,'clickMode');if(this.colorAxis&&!this.clickMode){this.clickMode=this.colorAxis.option('ClickMode');}}).add({hasRenderer:function(){return this._renderer;},renderer:function(renderer){if(renderer!=null){this._renderer=renderer;}else{renderer=this._renderer;if(!renderer){var keyArgs;var colorAxis=this.colorAxis;if(colorAxis){keyArgs={drawRule:colorAxis.option('DrawLine'),drawMarker:colorAxis.option('DrawMarker'),markerShape:colorAxis.option('Shape')};}
renderer=new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs);this._renderer=renderer;}}
return renderer;},itemSceneType:function(){var ItemType=this._itemSceneType;if(!ItemType){ItemType=def.type(pvc.visual.legend.BulletItemScene);var clickMode=this.clickMode;switch(clickMode){case'toggleSelected':ItemType.add(pvc.visual.legend.BulletItemSceneSelection);break;case'toggleVisible':ItemType.add(pvc.visual.legend.BulletItemSceneVisibility);break;}
this.panel()._extendSceneType('item',ItemType,['isOn','isClickable','click']);this._itemSceneType=ItemType;}
return ItemType;},createItem:function(keyArgs){var ItemType=this.itemSceneType();return new ItemType(this,keyArgs);}});def.type('pvc.visual.legend.BulletItemScene',pvc.visual.Scene).init(function(bulletGroup,keyArgs){this.base(bulletGroup,keyArgs);var value,label;if(keyArgs){value=keyArgs.value;label=keyArgs.label;}
if(value===undefined){var source=this.group||this.datum;if(source){value=source.value;label=source.ensureLabel();}}
this.vars.value=new pvc.visual.ValueLabelVar(value||null,label||"");}).add({isOn:function(){return true;},isClickable:function(){return false;},click:function(){},labelTextSize:function(){var valueVar=this.vars.value;return valueVar&&pvc.text.getTextSize(valueVar.label,this.vars.font);}});def.type('pvc.visual.legend.BulletItemSceneSelection').add({isOn:function(){var owner=(this.group||this.datum).owner;return!owner.selectedCount()||this.datums().any(function(datum){return!datum.isNull&&datum.isSelected;});},isClickable:function(){return this.chart().options.selectable;},click:function(){var datums=this.datums().array();var chart=this.chart();datums=chart._onUserSelection(datums);if(datums){var on=def.query(datums).any(function(datum){return datum.isSelected;});if(pvc.data.Data.setSelected(datums,!on)){chart.updateSelections();}}}});def.type('pvc.visual.legend.BulletItemSceneVisibility').add({isOn:function(){return this.datums().any(function(datum){return!datum.isNull&&datum.isVisible;});},isClickable:function(){return true;},click:function(){if(pvc.data.Data.toggleVisible(this.datums())){this.chart().render(true,true,false);}}});def.type('pvc.visual.legend.BulletItemRenderer');def.type('pvc.visual.legend.BulletItemDefaultRenderer').init(function(keyArgs){this.drawRule=def.get(keyArgs,'drawRule',false);if(this.drawRule){this.rulePvProto=def.get(keyArgs,'rulePvProto');}
this.drawMarker=!this.drawRule||def.get(keyArgs,'drawMarker',true);if(this.drawMarker){this.markerShape=def.get(keyArgs,'markerShape','square');this.markerPvProto=def.get(keyArgs,'markerPvProto');}}).add({drawRule:false,drawMarker:true,markerShape:null,rulePvProto:null,markerPvProto:null,create:function(legendPanel,pvBulletPanel){var renderInfo={};var drawRule=this.drawRule;var sceneColorProp=function(scene){return scene.color;};if(drawRule){var rulePvBaseProto=new pv.Mark().left(0).top(function(){return this.parent.height()/2;}).width(function(){return this.parent.width();}).lineWidth(1).strokeStyle(sceneColorProp);if(this.rulePvProto){rulePvBaseProto=this.rulePvProto.extend(rulePvBaseProto);}
renderInfo.pvRule=pvBulletPanel.add(pv.Rule).extend(rulePvBaseProto);}
if(this.drawMarker){var markerPvBaseProto=new pv.Mark().left(function(){return this.parent.width()/2;}).top(function(){return this.parent.height()/2;}).shapeSize(function(){return this.parent.width();}).lineWidth(2).fillStyle(sceneColorProp).strokeStyle(sceneColorProp).shape(this.markerShape).angle(drawRule?0:Math.PI/2).antialias(function(){var cos=Math.abs(Math.cos(this.angle()));if(cos!==0&&cos!==1){switch(this.shape()){case'square':case'bar':return false;}}
return true;});if(this.markerPvProto){markerPvBaseProto=this.markerPvProto.extend(markerPvBaseProto);}
renderInfo.pvDot=pvBulletPanel.add(pv.Dot).extend(markerPvBaseProto);}
return renderInfo;},extendMarks:function(legendPanel,renderInfo,extensionPrefix){if(renderInfo.pvRule){legendPanel.extend(renderInfo.pvRule,extensionPrefix+"Rule_");}
if(renderInfo.pvDot){legendPanel.extend(renderInfo.pvDot,extensionPrefix+"Dot_");}}});pvc.Abstract=Base.extend({invisibleLineWidth:0.001,defaultLineWidth:1.5});pvc.BaseChart=pvc.Abstract.extend({_disposed:false,_updateSelectionSuspendCount:0,_selectionNeedsUpdate:false,parent:null,root:null,axes:null,_axisType2RoleNamesMap:null,_visualRoles:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,isPreRendered:false,_createVersion:0,renderCallback:undefined,dataEngine:null,data:null,_partData:null,resultset:[],metadata:[],basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,legendSource:"series",colors:null,secondAxisColor:null,multiChartPageCount:null,multiChartPageIndex:null,constructor:function(options){var parent=this.parent=def.get(options,'parent')||null;if(pvc.debug>=3&&!parent&&options){try{pvc.log("INITIAL OPTIONS:\n"+JSON.stringify(options));}catch(ex){}}
if(parent){this.root=parent.root;this.dataEngine=this.data=options.data||def.fail.argumentRequired('options.data');this.left=options.left;this.top=options.top;this._visualRoles=parent._visualRoles;this._measureVisualRoles=parent._measureVisualRoles;if(parent._serRole){this._serRole=parent._serRole;}
if(parent._dataPartRole){this._dataPartRole=parent._dataPartRole;}}else{this.root=this;this._visualRoles={};this._measureVisualRoles=[];}
this._axisType2RoleNamesMap={};this.axes={};this.options=def.mixin({},this.defaults,options);},compatVersion:function(){return this.options.compatVersion;},_processOptions:function(){var options=this.options;this._processOptionsCore(options);if(pvc.debug>=3&&options&&!this.parent){try{pvc.log("CURRENT OPTIONS:\n"+JSON.stringify(options));}catch(ex){}}
return options;},_processOptionsCore:function(options){if(!$.support.svg||pv.renderer()==='batik'){options.animate=false;}
if(options.showTooltips){var ts=options.tipsySettings;if(ts){this.extend(ts,"tooltip_");}}},_preRender:function(keyArgs){var options=this.options;this._createVersion++;this.isPreRendered=false;if(pvc.debug>=3){pvc.log("Prerendering in pvc");}
this._checkNoData();if(!this.parent){pvc.removeTipsyLegends();}
this._processOptions();if(!this.parent&&this._createVersion===1){this._initVisualRoles();this._bindVisualRolesPre();}
this._initData(keyArgs);var hasMultiRole=this._isRoleAssigned('multiChart');this._initAxes(hasMultiRole);this._initChartPanels(hasMultiRole);this.isPreRendered=true;},_checkNoData:function(){if(!this.parent){if(!this.allowNoData&&this.resultset.length===0){throw new NoDataException();}}},_initAxes:function(isMulti){if(!this.parent){var colorRoleNames=this._axisType2RoleNamesMap.color;if(!colorRoleNames&&this.legendSource){colorRoleNames=this.legendSource;this._axisType2RoleNamesMap.color=colorRoleNames;}
if(colorRoleNames){this._createAxis('color',0);if(this.options.secondAxis){this._createAxis('color',1);}}}else{var root=this.root;var colorAxis=root.axes.color;if(colorAxis){this.axes.color=colorAxis;this.colors=root.colors;}
colorAxis=root.axes.color2;if(colorAxis){this.axes.color2=colorAxis;this.secondAxisColor=root.secondAxisColor;}}},_createAxis:function(axisType,axisIndex){var dataCells=this._getAxisDataCells(axisType,axisIndex);var axis=this._createAxisCore(axisType,axisIndex,dataCells);this.axes[axis.id]=axis;return axis;},_getAxisDataCells:function(axisType,axisIndex){return this._buildAxisDataCells(axisType,axisIndex,null);},_buildAxisDataCells:function(axisType,axisIndex,dataPartValues){return def.array.as(this._axisType2RoleNamesMap[axisType]).map(function(roleName){return{role:this.visualRoles(roleName),dataPartValues:dataPartValues};},this);},_createAxisCore:function(axisType,axisIndex,dataCells){switch(axisType){case'color':var colorAxis=new pvc.visual.ColorAxis(this,axisType,axisIndex,dataCells);switch(axisIndex){case 0:this.colors=colorAxis.colorsFactory;break;case 1:if(this.options.secondAxisOwnColors){this.secondAxisColor=colorAxis.colorsFactory;}
break;}
return colorAxis;}
throw def.error.operationInvalid("Invalid axis type '{0}'",[axisType]);},_initChartPanels:function(hasMultiRole){this._initBasePanel();this._initTitlePanel();this._initLegendPanel();if(!this.parent&&hasMultiRole){this._initMultiChartPanel();}else{this._preRenderContent({margins:this.options.contentMargins,paddings:this.options.contentPaddings});}},_preRenderContent:function(contentOptions){},_initData:function(keyArgs){if(!this.parent){var data=this.data;if(!data||def.get(keyArgs,'reloadData',true)){this._onLoadData();}else{data_disposeChildLists.call(data);data_syncDatumsState.call(data);}}
delete this._partData;if(pvc.debug>=3){pvc.log(this.data.getInfo());}},_onLoadData:function(){var data=this.data,complexType=data?data.type:new pvc.data.ComplexType(),translOptions=this._createTranslationOptions(),translation=this._createTranslation(complexType,translOptions);translation.configureType();if(pvc.debug>=3){pvc.log(complexType.describe());}
this._bindVisualRoles(complexType);if(pvc.debug>=3){this._logVisualRoles();}
if(!data){data=this.dataEngine=this.data=new pvc.data.Data({type:complexType,labelSep:this.options.groupedLabelSep});}
var loadKeyArgs={where:this._getLoadFilter(),isNull:this._getIsNullDatum()};data.load(translation.execute(data),loadKeyArgs);},_getLoadFilter:function(){if(this.options.ignoreNulls){return function(datum){var isNull=datum.isNull;if(isNull&&pvc.debug>=4){pvc.log("Datum excluded.");}
return!isNull;};}},_getIsNullDatum:function(){var measureDimNames=this.measureDimensionsNames(),M=measureDimNames.length;if(M){return function(datum){var atoms=datum.atoms;for(var i=0;i<M;i++){if(atoms[measureDimNames[i]].value!=null){return false;}}
return true;};}},_createTranslation:function(complexType,translOptions){var TranslationClass=translOptions.crosstabMode?pvc.data.CrosstabTranslationOper:pvc.data.RelationalTranslationOper;return new TranslationClass(complexType,this.resultset,this.metadata,translOptions);},_createTranslationOptions:function(){var options=this.options,dataOptions=options.dataOptions||{};var secondAxisSeriesIndexes;if(options.secondAxis){secondAxisSeriesIndexes=options.secondAxisSeriesIndexes;if(secondAxisSeriesIndexes===undefined){secondAxisSeriesIndexes=options.secondAxisIdx;}}
var valueFormat=options.valueFormat,valueFormatter;if(valueFormat&&valueFormat!==this.defaults.valueFormat){valueFormatter=function(v){return v!=null?valueFormat(v):"";};}
return{compatVersion:options.compatVersion,secondAxisSeriesIndexes:secondAxisSeriesIndexes,seriesInRows:options.seriesInRows,crosstabMode:options.crosstabMode,isMultiValued:options.isMultiValued,dimensionGroups:options.dimensionGroups,dimensions:options.dimensions,readers:options.readers,measuresIndexes:options.measuresIndexes,multiChartIndexes:options.multiChartIndexes,separator:dataOptions.separator,measuresInColumns:dataOptions.measuresInColumns,measuresIndex:dataOptions.measuresIndex||dataOptions.measuresIdx,measuresCount:dataOptions.measuresCount||dataOptions.numMeasures,categoriesCount:dataOptions.categoriesCount,isCategoryTimeSeries:options.timeSeries,timeSeriesFormat:options.timeSeriesFormat,valueNumberFormatter:valueFormatter};},_initVisualRoles:function(){this._addVisualRoles({multiChart:{defaultDimensionName:'multiChart*'}});if(this._hasDataPartRole()){this._addVisualRoles({dataPart:{defaultDimensionName:'dataPart',requireSingleDimension:true,requireIsDiscrete:true}});this._dataPartRole=this.visualRoles('dataPart');}
var serRoleSpec=this._getSeriesRoleSpec();if(serRoleSpec){this._addVisualRoles({series:serRoleSpec});this._serRole=this.visualRoles('series');}},_bindVisualRolesPre:function(){def.eachOwn(this._visualRoles,function(visualRole){visualRole.setIsReversed(false);});var boundDimNames={};def.each(this.options.visualRoles,function(roleSpec,name){var visualRole=this._visualRoles[name]||def.fail.operationInvalid("Role '{0}' is not supported by the chart type.",[name]);var groupingSpec;if(roleSpec&&typeof roleSpec==='object'){if(def.get(roleSpec,'isReversed',false)){visualRole.setIsReversed(true);}
groupingSpec=roleSpec.dimensions;}else{groupingSpec=roleSpec;}
if(groupingSpec!==undefined){var grouping=pvc.data.GroupingSpec.parse(groupingSpec);visualRole.preBind(grouping);grouping.dimensions().each(function(dimSpec){if(def.hasOwn(boundDimNames,dimSpec.name)){delete boundDimNames[dimSpec.name];}else{boundDimNames[dimSpec.name]=visualRole;}});}},this);var dimsSpec=(this.options.dimensions||(this.options.dimensions={}));def.eachOwn(boundDimNames,function(role,name){var dimSpec=dimsSpec[name]||(dimsSpec[name]={});if(role.valueType&&dimSpec.valueType===undefined){dimSpec.valueType=role.valueType;if(role.requireIsDiscrete!=null&&dimSpec.isDiscrete===undefined){dimSpec.isDiscrete=role.requireIsDiscrete;}}
if(dimSpec.label===undefined){dimSpec.label=role.label;}},this);},_hasDataPartRole:function(){return false;},_getSeriesRoleSpec:function(){return null;},_addVisualRoles:function(roles){def.eachOwn(roles,function(keyArgs,name){var visualRole=new pvc.visual.Role(name,keyArgs);this._visualRoles[name]=visualRole;if(visualRole.isMeasure){this._measureVisualRoles.push(visualRole);}},this);},_bindVisualRoles:function(type){var boundDimTypes={};function bind(role,dimNames){role.bind(pvc.data.GroupingSpec.parse(dimNames,type));def.array.as(dimNames).forEach(function(dimName){boundDimTypes[dimName]=true;});}
def.eachOwn(this._visualRoles,function(visualRole,name){if(visualRole.isPreBound()){visualRole.postBind(type);if(visualRole.grouping){visualRole.grouping.dimensions().each(function(dimSpec){boundDimTypes[dimSpec.name]=true;});}}},this);def.eachOwn(this._visualRoles,function(role,name){if(!role.grouping){var dimName=role.defaultDimensionName;if(dimName){var match=dimName.match(/^(.*?)(\*)?$/)||def.fail.argumentInvalid('defaultDimensionName');var anyLevel=!!match[2];if(anyLevel){var groupDimNames=type.groupDimensionsNames(match[1],{assertExists:false});if(groupDimNames){var freeGroupDimNames=def.query(groupDimNames).where(function(dimName2){return!def.hasOwn(boundDimTypes,dimName2);});if(role.requireSingleDimension){var freeDimName=freeGroupDimNames.first();if(freeDimName){bind(role,freeDimName);return;}}else{freeGroupDimNames=freeGroupDimNames.array();if(freeGroupDimNames.length){bind(role,freeGroupDimNames);return;}}}}else if(!def.hasOwn(boundDimTypes,dimName)&&type.dimensions(dimName,{assertExists:false})){bind(role,dimName);return;}
if(role.autoCreateDimension){var defaultName=match[1];type.addDimension(defaultName,pvc.data.DimensionType.extendSpec(defaultName,{isHidden:true}));bind(role,defaultName);return;}}
if(role.isRequired){throw def.error.operationInvalid("Chart type requires unassigned role '{0}'.",[name]);}
role.bind(null);}},this);},_logVisualRoles:function(){var out=["\n------------------------------------------"];out.push("Visual Roles Information");def.eachOwn(this._visualRoles,function(role,name){out.push("  "+name+def.array.create(18-name.length," ").join("")+
(role.grouping?(" <-- "+role.grouping):''));});out.push("------------------------------------------");pvc.log(out.join("\n"));},visualRoles:function(roleName,keyArgs){if(roleName==null){return def.own(this._visualRoles);}
var role=def.getOwn(this._visualRoles,roleName)||null;if(!role&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid('roleName',"Undefined role name '{0}'.",[roleName]);}
return role;},measureVisualRoles:function(){return this._measureVisualRoles;},measureDimensionsNames:function(){return def.query(this._measureVisualRoles).select(function(visualRole){return visualRole.firstDimensionName();}).where(def.notNully).array();},_isRoleAssigned:function(roleName){return!!this._visualRoles[roleName].grouping;},partData:function(dataPartValues){if(!this._partData){if(!this._dataPartRole||!this._dataPartRole.grouping){this._partData=this.data;}else{this._partData=this._dataPartRole.flatten(this.data);}}
if(!dataPartValues){return this._partData;}
dataPartValues=def.query(dataPartValues).distinct().array();dataPartValues.sort();var dataPartDimName=this._dataPartRole.firstDimensionName();if(dataPartValues.length===1){return this._partData._childrenByKey[dataPartDimName+':'+dataPartValues[0]]||new pvc.data.Data({linkParent:this._partData,datums:[]});}
return this._partData.where([def.set({},dataPartDimName,dataPartValues)]);},_initBasePanel:function(){var options=this.options;var basePanelParent=this.parent&&this.parent._multiChartPanel;this.basePanel=new pvc.BasePanel(this,basePanelParent,{margins:options.margins,paddings:options.paddings,size:{width:options.width,height:options.height}});},_initTitlePanel:function(){var options=this.options;if(!def.empty(options.title)){this.titlePanel=new pvc.TitlePanel(this,this.basePanel,{title:options.title,font:options.titleFont,anchor:options.titlePosition,align:options.titleAlign,alignTo:options.titleAlignTo,offset:options.titleOffset,inBounds:options.titleInBounds,margins:options.titleMargins,paddings:options.titlePaddings,titleSize:options.titleSize,titleSizeMax:options.titleSizeMax});}},_initLegendPanel:function(){var options=this.options;if(options.legend){var colorAxis=this.axes.color;this.legendPanel=new pvc.LegendPanel(this,this.basePanel,{anchor:colorAxis.option('Position'),align:colorAxis.option('Align'),alignTo:options.legendAlignTo,offset:options.legendOffset,inBounds:options.legendInBounds,size:colorAxis.option('Size'),sizeMax:colorAxis.option('SizeMax'),margins:colorAxis.option('Margins'),paddings:colorAxis.option('Paddings'),font:colorAxis.option('Font'),scenes:def.getPath(options,'legend.scenes'),minMarginX:options.legendMinMarginX,minMarginY:options.legendMinMarginY,textMargin:options.legendTextMargin,padding:options.legendPadding,shape:options.legendShape,markerSize:options.legendMarkerSize,drawLine:options.legendDrawLine,drawMarker:options.legendDrawMarker});this._initLegendScenes(this.legendPanel);}},_initLegendScenes:function(legendPanel){var rootScene;addAxis.call(this,this.axes.color);addAxis.call(this,this.axes.color2);function addAxis(colorAxis){if(colorAxis&&colorAxis.domainData){processAxis.call(this,colorAxis);}}
function processAxis(colorAxis){var domainData=colorAxis.domainData;if(!rootScene){rootScene=legendPanel._getBulletRootScene();}
var groupScene=rootScene.createGroup({group:domainData,colorAxis:colorAxis,extensionPrefix:pvc.visual.Axis.getId('legend',rootScene.childNodes.length)});colorAxis.legendBulletGroupScene=groupScene;var partColorScale=colorAxis.scale;domainData.children().each(function(itemData){var itemScene=groupScene.createItem({group:itemData});def.set(itemScene,'color',partColorScale(itemData.value),'shape','square');});}},_initMultiChartPanel:function(){this._multiChartPanel=new pvc.MultiChartPanel(this,this.basePanel);this.basePanel._children.unshift(this.basePanel._children.pop());},useTextMeasureCache:function(fun,ctx){var root=this.root;var textMeasureCache=root._textMeasureCache||(root._textMeasureCache=pvc.text.createCache());return pvc.text.useCache(textMeasureCache,fun,ctx||this);},render:function(bypassAnimation,recreate,reloadData){this.useTextMeasureCache(function(){try{if(!this.isPreRendered||recreate){this._preRender({reloadData:reloadData});}else if(!this.parent&&this.isPreRendered){pvc.removeTipsyLegends();}
this.basePanel.render({bypassAnimation:bypassAnimation,recreate:recreate});}catch(e){if(e instanceof NoDataException){if(pvc.debug>1){pvc.log("No data found.");}
this._addErrorPanelMessage("No data found",true);}else{pvc.logError(e.message);if(pvc.debug>0){this._addErrorPanelMessage("Error: "+e.message,false);}}}});},_addErrorPanelMessage:function(text,isNoData){var options=this.options,pvPanel=new pv.Panel().canvas(options.canvas).width(options.width).height(options.height),pvMsg=pvPanel.anchor("center").add(pv.Label).text(text);if(isNoData){this.extend(pvMsg,"noDataMessage_");}
pvPanel.render();},animate:function(start,end){return this.basePanel.animate(start,end);},isAnimatingStart:function(){return this.basePanel.isAnimatingStart();},setData:function(data,options){this.setResultset(data.resultset);this.setMetadata(data.metadata);$.extend(this.options,options);},setResultset:function(resultset){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.resultset=resultset;if(!resultset.length){pvc.log("Warning: Resultset is empty");}},setMetadata:function(metadata){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.metadata=metadata;if(!metadata.length){pvc.log("Warning: Metadata is empty");}},extend:function(mark,prefix,keyArgs){if(mark){var logOut=pvc.debug>=3?[]:null;var constOnly=def.get(keyArgs,'constOnly',false);var points=this.options.extensionPoints;if(points){if(mark.borderPanel){mark=mark.borderPanel;}
for(var p in points){if(p.indexOf(prefix)===0){var m=p.substring(prefix.length);var v=points[p];if(mark.isLocked&&mark.isLocked(m)){if(logOut){logOut.push(m+": locked extension point!");}}else if(mark.isIntercepted&&mark.isIntercepted(m)){if(logOut){logOut.push(m+":"+JSON.stringify(v)+" (controlled)");}}else{if(logOut){logOut.push(m+": "+JSON.stringify(v));}
if(v!=null){var type=typeof v;if(type==='object'){if(m==='svg'||m==='css'){var v2=mark.propertyValue(m);if(v2){v=def.copy(v2,v);}}}else if(constOnly&&type==='function'){continue;}}
if(typeof mark[m]==="function"){mark[m](v);}else{mark[m]=v;}}}}
if(logOut){if(logOut.length){pvc.log("Applying Extension Points for: '"+prefix+"'\n\t* "+logOut.join("\n\t* "));}else if(pvc.debug>=5){pvc.log("No Extension Points for: '"+prefix+"'");}}}}else if(pvc.debug>=4){pvc.log("Applying Extension Points for: '"+prefix+"' (target mark does not exist)");}},_getExtension:function(extPoint){var points=this.options.extensionPoints;if(!points){return undefined;}
extPoint=pvc.arraySlice.call(arguments).join('_');return points[extPoint];},clearSelections:function(){if(this.data.owner.clearSelected()){this.updateSelections();}},_suspendSelectionUpdate:function(){if(this===this.root){this._updateSelectionSuspendCount++;}else{this.root._suspendSelectionUpdate();}},_resumeSelectionUpdate:function(){if(this===this.root){if(this._updateSelectionSuspendCount>0){if(!(--this._updateSelectionSuspendCount)){if(this._selectionNeedsUpdate){this.updateSelections();}}}}else{this._resumeSelectionUpdate();}},updateSelections:function(){if(this===this.root){if(this._inUpdateSelections){return;}
if(this._updateSelectionSuspendCount){this._selectionNeedsUpdate=true;return;}
pvc.removeTipsyLegends();this._inUpdateSelections=true;try{var action=this.options.selectionChangedAction;if(action){var selections=this.data.selectedDatums();action.call(null,selections);}
this.basePanel._renderInteractive();}finally{this._inUpdateSelections=false;this._selectionNeedsUpdate=false;}}else{this.root.updateSelections();}},_onUserSelection:function(datums){if(!datums||!datums.length){return datums;}
if(this===this.root){var action=this.options.userSelectionAction;if(action){return action.call(null,datums)||datums;}
return datums;}
return this.root._onUserSelection(datums);},isOrientationVertical:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.vertical;},isOrientationHorizontal:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.horizontal;},dispose:function(){if(!this._disposed){this._disposed=true;}},defaults:{width:400,height:300,orientation:'vertical',ignoreNulls:true,crosstabMode:true,isMultiValued:false,seriesInRows:false,groupedLabelSep:undefined,animate:true,titlePosition:"top",titleAlign:"center",legend:false,legendPosition:"bottom",secondAxis:false,secondAxisIdx:-1,showTooltips:true,v1StyleTooltipFormat:function(s,c,v,datum){return s+", "+c+":  "+this.chart.options.valueFormat(v)+
(datum&&datum.percent?(" ("+datum.percent.label+")"):"");},tipsySettings:{gravity:"s",delayIn:200,delayOut:80,offset:2,opacity:0.8,html:true,fade:false,corners:false,followMouse:false},valueFormat:def.scope(function(){var pvFormat=pv.Format.number().fractionDigits(0,2);return function(d){return pvFormat.format(d);};}),percentValueFormat:def.scope(function(){var pvFormat=pv.Format.number().fractionDigits(0,1);return function(d){return pvFormat.format(d*100)+"%";};}),clickable:false,doubleClickMaxDelay:300,hoverable:false,selectable:false,ctrlSelectMode:true,clearSelectionMode:'emptySpaceClick',rubberBandFill:'rgba(203, 239, 163, 0.6)',rubberBandLine:'#86fe00',compatVersion:Infinity}});pvc.BasePanel=pvc.Abstract.extend({chart:null,parent:null,_children:null,type:pv.Panel,height:null,width:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:false,isTopRoot:false,root:null,topRoot:null,_coreInfo:null,_layoutInfo:null,data:null,dataPartValue:null,_colorAxis:null,_isAnimating:0,_isRubberBandSelecting:false,_ignoreClicks:0,_v1DimRoleName:{'series':'series','category':'category','value':'value'},_sceneTypeExtensions:null,constructor:function(chart,parent,options){if(options){if(options.scenes){this._sceneTypeExtensions=options.scenes;delete options.scenes;}
if(options.colorAxis){this._colorAxis=options.colorAxis;delete options.colorAxis;}}
$.extend(this,options);this.chart=chart;this.position={};this.margins=new pvc.Sides(options&&options.margins);this.paddings=new pvc.Sides(options&&options.paddings);this.size=new pvc.Size(options&&options.size);this.sizeMax=new pvc.Size(options&&options.sizeMax);if(!parent){this.parent=null;this.root=this;this.topRoot=this;this.isRoot=true;this.isTopRoot=true;this.data=this.chart.data;}else{this.parent=parent;this.root=parent.root;this.topRoot=parent.topRoot;this.isTopRoot=false;this.isRoot=(parent.chart!==chart);this.data=parent.data;if(this.isRoot){this.position.left=chart.left;this.position.top=chart.top;}
parent._addChild(this);}
if(this.isRoot){this.anchor=null;this.align=null;this.alignTo=null;this.offset=null;}else{this.align=pvc.parseAlign(this.anchor,this.align);var alignTo=this.alignTo;var side=this.anchor;if(alignTo!=null&&alignTo!==''&&(side==='left'||side==='right')){if(alignTo!=='page-middle'){if(!isNaN(+alignTo.charAt(0))){alignTo=pvc.PercentValue.parse(alignTo);}else{alignTo=pvc.parseAlign(side,alignTo);}}}else{alignTo=this.align;}
this.alignTo=alignTo;this.offset=new pvc.Offset(this.offset);}},compatVersion:function(){return this.chart.compatVersion();},defaultColorAxis:function(){return this._colorAxis||this.chart.axes.color;},defaultVisibleBulletGroupScene:function(){var colorAxis=this.defaultColorAxis();if(colorAxis&&colorAxis.isVisible){return colorAxis.legendBulletGroupScene;}
return null;},_addChild:function(child){child.parent===this||def.assert("Child has a != parent.");(this._children||(this._children=[])).push(child);},layout:function(availableSize,keyArgs){if(!this._layoutInfo||def.get(keyArgs,'force',false)){var referenceSize=def.get(keyArgs,'referenceSize');if(!referenceSize&&availableSize){referenceSize=def.copyOwn(availableSize);}
var desiredSize=this.size.resolve(referenceSize);var sizeMax=this.sizeMax.resolve(referenceSize);if(!availableSize){if(desiredSize.width==null||desiredSize.height==null){throw def.error.operationInvalid("Panel layout without width or height set.");}
availableSize=def.copyOwn(desiredSize);}
if(!referenceSize&&availableSize){referenceSize=def.copyOwn(availableSize);}
if(sizeMax.width!=null&&availableSize.width>sizeMax.width){availableSize.width=sizeMax.width;}
if(sizeMax.height!=null&&availableSize.height>sizeMax.height){availableSize.height=sizeMax.height;}
var margins=(def.get(keyArgs,'margins')||this.margins).resolve(referenceSize);var paddings=(def.get(keyArgs,'paddings')||this.paddings).resolve(referenceSize);var spaceWidth=margins.width+paddings.width;var spaceHeight=margins.height+paddings.height;var availableClientSize=new pvc.Size(Math.max(availableSize.width-spaceWidth,0),Math.max(availableSize.height-spaceHeight,0));var desiredClientSize=def.copyOwn(desiredSize);if(desiredClientSize.width!=null){desiredClientSize.width=Math.max(desiredClientSize.width-spaceWidth,0);}
if(desiredClientSize.height!=null){desiredClientSize.height=Math.max(desiredClientSize.height-spaceHeight,0);}
var prevLayoutInfo=this._layoutInfo||null;var canChange=def.get(keyArgs,'canChange',true);var layoutInfo=this._layoutInfo={canChange:canChange,referenceSize:referenceSize,margins:margins,paddings:paddings,desiredClientSize:desiredClientSize,clientSize:availableClientSize,pageClientSize:prevLayoutInfo?prevLayoutInfo.pageClientSize:availableClientSize.clone(),previous:prevLayoutInfo};if(prevLayoutInfo){delete prevLayoutInfo.previous;delete prevLayoutInfo.pageClientSize;}
var clientSize=this._calcLayout(layoutInfo);var size;if(!clientSize){size=availableSize;clientSize=availableClientSize;}else{layoutInfo.clientSize=clientSize;size={width:clientSize.width+spaceWidth,height:clientSize.height+spaceHeight};}
this.isVisible=(clientSize.width>0&&clientSize.height>0);delete layoutInfo.desiredClientSize;this.width=size.width;this.height=size.height;if(!canChange&&prevLayoutInfo){delete layoutInfo.previous;}}},_calcLayout:function(layoutInfo){if(!this._children){return;}
var aolMap=pvc.BasePanel.orthogonalLength;var aoMap=pvc.BasePanel.relativeAnchor;var altMap=pvc.BasePanel.leftTopAnchor;var aofMap=pvc.Offset.namesSidesToOffset;var fillChildren=[];var sideChildren=[];this._children.forEach(function(child){var a=child.anchor;if(a){if(a==='fill'){fillChildren.push(child);}else{def.hasOwn(aoMap,a)||def.fail.operationInvalid("Unknown anchor value '{0}'",[a]);sideChildren.push(child);}}});var clientSize=def.copyOwn(layoutInfo.clientSize);var childKeyArgs={force:true,referenceSize:clientSize};var margins,remSize;doMaxTimes(3,layoutCycle,this);return clientSize;function doMaxTimes(maxTimes,fun,ctx){var index=0;while(maxTimes--){if(fun.call(ctx,maxTimes,index)===false){return true;}
index++;}
return false;}
function layoutCycle(remTimes,iteration){if(pvc.debug>=5){pvc.log("\n[BasePanel] ==== LayoutCycle #"+(iteration+1));}
margins=new pvc.Sides(0);remSize=def.copyOwn(clientSize);var canResize=(remTimes>0);margins=new pvc.Sides(0);remSize=def.copyOwn(clientSize);var index,count,child;index=0;count=sideChildren.length;while(index<count){child=sideChildren[index];if(pvc.debug>=5){pvc.log("[BasePanel] SIDE Child i="+index+" at "+child.anchor);}
if(layoutChild.call(this,child,canResize)){return true;}
index++;}
index=0;count=fillChildren.length;while(index<count){child=fillChildren[index];if(pvc.debug>=5){pvc.log("[BasePanel] FILL Child i="+index);}
if(layoutChild.call(this,child,canResize)){return true;}
index++;}
return false;}
function layoutChild(child,canResize){var resized=false;var paddings;childKeyArgs.canChange=canResize;doMaxTimes(3,function(remTimes,iteration){if(pvc.debug>=5){pvc.log("[BasePanel]   Attempt #"+(iteration+1));}
childKeyArgs.paddings=paddings;childKeyArgs.canChange=remTimes>0;child.layout(new pvc.Size(remSize),childKeyArgs);if(child.isVisible){resized=checkChildResize.call(this,child,canResize);if(resized){return false;}
paddings=child._layoutInfo.requestPaddings;if(paddings){if(remTimes>0){paddings=new pvc.Sides(paddings);if(pvc.debug>=5){pvc.log("[BasePanel] Child requested paddings change: "+JSON.stringify(paddings));}
return true;}
if(pvc.debug>=2){pvc.log("[Warning] [BasePanel] FILL Child requests paddings change but no more iterations possible.");}}
positionChild.call(this,child);if(child.anchor!=='fill'){updateSide.call(this,child);}}
return false;},this);return resized;}
function checkChildResize(child,canResize){var resized=false;var addWidth=child.width-remSize.width;if(addWidth>0){if(!canResize){if(pvc.debug>=2){pvc.log("[Warning] Layout iterations limit reached.");}}else{resized=true;remSize.width+=addWidth;clientSize.width+=addWidth;}}
var addHeight=child.height-remSize.height;if(addHeight>0){if(!canResize){if(pvc.debug>=2){pvc.log("[Warning] Layout iterations limit reached.");}}else{resized=true;remSize.height+=addHeight;clientSize.height+=addHeight;}}
return resized;}
function positionChild(child){var side=child.anchor;var align=child.align;var alignTo=child.alignTo;var sidePos;if(side==='fill'){side='left';sidePos=margins.left+remSize.width/2-(child.width/2);align=alignTo='middle';}else{sidePos=margins[side];}
var sideo,sideOPosChildOffset;switch(align){case'top':case'bottom':case'left':case'right':sideo=align;sideOPosChildOffset=0;break;case'center':case'middle':sideo=altMap[aoMap[side]];sideOPosChildOffset=-child[aolMap[sideo]]/2;break;}
var sideOPosParentOffset;var sideOTo;switch(alignTo){case'top':case'bottom':case'left':case'right':sideOTo=alignTo;sideOPosParentOffset=(sideOTo!==sideo)?remSize[aolMap[sideo]]:0;break;case'center':case'middle':sideOTo=altMap[aoMap[side]];sideOPosParentOffset=remSize[aolMap[sideo]]/2;break;case'page-center':case'page-middle':sideOTo=altMap[aoMap[side]];var lenProp=aolMap[sideo];var pageLen=Math.min(remSize[lenProp],layoutInfo.pageClientSize[lenProp]);sideOPosParentOffset=pageLen/2;break;}
var sideOPos=margins[sideOTo]+sideOPosParentOffset+sideOPosChildOffset;var resolvedOffset=child.offset.resolve(remSize);if(resolvedOffset){sidePos+=resolvedOffset[aofMap[side]]||0;sideOPos+=resolvedOffset[aofMap[sideo]]||0;}
if(child.inBounds){if(sidePos<0){sidePos=0;}
if(sideOPos<0){sideOPos=0;}}
child.setPosition(def.set({},side,sidePos,sideo,sideOPos));}
function updateSide(child){var side=child.anchor;var sideol=aolMap[side];var olen=child[sideol];margins[side]+=olen;remSize[sideol]-=olen;}},_create:function(force){if(!this.pvPanel||force){this.pvPanel=null;delete this._coreInfo;this.layout();if(!this.isVisible){return;}
if(this.isRoot){this._creating();}
var margins=this._layoutInfo.margins;var paddings=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=new pv.Panel().canvas(this.chart.options.canvas);if(margins.width>0||margins.height>0){this.pvPanel.width(this.width).height(this.height);this.pvPanel=this.pvPanel.add(pv.Panel);}}else{this.pvPanel=this.parent.pvPanel.add(this.type);}
var pvBorderPanel=this.pvPanel;var width=this.width-margins.width;var height=this.height-margins.height;pvBorderPanel.width(width).height(height);var hasPositions={};def.eachOwn(this.position,function(v,side){pvBorderPanel[side](v+margins[side]);hasPositions[this.anchorLength(side)]=true;},this);if(!hasPositions.width&&margins.left>0){pvBorderPanel.left(margins.left);}
if(!hasPositions.height&&margins.top>0){pvBorderPanel.top(margins.top);}
if(paddings.width>0||paddings.height>0){this.pvPanel=pvBorderPanel.add(pv.Panel).width(width-paddings.width).height(height-paddings.height).left(paddings.left).top(paddings.top);}
pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=this.pvPanel;this.pvPanel.paddingPanel=this.pvPanel;this.pvPanel.borderPanel=pvBorderPanel;if(pvc.debug>=15){this.pvPanel.strokeStyle('lightgreen').lineWidth(1).strokeDasharray('- ');pvBorderPanel.strokeStyle('lightblue').lineWidth(1).strokeDasharray(null);}
this._createCore(this._layoutInfo);if(this.isTopRoot&&this.chart.options.selectable&&pv.renderer()!=='batik'){this._initRubberBand();}
this.applyExtensions();}},_creating:function(){if(this._children){this._children.forEach(function(child){child._creating();});}},_createCore:function(layoutInfo){if(this._children){this._children.forEach(function(child){child._create();});}},render:function(keyArgs){if(!this.isTopRoot){return this.topRoot.render(keyArgs);}
this._create(def.get(keyArgs,'recreate',false));if(!this.isVisible){return;}
var chart=this.chart,options=chart.options;if(options.renderCallback){options.renderCallback.call(chart);}
var pvPanel=this.pvRootPanel;this._isAnimating=options.animate&&!def.get(keyArgs,'bypassAnimation',false)?1:0;try{pvPanel.render();if(this._isAnimating){this._isAnimating=2;var me=this;pvPanel.transition().duration(2000).ease("cubic-in-out").start(function(){me._isAnimating=0;me._onRenderEnd(true);});}else{this._onRenderEnd(false);}}finally{this._isAnimating=0;}},_onRenderEnd:function(animated){if(this._children){this._children.forEach(function(child){child._onRenderEnd(animated);});}},_renderInteractive:function(){if(this.isVisible){var marks=this._getSignums();if(marks&&marks.length){marks.forEach(function(mark){mark.render();});}else if(!this._children){this.pvPanel.render();}
if(this._children){this._children.forEach(function(child){child._renderInteractive();});}}},_getSignums:function(){return null;},animate:function(start,end){return(this.topRoot._isAnimating===1)?start:end;},isAnimatingStart:function(){return(this.topRoot._isAnimating===1);},isAnimating:function(){return(this.topRoot._isAnimating>0);},applyExtensions:function(){if(this.isRoot){this.extend(this.pvPanel,"base_");}},extend:function(mark,prefix,keyArgs){this.chart.extend(mark,prefix,keyArgs);},_extendSceneType:function(typeKey,type,names){var typeExts=def.get(this._sceneTypeExtensions,typeKey);if(typeExts){pvc.extendType(type,typeExts,names);}},_getExtension:function(extPoint){return this.chart._getExtension.apply(this.chart,arguments);},_getConstantExtension:function(extPoint){var value=this.chart._getExtension.apply(this.chart,arguments);if(!def.fun.is(value)){return value;}},setPosition:function(position){for(var side in position){if(def.hasOwn(pvc.Sides.namesSet,side)){var s=position[side];if(s===null){delete this.position[side];}else{s=+s;if(!isNaN(s)&&isFinite(s)){this.position[side]=s;}}}}},createAnchoredSize:function(anchorLength,size){if(this.isAnchorTopOrBottom()){return new pvc.Size(size.width,Math.min(size.height,anchorLength));}
return new pvc.Size(Math.min(size.width,anchorLength),size.height);},getPvPanel:function(layer){var mainPvPanel=this.pvPanel;if(!layer){return mainPvPanel;}
if(!this.parent){throw def.error.operationInvalid("Layers are not possible in a root panel.");}
if(!mainPvPanel){throw def.error.operationInvalid("Cannot access layer panels without having created the main panel.");}
var pvPanel=null;if(!this._layers){this._layers={};}else{pvPanel=this._layers[layer];}
if(!pvPanel){var pvParentPanel=this.parent.pvPanel;var pvBorderPanel=pvPanel=pvParentPanel.borderPanel.add(this.type).extend(mainPvPanel.borderPanel);if(mainPvPanel!==mainPvPanel.borderPanel){pvPanel=pvBorderPanel.add(pv.Panel).extend(mainPvPanel);}
pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=pvPanel;pvPanel.paddingPanel=pvPanel;pvPanel.borderPanel=pvBorderPanel;this.initLayerPanel(pvPanel,layer);this._layers[layer]=pvPanel;}
return pvPanel;},initLayerPanel:function(pvPanel,layer){},_getV1DimName:function(v1Dim){var dimNames=this._v1DimName||(this._v1DimNameCache={});var dimName=dimNames[v1Dim];if(dimName==null){var role=this.chart.visualRoles(this._v1DimRoleName[v1Dim],{assertExists:false});dimName=role?role.firstDimensionName():'';dimNames[v1Dim]=dimName;}
return dimName;},_createContext:function(mark,ev){return new pvc.visual.Context(this,mark,ev);},_updateContext:function(context,mark,ev){visualContext_update.call(context,mark,ev);},_getContext:function(mark,ev){if(!this._context){this._context=this._createContext(mark,ev);}else{this._updateContext(this._context,mark,ev);}
return this._context;},_isTooltipEnabled:function(){return!this.isRubberBandSelecting()&&!this.isAnimating();},_addPropTooltip:function(mark,keyArgs){var myself=this,tipsyEvent=def.get(keyArgs,'tipsyEvent'),options=this.chart.options,tipsySettings=Object.create(options.tipsySettings),buildTooltip;tipsySettings.isEnabled=this._isTooltipEnabled.bind(this);if(!tipsyEvent){tipsyEvent='mouseover';}
var tooltipFormat=options.tooltipFormat;if(!tooltipFormat){buildTooltip=this._buildTooltip;}else{buildTooltip=function(context){return tooltipFormat.call(context,context.getV1Series(),context.getV1Category(),context.getV1Value()||'',context.scene.datum);};}
mark.localProperty("tooltip").tooltip(function(){var tooltip,context=myself._createContext(mark,null);if(!context.scene.atoms){return"";}
return function(){if(tooltip==null){tooltip=buildTooltip.call(myself,context);context=null;}
return tooltip;};}).title(function(){return'';}).event(tipsyEvent,pv.Behavior.tipsy(tipsySettings||options.tipsySettings));},_requirePointEvent:function(radius){if(!this.isTopRoot){return this.topRoot._requirePointEvent(radius);}
if(!this._attachedPointEvent){this.pvPanel.events('all').event("mousemove",pv.Behavior.point(radius||20));this._attachedPointEvent=true;}},_buildTooltip:function(context){var chart=this.chart,data=chart.data,visibleKeyArgs={visible:true},scene=context.scene,group=scene.group,isMultiDatumGroup=group&&group._datums.length>1;if(!isMultiDatumGroup&&scene.datum.isNull){return"";}
var tooltip=[],playingPercentMap=context.panel.stacked===false?null:data.type.getPlayingPercentVisualRoleDimensionMap(),commonAtoms=isMultiDatumGroup?group.atoms:scene.datum.atoms;function addDim(escapedDimLabel,label){tooltip.push('<b>'+escapedDimLabel+"</b>: "+(def.html.escape(label)||" - ")+'<br/>');}
function calcPercent(atom,dimName){var pct;if(group){pct=group.dimensions(dimName).percentOverParent(visibleKeyArgs);}else{pct=data.dimensions(dimName).percent(atom.value);}
return chart.options.percentValueFormat.call(null,pct);}
def.each(commonAtoms,function(atom,dimName){var dimType=atom.dimension.type;if(!dimType.isHidden){if(!isMultiDatumGroup||atom.value!=null){var valueLabel=atom.label;if(playingPercentMap&&playingPercentMap.has(dimName)){valueLabel+=" ("+calcPercent(atom,dimName)+")";}
addDim(def.html.escape(atom.dimension.type.label),valueLabel);}}});if(isMultiDatumGroup){tooltip.push('<hr />');tooltip.push("<b>#</b>: "+group._datums.length+'<br/>');group.freeDimensionNames().forEach(function(dimName){var dim=group.dimensions(dimName);if(!dim.type.isHidden){var dimLabel=def.html.escape(dim.type.label),valueLabel;if(dim.type.valueType===Number){valueLabel=dim.format(dim.sum(visibleKeyArgs));if(playingPercentMap&&playingPercentMap.has(dimName)){valueLabel+=" ("+calcPercent(null,dimName)+")";}
dimLabel="&sum; "+dimLabel;}else{valueLabel=dim.atoms(visibleKeyArgs).map(function(atom){return atom.label||"- ";}).join(", ");}
addDim(dimLabel,valueLabel);}});}
return'<div style="text-align: left;">'+tooltip.join('\n')+'</div>';},_addPropClick:function(mark){var myself=this;function onClick(){var ev=arguments[arguments.length-1];return myself._handleClick(this,ev);}
mark.cursor("pointer").event("click",onClick);},_addPropDoubleClick:function(mark){var myself=this;function onDoubleClick(){var ev=arguments[arguments.length-1];return myself._handleDoubleClick(this,ev);}
mark.cursor("pointer").event("dblclick",onDoubleClick);},_handleDoubleClick:function(mark,ev){var handler=this.chart.options.doubleClickAction;if(handler){this._ignoreClicks=2;var context=this._getContext(mark,ev);this._onDoubleClick(context);}},_onDoubleClick:function(context){var handler=this.chart.options.doubleClickAction;handler.call(context,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event);},_shouldHandleClick:function(keyArgs){var options=keyArgs||this.chart.options;return options.selectable||(options.clickable&&options.clickAction);},_handleClick:function(mark,ev){if(!this._shouldHandleClick()){return;}
var options=this.chart.options,context;if(!options.doubleClickAction){context=this._getContext(mark,ev);this._handleClickCore(context);}else{var myself=this;context=this._createContext(mark,ev);window.setTimeout(function(){myself._handleClickCore.call(myself,context);},options.doubleClickMaxDelay||300);}},_handleClickCore:function(context){if(this._ignoreClicks){this._ignoreClicks--;}else{this._onClick(context);if(this.chart.options.selectable&&context.scene.datum){this._onSelect(context);}}},_onClick:function(context){var handler=this.chart.options.clickAction;if(handler){handler.call(context,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event);}},_onSelect:function(context){var datums=context.scene.datums().array(),chart=this.chart;datums=this._onUserSelection(datums);if(datums&&datums.length){var changed;if(chart.options.ctrlSelectMode&&!context.event.ctrlKey){var alreadySelectedById=def.query(datums).where(function(datum){return datum.isSelected;}).object({name:function(datum){return datum.id;}});changed=chart.data.owner.clearSelected(function(datum){return!def.hasOwn(alreadySelectedById,datum.id);});changed|=pvc.data.Data.setSelected(datums,true);}else{changed=pvc.data.Data.toggleSelected(datums);}
if(changed){this._onSelectionChanged();}}},_onUserSelection:function(datums){return this.chart._onUserSelection(datums);},_onSelectionChanged:function(){this.chart.updateSelections();},isRubberBandSelecting:function(){return this.topRoot._isRubberBandSelecting;},_initRubberBand:function(){var myself=this,chart=this.chart,options=chart.options,data=chart.data;var dMin=2;this._isRubberBandSelecting=false;var rubberPvParentPanel=this.pvRootPanel||this.pvPanel.paddingPanel,toScreen,rb;var selectBar=this.selectBar=rubberPvParentPanel.add(pv.Bar).visible(function(){return!!rb;}).left(function(){return rb.x;}).top(function(){return rb.y;}).width(function(){return rb.dx;}).height(function(){return rb.dy;}).fillStyle(options.rubberBandFill).strokeStyle(options.rubberBandLine);if(!this._getExtension('base','fillStyle')){rubberPvParentPanel.fillStyle(pvc.invisibleFill);}
var selectionEndedDate;rubberPvParentPanel.event('mousedown',pv.Behavior.selector(false)).event('select',function(){if(!rb){if(myself.isAnimating()){return;}
var rb1=this.selectionRect;if(Math.sqrt(rb1.dx*rb1.dx+rb1.dy*rb1.dy)<=dMin){return;}
rb=rb1;myself._isRubberBandSelecting=true;if(!toScreen){toScreen=rubberPvParentPanel.toScreenTransform();}
myself.rubberBand=rb.clone().apply(toScreen);}else{rb=this.selectionRect;}
selectBar.render();}).event('selectend',function(){if(rb){var ev=arguments[arguments.length-1];if(!toScreen){toScreen=rubberPvParentPanel.toScreenTransform();}
myself.rubberBand=rb=this.selectionRect.clone().apply(toScreen);rb=null;myself._isRubberBandSelecting=false;selectBar.render();myself._dispatchRubberBandSelectionTop(ev);selectionEndedDate=new Date();myself.rubberBand=rb=null;}});if(options.clearSelectionMode==='emptySpaceClick'){rubberPvParentPanel.event("click",function(){if(selectionEndedDate){var timeSpan=new Date()-selectionEndedDate;if(timeSpan<300){selectionEndedDate=null;return;}}
if(data.owner.clearSelected()){myself._onSelectionChanged();}});}},_dispatchRubberBandSelectionTop:function(ev){if(pvc.debug>=3){pvc.log('rubberBand '+JSON.stringify(this.rubberBand));}
var chart=this.chart;chart._suspendSelectionUpdate();try{if(!ev.ctrlKey&&chart.options.ctrlSelectMode){chart.data.owner.clearSelected();}
chart.useTextMeasureCache(this._dispatchRubberBandSelection,this);}finally{chart._resumeSelectionUpdate();}},_dispatchRubberBandSelection:function(ev){var datumsByKey={},keyArgs={toggle:false};if(this._detectDatumsUnderRubberBand(datumsByKey,this.rubberBand,keyArgs)){var selectedDatums=def.own(datumsByKey);selectedDatums=this._onUserSelection(selectedDatums);var changed;if(keyArgs.toggle){pvc.data.Data.toggleSelected(selectedDatums);changed=true;}else{changed=pvc.data.Data.setSelected(selectedDatums,true);}
if(changed){this._onSelectionChanged();}}
if(this._children){this._children.forEach(function(child){child.rubberBand=this.rubberBand;child._dispatchRubberBandSelection(child);},this);}},_detectDatumsUnderRubberBand:function(datumsByKey,rb,keyArgs){var any=false;if(this.isVisible){var selectableMarks=this._getSignums();if(selectableMarks){selectableMarks.forEach(function(mark){this._forEachMarkDatumUnderRubberBand(mark,function(datum){datumsByKey[datum.key]=datum;any=true;},this,rb);},this);}}
return any;},_forEachMarkDatumUnderRubberBand:function(mark,fun,ctx,rb){if(!rb){rb=this.rubberBand;}
function processShape(shape,instance){if(shape.intersectsRect(rb)){var group=instance.group;var datums=group?group._datums:def.array.as(instance.datum);if(datums){datums.forEach(function(datum){if(!datum.isNull){if(pvc.debug>=10){pvc.log(datum.key+": "+JSON.stringify(shape)+" mark type: "+mark.type);}
fun.call(ctx,datum);}});}}}
var selectionMode=def.get(mark,'rubberBandSelectionMode','partial');var shapeMethod=(selectionMode==='center')?'getInstanceCenterPoint':'getInstanceShape';if(mark.type==='area'||mark.type==='line'){var instancePrev;mark.eachSignumInstance(function(instance,toScreen){if(!instance.visible||instance.isBreak||(instance.datum&&instance.datum.isNull)){instancePrev=null;}else{if(instancePrev){var shape=mark[shapeMethod](instancePrev,instance).apply(toScreen);processShape(shape,instancePrev);}
instancePrev=instance;}},this);}else{mark.eachSignumInstance(function(instance,toScreen){if(!instance.isBreak&&instance.visible){var shape=mark[shapeMethod](instance).apply(toScreen);processShape(shape,instance);}},this);}},isAnchorTopOrBottom:function(anchor){if(!anchor){anchor=this.anchor;}
return anchor==="top"||anchor==="bottom";},anchorOrtho:function(anchor){if(!anchor){anchor=this.anchor;}
return pvc.BasePanel.relativeAnchor[anchor];},anchorOrthoMirror:function(anchor){if(!anchor){anchor=this.anchor;}
return pvc.BasePanel.relativeAnchorMirror[anchor];},anchorOpposite:function(anchor){if(!anchor){anchor=this.anchor;}
return pvc.BasePanel.oppositeAnchor[anchor];},anchorLength:function(anchor){if(!anchor){anchor=this.anchor;}
return pvc.BasePanel.parallelLength[anchor];},anchorOrthoLength:function(anchor){if(!anchor){anchor=this.anchor;}
return pvc.BasePanel.orthogonalLength[anchor];},isOrientationVertical:function(orientation){return this.chart.isOrientationVertical(orientation);},isOrientationHorizontal:function(orientation){return this.chart.isOrientationHorizontal(orientation);}},{relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}});pvc.MultiChartPanel=pvc.BasePanel.extend({anchor:'fill',_calcLayout:function(layoutInfo){var chart=this.chart;var multiChartRole=chart.visualRoles('multiChart');if(!multiChartRole.grouping){return;}
var clientSize=layoutInfo.clientSize;var options=chart.options;var multiChartMax=Number(options.multiChartMax);if(isNaN(multiChartMax)||multiChartMax<1){multiChartMax=Infinity;}
var data=multiChartRole.flatten(chart.data,{visible:true});var leafCount=data._children.length;var count=Math.min(leafCount,multiChartMax);if(count===0){return;}
var multiChartMaxColumns=+options.multiChartMaxColumns;if(isNaN(multiChartMaxColumns)||multiChartMax<1){multiChartMaxColumns=3;}
var colCount=Math.min(count,multiChartMaxColumns);colCount>=1&&isFinite(colCount)||def.assert("Must be at least 1 and finite");var rowCount=Math.ceil(count/colCount);rowCount>=1||def.assert("Must be at least 1");var width=pvc.PercentValue.parse(options.multiChartWidth);if(width==null){var colsInAvailableWidth=isFinite(multiChartMaxColumns)?colCount:3;width=new pvc.PercentValue(1/colsInAvailableWidth);}
width=pvc.PercentValue.resolve(width,clientSize.width);var height;if((rowCount===1&&def.get(options,'multiChartSingleRowFillsHeight',true))||(colCount===1&&def.get(options,'multiChartSingleColFillsHeight',true))){var prevLayoutInfo=layoutInfo.previous;if(!prevLayoutInfo){height=clientSize.height;}else{height=prevLayoutInfo.height;}}else{var ar=+options.multiChartAspectRatio;if(isNaN(ar)||ar<=0){ar=this._calulateDefaultAspectRatio(width);}
height=width/ar;var maxHeight=+def.get(options,'multiChartMaxHeight');if(!isNaN(maxHeight)&&maxHeight>0){height=Math.min(height,maxHeight);}}
def.set(layoutInfo,'data',data,'count',count,'width',width,'height',height,'colCount',colCount,'rowCount',rowCount);return{width:width*colCount,height:Math.max(clientSize.height,height*rowCount)};},_calulateDefaultAspectRatio:function(totalWidth){if(this.chart instanceof pvc.PieChart){return 10/7;}
return 5/4;},_createCore:function(li){if(!li.data){return;}
var chart=this.chart;var options=chart.options;var smallChartMargins=options.multiChartMargins||new pvc.Sides(new pvc.PercentValue(0.02));var ChildClass=chart.constructor;var lastColIndex=li.colCount-1;var lastRowIndex=li.rowCount-1;for(var index=0;index<li.count;index++){var childData=li.data._children[index];var colIndex=(index%li.colCount);var rowIndex=Math.floor(index/li.colCount);var margins={};if(colIndex>0){margins.left=smallChartMargins.left;}
if(colIndex<lastColIndex){margins.right=smallChartMargins.right;}
if(rowIndex>0){margins.top=smallChartMargins.top;}
if(rowIndex<lastRowIndex){margins.bottom=smallChartMargins.bottom;}
var childOptions=def.create(options,{parent:chart,title:childData.absLabel,legend:false,data:childData,width:li.width,height:li.height,left:colIndex*li.width,top:rowIndex*li.height,margins:margins,extensionPoints:{base_fillStyle:null}});var childChart=new ChildClass(childOptions);childChart._preRender();}
this.base(li);}});pvc.TitlePanelAbstract=pvc.BasePanel.extend({pvLabel:null,anchor:'top',title:null,titleSize:undefined,font:"12px sans-serif",defaultPaddings:2,constructor:function(chart,parent,options){if(!options){options={};}
var anchor=options.anchor||this.anchor;if(options.size==null){var size=options.titleSize;if(size!=null){options.size=new pvc.Size().setSize(size,{singleProp:this.anchorOrthoLength(anchor)});}}
if(options.sizeMax==null){var sizeMax=options.titleSizeMax;if(sizeMax!=null){options.sizeMax=new pvc.Size().setSize(sizeMax,{singleProp:this.anchorOrthoLength(anchor)});}}
if(options.paddings==null){options.paddings=this.defaultPaddings;}
this.base(chart,parent,options);if(options.font===undefined){var extensionFont=this._getFontExtension();if(typeof extensionFont==='string'){this.font=extensionFont;}}},_getFontExtension:function(){return this._getExtension('titleLabel','font');},_calcLayout:function(layoutInfo){var requestSize=new pvc.Size();var a=this.anchor;var a_width=this.anchorLength(a);var a_height=this.anchorOrthoLength(a);var desiredWidth=layoutInfo.desiredClientSize[a_width];if(desiredWidth==null){desiredWidth=pvc.text.getTextLength(this.title,this.font)+2;}
var lines;var clientWidth=layoutInfo.clientSize[a_width];if(desiredWidth>clientWidth){desiredWidth=clientWidth;lines=pvc.text.justify(this.title,desiredWidth,this.font);}else{lines=this.title?[this.title]:[];}
var lineHeight=pvc.text.getTextHeight("m",this.font);var realHeight=lines.length*lineHeight;var desiredHeight=layoutInfo.desiredClientSize[a_height];if(desiredHeight==null){desiredHeight=realHeight;}
var availableHeight=layoutInfo.clientSize[a_height];if(desiredHeight>availableHeight){var maxLineCount=Math.max(1,Math.floor(availableHeight/lineHeight));if(lines.length>maxLineCount){var firstCroppedLine=lines[maxLineCount];lines.length=maxLineCount;realHeight=desiredHeight=maxLineCount*lineHeight;var lastLine=lines[maxLineCount-1]+" "+firstCroppedLine;lines[maxLineCount-1]=pvc.text.trimToWidthB(desiredWidth,lastLine,this.font,"..");}}
layoutInfo.lines=lines;layoutInfo.topOffset=(desiredHeight-realHeight)/2;layoutInfo.lineSize={width:desiredWidth,height:lineHeight};layoutInfo.a_width=a_width;layoutInfo.a_height=a_height;requestSize[a_width]=desiredWidth;requestSize[a_height]=desiredHeight;return requestSize;},_createCore:function(layoutInfo){var rotationByAnchor={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2};var linePanel=this.pvPanel.add(pv.Panel).data(layoutInfo.lines)
[pvc.BasePanel.leftTopAnchor[this.anchor]](function(){return layoutInfo.topOffset+this.index*layoutInfo.lineSize.height;})
[this.anchorOrtho(this.anchor)](0)
[layoutInfo.a_height](layoutInfo.lineSize.height)
[layoutInfo.a_width](layoutInfo.lineSize.width);var textAlign=pvc.BasePanel.horizontalAlign[this.align];this.pvLabel=linePanel.add(pv.Label).text(function(line){return line;}).font(this.font).textAlign(textAlign).textBaseline('middle').left(function(){return this.parent.width()/2;}).bottom(function(){return this.parent.height()/2;}).textAngle(rotationByAnchor[this.anchor]);if(textAlign!=='center'){if(this.isAnchorTopOrBottom()){this.pvLabel.left(null)
[textAlign](0);}else if(this.anchor=="right"){if(textAlign=="left"){this.pvLabel.bottom(null).top(0);}else{this.pvLabel.bottom(0);}}else if(this.anchor=="left"){if(textAlign=="right"){this.pvLabel.bottom(null).top(0);}else{this.pvLabel.bottom(0);}}}},applyExtensions:function(){this.extend(this.pvPanel,'title_');this.extend(this.pvLabel,'titleLabel_');}});pvc.TitlePanel=pvc.TitlePanelAbstract.extend({font:"14px sans-serif",defaultPaddings:4,constructor:function(chart,parent,options){if(!options){options={};}
var isV1Compat=chart.options.compatVersion<=1;if(isV1Compat){var size=options.titleSize;if(size==null){options.titleSize=25;}}
this.base(chart,parent,options);}});pvc.LegendPanel=pvc.BasePanel.extend({pvRule:null,pvDot:null,pvLabel:null,anchor:'bottom',pvLegendPanel:null,textMargin:6,padding:2.5,markerSize:15,font:'10px sans-serif',constructor:function(chart,parent,options){if(!options){options={};}
var isV1Compat=chart.compatVersion()<=1;if(isV1Compat){var anchor=options.anchor||this.anchor;var isVertical=anchor!=='top'&&anchor!=='bottom';if(options.padding!==undefined){options.padding=Math.max(0,(options.padding-16)/2);}else{options.padding=4;}
var minMarginX=Math.max(def.get(options,'minMarginX',8),0);var minMarginY;if(isVertical&&(options.align!=='middle'&&options.align!=='bottom')){minMarginY=Math.max(def.get(options,'minMarginY',20)-20,0);}else{minMarginY=0;}
options.paddings={left:minMarginX,top:minMarginY};}
this.base(chart,parent,options);},_calcLayout:function(layoutInfo){return this._getBulletRootScene().layout(layoutInfo);},_createCore:function(layoutInfo){var myself=this,clientSize=layoutInfo.clientSize,rootScene=this._getBulletRootScene(),padding=rootScene.vars.padding,contentSize=rootScene.vars.size,sceneColorProp=function(scene){return scene.color;};var isHorizontal=this.isAnchorTopOrBottom();var a_top=isHorizontal?'top':'left';var a_bottom=this.anchorOpposite(a_top);var a_width=this.anchorLength(a_top);var a_height=this.anchorOrthoLength(a_top);var a_center=isHorizontal?'center':'middle';var a_left=isHorizontal?'left':'top';var a_right=this.anchorOpposite(a_left);var leftOffset=0;switch(this.align){case a_right:leftOffset=clientSize[a_width]-contentSize.width;break;case a_center:leftOffset=(clientSize[a_width]-contentSize.width)/2;break;}
this.pvPanel.overflow("hidden");var pvLegendRowPanel=this.pvPanel.add(pv.Panel).data(rootScene.vars.rows)
[a_left](leftOffset)
[a_top](function(){var prevRow=this.sibling();return prevRow?(prevRow[a_top]+prevRow[a_height]+padding[a_height]):0;})
[a_width](function(row){return row.size.width;})
[a_height](function(row){return row.size.height;});this.pvLegendPanel=pvLegendRowPanel.add(pv.Panel).data(function(row){return row.items;}).def("hidden","false").localProperty('group',Object).group(function(itemScene){return itemScene.group;}).lock(a_right,null).lock(a_bottom,null).lock(a_left,function(clientScene){var padding=clientScene.vars.padding;var prevItem=this.sibling();return prevItem?(prevItem[a_left]+prevItem[a_width]+padding[a_width]):0;}).lock('height',function(itemScene){return itemScene.vars.clientSize.height;}).lock(a_top,isHorizontal?function(itemScene){var vars=itemScene.vars;return vars.row.size.height/2-vars.clientSize.height/2;}:0).lock('width',isHorizontal?function(itemScene){return itemScene.vars.clientSize.width;}:function(itemScene){return this.parent.width();}).fillStyle(function(){return this.hidden()=="true"?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)";}).cursor(function(itemScene){return itemScene.isClickable()?"pointer":null;}).event("click",function(itemScene){if(itemScene.isClickable()){return itemScene.click();}});var pvLegendMarkerPanel=this.pvLegendPanel.add(pv.Panel).left(0).top(0).right(null).bottom(null).width(function(itemScene){return itemScene.vars.markerSize;}).height(function(itemScene){return itemScene.vars.clientSize.height;});if(pvc.debug>=20){pvLegendRowPanel.strokeStyle('red');this.pvLegendPanel.strokeStyle('green');pvLegendMarkerPanel.strokeStyle('blue');}
rootScene.childNodes.forEach(function(groupScene){var pvGroupPanel=pvLegendMarkerPanel.add(pv.Panel).visible(function(itemScene){return itemScene.parent===groupScene;});var renderInfo=groupScene.renderer().create(this,pvGroupPanel);groupScene.renderInfo=renderInfo;},this);this.pvLabel=pvLegendMarkerPanel.anchor("right").add(pv.Label).textAlign('left').text(function(itemScene){return itemScene.vars.value.label;}).lock('textMargin',function(itemScene){return itemScene.vars.textMargin-4;}).font(function(itemScene){return itemScene.vars.font;}).textDecoration(function(itemScene){return itemScene.isOn()?"":"line-through";}).intercept('textStyle',labelTextStyleInterceptor,this._getExtension('legendLabel','textStyle'));function labelTextStyleInterceptor(getTextStyle,args){var baseTextStyle=getTextStyle?getTextStyle.apply(this,args):"black";var itemScene=args[0];return itemScene.isOn()?baseTextStyle:pvc.toGrayScale(baseTextStyle,null,undefined,150);}},applyExtensions:function(){this.extend(this.pvPanel,"legendArea_");this.extend(this.pvLegendPanel,"legendPanel_");this._getBulletRootScene().childNodes.forEach(function(groupScene){groupScene.renderer().extendMarks(this,groupScene.renderInfo,groupScene.extensionPrefix);},this);this.extend(this.pvLabel,"legendLabel_");},_getSignums:function(){return[this.pvLegendPanel];},_getBulletRootScene:function(){var rootScene=this._rootScene;if(!rootScene){rootScene=new pvc.visual.legend.BulletRootScene(null,{panel:this,group:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,padding:this.padding});this._rootScene=rootScene;}
return rootScene;}});pvc.TimeseriesAbstract=pvc.BaseChart.extend({allTimeseriesPanel:null,_preRenderContent:function(contentOptions){if(this.options.showAllTimeseries){this.allTimeseriesPanel=new pvc.AllTimeseriesPanel(this,this.basePanel,{anchor:this.options.allTimeseriesPosition,allTimeseriesSize:this.options.allTimeseriesSize});}},defaults:def.create(pvc.BaseChart.prototype.defaults,{showAllTimeseries:true,allTimeseriesPosition:"bottom",allTimeseriesSize:50})});pvc.AllTimeseriesPanel=pvc.BasePanel.extend({pvAllTimeseriesPanel:null,anchor:"bottom",allTimeseriesSize:50,_calcLayout:function(layoutInfo){return this.createAnchoredSize(this.allTimeseriesSize,layoutInfo.clientSize);},applyExtensions:function(){this.base();this.extend(this.pvPanel,"allTimeseries_");}});pvc.CartesianAbstract=pvc.TimeseriesAbstract.extend({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,_mainContentPanel:null,yScale:null,xScale:null,_visibleDataCache:null,constructor:function(options){this.axesPanels={};this.base(options);},_getSeriesRoleSpec:function(){return{isRequired:true,defaultDimensionName:'series*',autoCreateDimension:true};},_initData:function(){if(this._visibleDataCache){delete this._visibleDataCache;}
this.base.apply(this,arguments);},_initAxes:function(hasMultiRole){this.base(hasMultiRole);if(!hasMultiRole||this.parent){this._createAxis('base',0);this._createAxis('ortho',0);if(this.options.secondAxis){this._createAxis('ortho',1);}}},_preRenderContent:function(contentOptions){if(pvc.debug>=3){pvc.log("Prerendering in CartesianAbstract");}
var options=this.options;var axes=this.axes;var baseAxis=axes.base;var orthoAxis=axes.ortho;var ortho2Axis=axes.ortho2;this._gridDockPanel=new pvc.CartesianGridDockingPanel(this,this.basePanel,contentOptions);if(ortho2Axis){this._createAxisPanel(ortho2Axis);}
this._createAxisPanel(baseAxis);this._createAxisPanel(orthoAxis);this._mainContentPanel=this._createMainContentPanel(this._gridDockPanel);this.basePanel.layout();this._setAxisScaleRange(baseAxis);this._setAxisScaleRange(orthoAxis);if(ortho2Axis){this._setAxisScaleRange(ortho2Axis);}},_createAxisCore:function(axisType,axisIndex,dataCells){switch(axisType){case'base':case'ortho':var axis=new pvc.visual.CartesianAxis(this,axisType,axisIndex,dataCells);this.axes[axis.orientedId]=axis;this._createAxisScale(axis);return axis;}
return this.base(axisType,axisIndex,dataCells);},_createAxisPanel:function(axis){if(axis.isVisible){var titlePanel;var title=axis.option('Title');if(!def.empty(title)){titlePanel=new pvc.AxisTitlePanel(this,this._gridDockPanel,{title:title,font:axis.option('TitleFont')||axis.option('Font'),anchor:axis.option('Position'),align:axis.option('TitleAlign'),margins:axis.option('TitleMargins'),paddings:axis.option('TitlePaddings'),titleSize:axis.option('TitleSize'),titleSizeMax:axis.option('TitleSizeMax')});}
var panel=pvc.AxisPanel.create(this,this._gridDockPanel,axis,{useCompositeAxis:axis.option('Composite'),font:axis.option('Font'),anchor:axis.option('Position'),axisSize:axis.option('Size'),axisSizeMax:axis.option('SizeMax'),labelSpacingMin:axis.option('LabelSpacingMin'),tickExponentMin:axis.option('TickExponentMin'),tickExponentMax:axis.option('TickExponentMax'),fullGrid:axis.option('FullGrid'),fullGridCrossesMargin:axis.option('FullGridCrossesMargin'),ruleCrossesMargin:axis.option('RuleCrossesMargin'),zeroLine:axis.option('ZeroLine'),domainRoundMode:axis.option('DomainRoundMode'),desiredTickCount:axis.option('DesiredTickCount'),minorTicks:axis.option('MinorTicks'),clickAction:axis.option('ClickAction'),doubleClickAction:axis.option('DoubleClickAction')});if(titlePanel){titlePanel.panelName=panel.panelName;panel.titlePanel=titlePanel;}
this.axesPanels[axis.id]=panel;this.axesPanels[axis.orientedId]=panel;if(axis.index<=1){this[axis.orientedId+'AxisPanel']=panel;}
return panel;}},_createMainContentPanel:function(parentPanel){throw def.error.notImplemented();},_createAxisScale:function(axis){var isSecondOrtho=axis.index===1&&axis.type==='ortho';var scale;if(isSecondOrtho&&!this.options.secondAxisIndependentScale){scale=this.axes.ortho.scale||def.fail.operationInvalid("First ortho scale must be created first.");}else{scale=this._createScaleByAxis(axis);if(scale.isNull&&pvc.debug>=3){pvc.log(def.format("{0} scale for axis '{1}'- no data",[axis.scaleType,axis.id]));}}
axis.setScale(scale);if(isSecondOrtho){this.secondScale=scale;}else if(!axis.index){this[axis.orientation+'Scale']=scale;}
return scale;},_createScaleByAxis:function(axis){var createScale=this['_create'+axis.scaleType+'ScaleByAxis'];return createScale.call(this,axis);},_createDiscreteScaleByAxis:function(axis){var flatteningMode=null;var baseData=this._getVisibleData(axis.dataCell.dataPartValues,{ignoreNulls:false});var data=axis.role.flatten(baseData,{visible:true,flatteningMode:flatteningMode});var scale=new pv.Scale.ordinal();if(!data.count()){scale.isNull=true;}else{var values=data.children().select(function(child){return child.value;}).array();scale.domain(values);}
return scale;},_createTimeseriesScaleByAxis:function(axis){var extent=this._getVisibleValueExtent(axis);var scale=new pv.Scale.linear();if(!extent){scale.isNull=true;}else{var dMin=extent.min;var dMax=extent.max;if((dMax-dMin)===0){dMax=new Date(dMax.getTime()+3600000);}
scale.domain(dMin,dMax);}
return scale;},_createContinuousScaleByAxis:function(axis){var extent=this._getVisibleValueExtentConstrained(axis);var scale=new pv.Scale.linear();if(!extent){scale.isNull=true;}else{var dMin=extent.min;var dMax=extent.max;var originIsZero=axis.option('OriginIsZero');if(originIsZero&&(dMin*dMax>0)){if(dMin>0){dMin=0;extent.minLocked=true;}else{dMax=0;extent.maxLocked=true;}}
if(dMin===dMax){dMin=dMin!==0?dMin*0.99:originIsZero?0:-0.1;dMax=dMax!==0?dMax*1.01:0.1;}else if(dMin>dMax){var bound=dMin;dMin=dMax;dMax=bound;}
scale.domain(dMin,dMax);}
return scale;},_setAxisScaleRange:function(axis){var info=this._mainContentPanel._layoutInfo;var size=(axis.orientation==='x')?info.clientSize.width:info.clientSize.height;axis.setScaleRange(size);return axis.scale;},_getAxesRoundingPaddings:function(){var axesPaddings={};var axes=this.axes;processAxis(axes.x);processAxis(axes.secondX);processAxis(axes.y);processAxis(axes.secondY);return axesPaddings;function setSide(side,pct){var value=axesPaddings[side];if(value==null||pct>value){axesPaddings[side]=pct;}}
function processAxis(axis){if(axis){var roundingPaddings=axis.getScaleRoundingPaddings();if(roundingPaddings){if(axis.orientation==='x'){setSide('left',roundingPaddings.begin);setSide('right',roundingPaddings.end);}else{setSide('bottom',roundingPaddings.begin);setSide('top',roundingPaddings.end);}}}}},_getVisibleData:function(dataPartValues,keyArgs){var ignoreNulls=def.get(keyArgs,'ignoreNulls',true);if(ignoreNulls){ignoreNulls=!this.options.ignoreNulls;}
var key=ignoreNulls+'|'+(dataPartValues||''),data=def.getOwn(this._visibleDataCache,key);if(!data){data=this._createVisibleData(dataPartValues,ignoreNulls);(this._visibleDataCache||(this._visibleDataCache={}))
[key]=data;}
return data;},_createVisibleData:function(dataPartValues,ignoreNulls){var partData=this.partData(dataPartValues);return this._serRole&&this._serRole.grouping?this._serRole.flatten(partData,{visible:true,isNull:ignoreNulls?false:null}):partData;},_assertSingleContinuousValueRole:function(valueRole){if(!valueRole.grouping.isSingleDimension){pvc.log("[WARNING] A linear scale can only be obtained for a single dimension role.");}
if(valueRole.grouping.isDiscrete()){pvc.log("[WARNING] The single dimension of role '{0}' should be continuous.",[valueRole.name]);}},_getVisibleValueExtent:function(valueAxis){var dataCells=valueAxis.dataCells;if(dataCells.length===1){return this._getVisibleRoleValueExtent(valueAxis,dataCells[0]);}
return def.query(dataCells).select(function(dataCell){return this._getVisibleRoleValueExtent(valueAxis,dataCell);},this).reduce(this._unionReduceExtent,null);},_unionReduceExtent:function(result,range){if(!result){if(!range){return null;}
result={min:range.min,max:range.max};}else if(range){if(range.min<result.min){result.min=range.min;}
if(range.max>result.max){result.max=range.max;}}
return result;},_getVisibleRoleValueExtent:function(valueAxis,valueDataCell){var valueRole=valueDataCell.role;var dataPartValues=valueDataCell.dataPartValues;this._assertSingleContinuousValueRole(valueRole);if(valueRole.name==='series'){throw def.error.notImplemented();}
var valueDimName=valueRole.firstDimensionName();var extent=this._getVisibleData(dataPartValues).dimensions(valueDimName).extent();return extent?{min:extent.min.value,max:extent.max.value}:undefined;},_getVisibleValueExtentConstrained:function(axis,min,max){var extent={minLocked:false,maxLocked:false};if(min==null){min=axis.option('FixedMin');if(min!=null){extent.minLocked=true;}}
if(max==null){max=axis.option('FixedMax');if(max!=null){extent.maxLocked=true;}}
if(min==null||max==null){var baseExtent=this._getVisibleValueExtent(axis);if(!baseExtent){return null;}
if(min==null){min=baseExtent.min;}
if(max==null){max=baseExtent.max;}}
extent.min=min;extent.max=max;return extent;},defaults:def.create(pvc.TimeseriesAbstract.prototype.defaults,{showAllTimeseries:false,panelSizeRatio:0.9,timeSeries:false,timeSeriesFormat:"%Y-%m-%d",useCompositeAxis:false,showXScale:true,showYScale:true,xAxisPosition:"bottom",yAxisPosition:"left",secondAxisIndependentScale:false,secondAxisColor:"blue"})});pvc.GridDockingPanel=pvc.BasePanel.extend({anchor:'fill',_calcLayout:function(layoutInfo){if(!this._children){return;}
var margins=new pvc.Sides(0);var paddings=new pvc.Sides(0);var remSize=def.copyOwn(layoutInfo.clientSize);var overFlowPaddings;var aolMap=pvc.BasePanel.orthogonalLength;var aoMap=pvc.BasePanel.relativeAnchor;var alMap=pvc.BasePanel.parallelLength;var childKeyArgs={force:true,referenceSize:layoutInfo.clientSize};var fillChildren=[];var sideChildren=[];var paddingHistory={};var loopSignal={};var overflowPaddingsSignal={};var isDisasterRecovery=false;this._children.forEach(initChild);sideChildren.forEach(layoutChild1Side);doMaxTimes(9,layoutCycle);layoutInfo.gridMargins=new pvc.Sides(margins);layoutInfo.gridPaddings=new pvc.Sides(paddings);layoutInfo.gridSize=new pvc.Size(remSize);function layoutCycle(remTimes,iteration){if(pvc.debug>=5){pvc.log("\n[GridDockingPanel] ==== LayoutCycle "+(isDisasterRecovery?"Disaster MODE":("#"+(iteration+1))));}
var index,count;var canChange=layoutInfo.canChange!==false&&!isDisasterRecovery&&(remTimes>0);var paddingsChanged;var ownPaddingsChanged=false;index=0;count=sideChildren.length;while(index<count){if(pvc.debug>=5){pvc.log("[GridDockingPanel] SIDE Child i="+index);}
paddingsChanged=layoutChild2Side(sideChildren[index],canChange);if(!isDisasterRecovery&&paddingsChanged){if(paddingsChanged===loopSignal){isDisasterRecovery=true;layoutCycle(0);return false;}
if(paddingsChanged===overflowPaddingsSignal){if(!ownPaddingsChanged){ownPaddingsChanged=true;layoutInfo.requestPaddings=layoutInfo.paddings;}}else{if(remTimes>0){if(pvc.debug>=5){pvc.log("[GridDockingPanel] SIDE Child i="+index+" increased paddings");}
return true;}else if(pvc.debug>=2){pvc.log("[Warning] [GridDockingPanel] SIDE Child i="+index+" increased paddings but no more iterations possible.");}}}
index++;}
if(ownPaddingsChanged){if(pvc.debug>=5){pvc.log("[GridDockingPanel] Restarting due to overflowPaddings change");}
return false;}
index=0;count=fillChildren.length;while(index<count){if(pvc.debug>=5){pvc.log("[GridDockingPanel] FILL Child i="+index);}
paddingsChanged=layoutChildFill(fillChildren[index],canChange);if(!isDisasterRecovery&&paddingsChanged){if(paddingsChanged===loopSignal){isDisasterRecovery=true;layoutCycle(0);return false;}
if(remTimes>0){if(pvc.debug>=5){pvc.log("[GridDockingPanel] FILL Child i="+index+" increased paddings");}
return true;}else if(pvc.debug>=2){pvc.log("[Warning] [GridDockingPanel] FILL Child i="+index+" increased paddings but no more iterations possible.");}}
index++;}
return false;}
function doMaxTimes(maxTimes,fun){var index=0;while(maxTimes--){if(fun(maxTimes,index)===false){return true;}
index++;}
return false;}
function initChild(child){var a=child.anchor;if(a){if(a==='fill'){fillChildren.push(child);var childPaddings=child.paddings.resolve(childKeyArgs.referenceSize);paddings=pvc.Sides.resolvedMax(paddings,childPaddings);}else{def.hasOwn(aoMap,a)||def.fail.operationInvalid("Unknown anchor value '{0}'",[a]);sideChildren.push(child);}}}
function layoutChild1Side(child){var paddingsChanged=false;var a=child.anchor;childKeyArgs.paddings=filterAnchorPaddings(a,paddings);child.layout(new pvc.Size(remSize),childKeyArgs);if(child.isVisible){paddingsChanged=checkAnchorPaddingsChanged(a,paddings,child);positionChildNormal(a,child);updateSide(a,child);}
return paddingsChanged;}
function layoutChildFill(child,canChange){var paddingsChanged=false;var a=child.anchor;childKeyArgs.paddings=filterAnchorPaddings(a,paddings);childKeyArgs.canChange=canChange;child.layout(new pvc.Size(remSize),childKeyArgs);if(child.isVisible){paddingsChanged=checkAnchorPaddingsChanged(a,paddings,child,canChange);positionChildNormal(a,child);positionChildOrtho(child,a);}
return paddingsChanged;}
function layoutChild2Side(child,canChange){var paddingsChanged=false;if(child.isVisible){var a=child.anchor;var al=alMap[a];var aol=aolMap[a];var length=remSize[al];var olength=child[aol];var childSize2=new pvc.Size(def.set({},al,length,aol,olength));childKeyArgs.paddings=filterAnchorPaddings(a,paddings);childKeyArgs.canChange=canChange;child.layout(childSize2,childKeyArgs);if(child.isVisible){paddingsChanged=checkAnchorPaddingsChanged(a,paddings,child,canChange);if(checkOverflowPaddingsChanged(a,layoutInfo.paddings,child,canChange)){return overflowPaddingsSignal;}
positionChildOrtho(child,child.align);}}
return paddingsChanged;}
function positionChildNormal(side,child){var sidePos;if(side==='fill'){side='left';sidePos=margins.left+remSize.width/2-(child.width/2);}else{sidePos=margins[side];}
child.setPosition(def.set({},side,sidePos));}
function updateSide(side,child){var sideol=aolMap[side],olen=child[sideol];margins[side]+=olen;remSize[sideol]-=olen;}
function positionChildOrtho(child,align){var sideo;if(align==='fill'){align='middle';}
var sideOPos;switch(align){case'top':case'bottom':case'left':case'right':sideo=align;sideOPos=margins[sideo];break;case'middle':sideo='bottom';sideOPos=margins.bottom+(remSize.height/2)-(child.height/2);break;case'center':sideo='left';sideOPos=margins.left+remSize.width/2-(child.width/2);break;}
child.setPosition(def.set({},sideo,sideOPos));}
function filterAnchorPaddings(a,paddings){var filtered=new pvc.Sides();getAnchorPaddingsNames(a).forEach(function(side){filtered.set(side,paddings[side]);});return filtered;}
function checkAnchorPaddingsChanged(a,paddings,child,canChange){var newPaddings=child._layoutInfo.requestPaddings;var changed=false;if(newPaddings){if(pvc.debug>=10){pvc.log("[GridDockingPanel] => clientSize="+JSON.stringify(child._layoutInfo.clientSize));pvc.log("[GridDockingPanel] <= requestPaddings="+JSON.stringify(newPaddings));}
getAnchorPaddingsNames(a).forEach(function(side){if(newPaddings.hasOwnProperty(side)){var value=paddings[side]||0;var newValue=Math.floor(10000*(newPaddings[side]||0))/10000;var increase=newValue-value;if(increase!==0&&Math.abs(increase)>=Math.abs(0.01*value)){if(!canChange){if(pvc.debug>=2){pvc.log("[Warning] [GridDockingPanel] CANNOT change but child wanted to: "+side+"="+newValue);}}else{changed=true;paddings[side]=newValue;if(pvc.debug>=5){pvc.log("[Warning] [GridDockingPanel]   changed padding "+side+" <- "+newValue);}}}}});if(changed){var paddingKey=pvc.Sides.names.map(function(side){return(paddings[side]||0).toFixed(3);}).join('|');if(def.hasOwn(paddingHistory,paddingKey)){if(pvc.debug>=2){pvc.log("[GridDockingPanel] LOOP detected");}
changed=loopSignal;}else{paddingHistory[paddingKey]=true;}
paddings.width=paddings.left+paddings.right;paddings.height=paddings.top+paddings.bottom;}}
return changed;}
function checkOverflowPaddingsChanged(a,ownPaddings,child,canChange){var overflowPaddings=child._layoutInfo.overflowPaddings;var changed=false;if(overflowPaddings){if(pvc.debug>=10){pvc.log("[GridDockingPanel] <= overflowPaddings="+JSON.stringify(overflowPaddings));}
getAnchorPaddingsNames(a).forEach(function(side){if(overflowPaddings.hasOwnProperty(side)){var value=ownPaddings[side]||0;var newValue=Math.floor(10000*(overflowPaddings[side]||0))/10000;newValue-=margins[side];var increase=newValue-value;if(increase>Math.abs(0.05*value)){if(!canChange){if(pvc.debug>=2){pvc.log("[Warning] [GridDockingPanel] CANNOT change overflow  padding but child wanted to: "+side+"="+newValue);}}else{changed=true;ownPaddings[side]=newValue;if(pvc.debug>=5){pvc.log("[GridDockingPanel]   changed overflow padding "+side+" <- "+newValue);}}}}});if(changed){ownPaddings.width=ownPaddings.left+ownPaddings.right;ownPaddings.height=ownPaddings.top+ownPaddings.bottom;}}
return changed;}
function getAnchorPaddingsNames(a){switch(a){case'left':case'right':return pvc.Sides.vnames;case'top':case'bottom':return pvc.Sides.hnames;case'fill':return pvc.Sides.names;}}}});pvc.CartesianGridDockingPanel=pvc.GridDockingPanel.extend({applyExtensions:function(){this.base();this.extend(this.pvPanel,"content_");this.extend(this.xGridRule,"xAxisGrid_");this.extend(this.yGridRule,"yAxisGrid_");this.extend(this.pvFrameBar,"plotFrame_");if(this.chart.options.compatVersion<=1){this.extend(this.pvFrameBar,"xAxisEndLine_");this.extend(this.pvFrameBar,"yAxisEndLine_");}
this.extend(this.xZeroLine,"xAxisZeroLine_");this.extend(this.yZeroLine,"yAxisZeroLine_");},_createCore:function(layoutInfo){var chart=this.chart;var axes=chart.axes;var xAxis=axes.x;var yAxis=axes.y;if(xAxis.isVisible&&xAxis.option('FullGrid')){this.xGridRule=this._createGridRule(xAxis);}
if(yAxis.isVisible&&yAxis.option('FullGrid')){this.yGridRule=this._createGridRule(yAxis);}
this.base(layoutInfo);var contentPanel=chart._mainContentPanel;if(contentPanel){var showPlotFrame=chart.options.showPlotFrame;if(showPlotFrame==null){if(chart.options.compatVersion<=1){showPlotFrame=!!(xAxis.option('EndLine')||yAxis.option('EndLine'));}else{showPlotFrame=true;}}
if(showPlotFrame){this.pvFrameBar=this._createFrame(layoutInfo,axes);}
if(xAxis.scaleType==='Continuous'&&xAxis.option('ZeroLine')){this.xZeroLine=this._createZeroLine(xAxis,layoutInfo);}
if(yAxis.scaleType==='Continuous'&&yAxis.option('ZeroLine')){this.yZeroLine=this._createZeroLine(yAxis,layoutInfo);}}},_createGridRule:function(axis){var scale=axis.scale;var ticks;if(!scale.isNull&&(ticks=axis.ticks)){var margins=this._layoutInfo.gridMargins;var paddings=this._layoutInfo.gridPaddings;var tick_a=axis.orientation==='x'?'left':'bottom';var len_a=this.anchorLength(tick_a);var obeg_a=this.anchorOrtho(tick_a);var oend_a=this.anchorOpposite(obeg_a);var tick_offset=margins[tick_a]+paddings[tick_a];var obeg=margins[obeg_a];var oend=margins[oend_a];var isDiscrete=axis.scaleType==='Discrete';if(isDiscrete){ticks=ticks.concat(ticks[ticks.length-1]);}
var pvGridRule=this.pvPanel.add(pv.Rule).data(ticks).zOrder(-12).strokeStyle("#f0f0f0")
[obeg_a](obeg)
[oend_a](oend)
[len_a](null);if(!isDiscrete){pvGridRule
[tick_a](function(tick){return tick_offset+scale(tick);});}else{var halfStep=scale.range().step/2;var lastTick=ticks.length-1;pvGridRule
[tick_a](function(childData){var position=tick_offset+scale(childData.value);return position+(this.index<lastTick?-halfStep:halfStep);});}
return pvGridRule;}},_createFrame:function(layoutInfo,axes){if(axes.base.scale.isNull||(axes.ortho.scale.isNull&&(!axes.ortho2||axes.ortho2.scale.isNull))){return;}
var margins=layoutInfo.gridMargins;var left=margins.left;var right=margins.right;var top=margins.top;var bottom=margins.bottom;var pvFrame=this.pvPanel.add(pv.Bar).zOrder(-8).left(left).right(right).top(top).bottom(bottom).strokeStyle("#808285").lineWidth(0.5).lock('fillStyle',null);return pvFrame;},_createZeroLine:function(axis,layoutInfo){var scale=axis.scale;if(!scale.isNull){var domain=scale.domain();if(domain[0]*domain[1]<=0){var a=axis.orientation==='x'?'left':'bottom';var len_a=this.anchorLength(a);var obeg_a=this.anchorOrtho(a);var oend_a=this.anchorOpposite(obeg_a);var margins=layoutInfo.gridMargins;var paddings=layoutInfo.gridPaddings;var zeroPosition=margins[a]+paddings[a]+scale(0);var obeg=margins[obeg_a];var oend=margins[oend_a];this.pvZeroLine=this.pvPanel.add(pv.Rule).zOrder(-9).strokeStyle("#808285")
[obeg_a](obeg)
[oend_a](oend)
[a](zeroPosition)
[len_a](null);}}},_getOrthoAxis:function(type){var orthoType=type==='base'?'ortho':'base';return this.chart.axes[orthoType];}});pvc.CartesianAbstractPanel=pvc.BasePanel.extend({anchor:'fill',orientation:"vertical",stacked:false,offsetPaddings:null,constructor:function(chart,parent,options){this.base(chart,parent,options);var axes=chart.axes;var paddings={};var hasAny=false;function setSide(side,pct){var value=paddings[side];if(value==null||pct>value){hasAny=true;paddings[side]=pct;}}
function processAxis(axis){var offset=axis&&axis.option('Offset');if(offset!=null&&offset>=0){if(axis.orientation==='x'){setSide('left',offset);setSide('right',offset);}else{setSide('top',offset);setSide('bottom',offset);}}}
processAxis(axes.x);processAxis(axes.secondX);processAxis(axes.y);processAxis(axes.secondY);if(hasAny){this.offsetPaddings=paddings;}},_calcLayout:function(layoutInfo){layoutInfo.requestPaddings=this._calcRequestPaddings(layoutInfo);},_calcRequestPaddings:function(layoutInfo){var op=this.offsetPaddings;if(!op){return;}
var rp=this.chart._getAxesRoundingPaddings();var clientSize=layoutInfo.clientSize;var paddings=layoutInfo.paddings;var reqPad={};pvc.Sides.names.forEach(function(side){var len_a=pvc.BasePanel.orthogonalLength[side];var clientLen=clientSize[len_a];var paddingLen=paddings[len_a];var len=clientLen+paddingLen;var offset=len*(op[side]||0);var rounding=clientLen*(rp[side]||0);reqPad[side]=Math.max(offset-rounding,0);},this);return reqPad;},_createCore:function(){this.pvPanel.zOrder(-10);var orthoAxis=this.chart.axes.ortho,baseAxis=this.chart.axes.base;if(orthoAxis.option('FixedMin')!=null||orthoAxis.option('FixedMax')!=null||baseAxis.option('FixedMin')!=null||baseAxis.option('FixedMax')!=null){this.pvPanel.borderPanel.overflow("hidden");}},_getVisibleData:function(dataPartValues,keyArgs){return this.chart._getVisibleData(dataPartValues||this.dataPartValue,keyArgs);},applyExtensions:function(){this.base();this.extend(this.pvPanel,"chart_");},isOrientationVertical:function(){return this.orientation===pvc.orientation.vertical;},isOrientationHorizontal:function(){return this.orientation===pvc.orientation.horizontal;},_detectDatumsUnderRubberBand:function(datumsByKey,rb,keyArgs){var any=false,chart=this.chart,xAxisPanel=chart.xAxisPanel,yAxisPanel=chart.yAxisPanel,xDatumsByKey,yDatumsByKey;if(xAxisPanel){xDatumsByKey={};if(!xAxisPanel._detectDatumsUnderRubberBand(xDatumsByKey,rb,keyArgs)){xDatumsByKey=null;}}
if(yAxisPanel){yDatumsByKey={};if(!yAxisPanel._detectDatumsUnderRubberBand(yDatumsByKey,rb,keyArgs)){yDatumsByKey=null;}}
if(xDatumsByKey&&yDatumsByKey){def.eachOwn(yDatumsByKey,function(datum,key){if(def.hasOwn(xDatumsByKey,key)){datumsByKey[datum.key]=datum;any=true;}});keyArgs.toggle=true;}else if(xDatumsByKey){def.copy(datumsByKey,xDatumsByKey);any=true;}else if(yDatumsByKey){def.copy(datumsByKey,yDatumsByKey);any=true;}else{any=this.base(datumsByKey,rb,keyArgs);}
return any;}});pvc.CategoricalAbstract=pvc.CartesianAbstract.extend({constructor:function(options){this.base(options);def.set(this._axisType2RoleNamesMap,'base','category','ortho',this.options.orthoAxisOrdinal?'series':'value');var parent=this.parent;if(parent){this._catRole=parent._catRole;}},_initVisualRoles:function(){this.base();this._addVisualRoles({category:{isRequired:true,defaultDimensionName:'category*',autoCreateDimension:true}});this._catRole=this.visualRoles('category');},_createVisibleData:function(dataPartValues,ignoreNulls){var serGrouping=this._serRole&&this._serRole.flattenedGrouping(),catGrouping=this._catRole.flattenedGrouping(),partData=this.partData(dataPartValues),keyArgs={visible:true,isNull:ignoreNulls?false:null};return serGrouping?partData.groupBy([catGrouping,serGrouping],keyArgs):partData.groupBy(catGrouping,keyArgs);},_getVisibleRoleValueExtent:function(valueAxis,valueDataCell){var valueRole=valueDataCell.role;var dataPartValues=valueDataCell.dataPartValues;if(dataPartValues==null){return this._getVisibleCellValueExtent(valueAxis,valueRole,null);}
return def.query(dataPartValues).select(function(dataPartValue){return this._getVisibleCellValueExtent(valueAxis,valueRole,dataPartValue);},this).reduce(this._unionReduceExtent,null);},_isDataCellStacked:function(valueRole,dataPartValue){return this.options.stacked;},_getVisibleCellValueExtent:function(valueAxis,valueRole,dataPartValue){switch(valueRole.name){case'series':case'category':return pvc.CartesianAbstract.prototype._getVisibleRoleValueExtent.call(this,valueAxis,{role:valueRole,dataPartValues:dataPartValue});}
this._assertSingleContinuousValueRole(valueRole);var valueDimName=valueRole.firstDimensionName(),data=this._getVisibleData(dataPartValue);if(valueAxis.type!=='ortho'||!this._isDataCellStacked(valueRole,dataPartValue)){return data.leafs().select(function(serGroup){return serGroup.dimensions(valueDimName).sum();}).range();}
return data.children().select(function(catGroup){var range=this._getStackedCategoryValueExtent(catGroup,valueDimName);if(range){return{range:range,group:catGroup};}},this).where(def.notNully).reduce(function(result,rangeInfo){return this._reduceStackedCategoryValueExtent(result,rangeInfo.range,rangeInfo.group);}.bind(this),null);},_getStackedCategoryValueExtent:function(catGroup,valueDimName){var posSum=null,negSum=null;catGroup.children().select(function(serGroup){return serGroup.dimensions(valueDimName).sum();}).each(function(value){if(value!=null){if(value>=0){posSum+=value;}else{negSum+=value;}}});if(posSum==null&&negSum==null){return null;}
return{max:posSum||0,min:negSum||0};},_reduceStackedCategoryValueExtent:function(result,catRange,catGroup){return this._unionReduceExtent(result,catRange);},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:false,horizontalAnchorSwapLimit:80},markEvent:function(dateString,label,options){if(!this.options.timeSeries){pvc.log("Attempting to mark an event on a non timeSeries chart");return;}
var o=$.extend({},this.markEventDefaults,options);var baseScale=this.axes.base.scale;var d=pv.Format.date(this.options.timeSeriesFormat).parse(dateString);var dpos=baseScale(d),range=baseScale.range();if(dpos<range[0]||dpos>range[1]){pvc.log("Event outside the allowed range, returning");return;}
var panel=this._mainContentPanel.pvPanel;var h=this.yScale.range()[1];if(!o.forceHorizontalAnchor){var availableSize=o.horizontalAnchor=="right"?range[1]-dpos:dpos;if(availableSize<o.horizontalAnchorSwapLimit){o.horizontalAnchor=o.horizontalAnchor=="right"?"left":"right";}}
var line=panel.add(pv.Line).data([0,h]).strokeStyle(o.strokeStyle).lineWidth(o.lineWidth).bottom(function(d){return d;}).left(dpos);line.anchor(o.horizontalAnchor).top(o.verticalAnchor=="top"?o.verticalOffset:(h-o.verticalOffset)).add(pv.Label).text(label).textStyle(o.textStyle).visible(function(){return!this.index;});},defaults:def.create(pvc.CartesianAbstract.prototype.defaults,{orthoAxisOrdinal:false,stacked:false})});pvc.AxisPanel=pvc.BasePanel.extend({showAllTimeseries:false,pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:false,roleName:null,axis:null,anchor:"bottom",axisSize:undefined,tickLength:6,panelName:"axis",scale:null,ruleCrossesMargin:true,font:'9px sans-serif',labelSpacingMin:1,domainRoundMode:'none',desiredTickCount:null,tickExponentMin:null,tickExponentMax:null,minorTicks:true,_isScaleSetup:false,constructor:function(chart,parent,axis,options){options=def.create(options,{anchor:axis.option('Position')});if(options.sizeMax==null){var sizeMax=options.axisSizeMax;if(sizeMax!=null){var anchor=options.anchor||this.anchor;options.sizeMax=new pvc.Size().setSize(sizeMax,{singleProp:this.anchorOrthoLength(anchor)});}}
this.base(chart,parent,options);this.axis=axis;this.roleName=axis.role.name;this.isDiscrete=axis.role.grouping.isDiscrete();if(options.font===undefined){var extFont=this._getConstantExtension(this.panelName+'Label','font');if(extFont){this.font=extFont;}}},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks;},_calcLayout:function(layoutInfo){var scale=this.axis.scale;if(!this._isScaleSetup){this.pvScale=scale;this.scale=scale;this.extend(scale,this.panelName+"Scale_");this._isScaleSetup=true;}
if(scale.isNull){layoutInfo.axisSize=0;}else{this._calcLayoutCore(layoutInfo);}
return this.createAnchoredSize(layoutInfo.axisSize,layoutInfo.clientSize);},_calcLayoutCore:function(layoutInfo){layoutInfo.axisSize=this.axisSize;if(this.isDiscrete&&this.useCompositeAxis){if(layoutInfo.axisSize==null){layoutInfo.axisSize=50;}}else{this._calcTicks();if(layoutInfo.axisSize==null){this._calcAxisSizeFromLabel();}
this._calcMaxTextLengthThatFits();this._calcOverflowPaddings();layoutInfo.labelBBox=null;}},_calcAxisSizeFromLabel:function(){this._calcLabelBBox();this._calcAxisSizeFromLabelBBox();},_calcLabelBBox:function(){var layoutInfo=this._layoutInfo;var labelExtId=this.panelName+'Label';var align=this._getExtension(labelExtId,'textAlign');if(typeof align!=='string'){align=this.isAnchorTopOrBottom()?"center":(this.anchor=="left")?"right":"left";}
var baseline=this._getExtension(labelExtId,'textBaseline');if(typeof baseline!=='string'){switch(this.anchor){case"right":case"left":case"center":baseline="middle";break;case"bottom":baseline="top";break;default:baseline="bottom";}}
var angle=def.number.as(this._getExtension(labelExtId,'textAngle'),0);var margin=def.number.as(this._getExtension(labelExtId,'textMargin'),3);layoutInfo.labelBBox=pvc.text.getLabelBBox(layoutInfo.maxTextWidth,layoutInfo.textHeight,align,baseline,angle,margin);},_calcAxisSizeFromLabelBBox:function(){var layoutInfo=this._layoutInfo;var labelBBox=layoutInfo.labelBBox;var length=this._getLabelBBoxQuadrantLength(labelBBox,this.anchor);layoutInfo.axisSize=this.tickLength+length;var angle=labelBBox.sourceAngle;if(!(angle===0&&this.isAnchorTopOrBottom())){layoutInfo.axisSize+=this.tickLength;}},_getLabelBBoxQuadrantLength:function(labelBBox,quadrantSide){var length;switch(quadrantSide){case'left':length=-labelBBox.x;break;case'right':length=labelBBox.x2;break;case'top':length=-labelBBox.y;break;case'bottom':length=labelBBox.y2;break;}
return Math.max(length,0);},_calcOverflowPaddings:function(){if(!this._layoutInfo.labelBBox){this._calcLabelBBox();}
this._calcOverflowPaddingsFromLabelBBox();},_calcOverflowPaddingsFromLabelBBox:function(){var layoutInfo=this._layoutInfo;var paddings=layoutInfo.paddings;var labelBBox=layoutInfo.labelBBox;var orthoSides=this.isAnchorTopOrBottom()?['left','right']:['top','bottom'];var isDiscrete=this.scale.type==='Discrete';var halfBand;if(isDiscrete){this.axis.setScaleRange(layoutInfo.clientSize[this.anchorLength()]);halfBand=this.scale.range().band/2;}
var overflowPaddings=null;orthoSides.forEach(function(side){var overflowPadding=this._getLabelBBoxQuadrantLength(labelBBox,side);if(overflowPadding>0){overflowPadding-=(paddings[side]||0);if(overflowPadding>0){if(isDiscrete){overflowPadding-=halfBand;}
if(overflowPadding>1){if(isDiscrete){overflowPadding*=1.05;}
if(!overflowPaddings){overflowPaddings={};}
overflowPaddings[side]=overflowPadding;}}}},this);if(pvc.debug>=6&&overflowPaddings){pvc.log("[OverflowPaddings] "+this.panelName+" "+JSON.stringify(overflowPaddings));}
layoutInfo.overflowPaddings=overflowPaddings;},_calcMaxTextLengthThatFits:function(){var layoutInfo=this._layoutInfo;var availableClientLength=layoutInfo.clientSize[this.anchorOrthoLength()];if(layoutInfo.axisSize<=availableClientLength){layoutInfo.maxTextWidth=null;}else{var labelBBox=layoutInfo.labelBBox;if(!labelBBox){this._calcAxisSizeFromLabel();}
var maxOrthoLength=availableClientLength-2*this.tickLength;var mostOrthoDistantPoint;var parallelDirection;switch(this.anchor){case'left':parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(-maxOrthoLength,0);break;case'right':parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(maxOrthoLength,0);break;case'top':parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,-maxOrthoLength);break;case'bottom':parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,maxOrthoLength);break;}
var corners=labelBBox.sourceCorners;var botL=corners[0];var botR=corners[1];var topL=corners[2];var topR=corners[3];var topRLSideDir=topR.minus(topL);var botRLSideDir=botR.minus(botL);var intersect=pv.SvgScene.lineIntersect;var botI=intersect(mostOrthoDistantPoint,parallelDirection,botL,botRLSideDir);var topI=intersect(mostOrthoDistantPoint,parallelDirection,topL,topRLSideDir);var maxTextWidth;if(Math.cos(labelBBox.sourceAngle)>=0){maxTextWidth=Math.min(topR.minus(topI).length(),botR.minus(botI).length());}else{maxTextWidth=Math.min(topL.minus(topI).length(),botL.minus(botI).length());}
if(labelBBox.sourceAlign==='center'){var cutWidth=labelBBox.sourceTextWidth-maxTextWidth;maxTextWidth-=cutWidth;}
layoutInfo.maxTextWidth=maxTextWidth;}},_calcTicks:function(){var layoutInfo=this._layoutInfo;layoutInfo.textHeight=pvc.text.getTextHeight("m",this.font);layoutInfo.maxTextWidth=null;this.axis.setTicks(null);switch(this.scale.type){case'Discrete':this._calcDiscreteTicks();break;case'Timeseries':this._calcTimeseriesTicks();break;case'Continuous':this._calcNumberTicks(layoutInfo);break;default:throw def.error.operationInvalid("Undefined axis scale type");}
this.axis.setTicks(layoutInfo.ticks);if(layoutInfo.maxTextWidth==null){layoutInfo.maxTextWidth=def.query(layoutInfo.ticksText).select(function(text){return pvc.text.getTextLength(text,this.font);},this).max();}},_calcDiscreteTicks:function(){var layoutInfo=this._layoutInfo;var data=this.chart.visualRoles(this.roleName).flatten(this.chart.data,{visible:true});layoutInfo.data=data;layoutInfo.ticks=data._children;layoutInfo.ticksText=def.query(data._children).select(function(child){return child.absLabel;}).array();},_calcTimeseriesTicks:function(){this._calcContinuousTicks(this._layoutInfo,this.desiredTickCount);},_calcNumberTicks:function(layoutInfo){var desiredTickCount;var previousLayout;if(!layoutInfo.canChange&&(previousLayout=layoutInfo.previous)){desiredTickCount=previousLayout.ticks.length;}else{desiredTickCount=this.desiredTickCount;}
if(desiredTickCount==null){if(this.isAnchorTopOrBottom()){this._calcNumberHTicks();return;}
desiredTickCount=this._calcNumberVDesiredTickCount();}
this._calcContinuousTicks(this._layoutInfo,desiredTickCount);},_calcContinuousTicks:function(ticksInfo,desiredTickCount){this._calcContinuousTicksValue(ticksInfo,desiredTickCount);this._calcContinuousTicksText(ticksInfo);},_calcContinuousTicksValue:function(ticksInfo,desiredTickCount){ticksInfo.ticks=this.scale.ticks(desiredTickCount,{roundInside:this.domainRoundMode!=='tick',numberExponentMin:this.tickExponentMin,numberExponentMax:this.tickExponentMax});},_calcContinuousTicksText:function(ticksInfo){ticksInfo.ticksText=def.query(ticksInfo.ticks).select(function(tick){return this.scale.tickFormat(tick);},this).array();},_calcNumberVDesiredTickCount:function(){var layoutInfo=this._layoutInfo;var lineHeight=layoutInfo.textHeight*(1+Math.max(0,this.labelSpacingMin));var clientLength=layoutInfo.clientSize[this.anchorLength()];return Math.max(1,~~(clientLength/lineHeight));},_calcNumberHTicks:function(){var layoutInfo=this._layoutInfo;var clientLength=layoutInfo.clientSize[this.anchorLength()];var spacing=layoutInfo.textHeight*(1+Math.max(0,this.labelSpacingMin));var desiredTickCount=this._calcNumberHDesiredTickCount(this,spacing);var doLog=(pvc.debug>=7);var dir,prevResultTickCount;var ticksInfo,lastBelow,lastAbove;do{if(doLog){pvc.log("calculateNumberHTicks TickCount IN desired = "+desiredTickCount);}
ticksInfo={};this._calcContinuousTicksValue(ticksInfo,desiredTickCount);var ticks=ticksInfo.ticks;var resultTickCount=ticks.length;if(ticks.exponentOverflow){if(dir==null){if(ticks.exponent===this.exponentMin){lastBelow=ticksInfo;dir=1;}else{lastAbove=ticksInfo;dir=-1;}}else if(dir===1){if(lastBelow){ticksInfo=lastBelow;}
break;}else{if(lastAbove){ticksInfo=lastAbove;}
break;}}else if(prevResultTickCount==null||resultTickCount!==prevResultTickCount){if(doLog){pvc.log("calculateNumberHTicks TickCount desired/resulting = "+desiredTickCount+" -> "+resultTickCount);}
prevResultTickCount=resultTickCount;this._calcContinuousTicksText(ticksInfo);var length=this._calcNumberHLength(ticksInfo,spacing);var excessLength=length-clientLength;var pctError=ticksInfo.error=Math.abs(excessLength/clientLength);if(doLog){pvc.log("calculateNumberHTicks error="+(ticksInfo.error*100).toFixed(0)+"% count="+resultTickCount+" step="+ticks.step);pvc.log("calculateNumberHTicks Length client/resulting = "+clientLength+" / "+length+" spacing = "+spacing);}
if(excessLength>0){if(desiredTickCount===1){break;}
if(lastBelow){if(pctError>lastBelow.error){ticksInfo=lastBelow;}
break;}
lastAbove=ticksInfo;dir=-1;}else{if(pctError<=0.05||dir===-1){if(lastAbove&&pctError>lastAbove.error){ticksInfo=lastAbove;}
break;}
lastBelow=ticksInfo;dir=+1;}}
desiredTickCount+=dir;}while(true);if(ticksInfo){layoutInfo.ticks=ticksInfo.ticks;layoutInfo.ticksText=ticksInfo.ticksText;layoutInfo.maxTextWidth=ticksInfo.maxTextWidth;if(pvc.debug>=5){pvc.log("calculateNumberHTicks RESULT error="+(ticksInfo.error*100).toFixed(0)+"% count="+ticksInfo.ticks.length+" step="+ticksInfo.ticks.step);}}
if(doLog){pvc.log("calculateNumberHTicks END");}},_calcNumberHDesiredTickCount:function(spacing){var layoutInfo=this._layoutInfo;var domainTextLength=this.scale.domain().map(function(tick){var text=this.scale.tickFormat(tick);return pvc.text.getTextLength(text,this.font);},this);var avgTextLength=Math.max((domainTextLength[1]+domainTextLength[0])/2,layoutInfo.textHeight);var clientLength=layoutInfo.clientSize[this.anchorLength()];return Math.max(1,~~(clientLength/(avgTextLength+spacing)));},_calcNumberHLength:function(ticksInfo,spacing){var ticksText=ticksInfo.ticksText;var tickCount=ticksText.length;var length=0;var maxLength=-Infinity;for(var t=0;t<tickCount;t++){var textLength=pvc.text.getTextLength(ticksText[t],this.font);if(textLength>maxLength){maxLength=textLength;}
if(t){length+=spacing;}
if(!t||t===tickCount-1){length+=textLength/2;}else{length+=textLength;}}
ticksInfo.maxTextWidth=maxLength;return length;},_createCore:function(){this.renderAxis();},applyExtensions:function(){this.base();this.extend(this.pvPanel,this.panelName+"_");this.extend(this.pvRule,this.panelName+"Rule_");this.extend(this.pvTicks,this.panelName+"Ticks_");this.extend(this.pvLabel,this.panelName+"Label_");this.extend(this.pvMinorTicks,this.panelName+"MinorTicks_");},renderAxis:function(){if(this.scale.isNull){return;}
var clientSize=this._layoutInfo.clientSize;var paddings=this._layoutInfo.paddings;var begin_a=this.anchorOrtho();var end_a=this.anchorOpposite(begin_a);var size_a=this.anchorOrthoLength(begin_a);var rMin=this.ruleCrossesMargin?-paddings[begin_a]:0;var rMax=clientSize[size_a]+(this.ruleCrossesMargin?paddings[end_a]:0);var rSize=rMax-rMin;var ruleParentPanel=this.pvPanel;this._rSize=rSize;this.pvRule=ruleParentPanel.add(pv.Rule).zOrder(30).strokeStyle('black')
[this.anchorOpposite()](0)
[size_a](rSize)
[begin_a](rMin).lineCap('square');if(this.isDiscrete){if(this.useCompositeAxis){this.renderCompositeOrdinalAxis();}else{this.renderOrdinalAxis();}}else{this.renderLinearAxis();}},_getOrthoScale:function(){var orthoType=this.axis.type==='base'?'ortho':'base';return this.chart.axes[orthoType].scale;},_getOrthoAxis:function(){var orthoType=this.axis.type==='base'?'ortho':'base';return this.chart.axes[orthoType];},renderOrdinalAxis:function(){var myself=this,scale=this.scale,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),data=this._layoutInfo.data,itemCount=this._layoutInfo.ticks.length,includeModulo;if(this.axis.option('OverlappedLabelsHide')&&itemCount>0&&this._rSize>0){var overlapFactor=def.between(this.axis.option('OverlappedLabelsMaxPct'),0,0.9);var textHeight=pvc.text.getTextHeight("m",this.font)*(1-overlapFactor);includeModulo=Math.max(1,Math.ceil((itemCount*textHeight)/this._rSize));if(pvc.debug>=4){pvc.log({overlapFactor:overlapFactor,itemCount:itemCount,textHeight:textHeight,Size:this._rSize,modulo:(itemCount*textHeight)/this._rSize,itemSpan:itemCount*textHeight,itemAvailSpace:this._rSize/itemCount});}
if(pvc.debug>=3&&includeModulo>1){pvc.log("Hiding every "+includeModulo+" labels in axis "+this.panelName);}}else{includeModulo=1;}
this.pvTicks=this.pvRule.add(pv.Rule).zOrder(20).data(this._layoutInfo.ticks).localProperty('group').group(function(child){return child;})
[anchorLength](null)
[anchorOrtho](function(child){return scale(child.value);})
[anchorOrthoLength](this.tickLength).strokeStyle('rgba(0,0,0,0)');var align=this.isAnchorTopOrBottom()?"center":(this.anchor=="left")?"right":"left";var font=this.font;var maxTextWidth=this._layoutInfo.maxTextWidth;if(!isFinite(maxTextWidth)){maxTextWidth=0;}
this.pvLabel=this.pvTicks.anchor(this.anchor).add(pv.Label).intercept('visible',labelVisibleInterceptor,this._getExtension(this.panelName+"Label",'visible')).zOrder(40).textAlign(align).text(function(child){var text=child.absLabel;if(maxTextWidth){text=pvc.text.trimToWidthB(maxTextWidth,text,font,'..',true);}
return text;}).font(font).localProperty('group').group(function(child){return child;});function labelVisibleInterceptor(getVisible,args){var visible=getVisible?getVisible.apply(this,args):true;return visible&&((this.index%includeModulo)===0);}
if(this._shouldHandleClick()){this.pvLabel.cursor("pointer").events('all').event('click',function(child){var ev=arguments[arguments.length-1];return myself._handleClick(child,ev);});}
if(this.doubleClickAction){this.pvLabel.cursor("pointer").events('all').event("dblclick",function(child){var ev=arguments[arguments.length-1];myself._handleDoubleClick(child,ev);});}},renderLinearAxis:function(){var scale=this.scale,orthoAxis=this._getOrthoAxis(),orthoScale=orthoAxis.scale,layoutInfo=this._layoutInfo,ticks=layoutInfo.ticks,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),tickStep=Math.abs(ticks[1]-ticks[0]);var pvTicks=this.pvTicks=this.pvRule.add(pv.Rule).zOrder(20).data(ticks)
[anchorLength](null)
[anchorOrtho](scale)
[anchorOrthoLength](this.tickLength);if(this.minorTicks){this.pvMinorTicks=this.pvTicks.add(pv.Rule).zOrder(20)
[anchorOrtho](function(d){return scale((+d)+(tickStep/2));})
[anchorOrthoLength](this.tickLength/2).intercept('visible',minorTicksVisibleInterceptor,this._getExtension(this.panelName+"MinorTicks",'visible'));}
function minorTicksVisibleInterceptor(getVisible,args){var visible=(!pvTicks.scene||pvTicks.scene[this.index].visible)&&(this.index<ticks.length-1);return visible&&(getVisible?getVisible.apply(this,args):true);}
this.renderLinearAxisLabel(ticks,layoutInfo.ticksText);},renderLinearAxisLabel:function(ticks,ticksText){var labelAnchor=this.pvTicks.anchor(this.anchor).addMargin(this.anchorOpposite(),2);var scale=this.scale;var font=this.font;var maxTextWidth=this._layoutInfo.maxTextWidth;if(!isFinite(maxTextWidth)){maxTextWidth=0;}
var label=this.pvLabel=labelAnchor.add(pv.Label).zOrder(40).text(function(d){var text=ticksText[this.index];if(maxTextWidth){text=pvc.text.trimToWidthB(maxTextWidth,text,font,'..',true);}
return text;}).font(this.font).textMargin(0.5).visible(true);var rootPanel=this.pvPanel.root;if(this.isAnchorTopOrBottom()){label.textAlign(function(){var absLeft;if(this.index===0){absLeft=label.toScreenTransform().transformHPosition(label.left());if(absLeft<=0){return'left';}}else if(this.index===ticks.length-1){absLeft=label.toScreenTransform().transformHPosition(label.left());if(absLeft>=rootPanel.width()){return'right';}}
return'center';});}else{label.textBaseline(function(){var absTop;if(this.index===0){absTop=label.toScreenTransform().transformVPosition(label.top());if(absTop>=rootPanel.height()){return'bottom';}}else if(this.index===ticks.length-1){absTop=label.toScreenTransform().transformVPosition(label.top());if(absTop<=0){return'top';}}
return'middle';});}},_handleDoubleClick:function(d,ev){if(!d){return;}
var action=this.doubleClickAction;if(action){this._ignoreClicks=2;action.call(null,d,ev);}},_shouldHandleClick:function(){var options=this.chart.options;return options.selectable||(options.clickable&&this.clickAction);},_handleClick:function(data,ev){if(!data||!this._shouldHandleClick()){return;}
if(!this.doubleClickAction){this._handleClickCore(data,ev);}else{var myself=this,options=this.chart.options;window.setTimeout(function(){myself._handleClickCore.call(myself,data,ev);},options.doubleClickMaxDelay||300);}},_handleClickCore:function(data,ev){if(this._ignoreClicks){this._ignoreClicks--;return;}
var action=this.clickAction;if(action){action.call(null,data,ev);}
var options=this.chart.options;if(options.selectable&&this.isDiscrete){var toggle=options.ctrlSelectMode&&!ev.ctrlKey;this._selectOrdinalElement(data,toggle);}},_selectOrdinalElement:function(data,toggle){var selectedDatums=data.datums().array();selectedDatums=this._onUserSelection(selectedDatums);if(toggle){this.chart.data.owner.clearSelected();}
pvc.data.Data.toggleSelected(selectedDatums);this._onSelectionChanged();},_dispatchRubberBandSelection:function(ev){},_detectDatumsUnderRubberBand:function(datumsByKey,rb){if(!this.isDiscrete||!this.isVisible){return false;}
var any=false;function addData(data){data.datums().each(function(datum){datumsByKey[datum.key]=datum;any=true;});}
if(!this.useCompositeAxis){var mark=this.pvLabel;mark.eachInstance(function(instance,t){if(!instance.isBreak){var data=instance.group;if(data){var shape=mark.getInstanceShape(instance).apply(t);if(shape.intersectsRect(rb)){addData(data);}}}},this);}else{var t=this._pvLayout.toScreenTransform();this._rootElement.visitBefore(function(data,i){if(i>0){var centerX=t.transformHPosition(data.x+data.dx/2),centerY=t.transformVPosition(data.y+data.dy/2);if(rb.containsPoint(centerX,centerY)){addData(data);}}});}
return any;},renderCompositeOrdinalAxis:function(){var myself=this,isTopOrBottom=this.isAnchorTopOrBottom(),axisDirection=isTopOrBottom?'h':'v',tipsyGravity=this._calcTipsyGravity(),diagDepthCutoff=2,vertDepthCutoff=2;var layout=this._pvLayout=this.getLayoutSingleCluster();layout.node.def("fitInfo",null).height(function(d,e,f){var fitInfo=pvc.text.getFitInfo(d.dx,d.dy,d.label,myself.font,diagMargin);if(!fitInfo.h){if(axisDirection=='v'&&fitInfo.v){vertDepthCutoff=Math.min(diagDepthCutoff,d.depth);}else{diagDepthCutoff=Math.min(diagDepthCutoff,d.depth);}}
this.fitInfo(fitInfo);return d.dy;});layout.node.add(pv.Bar).fillStyle('rgba(127,127,127,.001)').strokeStyle(function(d){if(d.maxDepth===1||!d.maxDepth){return null;}
return"rgba(127,127,127,0.3)";}).lineWidth(function(d){if(d.maxDepth===1||!d.maxDepth){return 0;}
return 0.5;}).text(function(d){return d.label;});var H_CUTOFF_ANG=0.30,V_CUTOFF_ANG=1.27;var diagMargin=pvc.text.getFontSize(this.font)/2;var align=isTopOrBottom?"center":(this.anchor=="left")?"right":"left";this.pvLabel=layout.label.add(pv.Label).def('lblDirection','h').textAngle(function(d){if(d.depth>=vertDepthCutoff&&d.depth<diagDepthCutoff){this.lblDirection('v');return-Math.PI/2;}
if(d.depth>=diagDepthCutoff){var tan=d.dy/d.dx;var angle=Math.atan(tan);if(angle>V_CUTOFF_ANG){this.lblDirection('v');return-Math.PI/2;}
if(angle>H_CUTOFF_ANG){this.lblDirection('d');return-angle;}}
this.lblDirection('h');return 0;}).textMargin(1).textAlign(function(d){return(axisDirection!='v'||d.depth>=vertDepthCutoff||d.depth>=diagDepthCutoff)?'center':align;}).left(function(d){return(axisDirection!='v'||d.depth>=vertDepthCutoff||d.depth>=diagDepthCutoff)?d.x+d.dx/2:((align=='right')?d.x+d.dx:d.x);}).font(this.font).text(function(d){var fitInfo=this.fitInfo();switch(this.lblDirection()){case'h':if(!fitInfo.h){return pvc.text.trimToWidth(d.dx,d.label,myself.font,'..');}
break;case'v':if(!fitInfo.v){return pvc.text.trimToWidth(d.dy,d.label,myself.font,'..');}
break;case'd':if(!fitInfo.d){var diagonalLength=Math.sqrt(d.dy*d.dy+d.dx*d.dx);return pvc.text.trimToWidth(diagonalLength-diagMargin,d.label,myself.font,'..');}
break;}
return d.label;}).cursor('default').events('all');if(this._shouldHandleClick()){this.pvLabel.cursor("pointer").event('click',function(data){var ev=arguments[arguments.length-1];return myself._handleClick(data,ev);});}
if(this.doubleClickAction){this.pvLabel.cursor("pointer").event("dblclick",function(data){var ev=arguments[arguments.length-1];myself._handleDoubleClick(data,ev);});}
var tipsySettings=def.set(Object.create(this.chart.options.tipsySettings),'gravity',tipsyGravity,'offset',diagMargin*2);this.pvLabel.title(function(d){this.instance().tooltip=d.label;return'';}).event("mouseover",pv.Behavior.tipsy(tipsySettings));},getLayoutSingleCluster:function(){var orientation=this.anchor,reverse=orientation=='bottom'||orientation=='left',data=this.chart.visualRoles(this.roleName).select(this.chart.data,{visible:true,reverse:reverse}),maxDepth=data.treeHeight,elements=data.nodes(),depthLength=this._layoutInfo.axisSize;this._rootElement=elements[0];maxDepth++;var baseDisplacement=depthLength/maxDepth,margin=maxDepth>2?((1/12)*depthLength):0;baseDisplacement-=margin;var scaleFactor=maxDepth/(maxDepth-1),orthoLength=pvc.BasePanel.orthogonalLength[orientation];var displacement=(orthoLength=='width')?(orientation==='left'?[-baseDisplacement,0]:[baseDisplacement,0]):(orientation==='top'?[0,-baseDisplacement]:[0,baseDisplacement]);this.pvRule.strokeStyle(null).lineWidth(0);var panel=this.pvRule.add(pv.Panel)
[orthoLength](depthLength).strokeStyle(null).lineWidth(0).add(pv.Panel)
[orthoLength](depthLength*scaleFactor).strokeStyle(null).lineWidth(0);panel.transform(pv.Transform.identity.translate(displacement[0],displacement[1]));return panel.add(pv.Layout.Cluster.Fill).nodes(elements).orient(orientation);},_calcTipsyGravity:function(){switch(this.anchor){case'bottom':return's';case'top':return'n';case'left':return'w';case'right':return'e';}
return's';}});pvc.AxisPanel.create=function(chart,parentPanel,cartAxis,options){var PanelClass=pvc[def.firstUpperCase(cartAxis.orientedId)+'AxisPanel']||def.fail.argumentInvalid('cartAxis',"Unsupported cartesian axis");return new PanelClass(chart,parentPanel,cartAxis,options);};pvc.XAxisPanel=pvc.AxisPanel.extend({anchor:"bottom",panelName:"xAxis"});pvc.SecondXAxisPanel=pvc.XAxisPanel.extend({panelName:"secondXAxis"});pvc.YAxisPanel=pvc.AxisPanel.extend({anchor:"left",panelName:"yAxis"});pvc.SecondYAxisPanel=pvc.YAxisPanel.extend({panelName:"secondYAxis"});pvc.AxisTitlePanel=pvc.TitlePanelAbstract.extend({panelName:'axis',_getFontExtension:function(){return this._getExtension(this.panelName+'TitleLabel','font');},applyExtensions:function(){this.extend(this.pvPanel,this.panelName+'Title_');this.extend(this.pvLabel,this.panelName+'TitleLabel_');}});pvc.PieChartPanel=pvc.BasePanel.extend({anchor:'fill',pvPie:null,pvPieLabel:null,explodedOffsetRadius:0,explodedSliceIndex:null,activeOffsetRadius:new pvc.PercentValue(0.05),valueRoleName:'value',showValues:true,valuesMask:null,labelStyle:'linked',labelFont:'10px sans-serif',linkedLabel:{linkInsetRadius:new pvc.PercentValue(0.05),linkOutsetRadius:new pvc.PercentValue(0.025),linkMargin:new pvc.PercentValue(0.025),linkHandleWidth:0.5,labelSize:new pvc.PercentValue(0.15),labelSpacingMin:0.5},constructor:function(chart,parent,options){if(!options){options={};}
var isV1Compat=chart.options.compatVersion<=1;if(isV1Compat){if(options.labelStyle==null){options.labelStyle='inside';}}
if(options.paddings==null){var innerGap=options.innerGap||0.95;delete options.innerGap;if(innerGap>0&&innerGap<1){options.paddings=Math.round((1-innerGap)*100/2)+"%";}}
['explodedOffsetRadius','activeOffsetRadius'].forEach(function(name){var value=options[name];if(value!=null){options[name]=pvc.PercentValue.parse(value);}});var labelStyle=options.labelStyle||this.labelStyle;var isLinked=labelStyle==='linked';var valuesMask=options.valuesMask;if(valuesMask==null){options.valuesMask=isLinked?"{value} ({value.percent})":"{value}";}
if(isLinked){var sourceLinkedLabel=options.linkedLabel;if(sourceLinkedLabel){var linkedLabel=options.linkedLabel=Object.create(this.linkedLabel);def.copy(linkedLabel,sourceLinkedLabel);['linkInsetRadius','linkOutsetRadius','linkMargin','labelSize'].forEach(function(name){var value=linkedLabel[name];if(value!=null){linkedLabel[name]=pvc.PercentValue.parse(value);}});}}
this.base(chart,parent,options);},_getCoreInfo:function(){if(!this._coreInfo){this._coreInfo={rootScene:this._buildScene()};}
return this._coreInfo;},_calcLayout:function(layoutInfo){var clientSize=layoutInfo.clientSize;var clientWidth=clientSize.width;var clientRadius=Math.min(clientWidth,clientSize.height)/2;if(!clientRadius){return new pvc.Size(0,0);}
var center=pv.vector(clientSize.width/2,clientSize.height/2);function resolvePercentRadius(radius){return def.between(pvc.PercentValue.resolve(radius,clientRadius),0,clientRadius);}
function resolvePercentWidth(width){return def.between(pvc.PercentValue.resolve(width,clientWidth),0,clientWidth);}
var labelFont=def.number.to(this._getExtension('pieLabel','font'));if(!def.string.is(labelFont)){labelFont=this.labelFont;}
var maxPieRadius=clientRadius;if(this.showValues&&this.labelStyle==='linked'){var linkedLabel=this.linkedLabel;var linkInsetRadius=resolvePercentRadius(linkedLabel.linkInsetRadius);var linkOutsetRadius=resolvePercentRadius(linkedLabel.linkOutsetRadius);var linkMargin=resolvePercentWidth(linkedLabel.linkMargin);var linkLabelSize=resolvePercentWidth(linkedLabel.labelSize);var textMargin=def.number.to(this._getExtension('pieLabel','textMargin'),3);var textHeight=pvc.text.getTextHeight('m',labelFont);var linkHandleWidth=linkedLabel.linkHandleWidth*textHeight;linkMargin+=linkHandleWidth;var linkLabelSpacingMin=linkedLabel.labelSpacingMin*textHeight;var freeWidthSpace=Math.max(0,clientWidth/2-clientRadius);var spaceH=Math.max(0,linkOutsetRadius+linkMargin+linkLabelSize-freeWidthSpace);var spaceV=linkOutsetRadius+textHeight;var linkAndLabelRadius=Math.max(0,spaceV,spaceH);if(linkAndLabelRadius>=maxPieRadius){this.showValues=false;if(pvc.debug>=2){pvc.log("Hiding linked labels due to insufficient space.");}}else{maxPieRadius-=linkAndLabelRadius;layoutInfo.link={insetRadius:linkInsetRadius,outsetRadius:linkOutsetRadius,elbowRadius:maxPieRadius+linkOutsetRadius,linkMargin:linkMargin,handleWidth:linkHandleWidth,labelSize:linkLabelSize,maxTextWidth:linkLabelSize-textMargin,labelSpacingMin:linkLabelSpacingMin,textMargin:textMargin,lineHeight:textHeight};}}
var explodedOffsetRadius=resolvePercentRadius(this.explodedOffsetRadius);var activeOffsetRadius=0;if(this.chart.options.hoverable){activeOffsetRadius=resolvePercentRadius(this.activeOffsetRadius);}
var effectOffsetRadius=explodedOffsetRadius+activeOffsetRadius;var normalPieRadius=maxPieRadius-effectOffsetRadius;if(normalPieRadius<0){return new pvc.Size(0,0);}
layoutInfo.center=center;layoutInfo.clientRadius=clientRadius;layoutInfo.normalRadius=normalPieRadius;layoutInfo.explodedOffsetRadius=explodedOffsetRadius;layoutInfo.activeOffsetRadius=activeOffsetRadius;layoutInfo.labelFont=labelFont;},_createCore:function(layoutInfo){var myself=this;var chart=this.chart;var options=chart.options;var visibleKeyArgs={visible:true};var coreInfo=this._getCoreInfo();var rootScene=coreInfo.rootScene;var center=layoutInfo.center;var normalRadius=layoutInfo.normalRadius;this.pvPie=new pvc.visual.PieSlice(this,this.pvPanel,{extensionId:'pie',center:layoutInfo.center,activeOffsetRadius:layoutInfo.activeOffsetRadius}).lockValue('data',rootScene.childNodes).override('angle',function(scene){return scene.vars.value.angle;}).override('baseOffsetRadius',function(){var explodeIndex=myself.explodedSliceIndex;if(explodeIndex==null||explodeIndex==this.pvMark.index){return layoutInfo.explodedOffsetRadius;}
return this.base();}).lock('outerRadius',function(){return chart.animate(0,normalRadius);}).intercept('innerRadius',function(scene){var innerRadius=pvc.PercentValue.parse(this.delegate());if(innerRadius instanceof pvc.PercentValue){innerRadius=innerRadius.resolve(this.pvMark.outerRadius());}
return innerRadius>0?chart.animate(0,innerRadius):0;},true).pvMark;if(this.showValues){if(this.labelStyle==='inside'){this.pvPieLabel=this.pvPie.anchor("outer").add(pv.Label).intercept('visible',function(getVisible,args){var scene=args[0];var angle=scene.vars.value.angle;if(angle<0.001){return false;}
return!getVisible||getVisible.apply(null,args);},this._getExtension('pieLabel','visible')).localProperty('group').group(function(scene){return scene.group;}).text(function(scene){return scene.vars.value.sliceLabel;}).textMargin(10);}else if(this.labelStyle==='linked'){var linkLayout=layoutInfo.link;rootScene.layoutLinkLabels(layoutInfo);this.pvLinkPanel=this.pvPanel.add(pv.Panel).data(rootScene.childNodes).localProperty('pieSlice').pieSlice(function(scene){return myself.pvPie.scene[this.index];});this.pvLinkLine=this.pvLinkPanel.add(pv.Line).data(function(scene){var pieSlice=this.parent.pieSlice();var midAngle=pieSlice.startAngle+pieSlice.angle/2;var outerRadius=pieSlice.outerRadius-linkLayout.insetRadius;var dot=pv.vector(pieSlice.left+outerRadius*Math.cos(midAngle),pieSlice.top+outerRadius*Math.sin(midAngle));return[dot].concat(scene.vars.link.dots);}).lock('visible').top(function(dot){return dot.y;}).left(function(dot){return dot.x;}).strokeStyle('black').lineWidth(0.5);this.pvPieLabel=this.pvLinkPanel.add(pv.Label).data(function(scene){return scene.vars.link.labelLines;}).lock('visible').localProperty('group').group(function(textLine,scene){return scene.group;}).left(function(textLine,scene){return scene.vars.link.labelX;}).top(function(textLine,scene){return scene.vars.link.labelY+((this.index+1)*linkLayout.lineHeight);}).textAlign(function(textLine,scene){return scene.vars.link.labelAnchor;}).textBaseline('bottom').textMargin(linkLayout.textMargin).text(def.identity).fillStyle('red');if(this._shouldHandleClick()){this.pvPieLabel.events('all');this._addPropClick(this.pvPieLabel);}
if(pvc.debug>=20){this.pvPanel.add(pv.Panel).zOrder(-10).left(layoutInfo.center.x-layoutInfo.clientRadius).top(layoutInfo.center.y-layoutInfo.clientRadius).width(layoutInfo.clientRadius*2).height(layoutInfo.clientRadius*2).strokeStyle('red');this.pvPanel.strokeStyle('green');var linkColors=pv.Colors.category10();this.pvLinkLine.segmented(true).strokeStyle(function(){return linkColors(this.index);});}}
this.pvPieLabel.font(layoutInfo.labelFont);}},applyExtensions:function(){this.extend(this.pvPie,"pie_");this.extend(this.pvPieLabel,"pieLabel_");this.extend(this.pvLinkLine,"pieLinkLine_");this.extend(this.pvPanel,"chart_");},_renderInteractive:function(){this.pvPanel.render();},_getSignums:function(){var signums=[this.pvPie];if(this.pvPieLabel){signums.push(this.pvPieLabel);}
return signums;},_buildScene:function(){var rootScene=new pvc.visual.PieRootScene(this);this.sum=rootScene.vars.sumAbs.value;return rootScene;}});def.type('pvc.visual.PieRootScene',pvc.visual.Scene).init(function(panel){var chart=panel.chart;var data=chart.visualRoles('category').flatten(chart.data,pvc.data.visibleKeyArgs);this.base(null,{panel:panel,group:data});var valueRoleName=panel.valueRoleName;var valueDimName=chart.visualRoles(valueRoleName).firstDimensionName();var valueDim=data.dimensions(valueDimName);var options=chart.options;var percentValueFormat=options.percentValueFormat;var rootScene=this;var sumAbs=0;var CategSceneClass=def.type(pvc.visual.PieCategoryScene).init(function(categData,value){this.base(rootScene,{group:categData});this.vars.category=new pvc.visual.ValueLabelVar(categData.value,categData.label);sumAbs+=Math.abs(value);this.vars.value=new pvc.visual.ValueLabelVar(value,formatValue(value,categData));});panel._extendSceneType('category',CategSceneClass,['sliceLabel','sliceLabelMask']);data.children().each(function(categData){var value=categData.dimensions(valueDimName).sum(pvc.data.visibleKeyArgs);if(value!==0){new CategSceneClass(categData,value);}});this.angleScale=pv.Scale.linear(0,sumAbs).range(0,2*Math.PI).by1(Math.abs);this.vars.sumAbs=new pvc.visual.ValueLabelVar(sumAbs,formatValue(sumAbs));this.childNodes.forEach(function(categScene){completeBuildCategScene.call(categScene);});function formatValue(value,categData){if(categData){var datums=categData._datums;if(datums.length===1){return datums[0].atoms[valueDimName].label;}}
return valueDim.format(value);}
function completeBuildCategScene(){var valueVar=this.vars.value;valueVar.angle=this.parent.angleScale(valueVar.value);var percent=Math.abs(valueVar.value)/sumAbs;valueVar.percent=new pvc.visual.ValueLabelVar(percent,percentValueFormat(percent));valueVar.sliceLabel=this.sliceLabel();}}).add({layoutLinkLabels:function(layoutInfo){var startAngle=-Math.PI/2;var leftScenes=[];var rightScenes=[];this.childNodes.forEach(function(categScene){startAngle=categScene.layoutI(layoutInfo,startAngle);(categScene.vars.link.dir>0?rightScenes:leftScenes).push(categScene);});this._distributeLabels(-1,leftScenes,layoutInfo);this._distributeLabels(+1,rightScenes,layoutInfo);},_distributeLabels:function(dir,scenes,layoutInfo){scenes.sort(function(sceneA,sceneB){return def.compare(sceneA.vars.link.targetY,sceneB.vars.link.targetY);});this._distributeLabelsDownwards(scenes,layoutInfo)&&this._distributeLabelsUpwards(scenes,layoutInfo)&&this._distributeLabelsEvenly(scenes,layoutInfo);scenes.forEach(function(categScene){categScene.layoutII(layoutInfo);});},_distributeLabelsDownwards:function(scenes,layoutInfo){var linkLayout=layoutInfo.link;var labelSpacingMin=linkLayout.labelSpacingMin;var yMax=layoutInfo.clientSize.height;var overlapping=false;for(var i=0,J=scenes.length-1;i<J;i++){var linkVar0=scenes[i].vars.link;if(!i&&linkVar0.labelTop()<0){overlapping=true;}
var linkVar1=scenes[i+1].vars.link;var labelTopMin1=linkVar0.labelBottom()+labelSpacingMin;if(linkVar1.labelTop()<labelTopMin1){var halfLabelHeight1=linkVar1.labelHeight/2;var targetY1=labelTopMin1+halfLabelHeight1;var targetYMax=yMax-halfLabelHeight1;if(targetY1>targetYMax){overlapping=true;linkVar1.targetY=targetYMax;}else{linkVar1.targetY=targetY1;}}}
return overlapping;},_distributeLabelsUpwards:function(scenes,layoutInfo){var linkLayout=layoutInfo.link;var labelSpacingMin=linkLayout.labelSpacingMin;var overlapping=false;for(var i=scenes.length-1;i>0;i--){var linkVar1=scenes[i-1].vars.link;var linkVar0=scenes[i].vars.link;if(i===1&&linkVar1.labelTop()<0){overlapping=true;}
var labelBottomMax1=linkVar0.labelTop()-labelSpacingMin;if(linkVar1.labelBottom()>labelBottomMax1){var halfLabelHeight1=linkVar1.labelHeight/2;var targetY1=labelBottomMax1-halfLabelHeight1;var targetYMin=halfLabelHeight1;if(targetY1<targetYMin){overlapping=true;linkVar1.targetY=targetYMin;}else{linkVar1.targetY=targetY1;}}}
return overlapping;},_distributeLabelsEvenly:function(scenes,layoutInfo){var linkLayout=layoutInfo.link;var labelSpacingMin=linkLayout.labelSpacingMin;var totalHeight=0;scenes.forEach(function(categScene){totalHeight+=categScene.vars.link.labelHeight;});var freeSpace=layoutInfo.clientSize.height-totalHeight;var labelSpacing=freeSpace;if(scenes.length>1){labelSpacing/=(scenes.length-1);}
var y=0;scenes.forEach(function(scene){var linkVar=scene.vars.link;var halfLabelHeight=linkVar.labelHeight/2;y+=halfLabelHeight;linkVar.targetY=y;y+=halfLabelHeight+labelSpacing;});return true;}});def.type('pvc.visual.PieLinkLabelVar').add({labelTop:function(){return this.targetY-this.labelHeight/2;},labelBottom:function(){return this.targetY+this.labelHeight/2;}});def.type('pvc.visual.PieCategoryScene',pvc.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask;},sliceLabel:function(){return this.format(this.sliceLabelMask());},layoutI:function(layoutInfo,startAngle){var valueVar=this.vars.value;var endAngle=startAngle+valueVar.angle;var midAngle=(startAngle+endAngle)/2;var linkVar=(this.vars.link=new pvc.visual.PieLinkLabelVar());var linkLayout=layoutInfo.link;var labelLines=pvc.text.justify(valueVar.sliceLabel,linkLayout.maxTextWidth,layoutInfo.labelFont);linkVar.labelLines=labelLines;linkVar.labelHeight=labelLines.length*linkLayout.lineHeight;var cosMid=Math.cos(midAngle);var sinMid=Math.sin(midAngle);var isAtRight=cosMid>=0;var dir=isAtRight?1:-1;linkVar.labelAnchor=isAtRight?'left':'right';var center=layoutInfo.center;var elbowRadius=linkLayout.elbowRadius;var elbowX=center.x+elbowRadius*cosMid;var elbowY=center.y+elbowRadius*sinMid;var anchorX=center.x+dir*elbowRadius;var targetX=anchorX+dir*linkLayout.linkMargin;linkVar.dots=[pv.vector(elbowX,elbowY),pv.vector(anchorX,elbowY)];linkVar.elbowY=elbowY;linkVar.targetY=elbowY+0;linkVar.targetX=targetX;linkVar.dir=dir;return endAngle;},layoutII:function(layoutInfo){var linkVar=this.vars.link;var targetY=linkVar.targetY;var targetX=linkVar.targetX;var dots=linkVar.dots;var handleWidth=layoutInfo.link.handleWidth;if(handleWidth>0){dots.push(pv.vector(targetX-linkVar.dir*handleWidth,targetY));}
dots.push(pv.vector(targetX,targetY));linkVar.labelX=targetX;linkVar.labelY=targetY-linkVar.labelHeight/2;}});pvc.PieChart=pvc.BaseChart.extend({pieChartPanel:null,legendSource:'category',_initVisualRoles:function(){this.base();this._addVisualRoles({category:{isRequired:true,defaultDimensionName:'category*',autoCreateDimension:true},value:{isMeasure:true,isRequired:true,isPercent:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'value'}});},_preRenderContent:function(contentOptions){this.base();if(pvc.debug>=3){pvc.log("Prerendering in pieChart");}
var options=this.options;this.pieChartPanel=new pvc.PieChartPanel(this,this.basePanel,def.create(contentOptions,{innerGap:options.innerGap,explodedOffsetRadius:options.explodedSliceRadius,explodedSliceIndex:options.explodedSliceIndex,activeOffsetRadius:options.activeSliceRadius,showValues:options.showValues,valuesMask:options.valuesMask,labelStyle:options.valuesLabelStyle,linkedLabel:options.linkedLabel,labelFont:options.valuesLabelFont,scenes:def.getPath(options,'pie.scenes')}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{})});pvc.BarAbstractPanel=pvc.CartesianAbstractPanel.extend({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,data:null,barSizeRatio:0.9,maxBarSize:200,showValues:true,barWidth:null,barStepWidth:null,_linePanel:null,constructor:function(chart,parent,options){this.base(chart,parent,options);options=this.chart.options;this.stacked=options.stacked;},_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;if(colorAxis.option('DrawMarker')){var keyArgs={drawMarker:true,markerShape:colorAxis.option('Shape'),drawRule:colorAxis.option('DrawLine'),markerPvProto:new pv.Mark()};this.extend(keyArgs.markerPvProto,'bar_',{constOnly:true});groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_createCore:function(){this.base();var chart=this.chart,options=chart.options,isStacked=!!this.stacked,isVertical=this.isOrientationVertical();var data=this._getVisibleData(),seriesData=chart._serRole.flatten(data),rootScene=this._buildScene(data,seriesData);var orthoScale=chart.axes.ortho.scale,orthoZero=orthoScale(0),sceneOrthoScale=chart.axes.ortho.sceneScale({sceneVarName:'value',nullToZero:false}),bandWidth=chart.axes.base.scale.range().band,barStepWidth=chart.axes.base.scale.range().step,barWidth,reverseSeries=isVertical===isStacked;if(isStacked){barWidth=bandWidth;}else{var S=seriesData.childCount();barWidth=S>0?(bandWidth*this.barSizeRatio/S):0;}
if(barWidth>this.maxBarSize){barWidth=this.maxBarSize;}
this.barWidth=barWidth;this.barStepWidth=barStepWidth;this.pvBarPanel=this.pvPanel.add(pv.Layout.Band).layers(rootScene.childNodes).values(function(seriesScene){return seriesScene.childNodes;}).orient(isVertical?'bottom-left':'left-bottom').layout(isStacked?'stacked':'grouped').verticalMode(this._barVerticalMode()).yZero(orthoZero).band.x(chart.axes.base.sceneScale({sceneVarName:'category'})).w(bandWidth).differentialControl(this._barDifferentialControl()).item.order(reverseSeries?"reverse":null).h(function(scene){var h=sceneOrthoScale(scene);return h!=null?chart.animate(0,h-orthoZero):null;}).w(barWidth).horizontalRatio(this.barSizeRatio).verticalMargin(options.barStackedMargin||0).end;this.pvBar=new pvc.visual.Bar(this,this.pvBarPanel.item,{extensionId:'bar',freePosition:true}).lockDimensions().pvMark.antialias(false);;this._addOverflowMarkers();if(this.showValues){this.pvBarLabel=this.pvBar.anchor(this.valuesAnchor||'center').add(pv.Label).localProperty('_valueVar')._valueVar(function(scene){return options.showValuePercentage?scene.vars.value.percent:scene.vars.value;}).visible(function(){var length=this.scene.target[this.index][isVertical?'height':'width'];return length>=4;}).text(function(){return this._valueVar().label;});}},_barVerticalMode:function(){return null;},_barDifferentialControl:function(){return null;},applyExtensions:function(){this.base();this.extend(this.pvBarPanel,"barPanel_");this.extend(this.pvBar,"bar_");this.extend(this.pvUnderflowMarker,"barUnderflowMarker_");this.extend(this.pvOverflowMarker,"barOverflowMarker_");this.extend(this.pvBarLabel,"barLabel_");if(this._linePanel){this.extend(this._linePanel.pvLine,"barSecondLine_");this.extend(this._linePanel.pvDot,"barSecondDot_");}},_addOverflowMarkers:function(){var orthoAxis=this.chart.axes.ortho;if(orthoAxis.option('FixedMax')!=null){this.pvOverflowMarker=this._addOverflowMarker(false,orthoAxis.scale);}
if(orthoAxis.option('FixedMin')!=null){this.pvUnderflowMarker=this._addOverflowMarker(true,orthoAxis.scale);}},_addOverflowMarker:function(isMin,orthoScale){},_renderInteractive:function(){this.pvPanel.render();},_getSignums:function(){return[this.pvBar];},_buildScene:function(data,seriesData){var rootScene=new pvc.visual.Scene(null,{panel:this,group:data}),categDatas=data._children;seriesData.children().each(createSeriesScene,this);return rootScene;function createSeriesScene(seriesData1){var seriesScene=new pvc.visual.Scene(rootScene,{group:seriesData1}),seriesKey=seriesData1.key;this._onNewSeriesScene(seriesScene,seriesData1);categDatas.forEach(function(categData1){var categKey=categData1.key,group=data._childrenByKey[categKey]._childrenByKey[seriesKey],datum=group?null:createNullDatum(seriesData1,categData1),scene=new pvc.visual.Scene(seriesScene,{group:group,datum:datum});this._onNewSeriesCategoryScene(scene,categData1,seriesData1);},this);}
function createNullDatum(serData1,catData1){var atoms=def.array.append(def.own(serData1.atoms),def.own(catData1.atoms));return new pvc.data.Datum(data,atoms,true);}},_onNewSeriesScene:function(seriesScene,seriesData1){seriesScene.vars.series=new pvc.visual.ValueLabelVar(seriesData1.value,seriesData1.label);},_onNewSeriesCategoryScene:function(categScene,categData1,seriesData1){var categVar=categScene.vars.category=new pvc.visual.ValueLabelVar(categData1.value,categData1.label);categVar.group=categData1;var chart=this.chart,valueDim=categScene.group?categScene.group.dimensions(chart._valueDim.name):null;var value=valueDim?valueDim.sum({visible:true,zeroIfNone:false}):null;var valueVar=categScene.vars.value=new pvc.visual.ValueLabelVar(value,chart._valueDim.format(value));if(chart.options.showValuePercentage){if(value==null){valueVar.percent=new pvc.visual.ValueLabelVar(null,valueVar.label);}else{var valuePct=valueDim.percentOverParent({visible:true});valueVar.percent=new pvc.visual.ValueLabelVar(valuePct,chart.options.percentValueFormat.call(null,valuePct));}}
categScene.isNull=!categScene.group;}});pvc.BarAbstract=pvc.CategoricalAbstract.extend({constructor:function(options){this.base(options);var parent=this.parent;if(parent){this._valueRole=parent._valueRole;}},_initVisualRoles:function(){this.base();this._addVisualRoles({value:{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'value'}});this._valueRole=this.visualRoles('value');},_initData:function(){this.base.apply(this,arguments);var data=this.data;this._valueDim=data.dimensions(this._valueRole.firstDimensionName());},defaults:def.create(pvc.CategoricalAbstract.prototype.defaults,{showValues:true,barSizeRatio:0.9,maxBarSize:2000,barStackedMargin:0,valuesAnchor:"center",showValuePercentage:false})});pvc.BarPanel=pvc.BarAbstractPanel.extend({});pvc.BarChart=pvc.BarAbstract.extend({_processOptionsCore:function(options){this.base(options);if(options.secondAxis&&!options.showLines&&!options.showDots&&!options.showAreas){options.showLines=true;}},_hasDataPartRole:function(){return true;},_getAxisDataCells:function(axisType,axisIndex){if(this.options.secondAxis){var dataPartValues;if(axisType==='ortho'){dataPartValues=this.options.secondAxisIndependentScale?(''+axisIndex):['0','1'];}else if(axisType==='color'){dataPartValues=(''+axisIndex);}
if(dataPartValues!=null){return this._buildAxisDataCells(axisType,axisIndex,dataPartValues);}}
return this.base(axisType,axisIndex);},_isDataCellStacked:function(role,dataPartValue){return(!dataPartValue||(dataPartValue==='0'))&&this.options.stacked;},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in barChart");}
var options=this.options;var barPanel=new pvc.BarPanel(this,parentPanel,{colorAxis:this.axes.color,dataPartValue:options.secondAxis?'0':null,barSizeRatio:options.barSizeRatio,maxBarSize:options.maxBarSize,showValues:options.showValues,valuesAnchor:options.valuesAnchor,orientation:options.orientation});if(options.secondAxis){if(pvc.debug>=3){pvc.log("Creating LineDotArea panel.");}
var linePanel=new pvc.LineDotAreaPanel(this,parentPanel,{colorAxis:this.axes.color2,dataPartValue:'1',stacked:false,showValues:!(options.compatVersion<=1)&&options.showValues,valuesAnchor:options.valuesAnchor!='center'?options.valuesAnchor:'right',showLines:options.showLines,showDots:options.showDots,showAreas:options.showAreas,orientation:options.orientation,nullInterpolationMode:options.nullInterpolationMode});this._linePanel=linePanel;barPanel._linePanel=linePanel;}
return barPanel;},defaults:def.create(pvc.BarAbstract.prototype.defaults,{showDots:true,showLines:true,showAreas:false,nullInterpolationMode:'none'})});pvc.NormalizedBarPanel=pvc.BarAbstractPanel.extend({_barVerticalMode:function(){return'expand';}});pvc.NormalizedBarChart=pvc.BarAbstract.extend({constructor:function(options){options=def.set(options,'stacked',true);this.base(options);},_processOptionsCore:function(options){options.stacked=true;this.base(options);},_getVisibleValueExtentConstrained:function(axis,min,max){if(axis.type==='ortho'){min=0;max=100;}
return this.base(axis,min,max);},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in NormalizedBarChart");}
var options=this.options;return new pvc.NormalizedBarPanel(this,parentPanel,{barSizeRatio:options.barSizeRatio,maxBarSize:options.maxBarSize,showValues:options.showValues,valuesAnchor:options.valuesAnchor,orientation:options.orientation});}});pvc.WaterfallPanel=pvc.BarAbstractPanel.extend({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var isFalling=this.chart._isFalling;return function(scene){if(isFalling&&!this.index){return 1;}
if(scene.vars.category.group._isFlattenGroup){return-2;}
return isFalling?-1:1;};},_createCore:function(){this.base();var chart=this.chart,options=chart.options,isVertical=this.isOrientationVertical(),anchor=isVertical?"bottom":"left",ao=this.anchorOrtho(anchor),ruleRootScene=this._buildRuleScene(),orthoScale=chart.axes.ortho.scale,orthoPanelMargin=0.04*(orthoScale.range()[1]-orthoScale.range()[0]),orthoZero=orthoScale(0),sceneOrthoScale=chart.axes.ortho.sceneScale({sceneVarName:'value'}),sceneBaseScale=chart.axes.base.sceneScale({sceneVarName:'category'}),baseScale=chart.axes.base.scale,barWidth2=this.barWidth/2,barWidth=this.barWidth,barStepWidth=this.barStepWidth,isFalling=chart._isFalling,waterColor=chart._waterColor;if(chart.options.showWaterGroupAreas){var panelColors=pv.Colors.category10();var waterGroupRootScene=this._buildWaterGroupScene();this.pvWaterfallGroupPanel=this.pvPanel.add(pv.Panel).data(waterGroupRootScene.childNodes).zOrder(-1).fillStyle(function(scene){return panelColors(0).alpha(0.15);})
[ao](function(scene){var categVar=scene.vars.category;return baseScale(categVar.leftValue)-barStepWidth/2;})
[this.anchorLength(anchor)](function(scene){var categVar=scene.vars.category,length=Math.abs(baseScale(categVar.rightValue)-
baseScale(categVar.leftValue));return length+barStepWidth;})
[anchor](function(scene){return orthoScale(scene.vars.value.bottomValue)-orthoPanelMargin/2;})
[this.anchorOrthoLength(anchor)](function(scene){return orthoScale(scene.vars.value.heightValue)+orthoPanelMargin;});}
this.pvBar.sign.override('baseColor',function(type){var color=this.base(type);if(type==='fill'){if(this.scene.vars.category.group._isFlattenGroup){return pv.color(color).alpha(0.75);}}
return color;});this.pvWaterfallLine=new pvc.visual.Rule(this,this.pvPanel,{extensionId:'barWaterfallLine',noTooltips:false,noHover:false,noSelect:false,noClick:false,noDoubleClick:false}).lockValue('data',ruleRootScene.childNodes).optional('visible',function(){return(isFalling&&!!this.scene.previousSibling)||(!isFalling&&!!this.scene.nextSibling);}).optional(anchor,function(){return orthoZero+chart.animate(0,sceneOrthoScale(this.scene)-orthoZero);}).optionalValue(this.anchorLength(anchor),barStepWidth+barWidth).optional(ao,isFalling?function(){return sceneBaseScale(this.scene)-barStepWidth-barWidth2;}:function(){return sceneBaseScale(this.scene)-barWidth2;}).override('baseColor',function(){return this.delegate(waterColor);}).pvMark.lineCap('round');if(chart.options.showWaterValues){this.pvWaterfallLabel=this.pvWaterfallLine.add(pv.Label)
[anchor](function(scene){return orthoZero+chart.animate(0,sceneOrthoScale(scene)-orthoZero);}).visible(function(scene){if(scene.vars.category.group._isFlattenGroup){return false;}
return isFalling||!!scene.nextSibling;})
[this.anchorOrtho(anchor)](sceneBaseScale).textAlign(isVertical?'center':'left').textBaseline(isVertical?'bottom':'middle').textStyle(pv.Color.names.darkgray.darker(2)).textMargin(5).text(function(scene){return scene.vars.value.label;});}},applyExtensions:function(){this.base();this.extend(this.pvWaterfallLine,"barWaterfallLine_");this.extend(this.pvWaterfallLabel,"barWaterfallLabel_");this.extend(this.pvWaterfallGroupPanel,"barWaterfallGroup_");},_buildRuleScene:function(){var rootScene=new pvc.visual.Scene(null,{panel:this,group:this._getVisibleData()});if(this.chart._ruleInfos){this.chart._ruleInfos.forEach(createCategScene,this);}
return rootScene;function createCategScene(ruleInfo){var categData1=ruleInfo.group,categScene=new pvc.visual.Scene(rootScene,{group:categData1});var categVar=categScene.vars.category=new pvc.visual.ValueLabelVar(categData1.value,categData1.label);categVar.group=categData1;var value=ruleInfo.offset;categScene.vars.value=new pvc.visual.ValueLabelVar(value,this.chart._valueDim.format(value));}},_buildWaterGroupScene:function(){var chart=this.chart,ruleInfos=this.chart._ruleInfos,ruleInfoByCategKey=ruleInfos&&def.query(ruleInfos).object({name:function(ruleInfo){return ruleInfo.group.absKey;},value:function(ruleInfo){return ruleInfo;}}),isFalling=chart._isFalling,rootCatData=chart._catRole.select(chart.partData(this.dataPartValue),{visible:true}),rootScene=new pvc.visual.Scene(null,{panel:this,group:rootCatData});if(ruleInfoByCategKey){createCategSceneRecursive(rootCatData,0);}
return rootScene;function createCategSceneRecursive(catData,level){var children=catData.children().where(function(child){return child.key!=="";}).array();if(children.length){if(level){var categScene=new pvc.visual.Scene(rootScene,{group:catData});var categVar=categScene.vars.category=new pvc.visual.ValueLabelVar(catData.value,catData.label);categVar.group=catData;categVar.level=level;var valueVar=categScene.vars.value={};var ruleInfo=ruleInfoByCategKey[catData.absKey];var offset=ruleInfo.offset,range=ruleInfo.range,height=-range.min+range.max;if(isFalling){var lastChild=lastLeaf(catData);var lastRuleInfo=ruleInfoByCategKey[lastChild.absKey];categVar.leftValue=ruleInfo.group.value;categVar.rightValue=lastRuleInfo.group.value;valueVar.bottomValue=offset-range.max;}else{var firstChild=firstLeaf(catData);var firstRuleInfo=ruleInfoByCategKey[firstChild.absKey];categVar.leftValue=firstRuleInfo.group.value;categVar.rightValue=ruleInfo.group.value;valueVar.bottomValue=offset-range.max;}
valueVar.heightValue=height;}
children.forEach(function(child){createCategSceneRecursive(child,level+1);});}}
function firstLeaf(data){var firstChild=data._children&&data._children[0];return firstChild?firstLeaf(firstChild):data;}
function lastLeaf(data){var lastChild=data._children&&data._children[data._children.length-1];return lastChild?lastLeaf(lastChild):data;}}});pvc.WaterfallChart=pvc.BarAbstract.extend({_isFalling:true,_ruleInfos:null,_waterColor:pv.Color.names.darkblue,constructor:function(options){this.base(options);var parent=this.parent;if(parent){this._isFalling=parent._isFalling;}},_processOptionsCore:function(options){options.stacked=true;if(options.showWaterValues===undefined){options.showWaterValues=options.showValues;}
options.useCompositeAxis=false;this.base(options);},_initVisualRoles:function(){this.base();this._isFalling=(this.options.waterDirection==='down');this._catRole.setFlatteningMode(this._isFalling?'tree-pre':'tree-post');this._catRole.setFlattenRootLabel(this.options.allCategoryLabel);},_initLegendScenes:function(){this.base();var strokeStyle=this._getExtension("barWaterfallLine","strokeStyle");if(strokeStyle&&!def.fun.is(strokeStyle)){this._waterColor=pv.color(strokeStyle);}
this._addLegendGroup({id:"waterfallTotalLine",type:"discreteColorAndShape",items:[{value:null,label:this.options.accumulatedLineLabel,color:this._waterColor,shape:'bar',isOn:def.retTrue,click:null}]});},_reduceStackedCategoryValueExtent:function(result,catRange,catGroup){var offset,negOffset;if(!result){if(catRange){offset=catRange.max;negOffset=catRange.min;this._ruleInfos=[{offset:offset,negOffset:negOffset,group:catGroup,range:catRange}];return{min:catRange.min,max:catRange.max,offset:offset,negOffset:negOffset};}
return null;}
offset=result.offset;negOffset=result.negOffset;if(this._isFalling){this._ruleInfos.push({offset:offset,negOffset:negOffset,group:catGroup,range:catRange});}
if(!catGroup._isFlattenGroup){var dir=this._isFalling?-1:1;offset=result.offset=offset+dir*catRange.max;negOffset=result.negOffset=negOffset-dir*catRange.min;if(negOffset<result.min){result.min=negOffset;}
if(offset>result.max){result.max=offset;}}
if(!this._isFalling){this._ruleInfos.push({offset:offset,negOffset:negOffset,group:catGroup,range:catRange});}
return result;},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in WaterfallChart");}
var options=this.options;return new pvc.WaterfallPanel(this,parentPanel,{waterfall:options.waterfall,barSizeRatio:options.barSizeRatio,maxBarSize:options.maxBarSize,showValues:options.showValues,orientation:options.orientation});},defaults:def.create(pvc.BarAbstract.prototype.defaults,{waterDirection:'down',showWaterGroupAreas:true,allCategoryLabel:"All",accumulatedLineLabel:"Accumulated"})});pvc.LineDotAreaPanel=pvc.CartesianAbstractPanel.extend({anchor:'fill',stacked:false,pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,showLines:true,showDots:true,showValues:true,valuesAnchor:"right",valueRoleName:null,nullInterpolationMode:'linear',_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;var drawMarker=def.nullyTo(colorAxis.option('DrawMarker',true),this.showDots||this.showAreas);var drawRule=def.nullyTo(colorAxis.option('DrawLine',true),this.showLines&&!this.showAreas);if(drawMarker||drawRule){var keyArgs={};if((keyArgs.drawMarker=drawMarker)){var markerShape=colorAxis.option('Shape',true);if(this.showDots){if(!markerShape){markerShape='circle';}
keyArgs.markerPvProto=new pv.Dot().lineWidth(1.5).shapeSize(12);}else{keyArgs.markerPvProto=new pv.Mark();}
keyArgs.markerShape=markerShape;this.extend(keyArgs.markerPvProto,'dot_',{constOnly:true});}
if((keyArgs.drawRule=drawRule)){keyArgs.rulePvProto=new pv.Line().lineWidth(1.5);this.extend(keyArgs.rulePvProto,'line_',{constOnly:true});}
groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_createCore:function(){this.base();this.valueRoleName=this.chart.axes.ortho.role.name;var myself=this,chart=this.chart,options=chart.options,isStacked=this.stacked,showDots=this.showDots,showAreas=this.showAreas,showLines=this.showLines,anchor=this.isOrientationVertical()?"bottom":"left";var isBaseDiscrete=chart._catRole.grouping.isDiscrete(),data=this._getVisibleData(),isDense=!(this.width>0)||(data._children.length/this.width>0.5),rootScene=this._buildScene(data,isBaseDiscrete);if(isDense&&(options.selectable||options.hoverable)){options.selectable=false;options.hoverable=false;if(pvc.debug>=3){pvc.log("Warning: Disabling selection and hovering because the chart is to \"dense\".");}}
if(showAreas){this.pvPanel.zOrder(-7);}else{this.pvPanel.zOrder(1);}
this.pvScatterPanel=this.pvPanel.add(pv.Panel).lock('data',rootScene.childNodes);var areaFillColorAlpha=showAreas&&showLines&&!isStacked?0.5:null;this.pvArea=new pvc.visual.Area(this,this.pvScatterPanel,{extensionId:'area',antialias:showAreas&&!showLines,segmented:!isDense,noTooltips:false,noHover:false}).lock('visible',def.retTrue).lock('data',function(seriesScene){return seriesScene.childNodes;}).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;}).override('dy',function(){return chart.animate(0,this.scene.orthoLength);}).override('color',function(type){return showAreas?this.base(type):null;}).override('baseColor',function(type){var color=this.base(type);if(color&&!this.hasDelegate()&&areaFillColorAlpha!=null){color=color.alpha(areaFillColorAlpha);}
return color;}).override('fixAntialiasStrokeWidth',function(){if(this.scene.isNull||this.scene.isAlone){return 0;}
return this.base();}).pvMark;var showDotsOnly=showDots&&!showLines&&!showAreas,lineCopiesAreaColor=!showLines&&showAreas,darkerLineAndDotColor=isStacked&&showAreas;function lineAndDotNormalColor(type){var color=this.base(type);if(color&&darkerLineAndDotColor&&!this.hasDelegate()){color=color.darker(0.6);}
return color;}
this.pvLine=new pvc.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(anchor)),{extensionId:'line',freePosition:true}).lock('visible',showDotsOnly?def.retFalse:(isBaseDiscrete&&isStacked?function(){return!this.scene.isNull||this.scene.isIntermediate;}:function(){return!this.scene.isNull;})).override('color',function(type){if(lineCopiesAreaColor&&!this.scene.isActiveSeries()){return myself.pvArea.fillStyle();}
return this.base(type);}).override('baseColor',lineAndDotNormalColor).override('baseStrokeWidth',function(){var strokeWidth;if(showLines){strokeWidth=this.base();}
return strokeWidth==null?1.5:strokeWidth;}).pvMark;var showAloneDots=!(showAreas&&isBaseDiscrete&&isStacked);this.pvDot=new pvc.visual.Dot(this,this.pvLine,{extensionId:'dot',freePosition:true}).intercept('visible',function(){var scene=this.scene;return(!scene.isNull&&!scene.isIntermediate&&!scene.isInterpolated)&&this.delegate(true);}).override('color',function(type){if(!showDots){var visible=this.scene.isActive||(!showAloneDots&&this.scene.isSingle)||(showAloneDots&&this.scene.isAlone);if(!visible){return pvc.invisibleFill;}}
return this.base(type);}).override('baseColor',lineAndDotNormalColor).override('baseSize',function(){if(!showDots){var visible=this.scene.isActive||(!showAloneDots&&this.scene.isSingle)||(showAloneDots&&this.scene.isAlone);if(visible&&!this.scene.isActive){var lineWidth=Math.max(myself.pvLine.lineWidth(),0.2)/2;return lineWidth*lineWidth;}}
return this.base();}).pvMark;if(this.showValues){this.pvLabel=this.pvDot.anchor(this.valuesAnchor).add(pv.Label).bottom(0).text(function(scene){return scene.vars.value.label;});}},applyExtensions:function(){this.base();this.extend(this.pvScatterPanel,"scatterPanel_");this.extend(this.pvArea,"area_");this.extend(this.pvLine,"line_");this.extend(this.pvDot,"dot_");this.extend(this.pvLabel,"label_");this.extend(this.pvLabel,"lineLabel_");},_renderInteractive:function(){this.pvScatterPanel.render();},_getSignums:function(){var marks=[];marks.push(this.pvDot);if(this.showLines||this.showAreas){marks.push(this.pvLine);}
return marks;},_buildScene:function(data,isBaseDiscrete){var rootScene=new pvc.visual.Scene(null,{panel:this,group:data}),categDatas=data._children,interpolate=this.nullInterpolationMode==='linear';var chart=this.chart,valueDim=data.owner.dimensions(chart.axes.ortho.role.firstDimensionName()),firstCategDim=!isBaseDiscrete?data.owner.dimensions(chart.axes.base.role.firstDimensionName()):null,isStacked=this.stacked,visibleKeyArgs={visible:true,zeroIfNone:false},orthoScale=this.dataPartValue!=='1'?chart.axes.ortho.scale:chart.axes.ortho2.scale,orthoNullValue=def.scope(function(){var domain=orthoScale.domain(),dmin=domain[0],dmax=domain[1];if(dmin*dmax>=0){return dmin>=0?dmin:dmax;}
return 0;}),orthoZero=orthoScale(0),sceneBaseScale=chart.axes.base.sceneScale({sceneVarName:'category'});var reversedSeriesScenes=createSeriesScenes.call(this),seriesCount=reversedSeriesScenes.length;var categInfos=categDatas.map(createCategInfo,this);function createCategInfo(categData1,categIndex){var categKey=categData1.key;var seriesInfos=[];var categInfo={data:categData1,value:categData1.value,label:categData1.label,isInterpolated:false,seriesInfos:seriesInfos,index:categIndex};reversedSeriesScenes.forEach(function(seriesScene){var group=data._childrenByKey[categKey];var seriesData1=seriesScene.vars.series.value==null?null:seriesScene.group;if(seriesData1){group=group._childrenByKey[seriesData1.key];}
var value=group?group.dimensions(valueDim.name).sum(visibleKeyArgs):null;var seriesInfo={data:seriesData1,group:group,value:value,isNull:value==null,categ:categInfo};seriesInfos.push(seriesInfo);},this);return categInfo;}
var Interpolation=def.type().init(function(categInfos){this._categInfos=categInfos;this._outCategInfos=[];this._seriesCount=categInfos.length>0?categInfos[0].seriesInfos.length:0;this._seriesStates=def.range(0,this._seriesCount).select(function(seriesIndex){return new InterpolationSeriesState(this,seriesIndex);},this).array();if(!isBaseDiscrete&&categInfos.length>=2){if((+categInfos[1].value)>=(+categInfos[0].value)){this._comparer=def.compare;}else{this._comparer=function(b,a){return def.compare(a,b);};}}}).add({interpolate:function(){var categInfo;while((categInfo=this._categInfos.shift())){categInfo.seriesInfos.forEach(this._visitSeries,this);this._outCategInfos.push(categInfo);}
return this._outCategInfos;},_visitSeries:function(seriesInfo,seriesIndex){this._seriesStates[seriesIndex].visit(seriesInfo);},firstNonNullOfSeries:function(seriesIndex){var categIndex=0,categCount=this._categInfos.length;while(categIndex<categCount){var categInfo=this._categInfos[categIndex++];if(!categInfo.isInterpolated){var seriesInfo=categInfo.seriesInfos[seriesIndex];if(!seriesInfo.isNull){return seriesInfo;}}}},_setCategory:function(categValue){!isBaseDiscrete||def.assert("Only for continuous base.");function getCategValue(categInfo){return+categInfo.value;}
var index=def.array.binarySearch(this._categInfos,+categValue,this._comparer,getCategValue);if(index<0){var categInfo={value:firstCategDim.type.cast(categValue),isInterpolated:true};categInfo.label=firstCategDim.format(categInfo.value);categInfo.seriesInfos=def.range(0,this._seriesCount).select(function(seriesScene,seriesIndex){return{value:null,isNull:true,categ:categInfo};}).array();this._categInfos.splice(~index,0,categInfo);}
return index;}});var InterpolationSeriesState=def.type().init(function(interpolation,seriesIndex){this.interpolation=interpolation;this.index=seriesIndex;this._lastNonNull(null);}).add({visit:function(seriesInfo){if(seriesInfo.isNull){this._interpolate(seriesInfo);}else{this._lastNonNull(seriesInfo);}},_lastNonNull:function(seriesInfo){if(arguments.length){this.__lastNonNull=seriesInfo;this.__nextNonNull=undefined;}
return this.__lastNonNull;},_nextNonNull:function(){return this.__nextNonNull;},_initInterpData:function(){if(this.__nextNonNull!==undefined){return;}
var next=this.__nextNonNull=this.interpolation.firstNonNullOfSeries(this.index)||null;var last=this.__lastNonNull;if(next&&last){var fromValue=last.value;var toValue=next.value;var deltaValue=toValue-fromValue;if(isBaseDiscrete){var stepCount=next.categ.index-last.categ.index;(stepCount>=2)||def.assert("Must have at least one interpolation point.");this._stepValue=deltaValue/stepCount;this._middleIndex=~~(stepCount/2);var dotCount=(stepCount-1);this._isOdd=(dotCount%2)>0;}else{var fromCateg=+last.categ.data.value;var toCateg=+next.categ.data.value;var deltaCateg=toCateg-fromCateg;this._steep=deltaValue/deltaCateg;this._middleCateg=(toCateg+fromCateg)/2;this.interpolation._setCategory(this._middleCateg);}}},_interpolate:function(seriesInfo){this._initInterpData();var next=this.__nextNonNull;var last=this.__lastNonNull;if(!next&&!last){return;}
var value;var group;var isInterpolatedMiddle;if(next&&last){if(isBaseDiscrete){var groupIndex=(seriesInfo.categ.index-last.categ.index);value=last.value+groupIndex*this._stepValue;if(this._isOdd){group=groupIndex<this._middleIndex?last.group:next.group;isInterpolatedMiddle=groupIndex===this._middleIndex;}else{group=groupIndex<=this._middleIndex?last.group:next.group;isInterpolatedMiddle=false;}}else{var categ=+seriesInfo.categ.value;var lastCateg=+last.categ.data.value;value=last.value+this._steep*(categ-lastCateg);group=categ<this._middleCateg?last.group:next.group;isInterpolatedMiddle=categ===this._middleCateg;}}else{if(!isStacked){return;}
var the=next||last;value=the.value;group=the.group;isInterpolatedMiddle=false;}
seriesInfo.group=group;seriesInfo.value=value;seriesInfo.isNull=false;seriesInfo.isInterpolated=true;seriesInfo.isInterpolatedMiddle=isInterpolatedMiddle;}});if(interpolate){categInfos=new Interpolation(categInfos).interpolate();}
reversedSeriesScenes.forEach(createSeriesSceneCategories,this);var belowSeriesScenes2;reversedSeriesScenes.forEach(completeSeriesScenes,this);reversedSeriesScenes.forEach(trimNullSeriesScenes,this);return rootScene;function createSeriesScenes(){if(chart._serRole&&chart._serRole.grouping){chart._serRole.flatten(data).children().each(createSeriesScene,this);}else{createSeriesScene.call(this,null);}
return rootScene.children().reverse().array();}
function createSeriesScene(seriesData1){var seriesScene=new pvc.visual.Scene(rootScene,{group:seriesData1||data});seriesScene.vars.series=new pvc.visual.ValueLabelVar(seriesData1?seriesData1.value:null,seriesData1?seriesData1.label:"");}
function createSeriesSceneCategories(seriesScene,seriesIndex){categInfos.forEach(createCategScene,this);function createCategScene(categInfo){var seriesInfo=categInfo.seriesInfos[seriesIndex];var group=seriesInfo.group;var value=seriesInfo.value;var datum=group?null:createNullDatum(seriesInfo.data||seriesScene.group,categInfo.data);var scene=new pvc.visual.Scene(seriesScene,{group:group,datum:datum});scene.vars.category=new pvc.visual.ValueLabelVar(categInfo.value,categInfo.label);var valueVar=new pvc.visual.ValueLabelVar(value,valueDim.format(value));valueVar.accValue=value!=null?value:orthoNullValue;scene.vars.value=valueVar;scene.isInterpolatedMiddle=seriesInfo.isInterpolatedMiddle;scene.isInterpolated=seriesInfo.isInterpolated;scene.isNull=seriesInfo.isNull;scene.isIntermediate=false;}}
function completeSeriesScenes(seriesScene){var seriesScenes2=[],seriesScenes=seriesScene.childNodes,fromScene,notNullCount=0,firstAloneScene=null;for(var c=0,toChildIndex=0,categCount=seriesScenes.length;c<categCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex],c2=c*2;seriesScenes2[c2]=toScene;completeMainScene.call(this,fromScene,toScene,belowSeriesScenes2&&belowSeriesScenes2[c2]);if(toScene.isAlone&&!firstAloneScene){firstAloneScene=toScene;}
if(!toScene.isNull){notNullCount++;}
if(fromScene){var interScene=createIntermediateScene.call(this,seriesScene,fromScene,toScene,toChildIndex,belowSeriesScenes2&&belowSeriesScenes2[c2-1]);if(interScene){seriesScenes2[c2-1]=interScene;toChildIndex++;}}
fromScene=toScene;}
if(notNullCount===1&&firstAloneScene&&categCount===1){firstAloneScene.isSingle=true;}
if(isStacked){belowSeriesScenes2=seriesScenes2;}}
function completeMainScene(fromScene,toScene,belowScene){var toAccValue=toScene.vars.value.accValue;if(belowScene){if(toScene.isNull&&!isBaseDiscrete){toAccValue=orthoNullValue;}else{toAccValue+=belowScene.vars.value.accValue;}
toScene.vars.value.accValue=toAccValue;}
toScene.basePosition=sceneBaseScale(toScene);toScene.orthoPosition=orthoZero;toScene.orthoLength=orthoScale(toAccValue)-orthoZero;var isNullFrom=(!fromScene||fromScene.isNull),isAlone=isNullFrom&&!toScene.isNull;if(isAlone){var nextScene=toScene.nextSibling;isAlone=!nextScene||nextScene.isNull;}
toScene.isAlone=isAlone;toScene.isSingle=false;}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex,belowScene){var interIsNull=fromScene.isNull||toScene.isNull;if(interIsNull&&!this.showAreas){return null;}
var interValue,interAccValue,interBasePosition;if(interIsNull){if(belowScene&&isBaseDiscrete){var belowValueVar=belowScene.vars.value;interAccValue=belowValueVar.accValue;interValue=belowValueVar[this.valueRoleName];}else{interValue=interAccValue=orthoNullValue;}
if(isStacked&&isBaseDiscrete){interBasePosition=toScene.basePosition-(sceneBaseScale.range().band/2);}else if(fromScene.isNull){interBasePosition=toScene.basePosition;}else{interBasePosition=fromScene.basePosition;}}else{var fromValueVar=fromScene.vars.value,toValueVar=toScene.vars.value;interValue=(toValueVar.value+fromValueVar.value)/2;interAccValue=(toValueVar.accValue+fromValueVar.accValue)/2;interBasePosition=(toScene.basePosition+fromScene.basePosition)/2;}
var interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,group:toScene.isInterpolatedMiddle?fromScene.group:toScene.group,datum:toScene.group?null:toScene.datum});interScene.vars.category=toScene.vars.category;var interValueVar=new pvc.visual.ValueLabelVar(interValue,valueDim.format(interValue));interValueVar.accValue=interAccValue;interScene.vars.value=interValueVar;interScene.isIntermediate=true;interScene.isSingle=false;interScene.isNull=interIsNull;interScene.isAlone=interIsNull&&toScene.isNull&&fromScene.isNull;interScene.basePosition=interBasePosition;interScene.orthoPosition=orthoZero;interScene.orthoLength=orthoScale(interAccValue)-orthoZero;return interScene;}
function trimNullSeriesScenes(seriesScene){var seriesScenes=seriesScene.childNodes,L=seriesScenes.length;var scene,siblingScene;while(L&&(scene=seriesScenes[0]).isNull){siblingScene=scene.nextSibling;if(siblingScene&&!siblingScene.isNull){break;}
seriesScene.removeAt(0);L--;}
while(L&&(scene=seriesScenes[L-1]).isNull){siblingScene=scene.previousSibling;if(siblingScene&&!siblingScene.isNull){break;}
seriesScene.removeAt(L-1);L--;}}
function createNullDatum(serData1,catData1){var atoms=serData1&&catData1?def.array.append(def.own(serData1.atoms),def.own(catData1.atoms)):(serData1?def.own(serData1.atoms):def.own(catData1.atoms));return new pvc.data.Datum(data,atoms,true);}}});pvc.LineDotAreaAbstract=pvc.CategoricalAbstract.extend({_initVisualRoles:function(){this.base();this._addVisualRoles({value:{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'value'}});},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in LineDotAreaAbstract");}
var options=this.options;return new pvc.LineDotAreaPanel(this,parentPanel,{stacked:options.stacked,showValues:options.showValues,valuesAnchor:options.valuesAnchor,showLines:options.showLines,showDots:options.showDots,showAreas:options.showAreas,orientation:options.orientation,nullInterpolationMode:options.nullInterpolationMode});},defaults:def.create(pvc.CategoricalAbstract.prototype.defaults,{showDots:false,showLines:false,showAreas:false,showValues:false,orthoAxisOffset:0.04,baseAxisOffset:0.01,valuesAnchor:"right",panelSizeRatio:1,nullInterpolationMode:'none',tipsySettings:{offset:15}})});pvc.DotChart=pvc.LineDotAreaAbstract.extend({constructor:function(options){this.base(options);this.options.showDots=true;}});pvc.LineChart=pvc.LineDotAreaAbstract.extend({constructor:function(options){this.base(options);this.options.showLines=true;}});pvc.StackedLineChart=pvc.LineDotAreaAbstract.extend({constructor:function(options){this.base(options);this.options.showLines=true;this.options.stacked=true;}});pvc.StackedAreaChart=pvc.LineDotAreaAbstract.extend({constructor:function(options){this.base(options);this.options.showAreas=true;this.options.stacked=true;}});pvc.HeatGridChart=pvc.CategoricalAbstract.extend({constructor:function(options){options=def.set(options,'orthoAxisOrdinal',true,'legend',false);if(options.scalingType&&!options.colorScaleType){options.colorScaleType=options.scalingType;}
this.base(options);var parent=this.parent;if(parent){this._colorRole=parent._colorRole;this._dotSizeRole=parent._dotSizeRole;}},_initVisualRoles:function(){this.base();var colorDimName='value',sizeDimName='value2';if(this.options.compatVersion<=1){switch(this.options.colorValIdx){case 0:colorDimName='value';break;case 1:colorDimName='value2';break;default:colorDimName=undefined;}
switch(this.options.sizeValIdx){case 0:sizeDimName='value';break;case 1:sizeDimName='value2';break;default:sizeDimName=undefined;}}
this._addVisualRoles({color:{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:colorDimName},dotSize:{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:sizeDimName}});this._colorRole=this.visualRoles('color');this._dotSizeRole=this.visualRoles('dotSize');},_initData:function(keyArgs){this.base(keyArgs);var dotSizeGrouping=this._dotSizeRole.grouping;if(dotSizeGrouping){this._dotSizeDim=this.data.dimensions(dotSizeGrouping.firstDimension.name);}
var colorGrouping=this._colorRole.grouping;if(colorGrouping){this._colorDim=this.data.dimensions(colorGrouping.firstDimension.name);}},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in heatGridChart");}
var options=this.options;return new pvc.HeatGridChartPanel(this,parentPanel,{showValues:options.showValues,orientation:options.orientation});},defaults:def.create(pvc.CategoricalAbstract.prototype.defaults,{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],showValues:true,axisOffset:0,showPlotFrame:false,orientation:"vertical",colorScaleType:"linear",normPerBaseCategory:true,numSD:2,useShapes:false,colorRange:['red','yellow','green'],nullColor:"#efc5ad"})});pvc.HeatGridChartPanel=pvc.CartesianAbstractPanel.extend({anchor:'fill',pvHeatGrid:null,pvHeatGridLabel:null,data:null,showValues:true,orientation:"vertical",shape:"square",nullShape:"cross",defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){this.base();var chart=this.chart,options=chart.options;var colorDimName=this.colorDimName=chart._colorDim&&chart._colorDim.name,sizeDimName=this.sizeDimName=chart._dotSizeDim&&chart._dotSizeDim.name;options.nullColor=pv.color(options.nullColor);if(options.minColor!=null){options.minColor=pv.color(options.minColor);}
if(options.maxColor!=null){options.maxColor=pv.color(options.maxColor);}
if(options.shape!=null){this.shape=options.shape;}
if(options.nullShape!==undefined){this.nullShape=options.nullShape;}
var anchor=this.isOrientationVertical()?"bottom":"left";var xScale=chart.axes.x.scale,yScale=chart.axes.y.scale;var w=(xScale.max-xScale.min)/xScale.domain().length;var h=(yScale.max-yScale.min)/yScale.domain().length;if(anchor!=="bottom"){var tmp=w;w=h;h=tmp;}
this._cellWidth=w;this._cellHeight=h;var keyArgs={visible:true},colRootData=chart._catRole.flatten(chart.data,keyArgs),rowRootData=chart._serRole.flatten(chart.data,keyArgs),data=this._getVisibleData();var fillColorScaleByColKey;if(colorDimName){fillColorScaleByColKey=pvc.color.scales(def.create(false,this.chart.options,{type:options.colorScaleType,data:colRootData,colorDimension:colorDimName}));}
function getFillColor(detectSelection){var color;var colorValue=this.colorValue();if(colorValue!=null){color=fillColorScaleByColKey[this.group().parent.absKey](colorValue);}else{color=options.nullColor;}
if(detectSelection&&data.owner.selectedCount()>0&&!this.datum().isSelected){color=pvc.toGrayScale(color,0.6);}
return color;}
function getDatum(rowData1,colData1){var colData=this.parent.group();if(colData){var rowData=colData._childrenByKey[rowData1.absKey];if(rowData){var datum=rowData._datums[0];if(datum){return datum;}}}
var atoms=def.array.append(def.own(rowData1.atoms),def.own(colData1.atoms));return new pvc.data.Datum(data,atoms,true);}
var pvColPanel=this.pvPanel.add(pv.Panel).data(colRootData._children).localProperty('group',Object).group(function(colData1){return data._childrenByKey[colData1.absKey];})
[pvc.BasePanel.relativeAnchor[anchor]](function(){return this.index*w;})
[pvc.BasePanel.parallelLength[anchor]](w);var pvHeatGrid=this.pvHeatGrid=pvColPanel.add(pv.Panel).data(rowRootData._children).localProperty('group',Object).datum(getDatum).group(function(rowData1){return this.parent.group()._childrenByKey[rowData1.absKey];}).localProperty('colorValue').colorValue(function(){return colorDimName&&this.datum().atoms[colorDimName].value;}).localProperty('sizeValue').sizeValue(function(){return sizeDimName&&this.datum().atoms[sizeDimName].value;});pvHeatGrid
[anchor](function(){return this.index*h;})
[pvc.BasePanel.orthogonalLength[anchor]](h).antialias(false).strokeStyle(null).lineWidth(0);if(options.useShapes){this.shapes=this.createHeatMap(w,h,getFillColor);}else{this.shapes=pvHeatGrid;}
this.shapes.fillStyle(function(){return getFillColor.call(pvHeatGrid,true);});var valueDimName=colorDimName||sizeDimName;if(this.showValues&&valueDimName){this.pvHeatGridLabel=pvHeatGrid.anchor("center").add(pv.Label).bottom(0).text(function(){return this.datum().atoms[valueDimName].label;});}
if(this._shouldHandleClick()){this._addPropClick(this.shapes);}
if(options.doubleClickAction){this._addPropDoubleClick(this.shapes);}
if(options.showTooltips){this._addPropTooltip(this.shapes,{tipsyEvent:'mouseover'});}},applyExtensions:function(){this.base();if(this.pvHeatGridLabel){this.extend(this.pvHeatGridLabel,"heatGridLabel_");}
this.extend(this.pvHeatGrid,"heatGridPanel_");this.extend(this.pvHeatGrid,"heatGrid_");},createHeatMap:function(w,h,getFillColor){var myself=this,options=this.chart.options,data=this.chart.data,sizeDimName=this.sizeDimName,colorDimName=this.colorDimName,nullShapeType=this.nullShape,shapeType=this.shape;var maxRadius=Math.min(w,h)/2;if(this.shape==='diamond'){maxRadius/=Math.SQRT2;}
maxRadius-=2;var maxArea=maxRadius*maxRadius,minArea=12,areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;if(pvc.debug>=2){pvc.log("Using rescue mode dot area calculation due to insufficient space.");}}
var sizeValueToArea;if(sizeDimName){def.scope(function(){var sizeValExtent=data.dimensions(sizeDimName).extent({visible:true});if(sizeValExtent){var sizeValMin=sizeValExtent.min.value,sizeValMax=sizeValExtent.max.value,sizeValSpan=Math.abs(sizeValMax-sizeValMin);if(isFinite(sizeValSpan)&&sizeValSpan>1e-12){var sizeSlope=areaSpan/sizeValSpan;sizeValueToArea=function(sizeVal){return minArea+sizeSlope*(sizeVal==null?0:(sizeVal-sizeValMin));};}}});}
if(!sizeValueToArea){sizeValueToArea=pv.functor(maxArea);}
var notNullSelectedBorder=(this.selectedBorder==null||(+this.selectedBorder)===0)?this.defaultBorder:this.selectedBorder;var nullSelectedBorder=(this.selectedBorder==null||(+this.selectedBorder)===0)?this.nullBorder:this.selectedBorder;var nullDeselectedBorder=this.defaultBorder>0?this.defaultBorder:this.nullBorder;function getBorderWidth(){if(!sizeDimName||!myself._isNullShapeLineOnly()||this.parent.sizeValue()!=null){return this.selected()?notNullSelectedBorder:myself.defaultBorder;}
return this.selected()?nullSelectedBorder:nullDeselectedBorder;}
function getBorderColor(){var lineWidth=this.lineWidth();if(!(lineWidth>0)){return null;}
var color=getFillColor.call(this.parent,false);return(data.owner.selectedCount()===0||this.selected())?color.darker():color;}
var getShapeType;if(!sizeDimName){getShapeType=def.fun.constant(shapeType);}else{getShapeType=function(){return this.parent.sizeValue()!=null?shapeType:nullShapeType;};}
var getShapeSize;if(!sizeDimName){getShapeSize=function(){return(colorDimName&&!nullShapeType&&this.parent.colorValue()==null)?0:maxArea;};}else{getShapeSize=function(){var sizeValue=this.parent.sizeValue();return(sizeValue==null&&!nullShapeType)?0:sizeValueToArea(sizeValue);};}
return this.pvHeatGrid.add(pv.Dot).localProperty("selected",Boolean).selected(function(){return this.datum().isSelected;}).shape(getShapeType).shapeSize(getShapeSize).lock('shapeAngle').fillStyle(function(){return getFillColor.call(this.parent);}).lineWidth(getBorderWidth).strokeStyle(getBorderColor);},_isNullShapeLineOnly:function(){return this.nullShape=='cross';},_getSignums:function(){return[this.shapes];},_renderInteractive:function(){this.pvPanel.render();}});pvc.MetricXYAbstract=pvc.CartesianAbstract.extend({constructor:function(options){var isV1Compat=(options&&options.compatVersion<=1);if(isV1Compat){if(!options){options={};}
if(!options.visualRoles||!options.visualRoles.x){var dims=options.dimensions||(options.dimensions={}),catDim=dims.category||(dims.category={});if(catDim.valueType===undefined){catDim.valueType=Number;}}}
this.base(options);def.set(this._axisType2RoleNamesMap,'base','x','ortho','y');var parent=this.parent;if(parent){this._xRole=parent._xRole;this._yRole=parent._yRole;}},_initVisualRoles:function(){this.base();var isV1Compat=(this.options.compatVersion<=1);this._addVisualRoles({x:{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:isV1Compat?'category':'value'},y:{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:isV1Compat?'value':'value2'}});this._xRole=this.visualRoles('x');this._yRole=this.visualRoles('y');},_initData:function(){this.base.apply(this,arguments);this._xDim=this.data.dimensions(this._xRole.firstDimensionName());this._yDim=this.data.dimensions(this._yRole.firstDimensionName());},defaults:def.create(pvc.CartesianAbstract.prototype.defaults,{valuesAnchor:"right",panelSizeRatio:1})});pvc.MetricLineDotPanel=pvc.CartesianAbstractPanel.extend({anchor:'fill',pvLine:null,pvDot:null,pvLabel:null,pvScatterPanel:null,showLines:true,showDots:true,showValues:true,valuesAnchor:"right",dotShape:"circle",dotSizeRatio:1/5,dotSizeRatioTo:'minWidthHeight',autoDotSizePadding:true,_v1DimRoleName:{'series':'series','category':'x','value':'y'},constructor:function(chart,parent,options){this.base(chart,parent,options);if(!this.offsetPaddings){this.offsetPaddings=new pvc.Sides(0.01);}},_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;var drawMarker=def.nullyTo(colorAxis.option('DrawMarker',true),this.showDots);var drawRule=def.nullyTo(colorAxis.option('DrawLine',true),this.showLines);if(drawMarker||drawRule){var keyArgs={};if((keyArgs.drawMarker=drawMarker)){keyArgs.markerShape=colorAxis.option('Shape',true)||'circle';keyArgs.markerPvProto=new pv.Dot().lineWidth(1.5).shapeSize(12);this.extend(keyArgs.markerPvProto,'dot_',{constOnly:true});}
if((keyArgs.drawRule=drawRule)){keyArgs.rulePvProto=new pv.Line().lineWidth(1.5);this.extend(keyArgs.rulePvProto,'line_',{constOnly:true});}
groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_getRootScene:function(){var rootScene=this._rootScene;if(!rootScene){var chart=this.chart;var data=this._getVisibleData();var hasColorRole=!!chart._colorRole.grouping;var hasDotSizeRole=this.showDots&&!!chart._dotSizeDim;var sizeValRange;if(hasDotSizeRole){var sizeValExtent=chart._dotSizeDim.extent({visible:true});hasDotSizeRole=!!sizeValExtent;if(hasDotSizeRole){var sizeValMin=sizeValExtent.min.value,sizeValMax=sizeValExtent.max.value;if(this.dotSizeAbs){var atoms=chart._dotSizeDim.atoms({visible:true});for(var i=0;i<atoms.length;i++){if(i==0)
sizeValMin=sizeValMax=Math.abs(atoms[0].value);else{var newValue=Math.abs(atoms[i].value);if(newValue>sizeValMax)sizeValMax=newValue;if(newValue<sizeValMin)sizeValMin=newValue;}}}
var sizeValSpan=Math.abs(sizeValMax-sizeValMin);hasDotSizeRole=isFinite(sizeValSpan)&&sizeValSpan>1e-12;if(hasDotSizeRole){sizeValRange={min:sizeValMin,max:sizeValMax};}}}
rootScene=this._buildScene(data,hasColorRole,hasDotSizeRole);rootScene.sizeValRange=sizeValRange;this._rootScene=rootScene;}
return rootScene;},_calcLayout:function(layoutInfo){var chart=this.chart;var rootScene=this._getRootScene();var clientSize=layoutInfo.clientSize;if(rootScene.hasDotSizeRole){var radiusRange=this._calcDotRadiusRange(layoutInfo);if(this.dotShape==='diamond'){radiusRange.max/=Math.SQRT2;radiusRange.min/=Math.SQRT2;}
var maxArea=radiusRange.max*radiusRange.max,minArea=radiusRange.min*radiusRange.min,areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;radiusRange={min:Math.sqrt(minArea),max:Math.sqrt(maxArea)};if(pvc.debug>=3){pvc.log("Using rescue mode dot area calculation due to insufficient space.");}}
this.maxDotRadius=radiusRange.max;this.maxDotArea=maxArea;this.minDotArea=minArea;this.dotAreaSpan=areaSpan;this.dotSizeScale=this._getDotSizeRoleScale(rootScene.sizeValRange);}
this._calcAxesPadding(layoutInfo,rootScene);},_getDotDiameterRefLength:function(layoutInfo){var clientSize=layoutInfo.clientSize;var paddings=layoutInfo.paddings;switch(this.dotSizeRatioTo){case'minWidthHeight':return Math.min(clientSize.width+paddings.width,clientSize.height+paddings.height);case'width':return clientSize.width+paddings.width;case'height':return clientSize.height+paddings.height;}
if(pvc.debug>=2){pvc.log(def.format("Invalid option 'dotSizeRatioTo' value. Assuming 'minWidthHeight'.",[this.dotSizeRatioTo]));}
this.dotSizeRatioTo='minWidthHeight';return this._getDotDiameterRefLength(layoutInfo);},_calcDotRadiusRange:function(layoutInfo){var refLength=this._getDotDiameterRefLength(layoutInfo);var max=(this.dotSizeRatio/2)*refLength;var min=Math.sqrt(12);return{min:min,max:max};},_calcAxesPadding:function(layoutInfo,rootScene){var requestPaddings;if(!this.autoDotSizePadding){requestPaddings=this._calcRequestPaddings(layoutInfo);}else{var chart=this.chart;var axes=chart.axes;var clientSize=layoutInfo.clientSize;var paddings=layoutInfo.paddings;requestPaddings={};axes.x.setScaleRange(clientSize.width);axes.y.setScaleRange(clientSize.height);var sceneXScale=chart.axes.base.sceneScale({sceneVarName:'x'});var sceneYScale=chart.axes.ortho.sceneScale({sceneVarName:'y'});var xLength=chart.axes.base.scale.max;var yLength=chart.axes.ortho.scale.max;var hasDotSizeRole=rootScene.hasDotSizeRole;var sizeScale=this.dotSizeScale;if(!hasDotSizeRole){var defaultSize=def.number.as(this._getExtension('dot','shapeRadius'),0);if(!(defaultSize>0)){defaultSize=def.number.as(this._getExtension('dot','shapeSize'),0);if(!(defaultSize)>0){defaultSize=12;}}else{defaultSize=defaultSize*defaultSize;}
sizeScale=def.fun.constant(defaultSize);}
requestPaddings={};var op;if(this.offsetPaddings){op={};pvc.Sides.names.forEach(function(side){var len_a=pvc.BasePanel.orthogonalLength[side];op[side]=(this.offsetPaddings[side]||0)*(clientSize[len_a]+paddings[len_a]);},this);}
var setSide=function(side,padding){if(op){padding+=(op[side]||0);}
if(padding<0){padding=0;}
var value=requestPaddings[side];if(value==null||padding>value){requestPaddings[side]=padding;}};var processScene=function(scene){var x=sceneXScale(scene);var y=sceneYScale(scene);var r=Math.sqrt(sizeScale(hasDotSizeRole?scene.vars.dotSize.value:0));setSide('left',r-x);setSide('bottom',r-y);setSide('right',x+r-xLength);setSide('top',y+r-yLength);};rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(processScene);}
layoutInfo.requestPaddings=requestPaddings;},_createCore:function(layoutInfo){this.base();var myself=this,chart=this.chart,options=chart.options;var rootScene=this._getRootScene(),data=rootScene.group,isDense=!(this.width>0)||(data._leafs.length/this.width>0.5);this._finalizeScene(rootScene);if(isDense&&(options.selectable||options.hoverable)){options.selectable=false;options.hoverable=false;if(pvc.debug>=3){pvc.log("Warning: Disabling selection and hovering because the chart is to \"dense\".");}}
this.pvPanel.zOrder(1);this.pvScatterPanel=this.pvPanel.add(pv.Panel).lock('data',rootScene.childNodes);var line=new pvc.visual.Line(this,this.pvScatterPanel,{extensionId:'line'}).lock('data',function(seriesScene){return seriesScene.childNodes;}).lockValue('visible',this.showLines).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;});this.pvLine=line.pvMark;var dot=new pvc.visual.Dot(this,this.pvLine,{extensionId:'dot',activeSeriesAware:this.showLines}).intercept('visible',function(){return!this.scene.isIntermediate&&this.delegate(true);}).lockValue('shape',this.dotShape).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;}).override('color',function(type){if(!myself.showDots){var visible=this.scene.isActive||this.scene.isSingle;if(!visible){return pvc.invisibleFill;}}
return this.base(type);});this.pvDot=dot.pvMark;this.pvDot.rubberBandSelectionMode='center';dot.override('baseColor',function(type){var color=this.delegate();if(color===undefined){var color;if(!rootScene.hasColorRole){color=this.defaultColor(type);}else{var colorValue=this.scene.vars.color.value;color=colorValue==null?options.nullColor:colorScale(colorValue);}
if(type==='stroke'){color=color.darker();}}
return color;});if(rootScene.hasColorRole){var colorScale=this._getColorRoleScale(data);line.override('baseColor',function(type){var color=this.delegate();if(color===undefined){var colorValue=this.scene.vars.color.value;color=colorValue==null?options.nullColor:colorScale(colorValue);}
return color;});dot.override('interactiveColor',function(type,color){if(this.scene.isActive){return color;}
return this.base(type,color);});}
if(!rootScene.hasDotSizeRole){dot.override('baseSize',function(){if(!myself.showDots){if(this.scene.isSingle){var lineWidth=Math.max(myself.pvLine.scene[this.pvMark.index].lineWidth,0.2)/2;return lineWidth*lineWidth;}}
return this.base();});}else{var sizeValueToArea=this._getDotSizeRoleScale(rootScene.sizeValRange);var dotSizeAbs=this.dotSizeAbs;if(this.dotSizeAbs){dot.override('strokeColor',function(scene){return scene.vars.dotSize.value<0?"#000000":this.base();});dot.optionalValue('lineCap','round');dot.optional('strokeDasharray',function(scene){return scene.vars.dotSize.value<0?'dot':null;});dot.optional('lineWidth',function(scene){return scene.vars.dotSize.value<0?1.8:1.5;});}
dot.override('baseSize',function(){var value=this.scene.vars.dotSize.value;if(dotSizeAbs)
value=Math.abs(value);return sizeValueToArea(value);}).override('interactiveSize',function(size){if(this.scene.isActive){var radius=Math.sqrt(size)*1.1;return radius*radius;}
return size;});this.pvPanel.borderPanel.overflow("hidden");}
if(this.showValues){this.pvLabel=this.pvDot.anchor(this.valuesAnchor).add(pv.Label).bottom(0).text(function(scene){return def.string.join(",",scene.vars.x.label,scene.vars.y.label);});}},_getColorRoleScale:function(data){var chart=this.chart,options=chart.options;if(chart._colorRole.grouping.isDiscrete()){var colorValues=chart._colorRole.flatten(data.owner).children().select(function(child){return child.value;}).array();return chart.colors(colorValues);}
return pvc.color.scale(def.create(false,options,{type:options.colorScaleType||'linear',data:data.owner,colorDimension:chart._colorRole.firstDimensionName()}));},_getDotSizeRoleScale:function(sizeValRange){var sizeValMin=sizeValRange.min,sizeValMax=sizeValRange.max,sizeValSpan=sizeValMax-sizeValMin;var sizeSlope=this.dotAreaSpan/sizeValSpan,minArea=this.minDotArea;return function(sizeVal){return minArea+sizeSlope*(sizeVal==null?0:(sizeVal-sizeValMin));};},applyExtensions:function(){this.base();this.extend(this.pvLabel,"lineLabel_");this.extend(this.pvScatterPanel,"scatterPanel_");this.extend(this.pvLine,"line_");this.extend(this.pvDot,"dot_");this.extend(this.pvLabel,"label_");},_renderInteractive:function(){this.pvScatterPanel.render();},_getSignums:function(){var marks=[];marks.push(this.pvDot);if(this.showLines){marks.push(this.pvLine);}
return marks;},_finalizeScene:function(rootScene){var chart=this.chart,sceneBaseScale=chart.axes.base.sceneScale({sceneVarName:'x'}),sceneOrthoScale=chart.axes.ortho.sceneScale({sceneVarName:'y'});rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(function(leafScene){leafScene.basePosition=sceneBaseScale(leafScene);leafScene.orthoPosition=sceneOrthoScale(leafScene);},this);return rootScene;},_buildScene:function(data,hasColorRole,hasDotSizeRole){var rootScene=new pvc.visual.Scene(null,{panel:this,group:data});rootScene.hasColorRole=hasColorRole;rootScene.hasDotSizeRole=hasDotSizeRole;var chart=this.chart,getColorRoleValue,getDotSizeRoleValue;if(hasColorRole){var colorGrouping=chart._colorRole.grouping;if(colorGrouping.isSingleDimension){var colorDimName=chart._colorRole.firstDimensionName();getColorRoleValue=function(scene){return scene.atoms[colorDimName].value;};}else{getColorRoleValue=function(scene){return colorGrouping.view(scene.datum).value;};}}
if(chart._dotSizeDim){var dotSizeDimName=chart._dotSizeDim.name;getDotSizeRoleValue=function(scene){return scene.atoms[dotSizeDimName].value;};}
data.children().each(createSeriesScene,this);rootScene.children().each(completeSeriesScenes,this);return rootScene;function createSeriesScene(seriesGroup){var seriesScene=new pvc.visual.Scene(rootScene,{group:seriesGroup});seriesScene.vars.series=new pvc.visual.ValueLabelVar(seriesGroup.value,seriesGroup.label);seriesGroup.datums().each(function(datum){var xAtom=datum.atoms[chart._xDim.name];if(xAtom.value==null){return;}
var yAtom=datum.atoms[chart._yDim.name];if(yAtom.value==null){return;}
var scene=new pvc.visual.Scene(seriesScene,{datum:datum});scene.vars.x=new pvc.visual.ValueLabelVar(xAtom.value,xAtom.label);scene.vars.y=new pvc.visual.ValueLabelVar(yAtom.value,yAtom.label);if(getColorRoleValue){scene.vars.color=new pvc.visual.ValueLabelVar(getColorRoleValue(scene),"");}
if(getDotSizeRoleValue){var dotSizeValue=getDotSizeRoleValue(scene);scene.vars.dotSize=new pvc.visual.ValueLabelVar(dotSizeValue,chart._dotSizeDim.format(dotSizeValue));}
scene.isIntermediate=false;});}
function completeSeriesScenes(seriesScene){var seriesScenes=seriesScene.childNodes,fromScene;for(var c=0,toChildIndex=0,pointCount=seriesScenes.length;c<pointCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex];toScene.isSingle=!fromScene&&!toScene.nextSibling;if(fromScene){var interScene=createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex);if(interScene){toChildIndex++;}}
fromScene=toScene;}}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex){var interYValue=(toScene.vars.y.value+fromScene.vars.y.value)/2;var interXValue=(toScene.vars.x.value+fromScene.vars.x.value)/2;var interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,datum:toScene.datum});interScene.vars.x=new pvc.visual.ValueLabelVar(interXValue,chart._xDim.format(interXValue));interScene.vars.y=new pvc.visual.ValueLabelVar(interYValue,chart._yDim.format(interYValue));if(getColorRoleValue){interScene.vars.color=toScene.vars.color;}
if(getDotSizeRoleValue){interScene.vars.dotSize=toScene.vars.dotSize;}
interScene.isIntermediate=true;interScene.isSingle=false;return interScene;}}});pvc.MetricLineDotAbstract=pvc.MetricXYAbstract.extend({constructor:function(options){this.base(options);var parent=this.parent;if(parent){this._colorRole=parent._colorRole;this._dotSizeRole=parent._dotSizeRole;}},_processOptionsCore:function(options){this.base(options);if(options.nullColor){options.nullColor=pv.color(options.nullColor);}},_initVisualRoles:function(){this.base();var isV1Compat=(this.options.compatVersion<=1);this._addVisualRoles({color:{isMeasure:true,defaultDimensionName:isV1Compat?'value2':'value3'},dotSize:{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:isV1Compat?'value3':'value4'}});this._colorRole=this.visualRoles('color');this._dotSizeRole=this.visualRoles('dotSize');},_initData:function(keyArgs){this.base(keyArgs);var dotSizeGrouping=this._dotSizeRole.grouping;if(dotSizeGrouping){this._dotSizeDim=this.data.dimensions(dotSizeGrouping.firstDimension.name);}
if(!this.parent){var colorGrouping=this._colorRole.grouping;if(colorGrouping){if(colorGrouping.isDiscrete()){this.legendSource='color';}else{this.options.legend=false;}}}},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in MetricLineDot");}
var options=this.options;return new pvc.MetricLineDotPanel(this,parentPanel,{showValues:options.showValues,valuesAnchor:options.valuesAnchor,showLines:options.showLines,showDots:options.showDots,orientation:options.orientation,dotSizeRatio:options.dotSizeRatio,dotSizeRatioTo:options.dotSizeRatioTo,autoDotSizePadding:options.autoDotSizePadding,dotSizeAbs:options.dotSizeAbs});},defaults:def.create(pvc.MetricXYAbstract.prototype.defaults,{showDots:false,showLines:false,showValues:false,originIsZero:false,tipsySettings:{offset:15},colorScaleType:"linear",colorRange:['red','yellow','green'],nullColor:"#efc5ad",dotSizeAbs:false})});pvc.MetricDotChart=pvc.MetricLineDotAbstract.extend({constructor:function(options){this.base(options);this.options.showDots=true;}});pvc.MetricLineChart=pvc.MetricLineDotAbstract.extend({constructor:function(options){this.base(options);this.options.showLines=true;}});pvc.BulletChart=pvc.BaseChart.extend({bulletChartPanel:null,allowNoData:true,constructor:function(options){options=options||{};var dimGroups=options.dimensionGroups||(options.dimensionGroups={});var rangeDimGroup=dimGroups.range||(dimGroups.range={});if(rangeDimGroup.valueType===undefined){rangeDimGroup.valueType=Number;}
var markerDimGroup=dimGroups.marker||(dimGroups.marker={});if(markerDimGroup.valueType===undefined){markerDimGroup.valueType=Number;}
options.legend=false;options.selectable=false;options.tooltipFormat=function(s,c,v){return this.chart.options.valueFormat(v);};this.base(options);},_initVisualRoles:function(){this.base();this._addVisualRoles({title:{defaultDimensionName:'title*'},subTitle:{defaultDimensionName:'subTitle*'},value:{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'value*'},marker:{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'marker*'},range:{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimensionName:'range*'}});},_createTranslation:function(complexType,translOptions){var translation=this.base(complexType,translOptions),size=translation.virtualItemSize();if(size){switch(size){case 1:translation.defReader({names:'value'});break;case 2:translation.defReader({names:['title','value']});break;case 3:translation.defReader({names:['title','value','marker']});break;default:translation.defReader({names:['title','subTitle','value','marker']});if(size>4){translation.defReader({names:'range',indexes:pv.range(4,size)});}
break;}}
return translation;},_preRenderContent:function(contentOptions){if(pvc.debug>=3){pvc.log("Prerendering in bulletChart");}
this.bulletChartPanel=new pvc.BulletChartPanel(this,this.basePanel,def.create(contentOptions,{showValues:this.options.showValues,showTooltips:this.options.showTooltips,orientation:this.options.orientation}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{showValues:true,orientation:"horizontal",legend:false,bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Bullet",bulletSubtitle:"",bulletTitlePosition:"left",crosstabMode:false,seriesInRows:false})});pvc.BulletChartPanel=pvc.BasePanel.extend({anchor:'fill',pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,showValues:true,_createCore:function(){var chart=this.chart,options=chart.options,data=this.buildData();var anchor=options.orientation=="horizontal"?"left":"bottom";var size,angle,align,titleLeftOffset,titleTopOffset,ruleAnchor,leftPos,topPos,titleSpace;if(options.orientation=="horizontal"){size=this.width-this.chart.options.bulletMargin-20;angle=0;switch(options.bulletTitlePosition){case'top':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=-12;titleSpace=parseInt(options.titleSize/2,10);break;case'bottom':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=options.bulletSize+32;titleSpace=0;break;case'right':leftPos=5;titleLeftOffset=size+5;align='left';titleTopOffset=parseInt(options.bulletSize/2,10);titleSpace=0;break;case'left':default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;titleTopOffset=parseInt(options.bulletSize/2,10);align='right';titleSpace=0;}
ruleAnchor="bottom";topPos=function(){return(this.index*(options.bulletSize+options.bulletSpacing))+titleSpace;};}
else
{size=this.height-this.chart.options.bulletMargin-20;switch(options.bulletTitlePosition){case'top':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=-20;angle=0;topPos=undefined;break;case'bottom':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=size+20;angle=0;topPos=20;break;case'right':leftPos=5;titleLeftOffset=this.chart.options.bulletSize+40;align='left';titleTopOffset=size;angle=-Math.PI/2;topPos=undefined;break;case'left':default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=-12;titleTopOffset=this.height-this.chart.options.bulletMargin-20;align='left';angle=-Math.PI/2;topPos=undefined;}
ruleAnchor="right";leftPos=function(){return options.bulletMargin+this.index*(options.bulletSize+options.bulletSpacing);};}
this.pvBullets=this.pvPanel.add(pv.Panel).data(data)
[pvc.BasePanel.orthogonalLength[anchor]](size)
[pvc.BasePanel.parallelLength[anchor]](this.chart.options.bulletSize).margin(20).left(leftPos).top(topPos);this.pvBullet=this.pvBullets.add(pv.Layout.Bullet).orient(anchor).ranges(function(d){return d.ranges;}).measures(function(d){return d.measures;}).markers(function(d){return d.markers;});if(options.clickable){this.pvBullet.cursor("pointer").event("click",function(d){var s=d.title;var c=d.subtitle;var ev=pv.event;return options.clickAction(s,c,d.measures,ev);});}
this.pvBulletRange=this.pvBullet.range.add(pv.Bar);this.pvBulletMeasure=this.pvBullet.measure.add(pv.Bar).text(function(d){return options.valueFormat(d);});this.pvBulletMarker=this.pvBullet.marker.add(pv.Dot).shape("square").fillStyle("white").text(function(d){return options.valueFormat(d);});if(this.showTooltips){var myself=this;this.pvBulletMeasure.localProperty('tooltip').tooltip(function(v,d){var s=d.title;var c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMarker.localProperty('tooltip').tooltip(function(v,d){var s=d.title;var c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMeasure.event("mouseover",pv.Behavior.tipsy(this.chart.options.tipsySettings));this.pvBulletMarker.event("mouseover",pv.Behavior.tipsy(this.chart.options.tipsySettings));}
this.pvBulletRule=this.pvBullet.tick.add(pv.Rule);this.pvBulletRuleLabel=this.pvBulletRule.anchor(ruleAnchor).add(pv.Label).text(this.pvBullet.x.tickFormat);this.pvBulletTitle=this.pvBullet.anchor(anchor).add(pv.Label).font("bold 12px sans-serif").textAngle(angle).left(-10).textAlign(align).textBaseline("bottom").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedTitle;});this.pvBulletSubtitle=this.pvBullet.anchor(anchor).add(pv.Label).textStyle("#666").textAngle(angle).textAlign(align).textBaseline("top").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedSubtitle;});var doubleClickAction=(typeof(options.axisDoubleClickAction)=='function')?function(d,e){options.axisDoubleClickAction(d,e);}:null;if(doubleClickAction){this.pvBulletTitle.cursor("pointer").events('all').event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});this.pvBulletSubtitle.cursor("pointer").events('all').event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});}
this.extend(this.pvBullets,"bulletsPanel_");this.extend(this.pvBullet,"bulletPanel_");this.extend(this.pvBulletRange,"bulletRange_");this.extend(this.pvBulletMeasure,"bulletMeasure_");this.extend(this.pvBulletMarker,"bulletMarker_");this.extend(this.pvBulletRule,"bulletRule_");this.extend(this.pvBulletRuleLabel,"bulletRuleLabel_");this.extend(this.pvBulletTitle,"bulletTitle_");this.extend(this.pvBulletSubtitle,"bulletSubtitle_");this.extend(this.pvPanel,"chart_");},buildData:function(){if(pvc.debug>=3){pvc.log("In buildData: "+this.chart.data.getInfo());}
var data,chart=this.chart,options=chart.options,titleRole=chart.visualRoles('title'),titleGrouping=titleRole.grouping,subTitleRole=chart.visualRoles('subTitle'),subTitleGrouping=subTitleRole.grouping,valueRole=chart.visualRoles('value'),valueDimName=valueRole.grouping&&valueRole.firstDimensionName(),markerRole=chart.visualRoles('marker'),markerDimName=markerRole.grouping&&markerRole.firstDimensionName(),rangeRole=chart.visualRoles('range'),rangeGrouping=rangeRole.grouping;var defaultData={title:options.bulletTitle,formattedTitle:def.scope(function(){var formatter=titleGrouping&&titleRole.firstDimension().formatter();if(formatter){return formatter(options.bulletTitle);}
return options.bulletTitle;}),subtitle:options.bulletSubtitle,formattedSubtitle:def.scope(function(){var formatter=subTitleGrouping&&subTitleRole.firstDimension().formatter();if(formatter){return formatter(options.bulletSubtitle);}
return options.bulletSubtitle;}),ranges:options.bulletRanges||[],measures:options.bulletMeasures||[],markers:options.bulletMarkers||[]};if(!valueRole.grouping&&!titleGrouping&&!markerRole.grouping&&!subTitleGrouping&&!rangeGrouping){data=[defaultData];}else{data=chart.data.datums().select(function(datum){var d=Object.create(defaultData),atoms=datum.atoms,view;if(valueDimName){d.measures=[atoms[valueDimName].value];}
if(titleGrouping){view=titleGrouping.view(datum);d.title=view.value;d.formattedTitle=view.label;}
if(subTitleGrouping){view=subTitleGrouping.view(datum);d.subtitle=view.value;d.formattedSubtitle=view.label;}
if(markerDimName){d.markers=[atoms[markerDimName].value];}
if(rangeGrouping){d.ranges=rangeGrouping.view(datum).values();}
return d;},this).array();}
return data;}});pvc.ParallelCoordinates=pvc.BaseChart.extend({parCoordPanel:null,legendSource:'category',constructor:function(options){options=options||{};options.dimensions=options.dimensions||{};if(!options.dimensions.value){options.dimensions.value={valueType:null};}
this.base(options);},_preRenderContent:function(contentOptions){if(pvc.debug>=3){pvc.log("Prerendering in parallelCoordinates");}
this.parCoordPanel=new pvc.ParCoordPanel(this,this.basePanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:true,mapAllDimensions:true,numDigits:0})});pvc.ParCoordPanel=pvc.BasePanel.extend({anchor:'fill',pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var data=this.chart.data;var numDigit=this.chart.options.numDigits;this.dimensions=data.getVisibleCategories();var values=data.getValues();var dataRowIndex=data.getVisibleSeriesIndexes();var pCoordIndex=data.getVisibleCategoriesIndexes();var pCoordKeys=data.getCategories();var pCoordMapping=(this.chart.options.mapAllDimensions)?pCoordIndex.map(function(d){return(isNaN(values[d][0]))?{categorical:true,len:0,map:[]}:{categorical:false,len:0,map:[],displayValue:[]};}):pCoordIndex.map(function(d){return(isNaN(values[d][0]))?{categorical:true,len:0,map:[]}:null;});var coordMapUpdate=function(i,val){var cMap=pCoordMapping[i];var k=null;if(!cMap.categorical){var keyVal=val.toFixed(numDigit);k=cMap.map[keyVal];if(k==null){k=cMap.len;cMap.len++;cMap.map[keyVal]=k;cMap.displayValue[keyVal]=val;}}else{k=cMap.map[val];if(k==null){k=cMap.len;cMap.len++;cMap.map[val]=k;}}
return k;};for(var d in pCoordMapping){if(pCoordMapping.hasOwnProperty(d)&&pCoordMapping[d]&&pCoordMapping[d].categorical){pCoordMapping[d].displayValue=pCoordMapping[d].map;}}
var i,item,k;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions){for(i=0;i<pCoordMapping.length;i++){if(pCoordMapping[i]){for(var col=0;col<values[i].length;col++){coordMapUpdate(i,values[i][col]);}
var cMap=pCoordMapping[i].map;var sorted=[];for(item in cMap){if(cMap.hasOwnProperty(item)){sorted.push(item);}}
sorted.sort();if(pCoordMapping[i].categorical){for(k=0;k<sorted.length;k++){cMap[sorted[k]]=k;}}else{for(k=0;k<sorted.length;k++){cMap[sorted[k]].index=k;}}}}}
var generateHashMap=function(col){var record={};for(var j in pCoordIndex){if(pCoordIndex.hasOwnProperty(j)){record[pCoordKeys[j]]=(pCoordMapping[j])?coordMapUpdate(j,values[j][col]):values[j][col];}}
return record;};this.data=dataRowIndex.map(function(col){return generateHashMap(col);});var descrVals=this.dimensions.map(function(cat){var item2={};var elements=cat.split("__");item2.id=cat;item2.name=elements[0];item2.unit=(elements.length>1)?elements[1]:"";return item2;});for(i=0;i<descrVals.length;i++){item=descrVals[i];var index=pCoordIndex[i];item.orgRowIndex=index;var len=values[index].length;var theMin,theMax,theMin2,theMax2;var v;if(pCoordMapping[index]){theMin=theMax=theMin2=theMax2=pCoordMapping[index].displayValue[values[index][0]];for(k=1;k<len;k++){v=pCoordMapping[index].displayValue[values[index][k]];if(v<theMin)
{theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}else{theMin=theMax=theMin2=theMax2=values[index][0];for(k=1;k<len;k++){v=values[index][k];if(v<theMin){theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}
var theStep=((theMax-theMax2)+(theMin2-theMin))/2;item.min=theMin;item.max=theMax;item.step=theStep;item.categorical=false;if(pCoordMapping[index]){item.map=pCoordMapping[index].map;item.mapLength=pCoordMapping[index].len;item.categorical=pCoordMapping[index].categorical;if(!item.categorical){item.orgValue=[];var theMap=pCoordMapping[index].map;for(var key in theMap){if(theMap.hasOwnProperty(key)){item.orgValue[theMap[key]]=0.0+key;}}}}}
var genKeyVal=function(keys,vals){var record={};for(var i=0;i<keys.length;i++){record[keys[i]]=vals[i];}
return record;};this.dimensionDescr=genKeyVal(this.dimensions,descrVals);},_createCore:function(){var myself=this;this.retrieveData();var height=this.height,numDigits=this.chart.options.numDigits,topRuleOffs=this.chart.options.topRuleOffset,botRuleOffs=this.chart.options.botRuleOffset,leftRuleOffs=this.chart.options.leftRuleOffset,rightRulePos=this.width-this.chart.options.rightRuleOffset,topRulePos=this.height-topRuleOffs,ruleHeight=topRulePos-botRuleOffs,labelTopOffs=topRuleOffs-12,dims=this.dimensions,dimDescr=this.dimensionDescr;var getDimSc=function(t,addMargin){var theMin=dimDescr[t].min;var theMax=dimDescr[t].max;var theStep=dimDescr[t].step;if(addMargin){theMin-=theStep;theMax+=theStep;}
return pv.Scale.linear(theMin,theMax).range(botRuleOffs,topRulePos);};var getDimensionScale=function(t){var scale=getDimSc(t,true).range(botRuleOffs,topRulePos);var dd=dimDescr[t];if(dd.orgValue&&!dd.categorical){var func=function(x){var res=scale(dd.orgValue[x]);return res;};func.domain=function(){return scale.domain();};func.invert=function(d){return scale.invert(d);};return func;}
return scale;};var getDimColorScale=function(t){var scale=getDimSc(t,false).range("steelblue","brown");return scale;};var x=pv.Scale.ordinal(dims).splitFlush(leftRuleOffs,rightRulePos);var y=pv.dict(dims,getDimensionScale);var colors=pv.dict(dims,getDimColorScale);var filter=pv.dict(dims,function(t){return{min:y[t].domain()[0],max:y[t].domain()[1]};});var active=dims[0];var selectVisible=(this.chart.options.mapAllDimensions)?function(d){return dims.every(function(t){var dd=dimDescr[t];var val=(dd.orgValue&&!dd.categorical)?dd.orgValue[d[t]]:d[t];return(val>=filter[t].min)&&(val<=filter[t].max);});}:function(d){return dims.every(function(t){return(d[t]>=filter[t].min)&&(d[t]<=filter[t].max);});};var auxData=null;this.pvParCoord=this.pvPanel.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){var res=y[t](d[t]);return res;}).strokeStyle("#ddd").lineWidth(1).antialias(false);var rule=this.pvPanel.add(pv.Rule).data(dims).left(x).top(topRuleOffs).bottom(botRuleOffs);rule.anchor("top").add(pv.Label).top(labelTopOffs).font("bold 10px sans-serif").text(function(d){return dimDescr[d].name;});var labels=[];var labelXoffs=6,labelYoffs=3;for(var d in dimDescr){if(dimDescr.hasOwnProperty(d)){var dim=dimDescr[d];if(dim.categorical){var xVal=x(dim.id)+labelXoffs;for(var l in dim.map){if(dim.map.hasOwnProperty(l)){labels[labels.length]={x:xVal,y:y[dim.id](dim.map[l])+labelYoffs,label:l};}}}}}
var dimLabels=this.pvPanel.add(pv.Panel).data(labels).add(pv.Label).left(function(d){return d.x;}).bottom(function(d){return d.y;}).text(function(d){return d.label;}).textAlign("left");var change=this.pvPanel.add(pv.Panel);var line=change.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){return y[t](d[t]);}).strokeStyle(function(t,d){var dd=dimDescr[active];var val=(dd.orgValue&&!dd.categorical)?dd.orgValue[d[active]]:d[active];return colors[active](val);}).lineWidth(1);function update(d){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(height-d.y-d.dy));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height-d.y));active=t;change.render();return false;}
function selectAll(d){if(d.dy<3){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(0));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height));d.y=botRuleOffs;d.dy=ruleHeight;active=t;change.render();}
return false;}
var handle=change.add(pv.Panel).data(dims.map(function(dim){return{y:botRuleOffs,dy:ruleHeight,dim:dim};})).left(function(t){return x(t.dim)-30;}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",update).event("selectend",selectAll).add(pv.Bar).left(25).top(function(d){return d.y;}).width(10).height(function(d){return d.dy;}).fillStyle(function(t){return(t.dim==active)?colors[t.dim]((filter[t.dim].max+filter[t.dim].min)/2):"hsla(0,0,50%,.5)";}).strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("dragstart",update).event("drag",update);handle.anchor("bottom").add(pv.Label).textBaseline("top").text(function(d){return(dimDescr[d.dim].categorical)?"":filter[d.dim].min.toFixed(numDigits)+dimDescr[d.dim].unit;});handle.anchor("top").add(pv.Label).textBaseline("bottom").text(function(d){return(dimDescr[d.dim].categorical)?"":filter[d.dim].max.toFixed(numDigits)+dimDescr[d.dim].unit;});this.extend(this.pvParCoord,"parCoord_");this.extend(this.pvPanel,"chart_");}});pvc.DataTree=pvc.BaseChart.extend({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,legendSource:'category',constructor:function(options){options=options||{};options.dimensionGroups=options.dimensionGroups||{};if(!options.dimensionGroups.value){options.dimensionGroups.value={valueType:null};}
this.base(options);},setStructData:function(data){this.structDataset=data.resultset;if(!this.structDataset.length){pvc.log("Warning: Structure-dataset is empty");}
this.structMetadata=data.metadata;if(!this.structMetadata.length){pvc.log("Warning: Structure-Metadata is empty");}},_preRenderContent:function(contentOptions){if(pvc.debug>=3){pvc.log("Prerendering in data-tree");}
var structEngine=this.structEngine;var structType=structEngine?structEngine.type:new pvc.data.ComplexType();structType.addDimension('value',{});var translOptions={seriesInRows:true,crosstabMode:true};var translation=new pvc.data.CrosstabTranslationOper(structType,this.structDataset,this.structMetadata,translOptions);translation.configureType();if(!structEngine){structEngine=this.structEngine=new pvc.data.Data({type:structType});}
structEngine.load(translation.execute(structEngine));if(pvc.debug>=3){pvc.log(this.structEngine.getInfo());}
this.dataTreePanel=new pvc.DataTreePanel(this,this.basePanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:false,numDigits:0,connectorSpace:0.15,minVerticalSpace:0.05,minAspectRatio:2.0})});pvc.DataTreePanel=pvc.BasePanel.extend({anchor:'fill',pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(leftLength){this.hRules=[];this.vRules=[];this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(elem.children!=null){var min=+10000,max=-10000;var theLeft=elem.left+elem.width;this.hRules.push({"left":theLeft,"width":leftLength,"bottom":elem.bottom+elem.height/2});theLeft+=leftLength;for(var i in elem.children){var child=this.structMap[elem.children[i]];var theBottom=child.bottom+child.height/2;if(theBottom>max){max=theBottom;}
if(theBottom<min){min=theBottom;}
this.hRules.push({"left":theLeft,"width":child.left-theLeft,"bottom":theBottom});}
if(max>min){this.vRules.push({"left":theLeft,"bottom":min,"height":max-min});}}}},generateLineSegment:function(x1,y1,x2,y2){var line=[];line.push({"x":x1,"y":y1});line.push({"x":x2,"y":y2});this.rules.push(line);},generateConnectors:function(leftLength){this.hRules=[];this.vRules=[];if(this.chart.options.perpConnector){this.generatePerpConnectors(leftLength);return;}
this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(elem.children!=null){var theCenter,child,i;var min=+10000,max=-10000;for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;if(theCenter>max){max=theCenter;}
if(theCenter<min){min=theCenter;}}
var mid=(max+min)/2;var theLeft1=elem.left+elem.width;var theLeft2=theLeft1+leftLength;this.generateLineSegment(theLeft1,elem.bottom+elem.height/2,theLeft2,mid);for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;this.generateLineSegment(theLeft2,mid,child.left,theCenter);}}}},retrieveStructure:function(){var data=this.chart.structEngine;var options=this.chart.options;var colLabels=data.getVisibleCategories();this.treeElements=data.getVisibleSeries();var values=data.getValues();var bottomHeightSpecified=(colLabels.length>4);var e;for(e in this.treeElements){this.treeElements[e]=$.trim(this.treeElements[e]);}
var bounds=[];bounds.getElement=function(label){if(bounds[label]==null){bounds[label]={"min":+10000,"max":-10000};}
return bounds[label];};bounds.addValue=function(label,value){var bnd=bounds.getElement(label);if(value<bnd.min){bnd.min=value;}
if(value>bnd.max){bnd.max=value;}
return bnd;};var col,colnr,elem,row;for(e in this.treeElements){elem=this.treeElements[e];col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bounds.addValue("__cols",colnr);bounds.addValue(col,row);}
var bnds=bounds.getElement("__cols");var gridWidth=this.innerWidth/(bnds.max-bnds.min+1);var connectorWidth=options.connectorSpace*gridWidth;var cellWidth=gridWidth-connectorWidth;var maxCellHeight=cellWidth/options.minAspectRatio;var colBase=bnds.min;delete bounds.__cols;for(e in bounds){bnds=bounds[e];if(typeof bnds=="function"){continue;}
var numRows=bnds.max-bnds.min+1;bnds.gridHeight=this.innerHeight/numRows;bnds.cellHeight=bnds.gridHeight*(1.0-options.minVerticalSpace);if(bnds.cellHeight>maxCellHeight){bnds.cellHeight=maxCellHeight;}
bnds.relBottom=(bnds.gridHeight-bnds.cellHeight)/2;bnds.numRows=numRows;}
var whitespaceQuote=new RegExp('[\\s\"\']+',"g");this.structMap={};for(e in this.treeElements){var box={};elem=this.treeElements[e];box.box_id=elem;this.structMap[elem]=box;col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bnds=bounds.getElement(col);box.colIndex=colnr-colBase;box.rowIndex=bnds.numRows-(row-bnds.min)-1;box.left=this.leftOffs+box.colIndex*gridWidth;box.width=cellWidth;if(bottomHeightSpecified){box.bottom=values[4][e];box.height=values[5][e];}else{box.bottom=this.botOffs+box.rowIndex*bnds.gridHeight+bnds.relBottom;box.height=bnds.cellHeight;}
box.label=values[0][e];box.selector=values[1][e];box.aggregation=values[2][e];var children=(values[3][e]||'').replace(whitespaceQuote," ");box.children=(children===" "||children==="")?null:children.split(" ");}
this.generateConnectors((gridWidth-cellWidth)/2);this.structArr=[];for(e in this.structMap){elem=this.structMap[e];this.structArr.push(elem);}},findDataValue:function(key,data){for(var i=0;i<data[0].length;i++){if(data[0][i]==key){return data[1][i];}}
pvc.log("Error: value with key : "+key+" not found.");},generateBoxPlots:function(){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(!elem.values.length){continue;}
elem.subplot={};var sp=elem.subplot;var dat=[];var margin=15;var rlMargin=elem.width/6;sp.hRules=[];sp.vRules=[];sp.marks=[];sp.labels=[];dat.push(this.findDataValue("_p5",elem.values));dat.push(this.findDataValue("_p25",elem.values));dat.push(this.findDataValue("_p50",elem.values));dat.push(this.findDataValue("_p75",elem.values));dat.push(this.findDataValue("_p95",elem.values));var noBox=false;if(typeof(dat[2])!="undefined"){if(dat[4]<dat[0]){dat=dat.reverse();pvc.log(" dataset "+elem.box_id+" repaired (_p95 was smaller than _p5)");}
if(dat[4]>dat[0]){sp.hScale=pv.Scale.linear(dat[0],dat[4]);}else{noBox=true;sp.hScale=pv.Scale.linear(dat[0]-1e-10,dat[0]+1e-10);}
sp.hScale.range(elem.left+rlMargin,elem.left+elem.width-rlMargin);var avLabel=""+dat[2];var i;for(i=0;i<dat.length;i++){dat[i]=sp.hScale(dat[i]);}
sp.bot=elem.bottom+elem.height/3;sp.top=elem.bottom+2*elem.height/3;sp.mid=(sp.top+sp.bot)/2;sp.textBottom=elem.bottom+margin;sp.textBottom=sp.bot-options.valueFontsize-1;var lwa=3;if(noBox){sp.vRules.push({"left":dat[0],"bottom":sp.bot,"lWidth":lwa,"height":sp.top-sp.bot});}else{sp.hRules.push({"left":dat[0],"width":dat[1]-dat[0],"lWidth":1,"bottom":sp.mid});sp.hRules.push({"left":dat[1],"width":dat[3]-dat[1],"lWidth":1,"bottom":sp.bot});sp.hRules.push({"left":dat[1],"width":dat[3]-dat[1],"lWidth":1,"bottom":sp.top});sp.hRules.push({"left":dat[3],"width":dat[4]-dat[3],"lWidth":1,"bottom":sp.mid});for(i=0;i<dat.length;i++){sp.vRules.push({"left":dat[i],"bottom":sp.bot,"lWidth":(i==2)?lwa:1,"height":sp.top-sp.bot});}}
sp.labels.push({left:dat[2],bottom:sp.textBottom,text:this.labelFixedDigits(avLabel),size:options.smValueFont,color:options.boxplotColor});}}},labelFixedDigits:function(value){if(typeof value=="string"){value=parseFloat(value);}
if(typeof value=="number"){var nd=this.chart.options.numDigits;value=value.toFixed(nd);}
return""+value;},addDataPoint:function(key){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(!elem.values.length){continue;}
var value=this.findDataValue(key,elem.values);if(typeof value=="undefined"){continue;}
var sp=elem.subplot;var theLeft=sp.hScale(value);var theColor="green";sp.marks.push({left:theLeft,bottom:sp.mid,color:theColor});sp.labels.push({left:theLeft,bottom:sp.textBottom,text:this.labelFixedDigits(value),size:options.valueFont,color:theColor});}},retrieveData:function(){var data=this.chart.data;var options=this.chart.options;var colLabels=data.getVisibleCategories();var selectors=data.getVisibleSeries();var values=data.getValues();var selMap={};var i;var numCols=values.length;for(var e in this.structArr){var elem=this.structArr[e];elem.values=[];for(i=0;i<numCols;i++){elem.values.push([]);}
selMap[elem.selector]=elem;}
var boxNotFound={};for(i in selectors){var box=selMap[selectors[i]];if(typeof(box)!="undefined"){for(var j in values){box.values[j].push(values[j][i]);}}else{boxNotFound[selectors[i]]=true;}}
for(var sel in boxNotFound){pvc.log("Could'nt find box for selector: "+sel);}
this.generateBoxPlots();var whitespaceQuote=new RegExp('[\\s\"\']+',"g");if(options.selectParam){var selPar=options.selectParam.replace(whitespaceQuote,'');if((selPar!="undefined")&&(selPar.length>0)&&(typeof window[selPar]!="undefined")){selPar=window[selPar];this.addDataPoint(selPar);}}},_createCore:function(){var myself=this;var options=this.chart.options;options.smValueFontsize=Math.round(0.6*options.valueFontsize);options.smValueFont=""+options.smValueFontsize+"px sans-serif";options.valueFont=""+options.valueFontsize+"px sans-serif";var topRuleOffs=options.topRuleOffset,botRuleOffs=options.botRuleOffset,leftRuleOffs=options.leftRuleOffset;this.innerWidth=this.width-leftRuleOffs-options.rightRuleOffset;this.innerHeight=this.height-topRuleOffs-botRuleOffs;this.botOffs=botRuleOffs;this.leftOffs=leftRuleOffs;this.retrieveStructure();this.retrieveData();var topMargin=options.headerFontsize+3;var rules=this.rules;var i;for(i=0;i<rules.length;i++){this.pvPanel.add(pv.Line).data(rules[i]).left(function(d){return d.x;}).bottom(function(d){return d.y;}).lineWidth(1).strokeStyle("black");}
this.pvDataTree=this.pvPanel.add(pv.Bar).data(myself.structArr).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).width(function(d){return d.width;}).fillStyle("green").add(pv.Bar).left(function(d){return d.left+options.border;}).bottom(function(d){return d.bottom+options.border;}).height(function(d){return d.height-options.border-topMargin;}).width(function(d){return d.width-2*options.border;}).fillStyle("white").add(pv.Label).text(function(d){return d.label;}).textAlign("center").left(function(d){return d.left+d.width/2;}).bottom(function(d){return d.bottom+d.height-options.headerFontsize-5+options.headerFontsize/5;}).font(""+options.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(i=0;i<this.structArr.length;i++){var box=this.structArr[i];this.pvPanel.add(pv.Rule).data(box.subplot.hRules).left(function(d){return d.left;}).width(function(d){return d.width;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Rule).data(box.subplot.vRules).left(function(d){return d.left;}).height(function(d){return d.height;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Dot).data(box.subplot.marks).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).fillStyle(function(d){return d.color;});this.pvPanel.add(pv.Label).data(box.subplot.labels).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).font(function(d){return d.size;}).text(function(d){return d.text;}).textAlign("center").textStyle(function(d){return d.color;});}
if(options.perpConnector){this.pvPanel.add(pv.Rule).data(myself.vRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).strokeStyle("black");this.pvPanel.add(pv.Rule).data(myself.hRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).width(function(d){return d.width;}).strokeStyle("black");}
this.extend(this.pvDataTree,"dataTree_");this.extend(this.pvPanel,"chart_");}});def.type('pvc.data.BoxplotChartTranslationOper',pvc.data.MatrixTranslationOper).init(function(chart,complexType,source,metadata,options){this._chart=chart;this.base(complexType,source,metadata,options);}).add({configureType:function(){var autoDimsReaders=[];function addRole(name,count){var visualRole=this._chart.visualRoles(name);if(!visualRole.isPreBound()){if(count==null){count=1;}
var dimGroupName=visualRole.defaultDimensionName.match(/^(.*?)(\*)?$/)[1],level=0;while(level<count){var dimName=pvc.data.DimensionType.dimensionGroupLevelName(dimGroupName,level++);if(!this.complexType.dimensions(dimName,{assertExists:false})){autoDimsReaders.push(dimName);}}}}
var catCount=def.get(this.options,'categoriesCount',1);if(!(catCount>=1)){catCount=1;}
addRole.call(this,'category',catCount);pvc.BoxplotChart.measureRolesNames.forEach(function(dimName){addRole.call(this,dimName);},this);autoDimsReaders.slice(0,this.freeVirtualItemSize());if(autoDimsReaders.length){this.defReader({names:autoDimsReaders});}},defDimensionType:function(dimName,dimSpec){var dimGroup=pvc.data.DimensionType.dimensionGroupName(dimName);switch(dimGroup){case'median':dimSpec=def.setUDefaults(dimSpec,'valueType',Number);break;case'percentil':dimSpec=def.setUDefaults(dimSpec,'valueType',Number,'label',"{0}% Percentil");break;}
return this.base(dimName,dimSpec);}});pvc.BoxplotChart=pvc.CategoricalAbstract.extend({legendSource:null,constructor:function(options){options.legend=false;this.base(options);this._axisType2RoleNamesMap.ortho=pvc.BoxplotChart.measureRolesNames;},_processOptionsCore:function(options){this.base.apply(this,arguments);options.secondAxis=options.showLines||options.showDots||options.showAreas;options.secondAxisIndependentScale=false;options.stacked=false;options.legend=false;},_getSeriesRoleSpec:function(){return null;},_hasDataPartRole:function(){return true;},_initVisualRoles:function(){this.base();var roleSpecBase={isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number};var rolesSpec=def.query([{name:'median',label:'Median',defaultDimensionName:'median',isRequired:true},{name:'percentil25',label:'25% Percentil',defaultDimensionName:'percentil25'},{name:'percentil75',label:'75% Percentil',defaultDimensionName:'percentil75'},{name:'percentil5',label:'5% Percentil',defaultDimensionName:'percentil5'},{name:'percentil95',label:'95% Percentil',defaultDimensionName:'percentil95'}]).object({name:function(info){return info.name;},value:function(info){return def.create(roleSpecBase,info);}});this._addVisualRoles(rolesSpec);},_createTranslation:function(complexType,translOptions){return new pvc.data.BoxplotChartTranslationOper(this,complexType,this.resultset,this.metadata,translOptions);},_isDataCellStacked:function(){return false;},_createMainContentPanel:function(parentPanel){if(pvc.debug>=3){pvc.log("Prerendering in boxplotChart");}
var options=this.options;var boxPanel=new pvc.BoxplotChartPanel(this,parentPanel,{orientation:options.orientation,boxSizeRatio:options.boxSizeRatio,maxBoxSize:options.maxBoxSize,boxplotColor:options.boxplotColor});if(options.secondAxis){if(pvc.debug>=3){pvc.log("Creating LineDotArea panel.");}
var linePanel=new pvc.LineDotAreaPanel(this,parentPanel,{orientation:options.orientation,stacked:false,showValues:!(options.compatVersion<=1)&&options.showValues,valuesAnchor:options.valuesAnchor,showLines:options.showLines,showDots:options.showDots,showAreas:options.showAreas,nullInterpolationMode:options.nullInterpolationMode});this._linePanel=linePanel;}
return boxPanel;},defaults:def.create(pvc.CategoricalAbstract.prototype.defaults,{boxplotColor:'darkgreen',boxSizeRatio:1/3,maxBoxSize:Infinity,showDots:false,showLines:false,showAreas:false,nullInterpolationMode:'none',showValues:false,valuesAnchor:'right'})},{measureRolesNames:['median','percentil25','percentil75','percentil5','percentil95']});pvc.BoxplotChartPanel=pvc.CartesianAbstractPanel.extend({anchor:'fill',_createCore:function(){this.base();var rootScene=this._buildScene();var a_bottom=this.isOrientationVertical()?"bottom":"left",a_left=this.anchorOrtho(a_bottom),a_width=this.anchorLength(a_bottom),a_height=this.anchorOrthoLength(a_bottom),strokeColor=pv.color(this.boxplotColor),boxFillColor=pv.color('limegreen');this.pvBoxPanel=this.pvPanel.add(pv.Panel).data(rootScene.childNodes)
[a_left](function(scene){var catVar=scene.vars.category;return catVar.x-catVar.width/2;})
[a_width](function(scene){return scene.vars.category.width;});function setupVRule(rule){rule.lock(a_left,function(){return this.pvMark.parent[a_width]()/2;}).override('defaultColor',function(type){if(type==='stroke'){return strokeColor;}});return rule;}
this.pvVRuleTop=setupVRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxVRule',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).intercept('visible',function(scene){return scene.vars.category.showVRuleAbove&&this.delegate(true);}).lock(a_bottom,function(scene){return scene.vars.category.vRuleAboveBottom;}).lock(a_height,function(scene){return scene.vars.category.vRuleAboveHeight;}).pvMark;this.pvVRuleBot=setupVRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxVRule',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).intercept('visible',function(scene){return scene.vars.category.showVRuleBelow&&this.delegate(true);}).lock(a_bottom,function(scene){return scene.vars.category.vRuleBelowBottom;}).lock(a_height,function(scene){return scene.vars.category.vRuleBelowHeight;}).pvMark;function setupHCateg(sign){sign.lock(a_left,function(scene){return scene.vars.category.boxLeft;}).lock(a_width,function(scene){return scene.vars.category.boxWidth;});return sign;}
this.pvBar=setupHCateg(new pvc.visual.Bar(this,this.pvBoxPanel,{extensionId:'boxBar',freePosition:true,normalStroke:true})).intercept('visible',function(scene){return scene.vars.category.showBox&&this.delegate(true);}).lock(a_bottom,function(scene){return scene.vars.category.boxBottom;}).lock(a_height,function(scene){return scene.vars.category.boxHeight;}).override('defaultColor',function(type){switch(type){case'fill':return boxFillColor;case'stroke':return strokeColor;}}).override('defaultStrokeWidth',def.fun.constant(1)).pvMark;function setupHRule(rule){setupHCateg(rule);rule.override('defaultColor',function(type){if(type==='stroke'){return strokeColor;}});return rule;}
this.pvHRule5=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxHRule5',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).intercept('visible',function(){return this.scene.vars.percentil5.value!=null&&this.delegate(true);}).lock(a_bottom,function(){return this.scene.vars.percentil5.position;}).pvMark;this.pvHRule95=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxHRule95',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).intercept('visible',function(){return this.scene.vars.percentil95.value!=null&&this.delegate(true);}).lock(a_bottom,function(){return this.scene.vars.percentil95.position;}).pvMark;this.pvHRule50=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxHRule50',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).intercept('visible',function(){return this.scene.vars.median.value!=null&&this.delegate(true);}).lock(a_bottom,function(){return this.scene.vars.median.position;}).override('defaultStrokeWidth',def.fun.constant(2)).pvMark;},applyExtensions:function(){this.base();this.extend(this.pvBoxPanel,"boxPanel_");this.extend(this.pvBoxPanel,"box_");this.extend(this.pvBar,"boxBar_");this.extend(this.hRule50,"boxHRule50_");this.extend(this.hRule5,"boxHRule5_");this.extend(this.hRule95,"boxHRule95_");this.extend(this.pvVRuleTop,"boxVRule_");this.extend(this.pvVRuleBot,"boxVRule_");},_renderInteractive:function(){this.pvBoxPanel.render();},_getSignums:function(){return[this.pvBar];},_buildScene:function(){var chart=this.chart,measureRolesDimNames=def.query(chart.measureVisualRoles()).object({name:function(role){return role.name;},value:function(role){return role.firstDimensionName();}}),visibleKeyArgs={visible:true,zeroIfNone:false},data=this._getVisibleData(),rootScene=new pvc.visual.Scene(null,{panel:this,group:data}),baseScale=chart.axes.base.scale,bandWidth=baseScale.range().band,boxWidth=Math.min(bandWidth*this.boxSizeRatio,this.maxBoxSize),orthoScale=chart.axes.ortho.scale;data.children().each(createCategScene,this);return rootScene;function createCategScene(categData){var categScene=new pvc.visual.Scene(rootScene,{group:categData}),vars=categScene.vars;var catVar=vars.category=new pvc.visual.ValueLabelVar(categData.value,categData.label);def.set(catVar,'group',categData,'x',baseScale(categData.value),'width',bandWidth,'boxWidth',boxWidth,'boxLeft',bandWidth/2-boxWidth/2);chart.measureVisualRoles().forEach(function(role){var dimName=measureRolesDimNames[role.name],svar;if(dimName){var dim=categData.dimensions(dimName),value=dim.sum(visibleKeyArgs);svar=new pvc.visual.ValueLabelVar(value,dim.format(value));svar.position=orthoScale(value);}else{svar=new pvc.visual.ValueLabelVar(null,"");svar.position=null;}
vars[role.name]=svar;});var has05=vars.percentil5.value!=null,has25=vars.percentil25.value!=null,has50=vars.median.value!=null,has75=vars.percentil75.value!=null,bottom,top;var show=has25||has75;if(show){bottom=has25?vars.percentil25.position:has50?vars.median.position:vars.percentil75.position;top=has75?vars.percentil75.position:has50?vars.median.position:vars.percentil25.position;show=(top!==bottom);if(show){catVar.boxBottom=bottom;catVar.boxHeight=top-bottom;}}
catVar.showBox=show;show=vars.percentil95.value!=null;if(show){bottom=has75?vars.percentil75.position:has50?vars.median.position:has25?vars.percentil25.position:has05?vars.percentil5.position:null;show=bottom!=null;if(show){catVar.vRuleAboveBottom=bottom;catVar.vRuleAboveHeight=vars.percentil95.position-bottom;}}
catVar.showVRuleAbove=show;show=has05;if(show){top=has25?vars.percentil25.position:has50?vars.median.position:has75?vars.percentil75.position:null;show=top!=null;if(show){bottom=vars.percentil5.position;catVar.vRuleBelowHeight=top-bottom;catVar.vRuleBelowBottom=bottom;}}
catVar.showVRuleBelow=show;}}});return pvc;});var ProtovisComponent=BaseComponent.extend({update:function(){if(this.parameters==undefined){this.parameters=[];};$("#"+this.htmlObject).empty();var myself=this;Dashboards.fetchData(this.chartDefinition,this.parameters,function(values){changedData=undefined;if((typeof(myself.postFetch)=='function')){changedData=myself.postFetch(values);};if(changedData!=undefined){values=changedData;};myself.render(values);});},render:function(values){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');var vis=new pv.Panel().canvas(this.htmlObject+"protovis").width(this.width).height(this.height);this.customfunction(vis,values);vis.root.render();},processdata:function(values){this.render(values);}});var BaseCccComponent=BaseComponent.extend({query:null,chart:null,exportChart:function(outputType,overrides){var _exportIframe=null;var myself=this;var buildChartDefinition=function(overrides){overrides=overrides||{};var chartDefinition={};var _params=Dashboards.objectToPropertiesArray($.extend({},Dashboards.propertiesArrayToObject(myself.parameters),overrides))
for(var param in _params){if(myself.parameters.hasOwnProperty(param)){var value;var name=myself.parameters[param][0];value=Dashboards.getParameterValue(myself.parameters[param][1]);if($.isArray(value)&&value.length==1&&(''+value[0]).indexOf(';')>=0){value=doCsvQuoting(value[0],';');}
if(typeof value=='function')value=value();chartDefinition['param'+name]=value;}}
var scriptName=myself.name.replace(/render_/,"");chartDefinition.script=("/"+Dashboards.context.solution+"/"+Dashboards.context.path+"/"+scriptName+".js").replace(/\/+/g,'/');chartDefinition.attachmentName=scriptName;return chartDefinition;};var chartDefinition=buildChartDefinition(overrides);chartDefinition.outputType=outputType;_exportIframe=_exportIframe||$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src="../cgg/draw?"+$.param(chartDefinition);_exportIframe.appendTo($('body'));}})
var CccComponent=BaseCccComponent.extend({query:null,chart:null,update:function(){if(this.parameters==undefined){this.parameters=[];}
var ph=$("#"+this.htmlObject).empty();var myself=this;if(typeof(this.chartDefinition.width)==="undefined")
this.chartDefinition.width=ph.width();if(typeof(this.chartDefinition.height)==="undefined")
this.chartDefinition.height=ph.height();if(Modernizr!=undefined&&Modernizr.svg){this.renderChart();}else{pv.listenForPageLoad(function(){myself.renderChart();});}},renderChart:function(){var myself=this;if(this.chartDefinition.dataAccessId||myself.chartDefinition.query){this.query=new Query(this.chartDefinition);this.query.fetchData(this.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);$("#"+this.htmlObject).append('<div id="'+myself.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
myself.render(values);});}
else if(this.valuesArray!=undefined){this.render(this.valuesArray);}
else{this.render();}},render:function(values){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);if(arguments.length>0){this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});}
this.chart.render();}});var CccComponent2=BaseCccComponent.extend({query:null,sQuery:null,chart:null,update:function(){var dataQuery=null,sDataQuery=null;if(this.parameters==undefined){this.parameters=[];};$("#"+this.htmlObject).empty();var myself=this;this.query=new Query(this.chartDefinition);this.sQuery=new Query({path:this.chartDefinition.path,dataAccessId:this.chartDefinition.structDatasource});var executed=false;var execComponent=function(){if((dataQuery!=null)&&(sDataQuery!=null)&&!executed){myself.render(dataQuery,sDataQuery);executed=true;}};pv.listenForPageLoad(function(){myself.query.fetchData(myself.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
dataQuery=values;execComponent();});});pv.listenForPageLoad(function(){myself.sQuery.fetchData(myself.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
sDataQuery=values;execComponent();});});},render:function(values,sValues){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});this.chart.setStructData(sValues)
this.chart.render();}});var CccDotChartComponent=CccComponent.extend({cccType:pvc.DotChart});var CccLineChartComponent=CccComponent.extend({cccType:pvc.LineChart});var CccStackedLineChartComponent=CccComponent.extend({cccType:pvc.StackedLineChart});var CccStackedAreaChartComponent=CccComponent.extend({cccType:pvc.StackedAreaChart});var CccBarChartComponent=CccComponent.extend({cccType:pvc.BarChart});var CccPieChartComponent=CccComponent.extend({cccType:pvc.PieChart});var CccHeatGridChartComponent=CccComponent.extend({cccType:pvc.HeatGridChart});var CccBulletChartComponent=CccComponent.extend({cccType:pvc.BulletChart});var CccWaterfallChartComponent=CccComponent.extend({cccType:pvc.WaterfallChart});var CccMetricDotChartComponent=CccComponent.extend({cccType:pvc.MetricDotChart});var CccMetricLineChartComponent=CccComponent.extend({cccType:pvc.MetricLineChart});var CccParCoordComponent=CccComponent.extend({cccType:pvc.ParallelCoordinates});var CccDataTreeComponent=CccComponent2.extend({cccType:pvc.DataTree});var CccBoxplotChartComponent=CccComponent.extend({cccType:pvc.BoxplotChart});var SimpleAutoCompleteComponent=BaseComponent.extend({ph:undefined,completionCallback:undefined,update:function(){var myself=this;this.ph=$("#"+this.htmlObject).empty();this.input=$("<input type='text'>").appendTo(this.ph);this.query=new Query(this.queryDefinition);var myself=this;this.input.autocomplete({source:function(obj,callback){return myself.triggerQuery(obj.term,callback);}});this.input.change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});},handleQuery:function(callback){var myself=this;return function(values){if(typeof myself.postFetch=="function"){var changedValues=myself.postFetch(values);values=changedValues||values;};var results=values.resultset.map(function(e){return e[0];});callback(results);}},triggerQuery:function(term,callback){var params=$.extend([],this.parameters);var termVal="'"+term+"'";if(this.searchParam){params.push([this.searchParam,termVal]);}
else if(params.length>0){this.parameters[0][1]=termVal;}
if(term.length>=this.minTextLength){this.query.fetchData(params,this.handleQuery(callback));}else{callback([]);}},getValue:function(){return this.input.val();}});(function(){var $,Chosen,get_side_border_padding,root;var __bind=function(fn,me){return function(){return fn.apply(me,arguments);};};root=this;$=jQuery;$.fn.extend({chosen:function(data,options){if($.browser==="msie"&&($.browser.version==="6.0"||$.browser.version==="7.0")){return this;}
return $(this).each(function(input_field){if(!($(this)).hasClass("chzn-done")){return new Chosen(this,data,options);}});}});Chosen=(function(){function Chosen(elmn){this.set_default_values();this.form_field=elmn;this.form_field_jq=$(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done");}
Chosen.prototype.set_default_values=function(){this.click_test_action=__bind(function(evt){return this.test_active_click(evt);},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;return this.choices=0;};Chosen.prototype.set_up_html=function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,'_'):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.width();this.default_text=this.form_field_jq.data('placeholder')?this.form_field_jq.data('placeholder'):this.default_text_default;container_div=$("<div />",{id:this.container_id,"class":"chzn-container "+(this.is_rtl?'chzn-rtl':''),style:'width: '+this.f_width+'px;'});if(this.is_multiple){container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>');}else{container_div.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');}
this.form_field_jq.hide().after(container_div);this.container=$('#'+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));this.dropdown=this.container.find('div.chzn-drop').first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({"width":dd_width+"px","top":dd_top+"px"});this.search_field=this.container.find('input').first();this.search_results=this.container.find('ul.chzn-results').first();this.search_field_scale();this.search_no_results=this.container.find('li.no-results').first();if(this.is_multiple){this.search_choices=this.container.find('ul.chzn-choices').first();this.search_container=this.container.find('li.search-field').first();}else{this.search_container=this.container.find('div.chzn-search').first();this.selected_item=this.container.find('.chzn-single').first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({"width":sf_width+"px"});}
this.results_build();return this.set_tab_index();};Chosen.prototype.register_observers=function(){this.container.mousedown(__bind(function(evt){return this.container_mousedown(evt);},this));this.container.mouseenter(__bind(function(evt){return this.mouse_enter(evt);},this));this.container.mouseleave(__bind(function(evt){return this.mouse_leave(evt);},this));this.search_results.mouseup(__bind(function(evt){return this.search_results_mouseup(evt);},this));this.search_results.mouseover(__bind(function(evt){return this.search_results_mouseover(evt);},this));this.search_results.mouseout(__bind(function(evt){return this.search_results_mouseout(evt);},this));this.form_field_jq.bind("liszt:updated",__bind(function(evt){return this.results_update_field(evt);},this));this.search_field.blur(__bind(function(evt){return this.input_blur(evt);},this));this.search_field.keyup(__bind(function(evt){return this.keyup_checker(evt);},this));this.search_field.keydown(__bind(function(evt){return this.keydown_checker(evt);},this));if(this.is_multiple){this.search_choices.click(__bind(function(evt){return this.choices_click(evt);},this));return this.search_field.focus(__bind(function(evt){return this.input_focus(evt);},this));}else{return this.selected_item.focus(__bind(function(evt){return this.activate_field(evt);},this));}};Chosen.prototype.container_mousedown=function(evt){if(evt&&evt.type==="mousedown"){evt.stopPropagation();}
if(!this.pending_destroy_click){if(!this.active_field){if(this.is_multiple){this.search_field.val("");}
$(document).click(this.click_test_action);this.results_show();}else if(!this.is_multiple&&evt&&($(evt.target)===this.selected_item||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();this.results_toggle();}
return this.activate_field();}else{return this.pending_destroy_click=false;}};Chosen.prototype.mouse_enter=function(){return this.mouse_on_container=true;};Chosen.prototype.mouse_leave=function(){return this.mouse_on_container=false;};Chosen.prototype.input_focus=function(evt){if(!this.active_field){return setTimeout((__bind(function(){return this.container_mousedown();},this)),50);}};Chosen.prototype.input_blur=function(evt){if(!this.mouse_on_container){this.active_field=false;return setTimeout((__bind(function(){return this.blur_test();},this)),100);}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field();}};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1);}
this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale();};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1);}
this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus();};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents('#'+this.container_id).length){return this.active_field=true;}else{return this.close_field();}};Chosen.prototype.results_build=function(){var content,data,startTime,_i,_len,_ref;startTime=new Date();this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0;}else if(!this.is_multiple){this.selected_item.find("span").text(this.default_text);}
content='';_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data);}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.selected_item.find("span").text(data.text);}}}
this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false;};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+'</li>';}else{return"";}};Chosen.prototype.result_add_option=function(option){var classes;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push("result-selected");}
if(option.group_array_index!=null){classes.push("group-option");}
return'<li id="'+option.dom_id+'" class="'+classes.join(' ')+'">'+option.html+'</li>';}else{return"";}};Chosen.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build();};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop((high_bottom-maxHeight)>0?high_bottom-maxHeight:0);}else if(high_top<visible_top){return this.search_results.scrollTop(high_top);}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted");}
return this.result_highlight=null;};Chosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide();}else{return this.results_show();}};Chosen.prototype.results_show=function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected);}}
dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({"top":dd_top+"px","left":0});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results();};Chosen.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop");}
this.result_clear_highlight();this.dropdown.css({"left":"-9000px"});return this.results_showing=false;};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",ti);}else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1);}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default");}else{this.search_field.val("");return this.search_field.removeClass("default");}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt);}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target);}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents('.active-result').first())){return this.result_clear_highlight();}};Chosen.prototype.choices_click=function(evt){evt.preventDefault();if(this.active_field&&!($(evt.target).hasClass("search-choice"||$(evt.target).parents('.search-choice').first))&&!this.results_showing){return this.results_show();}};Chosen.prototype.choice_build=function(item){var choice_id,link;choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$('#'+choice_id).find("a").first();return link.click(__bind(function(evt){return this.choice_destroy_link_click(evt);},this));};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();this.pending_destroy_click=true;return this.choice_destroy($(evt.target));};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide();}
this.result_deselect(link.attr("rel"));return link.parents('li').first().remove();};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();high.addClass("result-selected");if(this.is_multiple){this.result_deactivate(high);}else{this.result_single_selected=high;}
position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple){this.choice_build(item);}else{this.selected_item.find("span").first().text(item.text);}
if(!(evt.metaKey&&this.is_multiple)){this.results_hide();}
this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale();}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result").show();};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result").hide();};Chosen.prototype.result_deselect=function(pos){var result,result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale();};Chosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results();}else{return this.results_show();}};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,result_id,results,searchText,startTime,startpos,text,zregex,_i,_j,_len,_len2,_ref;startTime=new Date();this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$('<div/>').text($.trim(this.search_field.val())).html();regex=new RegExp('^'+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty){if(option.group){$('#'+option.dom_id).hide();}else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;if(regex.test(option.html)){found=true;results+=1;}else if(option.html.indexOf(" ")>=0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1;}}}}
if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+'</em>'+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}else{text=option.html;}
if($("#"+result_id).html!==text){$("#"+result_id).html(text);}
this.result_activate($("#"+result_id));if(option.group_array_index!=null){$("#"+this.results_data[option.group_array_index].dom_id).show();}}else{if(this.result_highlight&&result_id===this.result_highlight.attr('id')){this.result_clear_highlight();}
this.result_deactivate($("#"+result_id));}}}}
if(results<1&&searchText.length){return this.no_results(searchText);}else{return this.winnow_results_set_highlight();}};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);_results.push(li.hasClass("group-result")?li.show():!this.is_multiple||!li.hasClass("result-selected")?this.result_activate(li):void 0);}
return _results;};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high);}}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">No results match "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html);};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove();};Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active){this.result_do_highlight($(first_active));}}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){this.result_do_highlight(next_sib);}}
if(!this.results_showing){return this.results_show();}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show();}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first());}else{if(this.choices>0){this.results_hide();}
return this.result_clear_highlight();}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke();}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus");}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus");}
return this.pending_backstroke=null;};Chosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search();}
break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt);}
break;case 27:if(this.results_showing){return this.results_hide();}
break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search();}};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke();}
switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break;}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";";}
div=$('<div />',{'style':style_block});div.text(this.search_field.val());$('body').append(div);w=div.width()+25;div.remove();if(w>this.f_width-10){w=this.f_width-10;}
this.search_field.css({'width':w+'px'});dd_top=this.container.height();return this.dropdown.css({"top":dd_top+"px"});}};Chosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id;};Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0){string+=this.generate_random_char();}
return string;};Chosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1);};return Chosen;})();get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width();};root.get_side_border_padding=get_side_border_padding;}).call(this);(function(){var SelectParser;SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[];}
SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP"){return this.add_group(child);}else{return this.add_option(child);}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled));}
return _results;};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
return this.options_index+=1;}};return SelectParser;})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child);}
return parser.parsed;};this.SelectParser=SelectParser;}).call(this);